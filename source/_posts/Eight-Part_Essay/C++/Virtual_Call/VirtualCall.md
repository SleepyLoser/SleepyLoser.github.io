---
title: 虚调用
top_img: '111840835_p0.png'
cover: '122532836_p0.png'
categories: 
    - 八股文
      - C++
tags: 
    - C++
---

## 虚调用的定义

* `虚调用` 是相对于 `实调用` 而言，它的本质是 `动态联编` 。
* 在发生函数调用的时候，如果函数的入口地址是**在编译阶段静态确定的**，就是是 `实调用` 。
* 如果函数的入口地址要**在运行时通过查询虚函数表的方式获得**，就是 `虚调用` 。

## `虚函数` 的几种 `实调用` 的情形

### 不通过指针或者引用调用虚函数

* `虚调用` 不能简单的理解成 “对虚函数的调用” ，因为**对虚函数的调用很有可能是实调用**。

``` CPP
#include <iostream>
using namespace std;

class A 
{
public:
    virtual void show() 
    {
        cout<<"In A"<<endl;
    }
};

class B : public A 
{
public:
    void show() 
    {
        cout<<"In B"<<endl;
    }
};

void func(A a) 
{
    a.show();
}

int main() 
{
    B b;
    func(b);
}
```

* 上述程序运行输出结果是：`In A`
* 在函数 `func()` 中，虽然在 `class A` 中函数 `show()` 被定义为虚函数，但是由于 `a` 是类 `A` 的一个实例，而不是指向类 `A` 对象的指针或者引用，所以函数调用 `a.show()` 是实调用，**函数的入口地址是在编译阶段静态决定的**。
* 函数调用 `func(b)` 的执行过程是这样的：先由对象 `b` 通过类 `A` 的赋值构造函数，产生一个类 `A` 的对象作为函数 `func()` 的实参进入函数体。在函数体内，`a` 是一个 “纯粹” 的类 `A` 的对象，与类型 `B` 毫无关系，所以 `a.show()` 是实调用。

### 构造函数和析构函数中调用虚函数

* 在构造函数和析构函数中调用虚函数，对虚函数的调用实际上是实调用。这是虚函数被“实调用”的另一个例子。
