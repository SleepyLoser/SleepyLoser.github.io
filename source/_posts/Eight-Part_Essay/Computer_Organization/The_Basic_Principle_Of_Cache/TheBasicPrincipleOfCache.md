---
title: Cache的基本原理
top_img: '116763500_p1.jpg'
cover: '101048953_p0.png'
categories: 
    - 八股文
      - 计算机组成原理
tags: 
    - Cache
    - 计算机组成原理
---

## 为什么需要Cache

### 程序是如何运行起来的

* 程序是运行在 RAM（随机存储器） 之中，我们称之为 main memory（主存）。当我们需要运行一个进程的时候，首先会从磁盘设备（例如，eMMC、UFS、SSD等）中将可执行程序load到主存中，然后开始执行。
* 在CPU内部存在一堆的通用寄存器（register）。如果 CPU 需要将一个变量（假设地址是A）加1，一般分为以下3个步骤：
  1. CPU 从主存中读取地址 A 的数据到内部通用寄存器 x0（ARM64架构的通用寄存器之一）。
  2. 通用寄存器 x0 加1。
  3. CPU 将通用寄存器 x0 的值写入主存。

<img src="变量加一过程.png" alt="变量加一过程" style="zoom:100%;">

* 其实现实中，CPU通用寄存器的速度（< 1ns）和主存（~ 65ns）之间存在着太大的差异。
* 因此，上面举例的3个步骤中，步骤1和步骤3实际上速度很慢。当CPU试图从主存中 Load / Store 操作时，由于主存的速度限制，CPU不得不等待这漫长的65ns时间。
* 如果我们采用更快材料制作更快速度的主存，并且拥有几乎差不多的容量, 其成本将会大幅度上升。我们试图提升主存的速度和容量，又期望其成本很低，这就有点难为人了。
* 因此，我们有一种折中的方法，那就是制作一块速度极快但是容量极小的存储设备。那么其成本也不会太高。这块存储设备我们称之为**Cache Memory**。
* 在硬件上，我们将Cache放置在CPU和主存之间，作为主存数据的缓存。
* 当CPU试图从主存中 Load / Store数据的时候，CPU会首先从 Cache 中查找对应地址的数据是否缓存在 Cache 中。如果其数据缓存在 Cache 中，直接从 Cache 中拿到数据并返回给CPU。

<img src="变量加一过程(2).png" alt="变量加一过程(2)" style="zoom:100%;">

* CPU和主存之间直接数据传输的方式转变成 CPU 和 Cache 之间直接数据传输。Cache 负责和主存之间数据传输。

## 多级Cache存储结构
