---
title: 三维数学
top_img: '84603466_p0.jpg'
cover: '93921218_p0.jpg'
categories: 
    - Unity
      - 数学
tags: 
    - 数学
    - 图形学
---

## 如何判断一个点在三角形（矩形、扇形）内

### 向量点乘（Dot Product）

* 即相应元素的乘积的和：Vector1(x1, y1) · Vector2(x2, y2) = x1 · x2 + y1 · y2; **注意结果不是一个向量，而是一个标量（Scalar）**
* A · B = |A||B|Cos(θ)。θ是向量A和向量B之间的夹角，这里|A|我们称为向量A的模(norm)，也就是A的长度， 在二维空间中就是|A| = sqrt(x ^ 2 + y ^ 2)。这样我们就和容易计算两条线的夹角：Cos(θ) = A·B / (|A||B|)
* 这可以告诉我们如果点乘的结果（点积）**为0的话就表示这两个向量垂直**。当两向量平行时，点积有最大值。另外，点乘运算不仅限于2维空间，他可以推广到任意维空间。

### 叉乘（cross product）

<img src="叉乘.png" alt="叉乘" style="zoom:100%;">

* 二维空间中的叉乘是：Vector1(x1, y1) `x` Vector2(x2, y2) = x1 · y2 - y1 · x2。看起来像个标量，事实上叉乘的结果是个向量，方向在z轴上。**上述结果是它的模**。
* 在二维空间里，让我们暂时忽略它的方向，将结果看成一个向量，那么这个结果类似于上述的点积，我们有：A `x` B = |A||B|Sin(θ)
* 然而角度 θ 和上面点乘的角度有一点点不同，**它是有正负的**，是指从A到B的角度。
* 另外还有一个有用的特征那就是**叉积的绝对值就是A和B为两边所形成的平行四边形的面积**。也就是AB所包围三角形面积的两倍。
* 在**三维空间**里，A和B的叉乘公式为：

<img src="叉乘公式.png" alt="叉乘公式" style="zoom:100%;">

* 其中 i = (1, 0, 0); j = (0, 1, 0); k = (0, 0, 1)。
* 根据i、j、k间关系，有：

<img src="叉乘公式(2).png" alt="叉乘公式(2)" style="zoom:100%;">

* 向量A和向量B的外积结果是一个向量，有个更通俗易懂的叫法是**法向量**，该向量垂直于a和b向量构成的平面。

### 如何判断？

<img src="判断点在三角形内.png" alt="判断点在三角形内" style="zoom:100%;">

#### 面积法

* 如图：S▲ABP + S▲APC + S▲BPC = S▲ABC
* 利用叉乘求出各三角形面积即可（叉积的绝对值就是A和B为两边所形成的平行四边形的面积）

#### 叉乘法

* 首先看一下这个问题，如何判断某两个点在某条直线的同一侧

<img src="判断两点是否在同一侧.png" alt="判断两点是否在同一侧" style="zoom:100%;">

* 根据向量的叉乘以及右手螺旋定则，AB `x` AM 的方向为向外指出屏幕，AB `x` AN 也是向外指出屏幕，但 AB `x` AO 的方向是向内指向屏幕，因此 M、N 在直线 AB 的同侧，M、O在直线AB的另一侧。
* 实际计算时，只需要考虑叉积的数值正负。假设以上各点坐标为A(0,0), B(4,0), M(1,2), N(3,4), O(3,-4)， 则：
  1. AB `x` AM = (4, 0) `x` (1, 2) = 4 · 2 - 0 · 1 = 8
  2. AB `x` AN = (4, 0) `x` (3, 4) = 4 · 4 – 0 · 3 = 16
  3. AB `x` AO = (4, 0) `x` (3, -4) = 4 · -4 – 0 · 3 = –16
* 由上面的数值可知，可以根据数值的正负判断叉乘后向量的方向。
* 回到原来的问题上。
* 沿逆时针方向，三角形两两顶点构成三个向量，比如AB,BC,CA，分别用这三个向量与起点和P的交点构成的向量求叉乘，如ABxAP, BCxBP, CAxCP
* 由右手定则，如果三个结果都是正的，说明这个点都在向量的`左边`，可以推导得出这个点在三角形内。否则只要有一个是负数，就说明在`右边`，在三角形外了。

## 如何判断一条射线是否与一个三角形相交

* **传统方法**：
  1. 首先判断射线是否与三角形所在的平面相交，如果相交求出交点，进而判断交点是否在三角形内；如果不相交或者交点不在三角形之内，则射线一定不与三角形相交。
* **Moller-Trumbore 算法**：

## 如何判断两个三角形是否相交

* 如果两个三角形相交，必定**至少其中一个**三角形的**一条边**穿过了另一个三角形的内部；
* 把边当作光线去跟另一个三角形求交。如果三条边只要有一条边跟三角形有交点，即可判断两三角形相交，当然关键是要判断计算出来的 t 是否合理，是否位于边长范围之内。
