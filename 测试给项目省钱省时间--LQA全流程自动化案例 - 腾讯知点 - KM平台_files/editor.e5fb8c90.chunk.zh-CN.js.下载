(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{1692:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return d}));var r=a(0),n=a.n(r),i=a(3),o=a.n(i),s=function(){function e(){n()(this,e)}return o()(e,[{key:"getWrapOpDones",value:function(e){return e}},{key:"getWrapOps",value:function(e){return e}},{key:"getOpsFromWraper",value:function(e,t){}},{key:"getOpsDoneFromWraper",value:function(e,t){}},{key:"transOpFmla",value:function(){return!1}},{key:"decompileOpsFmla",value:function(){return!1}},{key:"getCmdMainId",value:function(e){console.error("pure virtual func")}},{key:"updateShapeIdxPath",value:function(e){}},{key:"OpTrsOp",value:function(){console.error("pure virtual func")}},{key:"reverse",value:function(e){console.error("pure virtual func")}},{key:"trans",value:function(e,t){var a=this.getWrapOpDones(e),r=this.getWrapOps(t),n=[];n[r.length-1]=0,n=n.fill(0);for(var i=!1,o=!1,s=0;s<r.length;++s)for(var l=n[s];l<a.length;++l){var c=[],d=[],p=this.transOpFmla(a[l],r[s]);if(this.OpTrsOp(a[l],r[s],d,this.svtMap),this.OpTrsOp(r[s],a[l],c,this.mstMap),d.length>0){if(r.splice.apply(r,[s,1].concat(d)),d.length>1){var u=[s+1,0],h=l+Math.max(c.length,1);u[d.length]=h,u=u.fill(h,2),n.splice.apply(n,u)}i=!0}c.length>0&&(a.splice.apply(a,[l,1].concat(c)),l+=c.length-1,o=!0),p&&this.decompileOpsFmla(d)&&(i=!0)}return i&&this.getOpsFromWraper(r,t),o&&this.getOpsDoneFromWraper(a,e),i}},{key:"trans_Reverser",value:function(e,t){var a=this.reverse(e);return!(a.length<=0)&&this.trans(a,t)}},{key:"trans_othersReverser",value:function(e,t){var a=this.reverse(e);return!(a.length<=0)&&this.trans(a,t)}},{key:"getLocalCmds",value:function(e){var t=[];return e?(e.forEach((function(e){t.push(e.localCommand)})),t):t}},{key:"getMainOps",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={};return e?(e.forEach((function(e){if(!(t&&e.isVerOfCurExec||a&&e.isSelf))for(var n in e.mainOperstes)if(e.mainOperstes.hasOwnProperty(n)){var i=e.mainOperstes[n];i.length<=0||(null==n&&(n=0),r[n]=n in r?r[n].concat(i):i)}})),r):r}}]),e}(),l=function(e){var t=[],a=[],r=e.applyVersions.length,n=e.resetBaseVersions.length;if(0===r||0===n)return e;for(var i=0;i<r;++i)for(var o=e.applyVersions[i],s=0;s<n;++s){var l=e.resetBaseVersions[s];if(o.bornTaskVer===l.bornTaskVer||o.bornTaskVer===l.taskVer){a[i]=!0,t[s]=!0;break}}if(0===t.length&&0===a.length)return e;var c={};c.localVersions=e.localVersions,c.localCommitedVersion=e.localCommitedVersion,c.resetBaseVersions=[],c.applyVersions=[],c.shapePictureChanged=e.shapePictureChanged;for(var d=0;d<r;++d)!0!==a[d]&&c.applyVersions.push(e.applyVersions[d]);for(var p=0;p<n;++p)!0!==t[p]&&c.resetBaseVersions.push(e.resetBaseVersions[p]);return c},c=function(e,t){var a=t.getLocalCmds(e.localVersions),r=t.getLocalCmds(e.localCommitedVersion);if(0===a.length)return a;e=l(e);var n={};return n.trans=t.getMainOps(e.applyVersions,!0),n.trans_Reverser=t.getMainOps(e.resetBaseVersions,!1),n.trans_othersReverser=t.getMainOps(e.resetBaseVersions,!0),["trans_othersReverser","trans"].forEach((function(e){var a=n[e],i=t[e];if(a)for(var o=0;o<r.length;++o){var s=[r[o]];i.call(t,a,s)&&(r.splice.apply(r,[o,1].concat(s)),o+=s.length-1)}})),["trans_Reverser","trans"].forEach((function(e){for(var r=n[e],i=t[e],o=0;o<a.length;++o){var s=r[t.getCmdMainId(a[o])];if(s){var l=[a[o]];i.call(t,s,l)&&(a.splice.apply(a,[o,1].concat(l)),o+=l.length-1)}}})),t.updateShapeIdxPath(a),a},d=function(e,t,a,r){if(!e||0===a.length)return!1;e=l(e);var n={};n.trans=t.getMainOps(e.applyVersions,!1,r),n.trans_Reverser=t.getMainOps(e.resetBaseVersions,!1,r);var i=!1;return["trans_Reverser","trans"].forEach((function(e){for(var r=t[e],o=0;o<a.length;++o){var s=n[e][t.getCmdMainId(a[o])];if(s){var l=[a[o]];r.call(t,s,l)&&(i=!0,a.splice.apply(a,[o,1].concat(l)),o+=l.length-1)}}})),i}},4654:function(e,t,a){"use strict";a.r(t),a.d(t,"selection",(function(){return hn})),a.d(t,"format_applyer",(function(){return fn})),a.d(t,"createModifierByName",(function(){return Ia}));var r=a(43),n=a.n(r),i=a(0),o=a.n(i),s=a(3),l=a.n(s),c=a(25),d=a.n(c),p=a(42),u=a.n(p),h=a(150),f=a.n(h),m=a(1692),v=a(696),g=a(268),y=a(158),T=a(167),C=a(315),_="default",b="shapes",S="custom";function k(e,t){if(e instanceof Array&&t instanceof Array&&e.length===t.length){for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}return!1}function P(e){return"number"==typeof e&&e>=0}function w(e){return-1!==e.startRow&&-1!==e.endRow&&-1!==e.startCol&&-1!==e.endCol&&!(e.startRow>=e.endRow||e.startCol>=e.endCol)}var x=function(){function e(t){o()(this,e),this.state=t.state,this.category=null==t.category?"slides":t.category,this.layerType=null==t.layerType?y.WppLayerType.WppLayerNormalSlide:t.layerType,this.rangePropNames=["slideIdx","shapePath","cellRange","gcp","ccp","sPath"];for(var a=0;a<this.rangePropNames.length;a++){var r=this.rangePropNames[a];this[r]=t[r]}}return l()(e,[{key:"range",value:function(){for(var e={category:this.category,layerType:this.layerType,state:this.state},t=0;t<this.rangePropNames.length;t++){var a=this.rangePropNames[t],r=this[a];null!=r&&(e[a]=r)}return e}}]),e}(),I=4,R=function(e){function t(e,a){o()(this,t);var r=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a));return r.name=e,r.param=Object.assign({},a),r._props={},r}return u()(t,e),l()(t,[{key:"setWrapper",value:function(e){this._wrapper=e}},{key:"getName",value:function(){return this.name}},{key:"getParam",value:function(){var e=this.range();return Object.assign({},this.param,e)}},{key:"getOrgParam",value:function(){return this._orgParam}},{key:"clone",value:function(){var e=this.getName(),a=this.getParam(),r=new t(e,Object(g.a)(a));return r._orgParam=this._orgParam,r._mergeType=this._mergeType,r._mergeFunc=this._mergeFunc,r._gid=this._gid,r._wrapper=this._wrapper,r._props=Object.assign({},this._props),r}},{key:"setProp",value:function(e,t){this._props[e]=t}},{key:"getProp",value:function(e){return this._props[e]}},{key:"setMerger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._mergeType=e,this._mergeFunc=t}},{key:"bInvalidRange",value:function(){return!!this.param._bInvalidRange}},{key:"setInvalidRange",value:function(e,t){var a=this.param._bInvalidRange||0;a&=~e,t&&(this.param._bInvalidRange=a|e)}},{key:"getSlideIdx",value:function(){return this.slideIdx}},{key:"setSlideIdx",value:function(e){this.slideIdx=e}},{key:"isSameSlideWith",value:function(e){return this.category===e.category&&this.layerType===e.layerType&&this.slideIdx===e.slideIdx}},{key:"getShapePath",value:function(){return this.shapePath?this.shapePath.slice(0):[]}},{key:"isSameShapeWith",value:function(e){return!!this.isSameSlideWith(e)&&k(this.getShapePath(),e.getShapePath())}},{key:"isParentShapeAncestorOf",value:function(e){if(this.isSameSlideWith(e)){var t=this.getShapePath(),a=e.getShapePath();if(t.length>0&&t.length<=a.length){for(var r=t.length-1,n=0;n<r;n++)if(t[n]!==a[n])return!1;return!0}}return!1}},{key:"isSameCellRange",value:function(e,t){return e&&t?e.startRow===t.startRow&&e.startCol===t.startCol&&e.endRow===t.endRow&&e.endCol===t.endCol:!e&&!t}},{key:"isSameTextStreamWith",value:function(e){return this.isSameShapeWith(e)&&this.isSameCellRange(this.cellRange,e.cellRange)}},{key:"isSameShapePath",value:function(e,t){return k(e,t)}},{key:"_isValidObjectPath",value:function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++)if(!P(e[t]))return!1;return!0}}},{key:"isValid",value:function(){switch(null==this.state&&console.error("Invalid OpItem, implement _toSelectionRange function in Wrapper class."),this.state){case T.SelectType.select_none:return!1;case T.SelectType.select_slide:return P(this.slideIdx);case T.SelectType.select_shape:case T.SelectType.select_multi_shape:case T.SelectType.select_table:return P(this.slideIdx)&&this._isValidObjectPath(this.shapePath);case T.SelectType.select_text:var e=P(this.slideIdx)&&this._isValidObjectPath(this.shapePath);return null!=this.cellRange&&(e=e&&w(this.cellRange)),e=e&&P(this.gcp)&&P(this.ccp),e;case T.SelectType.select_cell:case T.SelectType.select_multi_cell:var t=P(this.slideIdx)&&this._isValidObjectPath(this.shapePath);return this.cellRange&&(t=t&&w(this.cellRange)),t;case T.SelectType.select_multi_animation:return P(this.slideIdx)&&this._isValidObjectPath(this.sPath)}return!1}},{key:"isNeedSplitPara",value:function(){return this.gcp>=0&&this.ccp>=0&&null==this.sPath}},{key:"wrapper",get:function(){return this._wrapper}},{key:"orgWrapper",get:function(){for(var e=this._wrapper;e&&e.parent;)e=e.parent;return e}}]),t}(x),O=function(){function e(t,a,r){o()(this,e),this.gid=t.gid?t.gid:Object(C.a)(),this.op=t,this.pres=a,this.selection=r,this._props={}}return l()(e,[{key:"clone",value:function(){var e=new this.constructor(JSON.parse(JSON.stringify(this.op)),this.pres,this.selection);return e._factory=this._factory,e._props=Object.assign({},this._props),e.parent=this.parent,e}},{key:"wrapper",value:function(e){var t=this._createWrapper(e,this.pres,this.selection);return t._factory=this._factory,t._props=Object.assign({},this._props),t.parent=this.parent,t}},{key:"setParent",value:function(e){this.parent=e}},{key:"isOnlyServerCmd",value:function(){return this.op.param.bOnlyServerCmd}},{key:"getWrapperDepth",value:function(){for(var e=0,t=this.parent;t;)e+=1,t=t.parent;return e}},{key:"setCommandProp",value:function(e,t){this._props[e]=t}},{key:"getCommandProp",value:function(e){return this._props[e]}},{key:"createCvCmdsForReverse",value:function(e){var t=e.param.cvCmds;if(!t)return null;for(var a=[],r=t.length-1;r>=0;--r){var n=t[r];n.gid=this.gid;var i=this._createWrapper(n,this.pres,this.selection);if(i instanceof Array)for(var o=0;o<i.length;o++)a.push(i[r].op);else a.push(i.op)}return a}},{key:"_createWrapper",value:function(e,t,a){var r=this._factory.get(e);return r.pres=t,r.selection=a,r}},{key:"reverse",value:function(){console.error("Not found reverse function for op:",this.op.name);var e=Object(g.a)(this.op);return e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"category",value:function(){var e=this.collectItems();return e.length>0?e[0].category:"slides"}},{key:"layerType",value:function(){var e=this.collectItems();return e.length>0?e[0].layerType:y.WppLayerType.WppLayerNormalSlide}},{key:"getSlideIdx",value:function(){var e=this.collectItems();return e.length>0?e[0].slideIdx:-1}},{key:"apply",value:function(){var e=this.op,t=this.selection;console.warn("Not found apply function, op:",e.name);var a=t.transaction;this.beginTransact(),a.addCommand(e.name,e.param),this.commitTransact(a)}},{key:"setDelayTransact",value:function(e,t,a){this._waitCmds=t,this._bDelayTrans=e,this._delayTransTime=a}},{key:"beginTransact",value:function(){window.getTransaction().beginTransact()}},{key:"commitTransact",value:function(e){this.op.needClose?e.forceCommit():this._bDelayTrans?e.delayEndTransact(this._waitCmds,this._delayTransTime):(e.setWaitCommands(this._waitCmds),e.endTransact())}},{key:"_toSelectionRange",value:function(e){return e}},{key:"_fromSelectionRange",value:function(e){return e}},{key:"setItemExtraData",value:function(e,t){var a=this.getCommandProp("_itemExtras")||{};a[e]=t,this.setCommandProp("_itemExtras",a)}},{key:"_initItem",value:function(e){e.setWrapper(this),e.setProp("extras",this.getCommandProp("_itemExtras")),e._orgParam=this.op.param}},{key:"_getGroup",value:function(e,t){for(var a=[],r=null,n=0;n<e.length;n++){var i=e[n];r===i[t]?a[a.length-1].push(i):a.push([i]),r=i[t]}return a}},{key:"_createWrapperTree",value:function(e){for(var t={},a=0,r=0;r<e.length;r++){var n=e[r],i=n.getWrapperDepth(),o=t[i]||{deep:i,childs:[]};o.childs.push(n),t[i]=o,i>a&&(a=i)}for(var s=a;s>0;s--){var l=t[s],c=t[s-1]||{deep:s-1,childs:[]};c.childs.push(l),t[s-1]=c}return t[0]||{deep:0,childs:[]}}},{key:"_convertWrapperTree",value:function(e,t){for(var a=[],r=0;r<e.childs.length;r++){var n=e.childs[r];if(n.childs instanceof Array){var i=this._convertWrapperTree(n,t);i&&i.length>0&&(a=a.concat(i))}else a.push(n)}if(e.deep>0&&a.length>0){var o=a[0].parent,s=[];s=o&&t&&o[t]?o[t](a):a;for(var l=0;l<s.length;l++)s[l].parent=o.parent;return s}return a}},{key:"collectCommands",value:function(){return[this]}},{key:"collectDoneCommands",value:function(){return this.collectCommands()}},{key:"convertFromCommands",value:function(e){return e}},{key:"convertFromDoneCommands",value:function(e){return this.convertFromCommands(e)}},{key:"mergeCommands",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t="convertFromCommands"),e&&e.length>0){for(var a={},r=[],n=0;n<e.length;n++){var i=e[n];if(i.getCommandProp("bFakeCmd")){var o=i.getCommandProp("fakeCmdToken"),s=a[o]||[];s.push(i.op),a[o]=s}else{var l=i.getCommandProp("_items");if(l&&l.length>0){for(var c=[],d=0;d<l.length;d++){var p=l[d].getProp("fakeCmdToken");p&&c.indexOf(p)<0&&c.push(p)}c.length>0&&i.setCommandProp("fakeTokens",c)}r.push(i)}}var u=Object.keys(a);if(u.length>0)for(var h=0;h<r.length;h++){var f=r[h],m=f.getCommandProp("fakeTokens");if(m&&m.length>0){for(var v=[],g=0;g<m.length;g++){var y=m[g];v=v.concat(a[y]||[]),a[y]=null}f.op.param.fakeCmds=v}}for(var T=this._createWrapperTree(r),C=this._convertWrapperTree(T,t),_=0;_<C.length;_++)C[_].setParent(this.parent);return C}return e}},{key:"_defaultConvertFromCommands",value:function(e){return e}},{key:"collectItems",value:function(){var e=Object(C.a)(),t=[],a=this.op,r=a.name,n=a.param,i=n.category,o=n.layerType,s=this.getItemSlideIdx(n),l=n.shapePath,c=n.shapes;if(c instanceof Array)for(var d=0;d<c.length;d++){var p=this._toSelectionRange(Object(g.a)(c[d])),u=new R(r,Object.assign({category:i,layerType:o,slideIdx:s,shapePath:l},p));u._mergeType=b,t.push(u)}else{var h=this._toSelectionRange(Object.assign(Object(g.a)(n),{category:i,layerType:o,slideIdx:s,shapePath:l}));t.push(new R(r,h))}for(var f=0;f<t.length;f++)t[f]._gid=e,this._initItem(t[f]);return t}},{key:"collectDoneItems",value:function(){return this.collectItems()}},{key:"needCollectPreferDone",value:function(){return!1}},{key:"defaultMergeItem",value:function(e,t){var a=t,r=a[0],n=[],i=r._wrapper;if(e===b){for(var o=i.clone(),s={},l=[],c=0;c<a.length;c++){var d=o._fromSelectionRange(a[c].getParam());l.push(d)}s.shapes=l,Object.assign(o.op.param,r.getOrgParam(),s),o.setCommandProp("_items",a),n.push(o)}else for(var p=0;p<a.length;p++){var u=a[p],h=i.clone();h.op.param=h._fromSelectionRange(u.getParam()),h.setCommandProp("_items",[u]),n.push(h)}return n}},{key:"convertFromItems",value:function(e){if(e.length>0){var t=this._getGroup(e,"_wrapper");t.length>1&&console.warn(this.op.name+".convertFromItems get multiple _wrapper group!");for(var a=[],r=0;r<t.length;r++){var n=t[r],i=n[0],o=i._mergeType;if(o===S){var s=i._wrapper,l=i._mergeFunc;a=l&&s[l]?a.concat(s[l](n)):a.concat(this.defaultMergeItem(_,n))}else a=a.concat(this.defaultMergeItem(o,n))}return a}return[]}},{key:"convertFromDoneItems",value:function(e){return this.convertFromItems(e)}},{key:"getItemSlideIdx",value:function(e){return null==e.slideIdx?e.slideIndex:e.slideIdx}},{key:"isValid",value:function(){var e=this.collectItems();if(e.length>0){for(var t=0,a=0;a<e.length;a++)e[a].isValid()&&(t+=1);return t>0}return!1}},{key:"name",get:function(){return this.op.name}}]),e}();function A(e,t){var a=e.clone();return t.push(a),a}function B(e,t){var a=e.param;if(a.props&&a.props.data){var r=a.props.data,n=e.getShapePath();if(t[0]===n[0]&&t.length>1){var i=t.slice(1),o=r;a.props.bRoot=!0;for(var s=a.props,l=0;l<i.length-1;l++)s=o,o=o.childs[i[l]];return{info:o,parent:s}}}return null}O.isValidNumber=P,O.commTransIdxForMove=function(e,t,a,r,n){if(e<0||t<0||e===t||e+1===t)return null;if("insert"===r||"to"===r)if(a===t){if(e<t&&n)return a-1;if(e>t&&!n)return a+1}else{if(e<a&&a<t)return a-1;if(t<a&&a<=e)return a+1}else{if(a===e)return"from"===r&&n?-1:e<t?t-1:t;if(e<a&&a<t)return a-1;if(t<=a&&a<e)return a+1}},O.isValidCellRange=w;var D=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"collectNone",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=new R(t,{state:r,category:n,layerType:i,slideIdx:-1});a.push(o)}},{key:"collectSlide",value:function(e,t,a){var r=e.slides||[];r.indexOf(e.activeSlide)<0&&r.push(e.activeSlide);for(var n=e.state,i=e.category,o=e.layerType,s=0;s<r.length;++s){var l=new R(t,{state:n,category:i,layerType:o,slideIdx:r[s]});a.push(l)}}},{key:"collectShapes",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=e.text,c=o,d=null,p=null;l&&(d=l.begin,p=l.end-d);for(var u=0;u<s.length;++u){var h=s[u];h=Object.assign({state:r,category:n,layerType:i,slideIdx:c},h,{gcp:d,ccp:p});var f=new R(t,h);f.setProp("itemParam",Object.assign({},h)),a.push(f)}}},{key:"collectCellRange",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=e.cellRange,c=o;if(1===s.length){var d=s[0];if(l){d.cellRange=e.cellRange,d=Object.assign({state:r,category:n,layerType:i,slideIdx:c},d);var p=new R(t,d);p.setProp("itemParam",Object.assign({},d)),a.push(p)}}}},{key:"collectText",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=o,c=null,d=null;null!=e.begin&&null!=e.end&&(c=e.begin,d=e.end-e.begin);var p=null;if(e.tableRange?p=e.tableRange:e.cellRange&&(p=e.cellRange),1===s.length){var u=s[0];u=Object.assign({state:r,category:n,layerType:i,slideIdx:l},u,{cellRange:p,gcp:c,ccp:d});var h=new R(t,u);h.setProp("itemParam",Object.assign({},u)),a.push(h)}}},{key:"collectAnims",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=e.animations,c=o,d=[],p=r;if(s&&s.length>0){var u=e.cellRange;null!=e.begin?(this.collectText(e,t,d),p=T.SelectType.select_text):u?(this.collectCellRange(e,t,d),p=T.SelectType.select_cell):(this.collectShapes(e,t,d),p=T.SelectType.select_shape)}else this.collectSlide(e,t,d),p=T.SelectType.select_slide;for(var h=0;h<d.length;h++)d[h].setProp("isAnimation",!1),d[h].setProp("itemState",p),a.push(d[h]);if(l)for(var f=0;f<l.length;f++){var m=l[f],v=Object.assign({state:r,category:n,layerType:i,slideIdx:c},m),g=new R(t,v);g.setProp("animParam",Object.assign({},v)),g.setProp("isAnimation",!0),a.push(g)}}},{key:"collectItems",value:function(){var e=v.default.selectItem,t=Object(C.a)(),a=[],r=Object(g.a)(this.op).param,n=r.range;switch(n.state){case T.SelectType.select_none:this.collectNone(n,e,a);break;case T.SelectType.select_slide:case T.SelectType.select_multi_slide:this.collectSlide(n,e,a);break;case T.SelectType.select_shape:case T.SelectType.select_multi_shape:this.collectShapes(n,e,a);break;case T.SelectType.select_table:case T.SelectType.select_cell:case T.SelectType.select_multi_cell:this.collectCellRange(n,e,a);break;case T.SelectType.select_text:this.collectText(n,e,a);break;case T.SelectType.select_multi_animation:this.collectAnims(n,e,a)}for(var i=0;i<a.length;i++)a[i]._gid=t,a[i].param.select=Object(g.a)(n),a[i].param.bExtRange=Object(g.a)(r.bExtRange),this._initItem(a[i]);return a}},{key:"_getShapesParam",value:function(e){for(var t=[],a=[],r=[],n=[],i=[],o=0;o<e.length;++o){var s=e[o];if(s.getProp("isAnimation"))i.push(s);else{var l=s.getProp("itemParam"),c=Object.assign({},l,{category:s.category,layerType:s.layerType,slideIdx:s.slideIdx,shapePath:s.shapePath});t.push(c),s.slideIdx>=0&&a.indexOf(s.slideIdx)<0&&a.push(s.slideIdx),s.isValid()&&(r.push(c),n.push(s))}}return{shapes:t,validShapes:r,validItems:n,slides:a,anims:i}}},{key:"_mergeSlide",value:function(e,t){for(var a=0;a<t.length;++a)e.slides.push(t[a].slideIdx)}},{key:"_mergeShapes",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validShapes,i=a.slides;e.shapes=r,e.state=n.length>1?T.SelectType.select_multi_shape:T.SelectType.select_shape,e.slides=i}},{key:"_mergeCellRange",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validItems,i=a.slides;e.shapes=r,e.slides=i;var o=n[0];if(o){var s=o.cellRange;O.isValidCellRange(s)?(e.tableActive=!0,e.cellRange=s):e.tableActive=!1}e.tableActive||(e.state=T.SelectType.select_shape)}},{key:"_mergeText",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validItems,i=a.slides;e.shapes=r,e.slides=i;var o=n[0];if(o){e.begin=o.gcp,e.end=o.gcp+o.ccp;var s=o.cellRange;s&&O.isValidCellRange(s)&&(e.cellRange=s)}}},{key:"_mergeAnims",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validItems,i=a.slides,o=a.anims;e.shapes=r,e.slides=i,e.animations=[];var s=n[0],l=T.SelectType.select_multi_animation;if(s)if((l=s.getProp("itemState"))===T.SelectType.select_cell){var c=s.cellRange;O.isValidCellRange(c)?(e.tableActive=!0,e.cellRange=c):(e.tableActive=!1,l=r.length>1?T.SelectType.select_multi_shape:T.SelectType.select_shape)}else if(l===T.SelectType.select_text){e.begin=s.gcp,e.end=s.gcp+s.ccp;var d=s.cellRange;d&&O.isValidCellRange(d)?(e.tableActive=!0,e.cellRange=d):(e.tableActive=!1,l=r.length>1?T.SelectType.select_multi_shape:T.SelectType.select_shape)}for(var p=0;p<o.length;++p){var u=o[p],h=u.getProp("animParam"),f={category:u.category,layerType:u.layerType,slideIdx:u.slideIdx,sPath:u.sPath},m=Object.assign({},h,f);e.animations.push(m)}0===e.animations.length&&l&&(e.state=l),e.shapes&&0!==e.shapes.length||(e.state=T.SelectType.select_slide)}},{key:"convertFromItems",value:function(e){if(e&&e.length>0){var t=e[0].getOrgParam(),a=e[0].getParam(),r=t.range.state,n=Object.assign({},t.range,a.range);switch(n.state=r,n.slides=[],r){case T.SelectType.select_none:n.activeSlide=-1;break;case T.SelectType.select_slide:case T.SelectType.select_multi_slide:this._mergeSlide(n,e);break;case T.SelectType.select_shape:case T.SelectType.select_multi_shape:this._mergeShapes(n,e);break;case T.SelectType.select_table:case T.SelectType.select_cell:case T.SelectType.select_multi_cell:this._mergeCellRange(n,e);break;case T.SelectType.select_text:this._mergeText(n,e);break;case T.SelectType.select_multi_animation:this._mergeAnims(n,e)}return n.slides&&(n.activeSlide=0===n.slides.length?-1:n.slides[0]),t.range=n,[this.wrapper({name:v.default.selection,param:t})]}return e}},{key:"apply",value:function(){var e=this.op;this.selection.transDepositedInstall(e.param.range)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return null}}]),t}(O),F=function(){function e(){o()(this,e)}return l()(e,[{key:"txtStrmInsert",value:function(e,t,a){if(!e.isSameTextStreamWith(t))return!1;var r=this.bPreferKeep;if(e.orgWrapper.name===v.default.paste&&(r=t.orgWrapper.name===v.default.paste&&this.bPreferKeep),e.gcp<t.gcp||e.gcp===t.gcp&&!r){var n=t.clone();return n.gcp+=e.ccp,a.push(n),!0}return!1}},{key:"txtStrmDelete",value:function(e,t,a){if(!e.isSameTextStreamWith(t))return!1;if(e.gcp<=t.gcp){var r=t.clone();return r.gcp+=e.ccp,a.push(r),!0}if(e.gcp<t.gcp+t.ccp){var n=t.param.text,i=e.gcp-t.gcp,o=t.clone();o.param.text=n.substr(0,i);var s=t.clone();return s.gcp=t.gcp+e.ccp,s.param.text=n.substr(i),a.push(o),a.push(s),!0}return!1}},{key:"defaultCommand",value:function(e,t,a){if(!e.isSameTextStreamWith(t))return!1;if(e.gcp<=t.gcp){var r=t.clone();return r.gcp+=e.ccp,a.push(r),!0}if(e.gcp<t.gcp+t.ccp){if(t.name!==v.default.selectItem&&t.isNeedSplitPara()){var n=e.gcp-t.gcp,i=t.clone();i.ccp=n;var o=t.clone();o.gcp=e.gcp+e.ccp,o.ccp=t.ccp-n,a.push(i),a.push(o)}else{var s=t.clone();s.ccp+=e.ccp,a.push(s)}return!0}return!1}}]),e}(),M=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_text,e.slideIdx=this.getItemSlideIdx(e),e.ccp=e.text.length,e}},{key:"_fromSelectionRange",value:function(e){return e.slideIndex=e.slideIdx,delete e.ccp,e}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=t.getBuddy(),n=r.fetchTextStream(e.param);if(n){var i=e.param,o=i.category,s=i.layerType,l=i.cellRange,c=e.param.gcp,d=e.param.gcp+e.param.text.length,p=this.getItemSlideIdx(e.param),u=n.text.length;c>=u&&(console.error("param.gcp out of bounds !!"),d=(c=u-1)+e.param.text.length,e.param.gcp=u-1),a._doNotAutoRemoveTextBox((function(){a.selectSlideAt(p,o,s),a.selectShape(r.fetchShape(e.param)),l&&a.selectTableCell(l.startRow,l.startCol),a._data.getTextFrame(),a.selectText(c,c)}));var h=a.transaction;this.beginTransact(),n.initTransact(h),n.insertText(e.param.text,e.param.gcp,e.param.prop),n.initTransact(null),h.addCommand(e.name,e.param),a._doNotAutoRemoveTextBox((function(){a.selectText(d,d)})),this.commitTransact(h)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.txtStrmDelete,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new F}}]),t}(O),j=function(){function e(){o()(this,e)}return l()(e,[{key:"txtStrmInsert",value:function(e,t,a){if(!e.isSameTextStreamWith(t))return!1;if(e.gcp+e.ccp<=t.gcp){var r=t.clone();return r.gcp-=e.ccp,a.push(r),!0}if(e.gcp<t.gcp){var n=t.clone();return n.gcp=e.gcp,a.push(n),!0}return!1}},{key:"txtStrmDelete",value:function(e,t,a){if(!e.isSameTextStreamWith(t))return!1;var r=e.gcp+e.ccp;if(r<=t.gcp){var n=t.clone();return n.gcp-=e.ccp,a.push(n),!0}if(e.gcp<=t.gcp+t.ccp){var i=Math.max(e.gcp,t.gcp),o=Math.min(r,t.gcp+t.ccp),s=t.param.text,l=t.clone();l.gcp=Math.min(e.gcp,t.gcp);var c=s.substr(0,i-t.gcp),d=s.substr(o-t.gcp);return l.param.text=c+d,l.ccp=l.param.text.length,a.push(l),!0}return!1}},{key:"defaultCommand",value:function(e,t,a){if(!e.isSameTextStreamWith(t))return!1;var r=e.gcp+e.ccp;if(r<=t.gcp){var n=t.clone();return n.gcp-=e.ccp,a.push(n),!0}if(e.gcp<=t.gcp+t.ccp){var i=Math.max(e.gcp,t.gcp),o=Math.min(r,t.gcp+t.ccp),s=t.clone();return s.gcp=Math.min(e.gcp,t.gcp),s.ccp=s.ccp-(o-i),a.push(s),!0}return!1}}]),e}(),E=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_text,e.slideIdx=this.getItemSlideIdx(e),e.ccp=e.text.length,e}},{key:"_fromSelectionRange",value:function(e){return e.slideIndex=e.slideIdx,delete e.ccp,e}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=t.getBuddy(),n=r.fetchTextStream(e.param);if(n){var i=e.param.optype,o=e.param.gcp,s=e.param.gcp+e.param.text.length,l=e.param,c=l.category,d=l.layerType,p=l.cellRange,u=this.getItemSlideIdx(e.param);a._doNotAutoRemoveTextBox((function(){a.selectSlideAt(u,c,d),a.selectShape(r.fetchShape(e.param)),p&&a.selectTableCell(p.startRow,p.startCol),a._data.getTextFrame(),"backspace"===i?a.selectText(s,s):"deleteChar"===i?a.selectText(o,o):a.selectText(o,s)}));var h=a.transaction;this.beginTransact(),a.selectText(o,s),n.initTransact(h),n.deleteText(e.param.gcp,e.param.text.length,i),n.initTransact(null),h.addCommand(e.name,e.param),this.commitTransact(h)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.txtStrmInsert,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new j}}]),t}(O),N=function e(){o()(this,e)},L=function e(){o()(this,e)},V=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){if(e.state=T.SelectType.select_text,e.props){var t=e.props,a=t.gcp,r=t.ccp;e.gcp=a,e.ccp=r}return e}},{key:"_fromSelectionRange",value:function(e){var t=e.gcp,a=e.ccp;return e.props.gcp=t,e.props.ccp=a,delete e.gcp,delete e.ccp,e}},{key:"_selectTextRange",value:function(e,t,a){if(t.length>0){var r=t[a<0?t.length-1:a];e._doNotAutoRemoveTextBox((function(){e.selectSlideAt(r.slideIdx,r.category,r.layerType),e.selectShape(r.shape),r.cellRange&&e.selectTableCell(r.cellRange.startRow,r.cellRange.startCol),e._data.getTextFrame(),e.selectText(r.begin,r.end)}))}}},{key:"apply",value:function(){var e=this;if(!this.isValid())return!1;var t=this.op,a=this.pres,r=this.selection,n=a.getBuddy(),i=r.transaction,o={},s=[];n.helper.doOperate({data:t},(function(e){if(e.obj){var t=e.param,a=t.category,r=t.layerType,i=t.slideIdx,l=t.cellRange,c=t.gcp,d=t.ccp,p=n.fetchShape(e.param),u=e.obj.parent;if(u){var h=u.objID,f=c,m=c+d;if(o[h]){var v=o[h];v.begin=v.begin>f?f:v.begin,v.end=v.end<m?m:v.end}else o[h]={category:a,layerType:r,slideIdx:i,cellRange:l,begin:f,end:m,cmds:[],shape:p,textFrame:u},s.push(o[h]);o[h].cmds.push(e)}}})),this._selectTextRange(r,s,0),i.beginTransact();for(var l=0;l<s.length;l++){var c=s[l];this._selectTextRange(r,s,l);for(var d=function(t){var a=c.cmds[t],n=a.param,o=n.gcp,s=n.ccp;r._doNotAutoRemoveTextBox((function(){r.selectText(o,o+s)})),a.obj.initTransact(i),e._fmtInner(a.obj,a.param),a.obj.initTransact(null)},p=0;p<c.cmds.length;p++)d(p)}i.addCommand(t.name,t.param),this._selectTextRange(r,s,-1),this.commitTransact(i)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}}]),t}(O),W=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_fmtInner",value:function(e,t){var a=t.gcp,r=t.ccp,n=t.fmt;e.fmtChpx(a,r,n)}},{key:"transforms",value:function(){return new N}}]),t}(V),G=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_fmtInner",value:function(e,t){var a=t.gcp,r=t.ccp,n=t.fmt;e.fmtPapx(a,r,n)}},{key:"transforms",value:function(){return new L}}]),t}(V);function H(e,t){var a=Object(g.a)(t);!function(e,t){var a=t.transfrom2d,r=t.extendProps,n=t.rect,i=t.transform2DInfo,o=r&&r.transform,s=null;a&&(s=Object.assign(s||{},a)),i&&(i.rect&&(s=Object.assign(s||{},i.rect)),i.flipRotation&&(s=Object.assign(s||{},i.flipRotation)));var l=n&&window.CoreExports.Qt.QRect.create(n);if(l&&(s=Object.assign(s||{},l.scale(635,635).getRect())),s||o){var c=e.visual.getRealTransform2D(),d=Object.assign({},c,s||{});if(o){var p=window.APP.utils.createModifier("Transform2D");p.setSource(d),p.modify("transform",o),d=p.modifiedData()}e.visual.modifyShapeTransform2D(d)}}(e,a),delete a.transform2D,delete a.rect,delete a.transform2DInfo;var r=a.extendProps;if(r&&delete r.transform,a.geometry2D){var n=window.APP.utils.createModifier("Geometry2D",e.getGeometry2D().clone());n.batchModify(a.geometry2D),a.geometry2D=n.modifiedData()}if(a.newInkData&&(a.inkDate=a.newInkData,delete a.newInkData),a.textFrameProps){var i=e.getTextFrame();i&&i.modifyProps(a.textFrameProps),delete a.textFrameProps}if(a.textFont){var o=e.getTextFrame();if(o){var s=o.getTextStream();s&&s.fmtChpx(0,s.end,a.textFont)}delete a.textFont}if(a.fill){var l=a.modifiers;l&&l.length>0&&"opacity"===l[0].tag&&(e.visual.setOpacity(l[0].val),delete a.fill)}e.modifyProperties(a)}var U=function e(){o()(this,e)},z=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=t.getBuddy(),n=a.transaction;n.beginTransact();var i=Object(g.a)(e),o=i.param.shapes;if(o)for(var s=0;s<o.length;s++){var l=o[s],c=l.props;l.props={props:c}}var d=null,p=[];r.helper.doOperate({data:i},(function(e){var t=e.obj;t&&(d=r.fetchSlide(e.param),p.push(t),H(t,e.param.props))})),n.addCommand(e.name,e.param),a._doNotAutoRemoveTextBox((function(){a.selectSlide(d),a.selectShapes(p)})),this.commitTransact(n)}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new U}}]),t}(O),q=function(){function e(){o()(this,e)}return l()(e,[{key:"getByAdjust",value:function(e,t){return e<t||e===t&&!this.bPreferKeep?t+1:null}},{key:"defaultCommand",value:function(e,t,a){var r=!1;if(e.isSameSlideWith(t)){var n=null,i=e.getShapePath(),o=t.getShapePath(),s=null,l=e.wrapper.op.isReversed;l&&(s=B(e,i));var c=i.length-1,d=s&&s.info;if(d&&2===d.childs.length){if(l&&e.isSameShapePath(i.slice(0,c),o.slice(0,c))){var p=0===i[c]?1:0,u=o.slice(c);(n=t.clone()).shapePath=e.getShapePath(),n.shapePath=n.shapePath.concat(u),n.shapePath[c]=p,t.name===v.default.shapeMove&&(n.param.targetIndex=p)}}else if(e.isParentShapeAncestorOf(t)){var h=i[c],f=o[c],m=this.getByAdjust(h,f),y=null;t.name===v.default.shapeMove&&c===o.length-1&&(y=this.getByAdjust(h,t.param.targetIndex)),null===m&&null===y||(n=t.clone(),null!==m&&(n.shapePath[c]=m),null!==y&&(n.param.targetIndex=y))}if(n){if(t.name===v.default.shapeInsert&&t.isReversed||t.name===v.default.shapeDelete&&!t.isReversed){var T=B(n,i);if(T&&T.info&&T.info.childs){var C=T.parent,_=i[c],b=B(e,i);if(b?b=Object(g.a)(b.info):(b={childs:[{},{}]}).childs[_]={id:e.param.shapeid,childs:[]},b.childs[1-_]=T.info,C.bRoot)C.data=b;else{var S=C.childs.indexOf(T.info);C.childs[S]=b}}}a.push(n),r=!0}}return r}}]),e}(),K=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=a.getShapeSelection(),n=e.param,i=n.category,o=n.layerType,s=n.slideIdx,l=t.getSlideByIdx(o,i,s);if(l){a.clearSlideSelect(),a.selectSlide(l);var c=a.transaction;this.beginTransact();var d=e.param.slideProps,p=d.cmdName,u=p&&d[p],h=p&&r.insertNameToType(p);if(u){var f=r._insertShapeCommonV2(h,u);if(f){var m=f.shape;this._desensitize(p,m,e.param.userData);var v=c.getCommands(),g=v[v.length-1].param.slideProps[p],y=u.rect;if(m.visual.setAnchorRect({x:y.x/635,y:y.y/635,width:y.width/635,height:y.height/635}),g.rect=y,u.modifyProps&&(H(m,u.modifyProps),g.modifyProps=u.modifyProps),"insertInk"===p){var T=new window.CoreExports.InkData;T.setFromCommandData(u.inkData),T.applyToShape(m),g.inkData=u.inkData,u.bBroadcast&&!this.op.needClose&&m.broadcastToOthers(),a.clearShapeSelect()}else a.selectShape(m),"insertTextBox"===p&&a.selectText(0,0)}else c.addCommand(e.name,e.param)}else c.addCommand(e.name,e.param);this.commitTransact(c)}}}},{key:"reverse",value:function(){var e={name:v.default.shapeDelete,param:Object(g.a)(this.op.param),gid:this.gid},t=e.param,a={};if(a.category=t.category,a.layerType=t.layerType,a.slideIdx=t.slideIdx,a.shapePath=t.shapePath,this.op.isReversed){t.props&&(a.props=t.props);var r=this.op._orgParam,n=this.op._shapesIdx;r&&(a=t,t=Object(g.a)(r),e.param=Object.assign({},r),r.shapes&&r.shapes[n]&&(a=Object.assign({},Object(g.a)(r.shapes[n]),a)))}else e._orgParam=this.op.param;return e.param=t,e.param.shapes=[a],e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new q}},{key:"_desensitize",value:function(e,t,a){if(t){var r=(a||{})._COOPER_HANDLER;"insertSvgPicture"===e&&"handlerQRCode"===r&&delete t.private.picture}}}]),t}(O),Q=function(){function e(){o()(this,e)}return l()(e,[{key:"transIdx",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e!==t||a?e<t?t-1:null:-1}},{key:"_transFakeShapeGroup",value:function(e,t,a){if(e.isSameSlideWith(t)&&e.isParentShapeAncestorOf(t)){var r=e.shapePath.length-1,n=e.shapePath[r],i=t.shapePath[r];if(n<i){var o=t.clone();return o.shapePath[r]=i-1,a.push(o),!0}}return!1}},{key:"defaultCommand",value:function(e,t,a){if(t.name===v.default.shapeGroup&&t.param.isFakeItem)return this._transFakeShapeGroup(e,t,a);var r=!1;if(e.isSameSlideWith(t)){var n=t.name===v.default.shapeInsert||t.name===v.default.documentBeautify,i=t.name===v.default.shapeMove,o=null,s=e.getShapePath(),l=t.getShapePath(),c=s.length-1;if(e.isParentShapeAncestorOf(t)){var d=s[c],p=l[c],u=null,h=null;if(i&&(h=this.transIdx(d,t.param.targetIndex,!0)),d===p){var f=this.transIdx(d,p,n);null!=f&&((u=l.slice(0))[c]=f)}else{var m=null,g=B(e,s);if(g){var y=g.info;y&&y.childs&&y.childs.length<=2&&(m=s.slice(0,c))}m?u=m.concat(l.slice(c+1)):d<p&&((u=l.slice(0))[c]=p-1)}null==u&&null==h||(o=t.clone(),null!=u&&(o.shapePath=u),null!=h&&(o.param.targetIndex=h));var T=B(t,s);T&&T.info&&T.info.childs&&!o&&(o=t.clone())}if(o){var C=B(o,s);if(C&&C.info&&C.info.childs){var _=s[c],b=C.info,S=C.parent;if(b.childs.length>2)b.childs.splice(_,1);else{var k=S;if(k.bRoot)k.data=b.childs[1-_];else{var P=k.childs.indexOf(b);k.childs[P]=b.childs[1-_]}}}a.push(o),r=!0}}return r}}]),e}(),J=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection;if(e.isReversed)console.warn("apply a reverse op");else{var r=t.getBuddy(),n=e.param,i=null!=n.slideIdx?n.slideIdx:n.slideIndex,o={category:n.category,layerType:n.layerType,slideIdx:i},s=e.param.shapes,l=[],c=[],d=null;if(s.forEach((function(e){if(!e.emptyOp){var t=null!=e.slideIdx?e.slideIdx:e.slideIndex;e.slideIdx=null==t?i:t;var a=Object.assign({},o,e);l.push(a);var n=r.fetchShape(a);n&&(d=r.fetchSlide(a),c.push(n))}})),0!==l.length){var p=a.transaction,u=a.getShapeSelection();a.selectSlide(d),a.selectShapes(c);var h=a.getActiveSlide(),f=[];p.beginTransact();var m=u._deleteShapeNoTransact(h,c);f=f.concat(m.keeps);for(var v=[],g=0;g<f.length;g++)a.isValidShapeInActiveSlide(f[g])&&v.push(f[g]);m&&m.sendparam&&(e.param.shapes=m.sendparam.shapes),p.addCommand(e.name,e.param),v&&v.length>0?a.selectShapes(v):a.clearShapeSelect(),this.commitTransact(p)}}}}},{key:"reverse",value:function(){var e=this.op.param,t=!this.op.isReversed,a=e.shapes,r=[],n={category:e.category,layerType:e.layerType,slideIdx:e.slideIdx};this.op.isReversed&&this.op._orgParam&&(n=Object.assign(n,this.op._orgParam));for(var i=a.length-1;i>=0;i--){var o=Object.assign({},n,Object(g.a)(a[i])),s={name:v.default.shapeInsert,param:o,isReversed:t,gid:this.gid};s.isReversed&&(s._orgParam=e,s._shapesIdx=i),r.push(this._createWrapper(s,this.pres,this.selection))}if(1===r.length)return r[0];for(var l={name:v.default.batchCommands,param:{commands:[],_orgParam:e,_orgName:this.op.name}},c=0;c<r.length;c++)l.param.commands.push(r[c].op);return this._createWrapper(l,this.pres,this.selection)}},{key:"merge",value:function(e){for(var t=e.param,a=t._orgParam,r=t.commands,n=[],i={name:v.default.shapeDelete,param:{}},o={},s=0;s<r.length;s++){var l=r[s];if(l.name===v.default.shapeDelete){a&&Object.assign(o,a);for(var c=l.param.slideIdx,d=l.param.shapes,p=0;p<d.length;p++){var u=Object(g.a)(d[p]);u.slideIdx=null!=u.slideIdx?u.slideIdx:c,n.push(u)}}else console.warn("Invalid command:",l.name)}return i.param=Object.assign({},Object(g.a)(o)),i.param.shapes=n,this._createWrapper(i,this.pres,this.selection)}},{key:"transforms",value:function(){return new Q}}]),t}(O),Y=function(){function e(){o()(this,e)}return l()(e,[{key:"shapeMove",value:function(e,t,a){if(e.isSameSlideWith(t)&&e.isParentShapeAncestorOf(t)){var r=e.getShapePath(),n=t.getShapePath(),i=r.length-1,o=r[i],s=e.param.targetIndex,l=O.commTransIdxForMove(o,s,n[i],"from",this.bPreferKeep),c=null;if(r.length===n.length&&(c=O.commTransIdxForMove(o,s,t.param.targetIndex,"to",this.bPreferKeep)),null!=l||null!=c){var d=t.clone();return null!=l&&(n[i]=l,d.shapePath=n),null!=c&&(d.param.targetIndex=c),a.push(d),!0}}return!1}},{key:"shapeGroup",value:function(e,t,a){if(!t.param.isFakeItem)return this.defaultCommand(e,t,a);if(e.isSameSlideWith(t)&&e.isParentShapeAncestorOf(t)){var r=e.shapePath.length-1,n=e.shapePath[r],i=t.shapePath[r],o=O.commTransIdxForMove(n,e.param.targetIndex,i,"insert",this.bPreferKeep);if(i!==o){var s=t.clone();return s.shapePath[r]=o,a.push(s),!0}}return!1}},{key:"defaultCommand",value:function(e,t,a){if(e.isSameSlideWith(t)&&e.isParentShapeAncestorOf(t)){var r=e.getShapePath(),n=t.getShapePath(),i=r.length-1,o=r[i],s=e.param.targetIndex,l=t.name===v.default.shapeInsert||t.name===v.default.documentBeautify?"insert":"normal",c=O.commTransIdxForMove(o,s,n[i],l,this.bPreferKeep);if(null!=c){var d=t.clone();return n[i]=c,d.shapePath=n,a.push(d),!0}}return!1}}]),e}(),X=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=t.getBuddy(),n=e.param.shapes,i=a.transaction;i.beginTransact();var o=[];n.forEach((function(e){var t=e.category,a=e.layerType,n=e.slideIdx,i=e.shapePath,s=e.targetIndex,l=i[i.length-1],c=r.fetchShape({category:t,layerType:a,slideIdx:n,shapePath:i});c&&l!==s&&c.getParent().move(l,s-l),o.push(c)})),i.addCommand(e.name,e.param),o&&o.length>0&&a.selectShapes(o),this.commitTransact(i)}}},{key:"reverse",value:function(){for(var e=Object(g.a)(this.op),t=e.param.shapes,a=[],r=t.length-1;r>=0;r--){var n=t[r],i=n.shapePath;if(0===i.length||n.targetIndex<0)a.push(n);else{var o=i.length-1,s=i[o],l=n.targetIndex-s;i[o]=l>0?s+l-1:s+l,n.targetIndex=i[o]+1-l,a.push(n)}}return e.param.shapes=a,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Y}}]),t}(O),Z=function(){function e(){o()(this,e)}return l()(e,[{key:"slideMove",value:function(e,t,a){var r=null,n=t.param.slideProps,i=this.getByAdjust(e,t.getSlideIdx()),o=this.getByAdjust(e,n.to);return null==i&&null==o||(r=A(t,a)).wrapper.setSlideFromTo(r,i,o),null!=r}},{key:"transPaste",value:function(e,t,a){var r=t.param.select;if(null!=r.slideInsertion){var n=r.activeSlide,i=r.slideInsertion;if(n+1===i){var o=this.getByAdjust(e,i);if(null!=o){var s=A(t,a);s.setSlideIdx(o-1),s.param.select.slideInsertion=o}return null!=o}}var l=this.getByAdjust(e,t.getSlideIdx());if(null!=l){var c=A(t,a);c.setSlideIdx(l),c.param.select.slideInsertion=null}return null!=l}},{key:"defaultCommand",value:function(e,t,a){if(e.orgWrapper.name===v.default.documentBeautify&&t.wrapper.name===v.default.selection){var r=e.orgWrapper.op.param,n=r.fakeCmds,i=r.commands;if(1===n.length&&n.length===i.length&&n[0].slideIdx===i[0].length)return!1}if(t.name===v.default.selectItem&&t.orgWrapper.name===v.default.paste)return this.transPaste(e,t,a);var o=this.getByAdjust(e,t.getSlideIdx());return null!=o&&A(t,a).setSlideIdx(o),null!=o}},{key:"getByAdjust",value:function(e,t){var a=e.getSlideIdx();return a<t||a===t&&!this.bPreferKeep?t+1:null}}]),e}(),$=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_slide,e}},{key:"apply",value:function(){var e=this.category();if("slides"===e){if(this.isValid()){var t=this.op,a=this.pres,r=this.selection,n=t.param.slideIdx,i=t.param.slideProps.layoutId,o=window.CoreExports.Slide.createNewSlide(n,i,a.slides);if(o&&o.isSlideType){r.selectSlideAt(n-1>=0?n-1:0);var s=r.transaction;this.beginTransact(),a.slides.insertSlide(n,o),s.markData("insertSlide",o);var l={slideIdx:n,slideProps:{layoutId:o.private.following.private.slideId,localId:o.private.slideId}};s.addCommand(t.name,l),this.commitTransact(s),r.selectSlide(o)}}}else console.warn("Not support category:"+e)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.slideDelete,e.bReversed=!this.op.bReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Z}}]),t}(O),ee=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(e,t,a){var r=null;return e.getSlideIdx()===t.getSlideIdx()?r=-1:e.getSlideIdx()<t.getSlideIdx()&&(r=t.getSlideIdx()-1),null!=r&&A(t,a).setSlideIdx(r),null!=r}},{key:"docTemplate",value:function(e,t,a){return this.slideInsert(e,t,a)}},{key:"selectItem",value:function(e,t,a){if(e.orgWrapper.name===v.default.documentBeautify&&t.wrapper.name===v.default.selection){var r=e.orgWrapper.op.param,n=r.fakeCmds,i=r.commands;if(1===n.length&&n.length===i.length&&n[0].param.slideIdx===t.slideIdx&&i[0].param.slideIdx===t.slideIdx)return!1}if(t.param.bExtRange){var o=e.getSlideIdx(),s=t.getSlideIdx();if(o<s||!e.wrapper.op.bReversed&&o===s){var l=t.getSlideIdx()-1;return A(t,a).setSlideIdx(l),!0}return!1}return this.defaultCommand(e,t,a)}},{key:"documentBeautify",value:function(e,t,a){return this.defaultCommand(e,t,a)}},{key:"slideInsert",value:function(e,t,a){return e.getSlideIdx()<t.getSlideIdx()&&(A(t,a).setSlideIdx(t.getSlideIdx()-1),!0)}},{key:"slideMove",value:function(e,t,a){var r=null,n=t.param.slideProps,i=null,o=null,s=e.getSlideIdx(),l=t.getSlideIdx();return s===l?i=-1:s<l&&s<n.to?(i=l-1,o=n.to-1):l<s&&s<n.to?o=n.to-1:n.to<=s&&s<l&&(i=l-1),null==i&&null==o||(r=A(t,a)).wrapper.setSlideFromTo(r,i,o),null!=r}}]),e}(),te=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_slide,e}},{key:"apply",value:function(){var e=this.category();if(["slides","slideLayouts","slideMasters"].indexOf(e)<0)console.warn("Not support category:"+e);else{var t=this.op,a=this.pres,r=this.selection,n=t.param.slideIdx,i=a.getContainerByCategory(e);if(!(n<0||n>=i.getSlideCount())){var o=i.getSlideAt(n);if(o&&!a.isSlideFollowedByOthers(o)){r.selectSlide(o);var s=r.transaction;this.beginTransact();var l=r.getSlideSelection()._doDeleteSlide(o);l&&"success"===l.error?this.commitTransact(s):s.rollback()}else console.warn("layout/master "+o.getId()+" is used!")}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.slideInsert,e.bReversed=!this.op.bReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new ee}}]),t}(O),ae=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(e,t,a){var r=e.slideIdx,n=e.param.slideProps.to,i=t.name===v.default.slideInsert||t.name===v.default.docTemplate?"insert":"normal",o=O.commTransIdxForMove(r,n,t.getSlideIdx(),i,this.bPreferKeep);return null!=o&&A(t,a).setSlideIdx(o),null!=o}},{key:"slideMove",value:function(e,t,a){var r=e.slideIdx,n=e.param.slideProps.to,i=t.param.slideProps,o=t.getSlideIdx(),s=i.to,l=O.commTransIdxForMove(r,n,o,"from",this.bPreferKeep),c=O.commTransIdxForMove(r,n,s,"to",this.bPreferKeep);if(null!=l||null!=c){var d=A(t,a);return d.wrapper.setSlideFromTo(d,l,c),!0}return!1}}]),e}(),re=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){e.state=T.SelectType.select_slide;var t=e.slideProps;return e.slideIdx=t.from,null==t.to&&null!=t.offset&&(t.to=t.from+t.offset),e}},{key:"_fromSelectionRange",value:function(e){return e.slideProps.from=e.slideIdx,e}},{key:"apply",value:function(){var e=this.category();if("slides"===e){if(this.isValid()){var t=this.op,a=this.pres,r=this.selection,n=t.param.slideProps.from,i=t.param.slideProps.offset,o=a.slides.children.length;if(!(0===i||n<0||n>=o||n+i<0||n+i>o)){var s=a.slides.getSlideAt(n);r.selectSlide(s);var l=r.transaction;this.beginTransact(),a.slides.moveSlide(n,i),l.addCommand(t.name,t.param),this.commitTransact(l),r.selectSlide(s)}}}else console.warn("Not support category:"+e)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op),t=this.op.param.slideProps,a=e.param.slideProps;return t.offset>0?a.from=t.from+t.offset-1:a.from=t.from+t.offset,a.offset=1-t.offset,a.to=a.from+a.offset,e.param.slideIdx=a.from,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new ae}},{key:"setSlideFromTo",value:function(e,t,a){var r=e.param.slideProps;null!=a&&(r.to=a,a<0&&(t=-1)),null!=t&&e.setSlideIdx(t),t=e.getSlideIdx(),a=r.to,t>=0&&a>=0&&(r.offset=a-t)}}]),t}(O),ne=function e(){o()(this,e)},ie=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_slide,e}},{key:"apply",value:function(){var e=this,t=this.op,a=this.pres,r=this.selection,n=this.category(),i=a.getBuddy(),o=r.transaction;if(t.param.slideProps.applyForAll)return o.beginTransact(),this.modifyForAllSlides(),o.addCommand(t.name,t.param),void this.commitTransact(o);this.isValid()&&(o.beginTransact(),i.helper.doOperate({data:t},(function(t){var a=t.obj;if(a){"slides"===n&&r.selectSlide(a);var i=Object(g.a)(t.param.slideProps);e.modifyPropertiesWithCommandParam(a,i)}})),o.addCommand(t.name,t.param),this.commitTransact(o))}},{key:"modifyForAllSlides",value:function(){var e=this.op,t=this.selection,a=this.category(),r=t.getSlideSelection(),n=Object(g.a)(e.param.slideProps.applyForAll);if(n.hasOwnProperty("background")&&r._applyBackgroundForAll(a,n.background),n.hasOwnProperty("transition")){var i=n.transition,o=window.CoreUtils.createModifier("Transition",{});for(var s in i)o.modify(s,i[s]);r._applyTransitionForAll(a,o)}}},{key:"modifyPropertiesWithCommandParam",value:function(e,t){var a={},r=["background","transition"];for(var n in t)"undefineds"===n?t.undefineds.forEach((function(e){a[e]=null})):(r.indexOf(n)>=0||e.hasProperty(n))&&(a[n]=Object(g.a)(t[n]));if(a.hasOwnProperty("background")){var i=a.background;(null==i||i._REMOVE)&&(i={_REMOVE:!0}),e.visual.setBackgroundProperties(i)}delete a.background,delete a.allBackground,delete a.allTransition,e.modifyProperties(a)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new ne}}]),t}(O),oe=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(){return!1}},{key:"slideDelete",value:function(e,t,a){if(e.slideIdx>=0&&t.slideIdx>=0&&("slideLayouts"===t.category||"slideMasters"===t.category)&&e.param.masterId===t.param.slideProps.masterId){var r=t.clone();return r.slideIdx=-1,a.push(r),!0}}},{key:"needTransform",value:function(e,t){return e.name===v.default.modifySlideLayout&&t.name===v.default.slideDelete}}]),e}(),se=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"collectDoneCommands",value:function(e){if(e&&e.op.name===v.default.slideDelete)return[this];if(this.op.param.cvCmds){for(var t=this.op.param,a=[],r=0;r<t.cvCmds.length;r++){var n=this.wrapper(t.cvCmds[r]);n.setParent(this),n.setCommandProp("cmdType","LayoutCvCmds"),n.setCommandProp("orgCmdParam",t);var i=n.collectDoneCommands(e);a=a.concat(i)}return a}return[this]}},{key:"convertFromDoneCommands",value:function(e){if(e&&e.length>0&&"LayoutCvCmds"===e[0].getCommandProp("cmdType")){for(var t=[],a=0;a<e.length;a++)t.push(e[a].op);var r=Object(g.a)(e[0].getCommandProp("orgCmdParam")||{});return r.cvCmds=t,[this.wrapper({name:v.default.modifySlideLayout,param:r})]}return e}},{key:"collectItems",value:function(){var e=Object(C.a)(),t=[],a=this.op.param,r=a.select,n=r.category,i=r.layerType,o=r.activeSlide;a=Object.assign({},a,{state:T.SelectType.select_slide,category:n,layerType:i,slideIdx:o});var s=new R(v.default.selectItem,Object(g.a)(a));t.push(s);for(var l=0;l<t.length;l++)t[l]._gid=e,this._initItem(t[l]);return t}},{key:"convertFromItems",value:function(e){if(e&&e.length>0){e.length>1&&console.warn("ModifyLayoutWrapper.convertFromItems items.length === "+e.length);var t=e[0],a=t.getParam(),r=Object(g.a)(t.getOrgParam()),n=a.slideIdx,i=[n],o=Object.assign({},r.select,a.select);o.activeSlide=n,o.slides=i,o.state=T.SelectType.select_slide,r.select=o;var s=this.wrapper({name:v.default.modifySlideLayout,param:r});return s.setCommandProp("_items",e),[s]}return e}},{key:"apply",value:function(){var e=this.op,t=this.selection.transaction;t.beginTransact(),t.addCommand(e.name,e.param),this.commitTransact(t)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op),t=this.createCvCmdsForReverse(this.op);return t&&(e.param.cvCmds=t),e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new oe}}]),t}(O),le=window.CoreExports.helper.getEditObjectPath,ce=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(){return!1}}]),e}(),de=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"collectCommands",value:function(){return[this]}},{key:"collectDoneCommands",value:function(e){if(this.op.param.cvCmds){for(var t=this.op.param,a=[],r=0;r<t.cvCmds.length;r++){var n=this.wrapper(t.cvCmds[r]);n.setParent(this),n.setCommandProp("cmdType","PasteCvCmds"),n.setCommandProp("orgCmdParam",t);var i=n.collectDoneCommands(e);a=a.concat(i)}return a}return[this]}},{key:"convertFromCommands",value:function(e){if(e&&e.length>0&&"PasteCvCmds"===e[0].getCommandProp("cmdType")){for(var t=[],a=0;a<e.length;a++)t.push(e[a].op);var r=Object(g.a)(e[0].getCommandProp("orgCmdParam")||{});return r.cvCmds=t,[this.wrapper({name:v.default.paste,param:r})]}return e}},{key:"collectNone",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=new R(t,{state:r,category:n,layerType:i,slideIdx:-1});a.push(o)}},{key:"collectSlide",value:function(e,t,a){var r=e.slides||[];r.indexOf(e.activeSlide)<0&&r.push(e.activeSlide);for(var n=e.state,i=e.category,o=e.layerType,s=0;s<r.length;++s){var l=new R(t,{state:n,category:i,layerType:o,slideIdx:r[s]});a.push(l)}}},{key:"collectShapes",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=e.text,c=o,d=null,p=null;l&&(d=l.begin,p=l.end-d);for(var u=0;u<s.length;++u){var h=s[u];h=Object.assign({state:r,category:n,layerType:i,slideIdx:c},h,{gcp:d,ccp:p});var f=new R(t,h);f.setProp("itemParam",Object.assign({},h)),a.push(f)}}},{key:"collectCellRange",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=e.cellRange,c=o;if(1===s.length){var d=s[0];if(l){d=Object.assign({state:r,category:n,layerType:i,slideIdx:c,cellRange:l},d);var p=new R(t,d);p.setProp("itemParam",Object.assign({},d)),a.push(p)}}}},{key:"collectText",value:function(e,t,a){var r=e.state,n=e.category,i=e.layerType,o=e.activeSlide,s=e.shapes,l=e.text,c=o,d=null,p=null;null!=l.begin&&null!=l.end&&(d=l.begin,p=l.end-l.begin);var u=null;if(e.cellRange&&(u=e.cellRange),1===s.length){var h=s[0];h=Object.assign({state:r,category:n,layerType:i,slideIdx:c},h,{cellRange:u,gcp:d,ccp:p});var f=new R(t,h);f.setProp("itemParam",Object.assign({},h)),a.push(f)}}},{key:"collectItems",value:function(){var e=v.default.selectItem,t=Object(C.a)(),a=[],r=this.op.param.select;switch(r.state){case T.SelectType.select_none:this.collectNone(r,e,a);break;case T.SelectType.select_slide:case T.SelectType.select_multi_slide:this.collectSlide(r,e,a);break;case T.SelectType.select_shape:case T.SelectType.select_multi_shape:this.collectShapes(r,e,a);break;case T.SelectType.select_table:case T.SelectType.select_cell:case T.SelectType.select_multi_cell:this.collectCellRange(r,e,a);break;case T.SelectType.select_text:this.collectText(r,e,a)}for(var n=0;n<a.length;n++)a[n]._gid=t,a[n].param.select=Object(g.a)(r),this._initItem(a[n]);return a}},{key:"_mergeSlide",value:function(e,t){for(var a=0;a<t.length;++a)e.slides.push(t[a].slideIdx)}},{key:"_getShapesParam",value:function(e){for(var t=[],a=[],r=[],n=[],i=0;i<e.length;++i){var o=e[i],s=o.getProp("itemParam"),l=Object.assign({},s,{category:o.category,layerType:o.layerType,slideIdx:o.slideIdx,shapePath:o.shapePath});t.push(l),o.slideIdx>=0&&a.indexOf(o.slideIdx)<0&&a.push(o.slideIdx),o.isValid()&&(r.push(l),n.push(o))}return{shapes:t,validShapes:r,validItems:n,slides:a}}},{key:"_mergeShapes",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validShapes,i=a.slides;e.shapes=r,e.state=n.length>1?T.SelectType.select_multi_shape:T.SelectType.select_shape,e.slides=i}},{key:"_mergeCellRange",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validItems,i=a.slides;e.shapes=r,e.slides=i;var o=n[0];if(o){var s=o.cellRange;O.isValidCellRange(s)&&(e.tableActive=!0,e.cellRange=s)}}},{key:"_mergeText",value:function(e,t){var a=this._getShapesParam(t),r=a.shapes,n=a.validItems,i=a.slides;e.shapes=r,e.slides=i;var o=n[0];if(o){e.text={begin:o.gcp,end:o.gcp+o.ccp};var s=o.cellRange;s&&O.isValidCellRange(s)&&(e.cellRange=s)}}},{key:"convertFromItems",value:function(e){if(e&&e.length>0){var t=e[0].getOrgParam(),a=e[0].getParam(),r=t.select.state,n=Object.assign({},t.select,a.select);switch(n.state=r,n.slides=[],r){case T.SelectType.select_none:n.activeSlide=-1,n.slides=[];break;case T.SelectType.select_slide:case T.SelectType.select_multi_slide:this._mergeSlide(n,e);break;case T.SelectType.select_shape:case T.SelectType.select_multi_shape:this._mergeShapes(n,e);break;case T.SelectType.select_table:case T.SelectType.select_cell:case T.SelectType.select_multi_cell:this._mergeCellRange(n,e);break;case T.SelectType.select_text:this._mergeText(n,e)}n.slides&&(n.activeSlide=0===n.slides.length?-1:n.slides[0]),t.select=n;var i=this.wrapper({name:v.default.paste,param:t});return i.setCommandProp("_items",e),[i]}return e}},{key:"apply",value:function(){var e=this.op,t=this.pres,a=this.selection,r=a.transaction,n=e.param.select,i=Object.assign({},n);if(n.text&&(i.begin=n.text.begin,i.end=n.text.end),e.param.cvCmds=null,a.transDepositedInstall(i),r.beginTransact(),"DRAG_SHAPES"===e.param.actionName){var o=a.getShapeSelection().insertCloneShapes();if(o&&o.length>0){for(var s=[],l=0;l<o.length;l++){o[l].enableModifyProperty(["transform2D"]);var c=le(t,o[l]),d=c.category,p=c.layerType,u=c.slideIdx,h=c.shapePath;s.push({name:"shapeInsert",param:{category:d,layerType:p,slideIdx:u,shapePath:h,slideProps:{}}})}a.selectShapes(o),e.param.cvCmds=s}var f=window.APP.utils.createModifier("PasteModifier",e.param.extraDatas||{});r.markData("modifier",f),r.registerEndNotify((function(e){if(!e){f.getFlag("actionName")&&r.setActionName(f.getFlag("actionName"));var a=r.getCommands(),n=a&&a[0];if(n&&"paste"===n.name){var i=n.param,o=f.modifiedData();t.copypasteMgr._checkExtraParams(i,o&&o.extraDatas)}}}))}r.addCommand(e.name,e.param),this.commitTransact(r)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op),t=this.createCvCmdsForReverse(this.op);return t&&(e.param.cvCmds=t),e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new ce}}]),t}(O);var pe=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(e,t,a){if(((n=t.name)===v.default.commentAdd||n===v.default.commentDelete||n===v.default.commentModify)&&e.isSameSlideWith(t)){var r=this.getByAdjust(e,t.param.index);if(null!=r)return A(t,a).param.index=r,!0}var n;return!1}},{key:"getByAdjust",value:function(e,t){var a=e.param.index;return a<t||a===t&&!this.bPreferKeep?t+1:null}}]),e}(),ue=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_slide,e}},{key:"apply",value:function(){var e=this.category();if("slides"===e){if(this.isValid()){var t=this.op,a=this.selection.transaction;a.beginTransact(),a.addCommand(t.name,t.param,t.cmdFlag),this.commitTransact(a)}}else console.warn("Not support category:"+e)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.commentDelete,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new pe}}]),t}(O);var he=function(){function e(){o()(this,e)}return l()(e,[{key:"commentAdd",value:function(e,t,a){if(e.isSameSlideWith(t)&&e.param.index<t.param.index)return A(t,a).param.index-=1,!0;return!1}},{key:"defaultCommand",value:function(e,t,a){if(((o=t.name)===v.default.commentAdd||o===v.default.commentDelete||o===v.default.commentModify)&&e.isSameSlideWith(t)){var r=null,n=e.param.index,i=t.param.index;if(n===i?r=-1:n<i&&(r=i-1),null!=r)return A(t,a).param.index=r,!0}var o;return!1}}]),e}(),fe=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_slide,e}},{key:"apply",value:function(){var e=this.category();if("slides"===e){if(this.isValid()){var t=this.op,a=this.pres,r=this.selection,n=t.param.slideIdx;if(!(n<0||n>=a.slides.getSlideCount())){var i=a.slides.getSlideAt(n),o=r.transaction;o.beginTransact(),t.param.commentId&&i.deleteComment(t.param.commentId),o.addCommand(t.name,t.param,t.cmdFlag),this.commitTransact(o)}}}else console.warn("Not support category:"+e)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.commentAdd,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new he}}]),t}(O),me=function e(){o()(this,e)},ve=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(){return T.SelectType.select_slide}},{key:"apply",value:function(){var e=this.category();if("slides"===e){if(this.isValid()){var t=this.op,a=this.pres,r=this.selection.transaction,n=t.param.slideIdx,i=t.param.commentId,o=t.param.pos,s=a.slides.getSlideAt(n);r.beginTransact();var l=s.getComments().queryComment(i);s.updateCommentPos(l,o),r.addCommand(t.name,t.param,t.cmdFlag),this.commitTransact(r)}}else console.warn("Not support category:"+e)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new me}}]),t}(O),ge=a(154),ye=a.n(ge),Te=a(201),Ce=a(204);function _e(e){return e===v.default.effectAdd||e===v.default.effectRemove||e===v.default.effectMove||e===v.default.modifyEffectProps||e===v.default.behaviorAdd||e===v.default.behaviorMove||e===v.default.behaviorRemove||e===v.default.modifyBehaviorProps}function be(e,t){if(e.length!==t.length)return!1;for(var a=0;a<t.length-1;a++)if(e[a]!==t[a])return!1;return!0}function Se(e,t){if(e.length>t.length)return!1;for(var a=0;a<e.length-1;a++)if(e[a]!==t[a])return!1;return!0}function ke(e){return e.name===v.default.effectAdd||e.name===v.default.behaviorAdd}function Pe(e){return e.name===v.default.effectRemove||e.name===v.default.behaviorRemove}function we(e){return e.name===v.default.effectMove||e.name===v.default.behaviorMove}function xe(e){return e.name===v.default.modifyEffectProps||e.name===v.default.modifyBehaviorProps}var Ie=function(){function e(){o()(this,e)}return l()(e,[{key:"transInner",value:function(e,t){var a=!1,r=e.param,n=t.param,i=r.sPath,o=r.tPath,s=n.sPath,l=i[i.length-1],c=o[o.length-1],d=s[s.length-1],p=l<c?c+1:c,u=!1;if(we(t)){var h=n.tPath;i.length===s.length&&i.length===h.length&&(u=!0)}if(Se(i,s)){var f=s.length-1,m="normal";u?m="from":ke(t)&&(m="insert");var v=O.commTransIdxForMove(l,p,d,m,this.bPreferKeep);null!=v&&v!==d&&(s[f]=v,a=!0)}if(we(t)){var g=n.tPath,y=s.length-1;if(Se(i,g)){var T=g[y];if(d!==l){var C=!1;u&&d<T&&(T+=1,C=!0);var _=u?"to":"insert",b=O.commTransIdxForMove(l,p,T,_,this.bPreferKeep);null!=b&&b!==T&&(C&&(b-=1),g[y]=b,a=!0)}}}return a}},{key:"innerIdxMove",value:function(e,t,a){return e===t?t<a?a-1:a:t<e&&e<a?e-1:a<=e&&e<t?e+1:e}},{key:"defaultCommand",value:function(e,t,a){if(_e(t.name)&&e.isSameSlideWith(t)){var r=t.clone(),n=this.transInner(e,r);return n&&a.push(r),n}return!1}},{key:"selectItem",value:function(e,t,a){if(null!=t.sPath&&e.isSameSlideWith(t)){var r=t.clone(),n=this.transInner(e,r);return n&&a.push(r),n}return!1}}]),e}(),Re=function(){function e(){o()(this,e)}return l()(e,[{key:"transInner",value:function(e,t){var a=!1,r=e.param,n=t.param,i=r.sPath,o=n.sPath;if(Se(i,o)){var s=i.length-1,l=i[s],c=o[s];if(ke(t)||Pe(t)||xe(t)){if(-1===l||-1===c)return a;l<=c&&(o[s]=c+1,a=!0)}else if(we(t)){var d=n.tPath,p=d[s];if(l<0)return!1;l<=c&&l<=p?(o[s]=c+1,d[s]=p+1,a=!0):l>=c&&l<=p?(d[s]=p+1,a=!0):l<=c&&l>=p&&(o[s]=c+1,a=!0)}return a}}},{key:"defaultCommand",value:function(e,t,a){if(_e(t.name)&&e.isSameSlideWith(t)){var r=t.clone(),n=this.transInner(e,r);return n&&a.push(r),n}return!1}},{key:"selectItem",value:function(e,t,a){if(null!=t.sPath&&e.isSameSlideWith(t)){var r=t.clone(),n=this.transInner(e,r);return n&&a.push(r),n}return!1}}]),e}(),Oe=function(){function e(){o()(this,e)}return l()(e,[{key:"transInner",value:function(e,t){var a=e.param,r=t.param,n=!1,i=a.sPath,o=r.sPath;if(Se(i,o)){var s=i.length-1,l=i[s],c=o[s];if(ke(t)||Pe(t)||xe(t))l===c?t.name!==v.default.effectAdd&&t.name!==v.default.behaviorAdd&&(o[s]=-1,n=!0):l<c&&(o[s]=c-1,n=!0);else if(we(t)){var d=r.tPath;if(be(i,o)&&be(i,d)){var p=c,u=d[s],h=p,f=u;l===p?p=-1:l<p&&l<u?(p-=1,u-=1):p<l&&l<u?u-=1:u<=l&&l<p&&(p-=1),p===h&&u===f||(o[s]=p,d[s]=u,n=!0)}else if(Se(i,o)&&(l===c?(o[s]=-1,n=!0):l<c&&(o[s]=c-1,n=!0)),Se(i,d)){var m=d[s];l<m&&(d[s]=m-1,n=!0)}}return n}}},{key:"defaultCommand",value:function(e,t,a){if(_e(t.name)&&e.isSameSlideWith(t)){var r=t.clone(),n=this.transInner(e,r);return n&&a.push(r),n}return!1}},{key:"selectItem",value:function(e,t,a){if(null!=t.sPath&&e.isSameSlideWith(t)){var r=t.clone(),n=this.transInner(e,r);return n&&a.push(r),n}return!1}}]),e}(),Ae=function e(){o()(this,e)},Be=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=e.gcp>=0?T.SelectType.select_text:T.SelectType.select_shape,e}}]),t}(O),De=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Ie),Fe=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=t.getBuddy(),n=e.param,i=n.slideIdx,o=n.category,s=n.layerType;a.selectSlideAt(i,o,s);var l=a.transaction;if(r.fetchShape({category:o,layerType:s,slideIdx:i,shapePath:e.param.shapePath})){var c=e.param.sPath,d=e.param.tPath;l.beginTransact();var p=a.getActiveSlide().getTiming().mainSequence;p&&p.moveSubNode(c[1],d[1]),l.addCommand(e.name,e.param),this.commitTransact(l)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);e.isReversed=!0;var t=e.param,a=t.sPath.length-1,r=t.sPath[a];return t.sPath[a]=t.tPath[a],t.tPath[a]=r,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new De}}]),t}(Be),Me=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),l()(t,[{key:"transOthers",value:function(e,t,a){var r=!1,n=!1;switch(t.name){case v.default.txtStrmDelete:null!=e.gcp&&e.isSameTextStreamWith(t)&&t.gcp<=e.gcp&&t.ccp>=e.ccp-1&&(n=!0);break;case v.default.shapeDelete:null==e.gcp&&e.isSameShapeWith(t)&&(n=!0)}if(n){var i=Object(C.a)(),o=t.clone();o.setProp("fakeCmdToken",i),a.push(o);var s=e.clone().wrapper.reverse();s.op.param.bOnlyServerExec=!0,s.collectItems().forEach((function(e){e.setProp("bFakeCmd",!0),e.setProp("fakeCmdToken",i),e.wrapper.setParent(t.wrapper),a.push(e)})),r=!0}return r}},{key:"defaultCommand",value:function(e,a,r){return a.name===v.default.txtStrmDelete||a.name===v.default.shapeDelete?this.transOthers(e,a,r):ye()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"defaultCommand",this).call(this,e,a,r)}}]),t}(Re),je=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection;if(!(e.param&&null!=e.param.ccp&&e.param.ccp<=1)){var r=a.transaction,n=t.getBuddy(),i=e.param,o=i.slideIdx,s=i.category,l=i.layerType;a.selectSlideAt(o,s,l),r.beginTransact();var c=n.fetchShape({category:s,layerType:l,slideIdx:o,shapePath:e.param.shapePath});if(c){var d=e.param.sPath,p=e.param.nEffectType,u=e.param.nCategory;2===u?u=3:3===u&&(u=2);var h={presetType:p,presetClass:Object(Te.animCategoryStr)(u),animCategory:u,targetShapeId:c.getId(),nodeType:Te.AnimNodeType.Effect},f=Ce.a.createNode(Te.AnimNodeType.Effect,h);if(!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var m=window.aeoFactory.get(u,p);m&&m.create(f);var v=a.getActiveSlide().getTiming(),g=v.mainSequence;if(!g){var y=v.getTimeLine();g=Ce.a.createNode(Te.AnimNodeType.MainSeq),y.insertSubNode(0,g)}g.insertSubNode(d[1],f),a.selectAnimation(f)}r.addCommand(e.name,e.param),this.commitTransact(r)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.effectRemove,e.isReversed=!0,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Me}}]),t}(Be),Ee=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Oe),Ne=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection;if(!e.param.bOnlyServerExec){var r=t.getBuddy(),n=a.transaction,i=e.param,o=i.slideIdx,s=i.category,l=i.layerType;if(a.selectSlideAt(o,s,l),n.beginTransact(),r.fetchShape({category:s,layerType:l,slideIdx:e.param.slideIdx,shapePath:e.param.shapePath})){var c=e.param.sPath,d=a.getActiveSlide().getTiming().mainSequence;d&&d.deleteSubNode(c[1]),n.addCommand(e.name,e.param)}this.commitTransact(n)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.isReversed=!0,e.name=v.default.effectAdd,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Ee}}]),t}(Be),Le=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Ae),Ve=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_modifyAnimationSet",value:function(e,t){var a=e.getCategory(),r=e.getpresetType();if(!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var n=window.aeoFactory.get(a,r);if(!n)return!1;null!=t.direction&&n.apply(e,"direciton",t.direction);var i=t.animType;if(!i)return!0;switch(i){case Te.AnimBehaviorType.set:return this._modSetProperty(n,e,t);case Te.AnimBehaviorType.Command:return this._modCmdProperty(n,e,t);case Te.AnimBehaviorType.Filter:return this._modFilterProperty(n,e,t);case Te.AnimBehaviorType.Rotation:return this._modRotateProperty(n,e,t);case Te.AnimBehaviorType.Scale:return this._modScaleProperty(n,e,t);case Te.AnimBehaviorType.Color:return this._modColorProperty(n,e,t);case Te.AnimBehaviorType.Property:return this._modPropProperty(n,e,t);default:return!0}}},{key:"_modSetProperty",value:function(e,t,a){return null!=a.opacity&&e.apply(t,"opacity",a.opacity),!0}},{key:"_modFilterProperty",value:function(e,t,a){return!0}},{key:"_modCmdProperty",value:function(e,t,a){return!0}},{key:"_modRotateProperty",value:function(e,t,a){return null!=a.byAngle&&e.apply(t,"byAngle",a.byAngle),!0}},{key:"_modScaleProperty",value:function(e,t,a){return null!=a.by&&e.apply(t,"by",a.by),null!=a.byX&&e.apply(t,"byX",a.byX),null!=a.byY&&e.apply(t,"byY",a.byY),!0}},{key:"_modColorProperty",value:function(e,t,a){return a.colorTo&&e.apply(t,"colorTo",a.colorTo),a.colorType&&e.apply(t,"colorType",a.colorType),!0}},{key:"_modPropProperty",value:function(e,t,a){return!0}},{key:"_modifyAnimationTimer",value:function(e,t){null!=t.restart&&e.setProperty(t.restart),null!=t.delay&&e.setDuration(t.delay),null!=t.duration&&e.setDuration(t.duration),null!=t.repeat&&e.setProperty("repeat",t.repeat),null!=t.trigger&&e.setProperty("triggerType",t.trigger)}},{key:"_modifyAnimationInfo",value:function(e,t){null!=t.buildLevel&&e.setBuildLevel(t.buildLevel)}},{key:"_modifyAnimationPlay",value:function(e,t){}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=e.param,n=r.slideIdx,i=r.category,o=r.layerType;a.selectSlideAt(n,i,o);var s=a.getAnimSelection(),l=t.getBuddy(),c=a.transaction,d=e.param.nCategory,p=e.param.nEffectType,u=e.param.extendProps,h=e.param.sPath,f=a.getActiveSlide().getTiming().mainSequence;if(f){var m=f.subNode(h[1]);if(m)l.fetchShape({category:i,layerType:o,slideIdx:e.param.slideIdx,shapePath:e.param.shapePath})&&(c.beginTransact(),u.AnimReplace&&s.replaceOneAnimationNoTransact(m,d,p),u.AnimSet&&this._modifyAnimationSet(m,u.AnimSet),u.AnimTimer&&this._modifyAnimationTimer(m,u.AnimTimer),u.AnimInfo&&this._modifyAnimationInfo(m,u.AnimInfo),u.AnimPlay&&this._modifyAnimationPlay(m,u.AnimPlay),c.addCommand(e.name,e.param),this.commitTransact(c))}}}},{key:"reverse",value:function(){return this.clone()}},{key:"transforms",value:function(){return new Le}}]),t}(Be),We=window.CoreExports.table.TableOpType,Ge=["txtStrmInsert","txtStrmDelete","txtStrmFmtChpx","txtStrmFmtPapx","txtStrmFmtChpxV2","txtStrmFmtPapxV2","formatBrush","selectItem"];function He(e,t){return e.startRow<=t.startRow&&e.endRow>=t.endRow}function Ue(e,t){return e.startCol<=t.startCol&&e.endCol>=t.endCol}function ze(e,t){return e.startRow>t.startRow&&e.startRow<t.endRow}function qe(e,t){return e.endRow>t.startRow&&e.endRow<t.endRow}function Ke(e,t){return e.startCol>t.startCol&&e.startCol<t.endCol}function Qe(e,t){return e.endCol>t.startCol&&e.endCol<t.endCol}var Je=function(){function e(){o()(this,e)}return l()(e,null,[{key:"colInsert",value:function(e,t,a){return e.startCol<=t.startCol&&(t.startCol+=a,t.endCol+=a,!0)}},{key:"colDelete",value:function(e,t,a){return e.startCol<=t.startCol?(t.startCol+=a,t.endCol+=a,!0):e.startCol>t.startCol&&e.startCol<t.endCol&&(t.endCol+=a,!0)}},{key:"common",value:function(t,a,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.colDelete(t,a,r,n)}}]),e}(),Ye=function(){function e(){o()(this,e)}return l()(e,null,[{key:"colInsert",value:function(e,t,a){return!(e.startCol>=t.startCol)&&(e.startCol<t.startCol&&e.endCol>t.startCol?(t.startCol=-1,t.endCol=-1,!0):(t.startCol-=a,t.endCol-=a,!0))}},{key:"colDelete",value:function(e,t,a){if(e.startCol>=t.endCol)return!1;if(Ue(e,t))return t.startCol=-1,t.endCol=-1,!0;if(Ue(t,e))return t.endCol-=a,!0;if(Ke(e,t))return t.endCol=e.startCol,!0;if(Qe(e,t)){var r=t.endCol-e.endCol;return t.endCol-=a,t.startCol=t.endCol-r,!0}return t.startCol-=a,t.endCol-=a,!0}},{key:"common",value:function(t,a,r){return e.colDelete(t,a,r)}}]),e}(),Xe=function(){function e(){o()(this,e)}return l()(e,null,[{key:"rowInsert",value:function(e,t,a){return e.startRow<=t.startRow&&(t.startRow+=a,t.endRow+=a,!0)}},{key:"rowDelete",value:function(e,t,a){return e.startRow<=t.startRow?(t.startRow+=a,t.endRow+=a,!0):e.startRow>t.startRow&&e.startRow<t.endRow&&(t.endRow+=a,!0)}},{key:"common",value:function(t,a,r){return e.rowDelete(t,a,r)}}]),e}(),Ze=function(){function e(){o()(this,e)}return l()(e,null,[{key:"rowInsert",value:function(e,t,a){return!(e.startRow>=t.startRow)&&(e.startRow<t.startRow&&e.endRow>t.startRow?(t.startRow=-1,t.endRow=-1,!0):(t.startRow-=a,t.endRow-=a,!0))}},{key:"rowDelete",value:function(e,t,a){if(e.startRow>=t.endRow)return!1;if(He(e,t))return t.startRow=-1,t.endRow=-1,!0;if(He(t,e))return t.endRow-=a,!0;if(ze(e,t))return t.endRow=e.startRow,!0;if(qe(e,t)){var r=t.endRow-e.endRow;return t.endRow-=a,t.startRow=t.endRow-r,!0}return t.startRow-=a,t.endRow-=a,!0}},{key:"common",value:function(t,a,r){return e.rowDelete(t,a,r)}}]),e}(),$e=function(){function e(){o()(this,e)}return l()(e,null,[{key:"colInsert",value:function(e,t){return!!(Ue(e,t)||Qe(e,t)||Ke(e,t))&&(t.startCol=-1,t.endCol=-1,!0)}},{key:"colDelete",value:function(e,t){return Ue(e,t)||Ue(t,e)?(t.startCol=e.startCol,t.endCol=e.endCol,!0):Ke(e,t)?(t.endCol=e.endCol,!0):!!Qe(e,t)&&(t.startCol=e.startCol,!0)}},{key:"rowInsert",value:function(e,t){return!!(He(e,t)||ze(e,t)||qe(e,t))&&(t.startRow=-1,t.endRow=-1,!0)}},{key:"rowDelete",value:function(e,t){return He(e,t)?(t.startRow=e.startRow,t.endRow=e.endRow,!0):ze(e,t)?(t.endRow=e.endRow,!0):!!qe(e,t)&&(t.startRow=e.startRow,!0)}},{key:"rowColumIntersect",value:function(e,t){return!(t.endCol<=e.startCol||t.startCol>=e.endCol||t.endRow<=e.startRow||t.startRow>=e.endRow)&&(t.startCol=t.endCol=t.startRow=t.endRow=-1,!0)}}]),e}(),et=function(){function e(){o()(this,e)}return l()(e,[{key:"filterTrans",value:function(e,t,a){var r,n=!1;if(r=t.name,!(Ge.indexOf(r)>=0))return!1;var i=t.clone(),o=i.param;if(!o.cellRange)return!1;switch(e.param.optType){case We.InsertRow:n=this.filterInsertRow(e,i);break;case We.DeleteRows:n=this.filterDelRow(e,i);break;case We.InsertCol:n=this.filterInsertCol(e,i);break;case We.DeleteCols:n=this.filterDelCol(e,i);break;case We.MergeCells:n=this.filterMergeCell(e,i);break;case We.UnMergeCells:n=this.filterUnMergeCells(e,i)}if("selectItem"===i.name&&o.state===T.SelectType.select_text){var s=o.cellRange;s.endRow=s.startRow+1,s.endCol=s.startCol+1,n=!0}return n&&a.push(i),n}},{key:"filterInsertRow",value:function(e,t){var a=e.param,r=t.param,n=a.range,i=r.cellRange,o=n.startRow,s=n.endRow-o;return!(s<=0)&&Xe.common(n,i,s)}},{key:"filterDelRow",value:function(e,t){var a=e.param,r=t.param,n=a.range,i=r.cellRange,o=n.endRow-n.startRow;return!(o<=0)&&Ze.common(n,i,o)}},{key:"filterInsertCol",value:function(e,t){var a=e.param,r=t.param,n=a.range,i=r.cellRange,o=n.endCol-n.startCol;return!(o<=0)&&Je.common(n,i,o)}},{key:"filterDelCol",value:function(e,t){var a=e.param,r=t.param,n=a.range,i=r.cellRange,o=n.endCol-n.startCol;return!(o<=0)&&Ye.common(n,i,o)}},{key:"filterMergeCell",value:function(e,t){if("paste"===t._wrapper.name)return!1;var a=e.param,r=t.param,n=a.cellRange,i={startRow:n.startRow,endRow:n.startRow+1,startCol:n.startCol,endCol:n.startCol+1};return t.cellRange=r.cellRange=i,t.state===T.SelectType.select_text&&(t.gcp=r.gcp=0,t.ccp=r.ccp=1),!0}},{key:"filterUnMergeCells",value:function(e,t){return!1}},{key:"transInner",value:function(e,t,a){var r=!1,n=t.clone();switch(e.param.optType){case We.InsertRow:r=this.insertRow(e,n);break;case We.DeleteRows:r=this.deleteRow(e,n);break;case We.InsertCol:r=this.insertCol(e,n);break;case We.DeleteCols:r=this.deleteCol(e,n);break;case We.MergeCells:r=this.mergeCells(e,n)}return r&&a.push(n),r}},{key:"insertRow",value:function(e,t){var a=!1,r=e.param,n=t.param,i=n.optType;if(!i)return a;var o=r.range,s=n.range,l=o.endRow-o.startRow;if(l<=0)return!1;switch(i){case We.InsertRow:a=Xe.rowInsert(o,s,l);break;case We.DeleteRows:a=Xe.rowDelete(o,s,l);break;case We.DistributeRows:case We.MergeCells:case We.UnMergeCells:case We.ModCells:case We.SetHoriPos:case We.SetRowHeight:a=Xe.common(o,s,l);break;case We.InsertCol:case We.DeleteCols:a=Xe.common(o,s,l)}return a}},{key:"deleteRow",value:function(e,t){var a=!1,r=e.param,n=t.param,i=n.optType,o=r.range,s=n.range,l=o.endRow-o.startRow;if(l<=0)return!1;switch(i){case We.InsertRow:a=Ze.rowInsert(o,s,l);break;case We.DeleteRows:a=Ze.rowDelete(o,s,l);break;case We.DistributeRows:case We.MergeCells:case We.UnMergeCells:case We.SetHoriPos:case We.SetRowHeight:case We.ModCells:a=Ze.common(o,s,l);break;case We.InsertCol:case We.DeleteCols:a=Ze.common(o,s,l)}return a}},{key:"insertCol",value:function(e,t){var a=!1,r=e.param,n=t.param,i=n.optType,o=r.range,s=n.range,l=o.endCol-o.startCol;if(l<=0)return!1;switch(i){case We.InsertCol:a=Je.colInsert(o,s,l);break;case We.DeleteCols:a=Je.colDelete(o,s,l);break;case We.DistributeCols:case We.MergeCells:case We.UnMergeCells:case We.ModCells:case We.SetVertPos:case We.SetColWidth:a=Je.common(o,s,l);break;case We.InsertRow:case We.DeleteRows:a=Je.common(o,s,l)}return a}},{key:"deleteCol",value:function(e,t){var a=!1,r=e.param,n=t.param,i=n.optType,o=r.range,s=n.range,l=o.endCol-o.startCol;if(l<=0)return!1;switch(i){case We.InsertCol:a=Ye.colInsert(o,s,l);break;case We.DeleteCols:a=Ye.colDelete(o,s,l);break;case We.DistributeCols:case We.MergeCells:case We.UnMergeCells:case We.ModCells:case We.SetVertPos:case We.SetColWidth:a=Ye.common(o,s,l);break;case We.InsertRow:case We.DeleteRows:a=Ye.common(o,s,l)}return a}},{key:"innerMerge",value:function(e,t){}},{key:"mergeCells",value:function(e,t){var a=!1,r=e.param,n=t.param,i=n.optType;if(!i)return a;var o=r.range,s=n.range;switch(i){case We.InsertRow:a=$e.rowInsert(o,s);break;case We.DeleteRows:a=$e.rowDelete(o,s);break;case We.InsertCol:a=$e.colInsert(o,s);break;case We.DeleteCols:a=$e.colDelete(o,s);break;case We.MergeCells:case We.UnMergeCells:a=$e.rowColumIntersect(o,s)}return a}},{key:"defaultCommand",value:function(e,t,a){if(e.isSameShapeWith(t))switch(t.name){case"tableHandler":return this.transInner(e,t,a);default:return this.filterTrans(e,t,a)}return!1}}]),e}(),tt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_table,e}},{key:"collectItems",value:function(){var e=Object(C.a)(),t=[],a=this.op,r=a.name,n=a.param,i=n.category,o=n.layerType,s=n.slideIdx,l=n.shapePath,c=n.range,d=this._toSelectionRange(Object.assign(Object(g.a)(n),{category:i,layerType:o,slideIdx:s,shapePath:l,cellRange:c}));t.push(new R(r,d));for(var p=0;p<t.length;++p)t[p]._gid=e,this._initItem(t[p]);return t}},{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection;if(e.isReversed)console.warn("apply a reverse op");else{var r=e.param,n=r.optType,i=r.category,o=r.layerType,s=r.slideIdx,l=r.extraDatas,c=t.getBuddy().fetchShape({category:i,layerType:o,slideIdx:s,shapePath:r.shapePath});if(c)if(c.hasTable()){var d=c.getTableFrame();if(n!==We.ModTable){if(O.isValidCellRange(r.range)){var p=Object(g.a)(r.range);switch(this.hasNewSelection=!0,n){case We.InsertRow:this._applyInsertRow(a,e,d,p);break;case We.InsertCol:this._applyInsertCol(a,e,d,p);break;case We.DeleteRows:this._applyRemoveRows(a,e,d,p);break;case We.DeleteCols:this._applyRemoveCols(a,e,d,p);break;case We.MergeCells:this._applyMergeCells(a,e,d,p);break;case We.UnMergeCells:this._applyUnMergeCells(a,e,d,p);break;case We.ModCells:this._applyModCells(a,e,d,p,l.props)}}}else{var u={startRow:0,endRow:d.getRowCount(),startCol:0,endCol:d.getColumnCount()};this._applyModCells(a,e,d,u,l.props)}}else console.warn("invalid table");else console.warn("invalid shape")}}}},{key:"_applyInsertRow",value:function(e,t,a,r){if(O.isValidCellRange(r)){var n=a.getRowCount();if(r.startRow<0)console.warn("invalid insert position");else{var i=t.param.extraDatas.bAbove;if(i){if(r.endRow>n)return}else if(r.startRow>n)return;var o=e.transaction;if(o.beginTransact(),i)a.insertRowAbove(r);else{var s=r.endRow-r.startRow,l=r.startRow,c={startRow:l-s,endRow:l,startCol:r.startCol,endCol:r.endCol};a.insertRowBellow(c)}var d=a.getColumnCount();r.startCol=0,r.endCol=d,a.visual.autoFit(),e.selectTableCells(r.startRow,r.startCol,r.endRow,r.endCol),this.hasNewSelection=!0,o.addCommand(t.name,t.param),this.commitTransact(o)}}}},{key:"_applyInsertCol",value:function(e,t,a,r){if(O.isValidCellRange(r)){var n=a.getColumnCount();if(!(r.startCol<0)){var i=t.param.extraDatas.bLeft;if(i){if(r.endCol>n)return}else if(r.startCol>n)return;var o=e.transaction;if(o.beginTransact(),i)a.insertColLeft(r);else{var s=r.endCol-r.startCol,l=r.startCol,c=l-s,d={startRow:r.startRow,endRow:r.endRow,startCol:c,endCol:l};a.insertColRight(d)}var p=a.getRowCount();r.startRow=0,r.endRow=p,a.visual.autoFit(),e.selectTableCells(r.startRow,r.startCol,r.endRow,r.endCol),this.hasNewSelection=!0,o.addCommand(t.name,t.param),this.commitTransact(o)}}}},{key:"_applyRemoveRows",value:function(e,t,a,r){if(O.isValidCellRange(r)){var n=a.getRowCount(),i=a.getColumnCount();if(r.endRow-r.startRow>=n)e.deleteShape([a.parent]);else{var o=e.transaction;o.beginTransact(),a.removeRows(r),n=a.getRowCount(),r.endRow=r.startRow+1,r.endRow>=n&&(r.startRow=n-1,r.endRow=n),r.startCol=0,r.endCol=i,a.visual.autoFit(),e.selectTableCells(r.startRow,r.startCol,r.endRow,r.endCol),this.hasNewSelection=!0,o.addCommand(t.name,t.param),this.commitTransact(o)}}}},{key:"_applyRemoveCols",value:function(e,t,a,r){if(O.isValidCellRange(r)){var n=a.getRowCount(),i=a.getColumnCount();if(r.endCol-r.startCol>=i)e.deleteShape([a.parent]);else{var o=e.transaction;o.beginTransact(),a.removeCols(r),i=a.getColumnCount(),r.endCol=r.startCol+1,r.endCol>=i&&(r.endCol=i,r.startCol=i-1),r.startRow=0,r.endRow=n,a.visual.autoFit(),e.selectTableCells(r.startRow,r.startCol,r.endRow,r.endCol),this.hasNewSelection=!0,o.addCommand(t.name,t.param),this.commitTransact(o)}}}},{key:"_applyMergeCells",value:function(e,t,a,r){if(O.isValidCellRange(r)){var n=e.transaction;n.beginTransact(),a.mergeCells(r),a.visual.autoFit(),e.selectTableCell(r.startRow,r.startCol),this.hasNewSelection=!0,n.addCommand(t.name,t.param),this.commitTransact(n)}}},{key:"_applyUnMergeCells",value:function(e,t,a,r){if(O.isValidCellRange(r)){var n=e.transaction;n.beginTransact(),a.unMergeCells(r),e.selectTblRange(r),this.hasNewSelection=!0,n.addCommand(t.name,t.param),this.commitTransact(n)}}},{key:"_applyModCells",value:function(e,t,a,r,n){if(O.isValidCellRange(r)){var i=e.transaction;i.beginTransact();var o=e.getTableSelection(),s=null;if(n.fill)(s=window.APP.utils.createModifier("Fill")).modify("fill",n.fill),o.modifyCellsPropertyNoTransact(s,a,r);else if(n.outline)(s=window.APP.utils.createModifier("Outline")).modify("outlineData",n.outline),o.modifyCellsPropertyNoTransact(s,a,r);else if(n.modifiers){s=window.APP.utils.createModifier("TblCellBorder");var l=n.modifiers[0],c=l.tag,d=l.val;s.modify(c,d),o.modifyCellsPropertyNoTransact(s,a,r)}i.addCommand(t.name,t.param),this.commitTransact(i)}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);e.isReversed=!this.op.isReversed;var t=e.param;switch(t.optType){case We.InsertRow:t.optType=We.DeleteRows;break;case We.InsertCol:t.optType=We.DeleteCols;break;case We.DeleteRows:t.optType=We.InsertRow;break;case We.DeleteCols:t.optType=We.InsertCol;break;case We.MergeCells:t.optType=We.UnMergeCells;break;case We.UnMergeCells:t.optType=We.MergeCells}return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new et}}]),t}(O),at=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(){return!1}}]),e}(),rt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"collectCommands",value:function(){for(var e=this.op,t=e.param.commands,a=Object(g.a)(e),r=[],n=0;n<t.length;n++){var i=this.wrapper(t[n]);i.setCommandProp("orgCmdParam",a.param),i.setParent(this);var o=i.collectCommands();r=r.concat(o)}return r}},{key:"collectDoneCommands",value:function(e){for(var t=this.op,a=t.param.commands,r=Object(g.a)(t),n=[],i=0;i<a.length;i++){var o=this.wrapper(a[i]);o.setCommandProp("orgCmdParam",r.param),o.setParent(this);var s=o.collectDoneCommands(e);n=n.concat(s)}return n}},{key:"convertFromCommands",value:function(e){if(e&&e.length>0){for(var t=e[0].getCommandProp("orgCmdParam")||{},a=[],r=0;r<e.length;r++)a.push(e[r].op);t.commands=a;var n={name:v.default.batchCommands,param:t};return[this.wrapper(n)]}}},{key:"transforms",value:function(){return new at}},{key:"apply",value:function(){var e=this,t=this.selection.transaction;t.beginBatchCommand(),t.setWaitCommands({all:!0});var a=this.op.param,r=a.commands,n=a.mainCommand,i=a.actionName,o=a.userData;if(n&&t.setMainCommand(n),i&&t.setActionName(i),o)for(var s in o)t.setUserData(s,o[s]);r.forEach((function(t){e._createWrapper(t,e.pres,e.selection).apply()})),this.commitTransact(t)}},{key:"reverse",value:function(){for(var e=this.op.param.commands,t=[],a=e.length-1;a>=0;a--)for(var r=this._createWrapper(e[a],this.pres,this.selection).reverse(),n=r instanceof Array?r:[r],i=0;i<n.length;i++)t.push(n[i].op);var o=this.op.param,s=o._orgName,l=o._orgParam;if(s&&s!==this.op.name){var c=this._createWrapper({name:s,param:l},this.pres,this.selection),d=Object.assign({},this.op.param),p=Object.assign({},this.op);return p.param=d,p.param.commands=t,c.merge(p)}var u=Object(g.a)(this.op);return u.param.commands=t,this.wrapper(u)}}]),t}(O);function nt(e){var t=e?e.length:0;if(t>0){for(var a=0;a<t;a++)if(e[a]<0)return!1;return!0}return!1}var it=function(){function e(){o()(this,e)}return l()(e,[{key:"_transUnsamePosition",value:function(e,t,a,r){for(var n=e.from.length,i=-1,o=0;o<n;o++)r<=e.sortedFrom[o]&&i<0&&(i=o);return a&&i<0&&r<=t&&(i=n),i<0&&r>t&&(i=n-1),i>0?r-i:r}},{key:"_transGroupedChildShape",value:function(e,t,a,r){var n=e.groupedInfo,i=e.newPos,o=e.childPos,s=e.bPreferGroup,l=e.bPreferKeep,c=!!t.wrapper.op.bReversed,d=a.getShapePath();if(!a.bInvalidRange()){var p=[],u=-1;if(a.name===v.default.shapeMove){if(!c){var h=a.clone();return h.shapePath[0]=-1,r.push(h),!0}if(a.bInvalidRange()){var f=a.clone();return f.setInvalidRange(I,!1),r.push(f),!0}p.push(i),p.push(n.to[o]);for(var m=1;m<d.length;m++)p.push(d[m]);var g=a.param.targetIndex,y=n.from.indexOf(g-1);u=y>=0?n.to[y]+1:g}else{p.push(i),s&&l||p.push(n.to[o]);for(var T=1;T<d.length;T++)p.push(d[T])}var C=a.clone();return C.shapePath=p,a.name===v.default.shapeMove&&(C.param.targetIdx=u),r.push(C),!0}return!1}},{key:"defaultCommand",value:function(e,t,a){if(!e.param.isDoneItem)return!1;if(!e.isSameSlideWith(t))return!1;var r=t.getSlideIdx(),n=t.getShapePath();if(!nt(n))return!1;var i=e.wrapper.getGroupedInfo();if(!i.bValid||i.slideIdx<0||i.slideIdx!==r||0===i.shapes.length)return!1;var o=e.wrapper.op,s=i.shapes.length,l=i.hasExec,c=l&&1===s;if(s<2&&!l)return!1;if(i.slideIdx<0||r!==i.slideIdx)return!1;var d=!!o.bReversed,p=d?i.ungroupedIdx:i.groupedIdx,u=p;d||(u=i.groupedIdx!==i.sortedFrom[s-1]?i.groupedIdx-s:i.groupedIdx-s+1);var h=t.name,f=h===v.default.shapeMove,m=[],y=f?t.param.targetIndex:-1,T=f?y:-1,C=!1,_=n[0],b=i.from.indexOf(_);if(b>=0&&h!==v.default.shapeInsert)return this._transGroupedChildShape({groupedInfo:i,newPos:u,childPos:b,bPreferGroup:c,bPreferKeep:this.bPreferKeep},e,t,a);if(b>=0&&t.bInvalidRange());else{var S=this._transUnsamePosition(i,p,c,_);C=S!==_,m=Object(g.a)(n),C&&(m[0]=S),h===v.default.shapeMove&&(T=this._transUnsamePosition(i,p,c,y),C=C||T!==y)}if(C){var k=t.clone();k.shapePath=m,h===v.default.shapeMove&&(k.param.targetIndex=T),a.push(k)}return C}}]),e}(),ot=function(){function e(){o()(this,e)}return l()(e,[{key:"_checkCanTrans",value:function(e,t){var a=e.param;if(a.isDoneItem&&e.isSameSlideWith(t)){var r=t.getSlideIdx(),n=t.getShapePath();if(nt(n)){var i=e.wrapper.getGroupedInfo();if(!(!i.bValid||i.slideIdx<0||i.ungroupedIdx<0||i.slideIdx!==r||0===i.shapes.length)&&a.targetPath&&nt(a.targetPath))return{groupedInfo:i,targetSlideIdx:r,targetShapePath:n}}}}},{key:"_transTargetPosUngroup",value:function(e,t,a,r){var n=0,i=r.from.length;if(t>r.ungroupedIdx){var o=r.sortedTo[i-1]-i+1;return t+(n=r.bReversed&&r.ungroupedIdx!==o?i:i-1)}if(t<r.sortedTo[0]||t===r.sortedTo[0]&&e&&a<=0)return t;if(r.bReversed){var s=t;n=i,a>=0&&r.sortedTo.indexOf(a-1)>=0&&(s=a);for(var l=0;l<i;l++){if(s<r.sortedTo[l]||a>0&&s===r.sortedTo[l]){n=l;break}e||(s+=1)}s>r.groupedIdx&&(n-=1)}else n=t>r.groupedIdx?i-1:0;return t+n}},{key:"shapeInsert",value:function(e,t,a){var r=this._checkCanTrans(e,t);if(!r)return!1;var n=r.groupedInfo,i=r.targetShapePath,o=n.ungroupedIdx,s=!1,l=i[0],c=[];if(1===i.length){var d=this._transTargetPosUngroup(!0,l,0,n);d!==l&&(c=[d],s=!0)}else if(o===l){var p=i[1];if(2===i.length){var u=n.sortedFrom.indexOf(p);u<0&&(u=n.sortedFrom.length);var h=o+u;c.push(h),s=!0}else{var f=n.from.indexOf(p);if(f>=0){var m=n.to[f];if(n.bReversed)for(var v=0;v<n.sortedFrom.length-1;v++){var g=n.sortedFrom[v],y=n.sortedFrom[v+1];if(n.fromToMap[g]===n.fromToMap[y])f===n.from.indexOf(y)&&(m+=1)}c.push(m);for(var T=2;T<i.length;T++)c.push(i[T]);s=!0}}}if(s){var C=t.clone();C.shapePath=c,a.push(C)}return s}},{key:"shapeMove",value:function(e,t,a){var r=this._checkCanTrans(e,t);if(!r)return!1;var n=r.groupedInfo,i=r.targetShapePath,o=n.ungroupedIdx,s=i[0],l=t.param.targetIndex,c=[],d=!1,p=n.from.length;if(i.length>=2){if(s===o){var u=i[1],h=n.from.indexOf(u);if(h>=0&&t.bInvalidRange()){d=!0;var f=t.clone();f.setInvalidRange(I,!1),a.push(f)}else if(h>=0){var m=n.to[h],v=l;if(2===i.length)if(l===n.sortedFrom[p-1]+1)v=n.fromToMap[n.sortedFrom[p-1]]+1;else{var g=n.from.indexOf(l);g>=0&&(v=n.to[g])}d=!0;var y=t.clone();a.push(y),c.push(m);for(var T=2;T<i.length;T++)c.push(i[T]);y.shapePath=c,v!==l&&(y.param.targetIndex=v)}}}else if(1===i.length)if(s===o||n.bReversed&&n.to.indexOf(s)>=0){d=!0;var C=t.clone();C.shapePath[0]=-1,a.push(C)}else{var _=this._transTargetPosUngroup(!1,s,-1,n),b=this._transTargetPosUngroup(!0,l,0,n);if(_!==s||b!==l){d=!0;var S=t.clone();S.shapePath=[_],S.param.targetIndex=b,a.push(S)}}return d}},{key:"defaultCommand",value:function(e,t,a){var r=this._checkCanTrans(e,t);if(!r)return!1;var n=r.groupedInfo,i=r.targetShapePath,o=n.ungroupedIdx,s=t.name,l=i[0];if(o===l&&(1===i.length||s===v.default.shapeUngroup))return this._transSameGroupShapeUngrouped(n,t,a);var c=!1,d=n.from.length,p=[];if(o!==l){if(l>=n.sortedTo[0]){var u=this._transTargetPosUngroup(!1,l,-1,n);u!==l&&((p=Object(g.a)(i))[0]=u,c=!0)}}else{var h=i[1],f=n.from.indexOf(h);if(h<0||f<0)console.error("Invalid Shape Path!"),(p=i)[1]=-1,c=!0;else{var m=n.to[f];if(n.bReversed)for(var y=0;y<d-1;y++){var T=n.sortedFrom[y],C=n.sortedFrom[y+1];if(n.fromToMap[T]===n.fromToMap[C])f===n.from.indexOf(C)&&(m+=1)}p.push(m);for(var _=2;_<i.length;_++)p.push(i[_]);c=!0}}if(c){var b=t.clone();b.shapePath=p,a.push(b)}return c}},{key:"_transSameGroupShapeUngrouped",value:function(e,t,a){var r=e.shapes.length;if(t.name===v.default.shapeMove){var n=t.param.targetIndex;if(n>=0){for(var i=0;i<r;i++){var o=e.sortedFrom[i],s=e.from.indexOf(o),l=A(t,a);l.param.shapeid=e.shapes[s].shapeid,n<=e.groupedIdx?(l.shapePath[0]=e.groupedIdx+i,l.param.targetIndex=n+i):l.param.targetIndex=n+r-1}return!0}}else if(t.name!==v.default.shapeInsert){var c=!1;if(t.state===T.SelectType.select_shape||t.state===T.SelectType.select_multi_shape){if(t.name!==v.default.modifyShapeProps&&t.name!==v.default.effectAdd&&t.name!==v.default.effectMove&&t.name!==v.default.effectRemove&&t.name!==v.default.modifyEffectProps&&t.name!==v.default.behaviorAdd&&t.name!==v.default.behaviorMove&&t.name!==v.default.behaviorRemove&&t.name!==v.default.modifyBehaviorProps&&t.name!==v.default.shapeUngroup){for(var d=0;d<r;d++){var p=A(t,a);p.shapePath[0]=e.to[d],p.param.shapeid=e.shapes[d].shapeid}return r>0}c=!0}else nt(t.shapePath)&&(console.warn("目标命令所编辑内容不是一个组合对象"),c=!0);if(c)return A(t,a).shapePath[0]=-1,!0}return!1}}]),e}(),st=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"collectItems",value:function(){var e=ye()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collectItems",this).call(this),a=this.op.param.targetPath;if(a)for(var r=0;r<e.length;r++)if(e[r].isValid()){var n=e[r].clone();n.param.isFakeItem=!0,n.shapePath=Object(g.a)(a),e.push(n);break}for(var i=0;i<e.length;i++)e[i].setMerger(S,"convertFromItems");return e}},{key:"collectDoneItems",value:function(){for(var e=this.op.param,t=e.shapes,a=Object(g.a)(e),r=0;r<t.length;r++){var n=new R(this.op.name,t[r]);if(n.state=T.SelectType.select_shape,n.isValid()){a.category=n.category,a.layerType=n.layerType,a.slideIdx=n.getSlideIdx();break}}a.isDoneItem=!0,a.state=T.SelectType.select_slide;var i=new R(this.op.name,a);return i._gid=Object(C.a)(),this._initItem(i),i.setMerger(S,"convertFromDoneItems"),[i]}},{key:"needCollectPreferDone",value:function(){return!0}},{key:"convertFromDoneItems",value:function(e){if(!e||0===e.length)return[];console.assert(1===e.length);var t=e[0],a=t.wrapper.clone(),r=t.getParam();return delete r.isDoneItem,delete r.state,a.op.param=r,a.setCommandProp("_items",e),[a]}},{key:"convertFromItems",value:function(e){if(!e||0===e.length)return[];if(e[0].param.isDoneItem)return this.convertFromDoneItems(e);for(var t=null,a=[],r=0;r<e.length;r++){var n=e[r];n.param.isFakeItem?t=n:a.push(n)}var i=this.defaultMergeItem(b,a);return console.assert(1===i.length),t&&i.length>0&&(i[0].op.param.targetPath=t.getShapePath()),i[0].setCommandProp("_items",e),i}},{key:"getGroupedInfo",value:function(){var e=!!this.op.bReversed,t={bValid:!1,slideIdx:-1,groupedIdx:-1,ungroupedIdx:-1,groupedShapeId:-1,from:[],to:[],sortedFrom:[],sortedTo:[],shapes:[],fromToMap:{},hasExec:!1,bReversed:e},a=!1,r=this.op.param;r.targetPath&&(a=!0,t.slideIdx=null!=r.slideIdx?r.slideIdx:-1,r.targetPath.length>0&&(t.ungroupedIdx=r.targetPath[0]),t.groupedShapeId=r.shapeid,t.hasExec=!0);for(var n=-1,i=r.shapes,o=0;o<i.length;o++){var s=i[o];if(s.slideIdx>=0&&nt(s.shapePath)){var l=-1;this.op.name===v.default.shapeGroup?l=s.shapePath[0]:(n=s.shapePath[0],l=s.shapePath[1]),t.from.indexOf(l)<0&&(t.from.push(l),t.shapes.push(s),t.sortedFrom.push(l),e&&(t.to.push(s.targetIndex),t.fromToMap[l]=s.targetIndex))}}var c=t.from.length;a&&(t.groupedIdx=t.ungroupedIdx);var d=function(e,t){return e>t?1:e<t?-1:0};if(t.sortedFrom.sort(d),c>0&&(t.slideIdx=t.shapes[0].slideIdx,!e)){a||(this.op.name===v.default.shapeGroup?t.groupedIdx=t.sortedFrom[c-1]:t.groupedIdx=n);for(var p=this.op.name===v.default.shapeGroup?0:t.groupedIdx,u=0;u<c;u++){var h=t.sortedFrom[u];t.fromToMap[h]=p+u}for(var f=0;f<c;f++)t.to.push(t.fromToMap[t.from[f]])}if(t.sortedTo=t.to.slice(0),t.sortedTo.sort(d),0===c)return t;if(e)if(this.op.name===v.default.shapeUngroup){var m=t.sortedTo[c-1]-c+1;t.ungroupedIdx!==m?t.groupedIdx=t.ungroupedIdx+c:t.groupedIdx=t.ungroupedIdx+c-1}else{for(var g=[],y=0;y<c;y++){var T=t.sortedTo.indexOf(t.to[y]);g.push(T),t.fromToMap[t.from[y]]=T}t.to=g,t.sortedTo=g.slice(0),t.sortedTo.sort(d)}return t.groupedIdx<0||(t.ungroupedIdx<0&&(t.ungroupedIdx=t.groupedIdx),t.bValid=!0),t}},{key:"reverse",value:function(){var e=this.getGroupedInfo(),t=this.op.bReversed,a=this.op.name,r=e.from.length,n=Object(g.a)(this.op);if(n.name=this.op.name===v.default.shapeGroup?v.default.shapeUngroup:v.default.shapeGroup,a===v.default.shapeGroup){var i=e.ungroupedIdx;t||(i!==e.sortedFrom[r-1]?i-=r:i=i-r+1),n.param.targetPath&&(n.param.targetPath=[i]);for(var o=[],s=0;s<r;s++){var l=Object(g.a)(e.shapes[s]);l.shapePath=[i,e.to[s]],l.targetIndex=e.from[s],o.push(l)}n.param.shapes=o}else{for(var c=[],d=0;d<r;d++){var p=Object(g.a)(e.shapes[d]);p.shapePath=[e.to[d]],p.targetIndex=e.from[d],c.push(p)}if(n.param.shapes=c,n.param.targetPath&&r>0){var u=n.param.targetPath;if(t){var h=u[0],f=e.sortedTo[r-1]-r+1;u[0]=h!==f?h+r:h+r-1}}}return n.bReversed=!t,this._createWrapper(n,this.pres,this.selection)}}]),t}(O),lt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){for(var e=this.op,t=this.pres,a=this.selection,r=e.param,n=r.shapes,i=[],o=t.getBuddy(),s=0;s<n.length;s++){var l=n[s];if(nt(l.shapePath)){var c=o.fetchShape(l);if(c){var d=c.visual.getRootShape();i.indexOf(d)<0&&i.push(d),l.shapeid=c.getId()}}}if(a.selectShapes(i),this.hasNewSelection=!0,!(i.length<2)){var p=window.getTransaction();if(p.beginTransact(),i.length>1){var u=a.getShapeSelection().groupShapesNoTransact(i);u&&a.selectShape(u.groupshape)}p.addCommand("shapeGroup",r),this.commitTransact(p)}}}},{key:"transforms",value:function(){return new it}}]),t}(st),ct=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){for(var e=this.op,t=this.pres,a=this.selection,r=e.param,n=r.shapes,i=t.getBuddy(),o=[],s=null,l=0;l<n.length;l++){var c=n[l];if(nt(c.shapePath)){var d=c.shapePath[0];if(d>=0){o=[d],s=c;break}}}if(s&&0!==o.length){var p=Object(g.a)(s);p.shapePath=o;var u=i.fetchShape(p,!1);if(u&&u.isGroupShape()){a.selectShape(u);var h=window.getTransaction();h.beginTransact();var f=a.getShapeSelection().ungroupShapesNoTransact(u);if(f){var m=f.sendparam;r.shapes=m.shapes}h.addCommand(e.name,e.param),this.commitTransact(h)}}}}},{key:"transforms",value:function(){return new ot}}]),t}(st),dt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}}]),t}(O),pt=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Ie),ut=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.selection,a=e.param.slideIdx;t.selectSlideAt(a);var r=t.transaction,n=e.param.sPath,i=e.param.tPath;if(!k(n,i))if(k(n.slice(0,n.length-1),i.slice(0,i.length-1))){r.beginTransact();var o=t.getActiveSlide(),s=Ce.a.getNode(o,n.slice(0,n.length-1));s&&s.moveSubNode(n[n.length-1],i[i.length-1]),r.addCommand(e.name,e.param),this.commitTransact(r)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);e.isReversed=!0;var t=e.param,a=t.sPath.slice(0);return t.sPath=t.tPath.slice(0),t.tPath=a,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new pt}}]),t}(dt),ht=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Re),ft=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.pres,a=this.selection,r=a.transaction,n=t.getBuddy(),i=e.param.slideIdx;if(a.selectSlideAt(i),r.beginTransact(),n.fetchShape({slideIdx:i,shapePath:e.param.shapePath})){var o=e.param.sPath,s=o[o.length-1],l=e.param.extendProps,c=Ce.a.createNode(l.behaviorType,l);if(!c)return;var d=a.getActiveSlide(),p=Ce.a.getNode(d,o.slice(0,o.length-1));if(!p)return;p.insertSubNode(s,c),a.selectAnimation(p)}r.addCommand(e.name,e.param),this.commitTransact(r)}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.name=v.default.behaviorRemove,e.isReversed=!0,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new ht}}]),t}(dt),mt=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Oe),vt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.selection,a=t.transaction,r=e.param.slideIdx;t.selectSlideAt(r),a.beginTransact();var n=e.param.sPath,i=n[n.length-1],o=t.getActiveSlide(),s=Ce.a.getNode(o,n.slice(0,n.length-1));s&&(s.deleteSubNode(i),a.addCommand(e.name,e.param),this.commitTransact(a))}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return e.isReversed=!0,e.name=v.default.behaviorAdd,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new mt}}]),t}(dt),gt=function(e){function t(){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),t}(Ae),yt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"apply",value:function(){if(this.isValid()){var e=this.op,t=this.selection,a=t.transaction,r=e.param.slideIdx;t.selectSlideAt(r);var n=e.param.extendProps,i=e.param.sPath,o=t.getActiveSlide(),s=Ce.a.getNode(o,i);if(s){for(var l in a.beginTransact(),n)s.setProperty(l,n[l]);a.addCommand(e.name,e.param),this.commitTransact(a)}}}},{key:"reverse",value:function(){return this.clone()}},{key:"transforms",value:function(){return new gt}}]),t}(dt),Tt=function e(){o()(this,e)},Ct=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"apply",value:function(){var e=this.op,t=this.pres,a=this.selection,r=t.getBuddy(),n=a.transaction;if(this.isValid()){n.beginTransact();for(var i=e.param.shapes,o=0;o<i.length;o++){var s=i[o],l=r.fetchShape(s,!1);if(l){var c=s.category,d=s.layerType,p=s.slideIdx;a.selectSlideAt(p,c,d),a.selectShape(l),a.modifyTextFrameProperty(s.props,!1)}}n.addCommand(e.name,e.param),this.commitTransact(n)}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Tt}}]),t}(O),_t=window.CoreExports.format_brush.FormatBrushType,bt=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(){return!1}},{key:"needTransform",value:function(e,t){return!0}}]),e}(),St=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e}},{key:"collectItems",value:function(){var e=Object(C.a)(),t=[],a=this.op,r=a.name,n=a.param,i=n.category,o=n.layerType,s=n.slideIdx,l=n.shapePath,c=n.cellRange,d={};d=c?Object.assign(Object(g.a)(n),{category:i,layerType:o,slideIdx:s,shapePath:l,cellRange:c}):Object.assign(Object(g.a)(n),{category:i,layerType:o,slideIdx:s,shapePath:l});var p=p=this._toSelectionRange(d);t.push(new R(r,p));for(var u=0;u<t.length;++u)t[u]._gid=e,this._initItem(t[u]);return t}},{key:"collectDoneCommands",value:function(e){if(this.op.param.cvCmds){for(var t=this.op.param,a=[],r=0;r<t.cvCmds.length;++r){var n=this.wrapper(t.cvCmds[r]);n.setParent(this),n.setCommandProp("cmdType","BrushCvCmds"),n.setCommandProp("orgCmdParam",t);var i=n.collectDoneCommands(e);a=a.concat(i)}return a}return[this]}},{key:"convertFromDoneCommands",value:function(e){if(e&&e.length>0&&"BrushCvCmds"===e[0].getCommandProp("cmdType")){for(var t=[],a=0;a<e.length;++a)t.push(e[a].op);var r=Object(g.a)(e[0].getCommandProp("orgCmdParam")||{});return r.cvCmds=t,[this.wrapper({name:v.default.formatBrush,param:r})]}return e}},{key:"apply",value:function(){var e=this.op,t=this.pres,a=this.selection;switch(e.param.brushType){case _t.Common:this.applyCommon(t,a,e);break;case _t.Transform2D:this.applyTrans2D(t,a,e);break;case _t.Animation:this.applyAnimation(t,a,e)}}},{key:"applyCommon",value:function(e,t,a){var r=t.transaction,n=a.param.state;switch(r.beginTransact(),n){case T.SelectType.select_slide:break;case T.SelectType.select_text:this.applyText(e,a);break;case T.SelectType.select_shape:this.applyShape(e,a);break;case T.SelectType.select_cell:case T.SelectType.select_multi_cell:this.applyCells(e,a)}r.addCommand(a.name,a.param),this.commitTransact(r)}},{key:"applyText",value:function(e,t){var a=t.param,r=e.getBuddy().fetchTextStream(a);if(r){var n=r.parent;if(n){var i=e.formatApplyer,o=a.stashCache,s={begin:a.gcp,end:a.gcp+a.ccp};i.applyTextInner(n,o,s)}else console.warn("invalid textFrame apply text")}else console.warn("invalid textstream apply text")}},{key:"applyShape",value:function(e,t){var a=t.param,r=a.category,n=a.layerType,i=a.slideIdx,o=e.getBuddy().fetchShape({category:r,layerType:n,slideIdx:i,shapePath:a.shapePath});if(o){var s=e.formatApplyer,l=a.stashCache;s.applyShapeInner(o,l)}else console.warn("invalid shape, apply shape")}},{key:"applyCells",value:function(e,t){var a=t.param,r=a.category,n=a.layerType,i=a.slideIdx,o=a.cellRange,s=e.getBuddy().fetchShape({category:r,layerType:n,slideIdx:i,shapePath:a.shapePath});if(s)if(s.hasTable()){var l=e.formatApplyer,c=a.stashCache,d=s.getTableFrame().getCells(o.startRow,o.startCol,o.endRow,o.endCol);d.length>0&&l.applyCellsInner(d,c)}else console.warn("invalid table");else console.warn("invalid shape, apply shape")}},{key:"applyTrans2D",value:function(e,t,a){var r=a.param,n=t.transaction,i=r.stashCache;if("trans2D"===i.stashType){var o=r.category,s=r.layerType,l=r.slideIdx,c=e.getBuddy().fetchShape({category:o,layerType:s,slideIdx:l,shapePath:r.shapePath});if(c){var d=e.formatApplyer,p=i.trans2D;n.beginTransact(),d.applyTrans2DInner(c,p),n.addCommand(a.name,a.param),this.commitTransact(n)}else console.warn("invalid shape")}else console.warn("invalid trans2d brush")}},{key:"applyAnimation",value:function(e,t,a){var r=a.param,n=r.stashCache;if("animation"===n.stashType){var i=t.transaction,o=r.category,s=r.layerType,l=r.slideIdx,c=e.getBuddy().fetchShape({category:o,layerType:s,slideIdx:l,shapePath:r.shapePath});if(c){var d=c.getSlide();if(d){var p=e.formatApplyer;i.beginTransact(),p.applyAnimInner(i,d,c,n),i.addCommand(a.name,a.param),this.commitTransact(i)}else console.warn("invalid slide, apply animation")}else console.warn("invalid shape")}else console.warn("invalid animation brush")}},{key:"reverse",value:function(){var e=Object(g.a)(this.op),t=this.createCvCmdsForReverse(this.op);return t&&(e.param.cvCmds=t),e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new bt}}]),t}(O),kt=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(){return!1}}]),e}(),Pt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"collectCommands",value:function(){var e=this,t=this.op,a=t.param,r=a.commands,n=a.fakeCmds,i=Object(g.a)(t),o=[];(r||[]).concat(n||[]).forEach((function(t){var a=e.wrapper(t);a.setCommandProp("orgCmdParam",i.param),a.setParent(e);var r=a.collectCommands();o=o.concat(r)}));var s=this.clone();return s.setCommandProp("orgCmdParam",i.param),s.setParent(this),o.unshift(s),o}},{key:"collectDoneCommands",value:function(e){var t=this,a=this.op,r=a.param;if(r.bOnlyServerCmd)return[this];var n=r.commands,i=r.fakeCmds,o=Object(g.a)(a),s=[];(n||[]).concat(i||[]).forEach((function(a){var r=t.wrapper(a);r.setCommandProp("orgCmdParam",o.param),r.setParent(t);var n=r.collectDoneCommands(e);s=s.concat(n)}));var l=this.clone();return l.setCommandProp("orgCmdParam",o.param),l.setParent(this),s.unshift(l),s}},{key:"convertFromCommands",value:function(e){if(e&&e.length>0){for(var t=e[0].getCommandProp("orgCmdParam")||{},a=[],r=[],n=0;n<e.length;++n){var i=e[n].op;"documentBeautify"!==e[n].name?i.param.bFakeCmd?r.push(i):a.push(i):(t.slideIdx=i.param.slideIdx,i.param.shapePath&&(t.shapePath=i.param.shapePath.slice(0)))}t.commands=a,t.fakeCmds=r;var o={name:v.default.documentBeautify,param:t};return[this.wrapper(o)]}}},{key:"transforms",value:function(){return new kt}},{key:"apply",value:function(){var e=this,t=this.selection.transaction;t.beginBatchCommand(),t.setWaitCommands({all:!0});var a=this.op.param,r=a.commands,n=a.mainCommand,i=a.actionName,o=a.userData;if(n&&t.setMainCommand(n),i&&t.setActionName(i),o)for(var s in o)t.setUserData(s,o[s]);var l=0;this._createWrapper(this.op,this.pres,this.selection).isValid()&&l++,r.forEach((function(t){e._createWrapper(t,e.pres,e.selection).isValid()&&l++})),l>0?(t.addCommand("documentBeautify",a),t.endBatchCommand()):t.rollback()}},{key:"reverse",value:function(){var e=this.op.param.commands;if(!e||0===e.length)return this.wrapper(Object(g.a)(this.op));for(var t=[],a=e.length-1;a>=0;a--)for(var r=this._createWrapper(e[a],this.pres,this.selection).reverse(),n=r instanceof Array?r:[r],i=0;i<n.length;i++)t.push(n[i].op);var o=this.op.param,s=o._orgName,l=o._orgParam;if(s&&s!==this.op.name){var c=this._createWrapper({name:s,param:l},this.pres,this.selection),d=Object.assign({},this.op.param),p=Object.assign({},this.op);return p.param=d,p.param.commands=t,c.merge(p)}var u=Object(g.a)(this.op);return u.param.commands=t,this.wrapper(u)}}]),t}(O),wt=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(){return!1}}]),e}(),xt=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_slide,e}},{key:"collectCommands",value:function(){return[this]}},{key:"collectDoneCommands",value:function(e){if(this.op.param.cvCmds){for(var t=this.op.param,a=[],r=0;r<t.cvCmds.length;++r){var n=this.wrapper(t.cvCmds[r]);n.setParent(this),n.setCommandProp("cmdType","DocTemplateCvCmds"),n.setCommandProp("orgCmdParam",t);var i=n.collectDoneCommands(e);a=a.concat(i)}return a}return[this]}},{key:"collectItems",value:function(){var e=Object(C.a)(),t=[],a=this.op,r=a.name,n=a.param,i=n.category,o=n.layerType,s=n.slideIdx,l=Object.assign(Object(g.a)(n),{category:i,layerType:o,slideIdx:s}),c=this._toSelectionRange(l);t.push(new R(r,c));for(var d=0;d<t.length;++d)t[d]._gid=e,this._initItem(t[d]);return t}},{key:"convertFromDoneCommands",value:function(e){if(e&&e.length>0&&"DocTemplateCvCmds"===e[0].getCommandProp("cmdType")){for(var t=[],a=0;a<e.length;++a)t.push(e[a].op);var r=Object(g.a)(e[0].getCommandProp("orgCmdParam")||{});return r.cvCmds=t,[this.wrapper({name:"docTemplate",param:r})]}return e}},{key:"apply",value:function(){var e=this.op,t=this.selection,a=e.param,r=t.transaction;r.beginTransact(),a.userData.genid&&r.setUserData("genid",a.userData.genid),r.endTopTransact(e.name,e.param)}},{key:"reverse",value:function(){var e=Object(g.a)(this.op),t=this.createCvCmdsForReverse(this.op);return t&&(e.param.cvCmds=t),e.isReversed=!this.op.isReversed,this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new wt}}]),t}(O),It=a(44),Rt=a.n(It),Ot=a(152),At=a.n(Ot),Bt=1,Dt=2,Ft=3,Mt=4,jt=5,Et=6,Nt=function(){function e(){o()(this,e)}return l()(e,null,[{key:"modifyAttributes",value:function(e,t){e.attributes=Object.assign({},e.attributes,t)}},{key:"addPoint",value:function(e,t,a,r){switch(r&&this.mapPathArguments(e,r),t){case Et:return this.addClose(e);case Bt:return this.addMoveTo(e,a);case Dt:return this.addLineTo(e,a);case Ft:return this.addArcTo(e,a);case Mt:return this.addQuadraticBezierTo(e,a);case jt:return this.addCubicBezierTo(e,a)}}},{key:"mapPathArguments",value:function(e,t){if(t)for(var a=e.commands,r=e.argumentIndices,n=e.arguments,i=0;i<a.length;++i){var o=a[i],s=r[i],l=void 0,c=void 0,d=void 0,p=void 0,u=void 0,h=void 0;switch(o){case Bt:case Dt:var f=t.MAPINT(n[s],n[s+1]),m=At()(f,2);l=m[0],c=m[1],n[s]=l,n[s+1]=c;break;case Mt:var v=t.MAPINT(n[s],n[s+1]),g=At()(v,2);l=g[0],c=g[1],n[s]=l,n[s+1]=c;var y=t.MAPINT(n[s+2],n[s+3]),T=At()(y,2);d=T[0],p=T[1],n[s+2]=d,n[s+3]=p;break;case jt:var C=t.MAPINT(n[s],n[s+1]),_=At()(C,2);l=_[0],c=_[1],n[s]=l,n[s+1]=c;var b=t.MAPINT(n[s+2],n[s+3]),S=At()(b,2);d=S[0],p=S[1],n[s+2]=d,n[s+3]=p;var k=t.MAPINT(n[s+4],n[s+5]),P=At()(k,2);u=P[0],h=P[1],n[s+4]=u,n[s+5]=h}}}},{key:"addClose",value:function(e){e.commands.push(Et),e.argumentIndices.push(0)}},{key:"addMoveTo",value:function(e,t){null!=t.x&&null!=t.y?(e.commands.push(Bt),e.argumentIndices.push(e.arguments.length),e.arguments.push(t.x),e.arguments.push(t.y)):console.warn("argument's format error")}},{key:"addLineTo",value:function(e,t){null!=t.x&&null!=t.y?(e.commands.push(Dt),e.argumentIndices.push(e.arguments.length),e.arguments.push(t.x),e.arguments.push(t.y)):console.warn("argument's format error")}},{key:"addArcTo",value:function(e,t){var a=t.widthRadius,r=t.heightRadius,n=t.startAngle,i=t.swingAngle;null!=a&&null!=r&&null!=n&&null!=i?(e.commands.push(Ft),e.argumentIndices.push(e.arguments.length),["widthRadius","heightRadius","startAngle","swingAngle"].forEach((function(a){e.arguments.push(t[a])}))):console.warn("argument's format error")}},{key:"addQuadraticBezierTo",value:function(e,t){var a=t.x1,r=t.y1,n=t.x2,i=t.y2;null!=a&&null!=r&&null!=n&&null!=i?(e.commands.push(Mt),e.argumentIndices.push(e.arguments.length),e.arguments.push(t.x1),e.arguments.push(t.y1),e.arguments.push(t.x2),e.arguments.push(t.y2)):console.warn("argument's format error")}},{key:"addCubicBezierTo",value:function(e,t){var a=t.x1,r=t.y1,n=t.x2,i=t.y2,o=t.x3,s=t.y3;null!=a&&null!=r&&null!=n&&null!=i&&null!=o&&null!=s?(e.commands.push(jt),e.argumentIndices.push(e.arguments.length),e.arguments.push(t.x1),e.arguments.push(t.y1),e.arguments.push(t.x2),e.arguments.push(t.y2),e.arguments.push(t.x3),e.arguments.push(t.y3)):console.warn("argument's format error")}},{key:"isClosed",value:function(e){return e.commands&&e.commands.slice(-1)[0]===Et}}]),e}(),Lt=a(1284),Vt=a(470),Wt=a(263),Gt=window.CoreExports.InkData,Ht=window.CoreExports.utils.deepMerge,Ut=window.CoreExports.color,zt=Ut.Color,qt=Ut.ColorType,Kt=Ut.ScRgb;function Qt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&"Object"!=e.constructor.name?t&&"function"==typeof e.clone?e.clone():t||"function"!=typeof e.shadowClone?e instanceof Wt.AbsVectorObject?Jt(e):Object(g.b)(e):e.shadowClone():Object(g.a)(e)}function Jt(e){var t=new Wt.AbsVectorObject;t.private=t.vector;for(var a=0;a<e.vector.length;++a){var r=Qt(e.vector[a],!0);t.push(r)}return t}var Yt=function(){function e(t,a){o()(this,e),this._name=t,this._typeName=t,this._data=a,this._modified=Qt(a),this._modifiers=[],this._done=[],this._flags={},this._default=null,this._propNameList=[]}return l()(e,[{key:"empty",value:function(){return 0===this._modifiers.length}},{key:"name",value:function(){return this._name}},{key:"typeName",value:function(){return this._typeName}},{key:"setName",value:function(e){this._name=e}},{key:"primary",value:function(){return this._data}},{key:"setSource",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._data=e,this._modified=Qt(e,t),this._modifiers=this.modifiers(),this._done=[]}},{key:"setDefault",value:function(e){this._default=e}},{key:"setCanAcceptNames",value:function(e){this._propNameList=e}},{key:"modifiedData",value:function(){if(null==this._modified)throw new Error(this.name()+"Modifier: source data is null.");return this._doModify(),this._done=this._done.concat(this._modifiers),this._modifiers=[],this._modified}},{key:"modifiers",value:function(){var e=[];return e=(e=e.concat(this._done)).concat(this._modifiers)}},{key:"trimmedModifiers",value:function(){for(var e=this.modifiers(),t=[],a={},r=0;r<e.length;r++){var n=e[r],i=n.tag,o=n.val,s=null==a[i]?t.length:a[i];t[s]={tag:i,val:o},a[i]=s}return t}},{key:"setFlag",value:function(e,t){this._flags[e]=t}},{key:"getFlag",value:function(e){return this._flags[e]}},{key:"flags",value:function(){return this._flags}},{key:"modify",value:function(e,t){this._modifiers.push({tag:e,val:t})}},{key:"hasTag",value:function(e){for(var t=0;t<this._modifiers.length;++t)if(e==this._modifiers[t].tag)return!0}},{key:"batchModify",value:function(e){this._modifiers=this._modifiers.concat(e)}},{key:"hasModified",value:function(e){for(var t=0;t<this._done.length;++t)if(e==this._done[t].tag)return!0}},{key:"reset",value:function(e,t){this.remove(e),this._modifiers.push({tag:e,val:t})}},{key:"clearAll",value:function(){this._modifiers=[],this._done=[],this._flags={}}},{key:"assign",value:function(e){this._modifiers=e.modifiers(),this._flags=e.flags()}},{key:"remove",value:function(e){for(var t=0;t<this._modifiers.length;t++){this._modifiers[t].tag==e&&this._modifiers.splice(t--,1)}for(var a=0;a<this._done.length;a++){this._done[a].tag==e&&this._done.splice(a--,1)}}},{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;this._modifyByTag(a,r)}}},{key:"_modifyByTag",value:function(e,t){var a="";switch(this._name.length>0&&(a=this._name[0].toLowerCase()+this._name.slice(1)),e){case a:""!==a&&(this._modified=Object(g.a)(t));break;default:this._propNameList.indexOf(e)>=0&&(this._modified[e]=Object(g.a)(t))}}},{key:"apply",value:function(e,t,a){if(e&&t&&a){var r=t();return this.setSource(r||{}),a(this.modifiedData())}}},{key:"applyOperate",value:function(e,t){if(e&&t){for(var a=this.modifiers(),r={newval:{},modifiers:a},n=0;n<a.length;n++){var i=a[n],o=t(i.tag,i.val,r);if(!o)return null;r.newval=Object.assign({},r.newval,o.newval)}return r}}}]),e}(),Xt=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Property",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;this._modified[a]=Object(g.a)(r)}}}]),t}(Yt),Zt=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Color",e));return a._color=new zt(a._modified||{}),a}return u()(t,e),l()(t,[{key:"setColor",value:function(e){this.modify("color",e)}},{key:"setRgb",value:function(e){this.modify("rgb",e)}},{key:"setOpacity",value:function(e){this.modify("opacity",e)}},{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val,n=this._color.data;switch(a){case"color":this._color.setData(Object(g.a)(r));break;case"opacity":this._color.setOpacity(r);break;case"rgb":var i=Kt.fromString(r);i.setHasAlpha(!1),this._color=zt.fromScRgb(i),this._color.setTransforms(n.transOp),this._color.removeNoMattersTransform();break;case"scRgb":this._color=zt.fromScRgb(Kt.fromScRgb(r));break;case"hsl":this._color=zt.fromScRgb(Kt.fromHsl(r));break;case"scheme":this._color.setData({type:qt.Scheme,isAutoColor:!1,toRGB:n.toRGB,transOp:n.transOp,scheme:r});break;case"preset":this._color=zt.fromPreset(r);break;case"system":this._color=zt.fromSystem(r);break;case"palette":this._color=zt.fromPalette(r);break;case"legacyRef":this._color.setData({type:qt.LegacyRef,isAutoColor:!1,toRGB:n.toRGB,refColor:r})}}this._modified=this._color.data,this._modified.toRGB=this._color.toRGB(),console.log("color",this._modified)}}]),t}(Yt),$t=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Fill",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"fill":this._modified=Object(g.a)(r);break;case"color.rgb":this._modifyColor("rgb",r);break;case"color":case"opacity":default:this._modifyColor(a,r)}}}},{key:"_modifyColor",value:function(e,t){var a=this._modified;if(a){a.color||(a.color={});var r=new Zt(a.color);r.modify(e,t),a.color=r.modifiedData(),a.type=2}}}]),t}(Yt),ea=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Outline",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"outline":this._modified=Object(g.a)(r);break;case"lineType":this._modified.compoundLine=r.compoundLine,this._modified.dashType=r.dashType;break;case"fill":case"color":case"color.rgb":case"opacity":this._modifyFill(a,r),this._modified.fill&&!this._modified.fill.type&&(this._modified.fill.type=2);break;case"width":this._modified[a]=r.lineWidth;break;default:this._modified[a]=r}}}},{key:"_modifyFill",value:function(e,t){var a=this._modified;if(a){a.fill||(a.fill={});var r=new $t(a.fill);r.modify(e,t),a.fill=r.modifiedData()}}}]),t}(Yt),ta=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Effects",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"effects":this._modified=Object(g.a)(r);break;default:this._modified||(this._modified={}),null==r?delete this._modified[a]:this._modified[a]=Object(g.a)(r)}}}}]),t}(Yt),aa=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"BlipFill",e))}return u()(t,e),l()(t,[{key:"validBip",value:function(e){return Ht({colorMap:[],compression:2,effects:[],fillMap:[],imageLayer:{effects:[]},linkMode:0,useLocalDpi:!0},e||{})}},{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"fill":this._modified=Object(g.a)(r);break;case"isStretched":this._modified.isStretched=!!r;break;case"imageId":var n=this._modified.blip||{};n.blipAtom||(n.blipAtom={}),n.blipAtom.imageId=r,this._modified.blip=n;break;case"sourceRectangle":this._modified.sourceRectangle=r;break;case"effects":this._modified.blip||(this._modified.blip={});var i=this._modified.blip;i.effects||(i.effects=[]);var o=Ht(i.effects,Object(g.a)(r));this._modified.blip.effects=o;break;default:var s=this._modified.blip||{};s[a]=Object(g.a)(r),this._modified.blip=s}}this._modified&&this._modified.blip&&(this._modified.blip=this.validBip(this._modified.blip))}}]),t}(Yt),ra=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Transform2D",e));return a.setCanAcceptNames(["x","y","width","height","rotation","horizontalFlipped","verticalFlipped"]),a}return u()(t,e),l()(t,[{key:"_modifyByTag",value:function(e,a){if("transform"===e){var r=this._modified;a.x&&(r.x=null==r.x?a.x:r.x+a.x),a.y&&(r.y=null==r.y?a.y:r.y+a.y),a.width&&(r.width=null==r.width?a.width:r.width+a.width),a.height&&(r.height=null==r.height?a.height:r.height+a.height);var n=null!=a.rotation?a.rotation:a.rotate;n&&(r.rotation=null==r.rotation?n:r.rotation+n),null!=a.horizontalFlipped&&(null==r.horizontalFlipped?r.horizontalFlipped=a.horizontalFlipped:a.horizontalFlipped&&(r.horizontalFlipped=!r.horizontalFlipped)),null!=a.verticalFlipped&&(null==r.verticalFlipped?r.verticalFlipped=a.verticalFlipped:a.verticalFlipped&&(r.verticalFlipped=!r.verticalFlipped))}else if("anchorRect"===e);else if("rect"===e||"position"===e||"size"===e)for(var i in a)ye()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_modifyByTag",this).call(this,i,a[i]);else ye()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_modifyByTag",this).call(this,e,a)}}]),t}(Yt),na=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Geometry2D",e))}return u()(t,e),l()(t,[{key:"setGeometryType",value:function(e,t){if(e&&t&&e instanceof Lt.a){var a=Vt.PresetShapeType[t],r=Vt.PresetShapeInfo[a].text;e.setProp("presetType",r),e.setProp("presetTypeNum",a)}}},{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"adjustValues":this.setAdjustValues(this._modified,r);break;case"paths":this.setPaths(this._modified,r);break;case"presetType":this.setGeometryType(this._modified,r);break;default:this._modified[a]=Object(g.a)(r)}}}},{key:"setAdjustValues",value:function(e,t){var a={},r=e.adjustValues||{};for(var n in r)r.hasOwnProperty(n)&&(a[n]=r[n]);for(var i=0;i<t.length;i++){a[t[i].name]=t[i].value}e.setAdjustValues(a)}},{key:"setPaths",value:function(e,t){var a=t.cmdType,r=t.points,n=t.attributes,i=t.matrix;null==e.getPaths()&&e.setPaths([{attributes:{},commands:[],argumentIndices:[],arguments:[]}]);var o=e.getPaths()[0];Nt.addPoint(o,a,r,i),Nt.modifyAttributes(o,n)}}]),t}(Yt),ia=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"TextFont",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"hightLightColor":case"textColor":r&&r.color&&r.color.primary?this._modified[a]=Object(g.a)(r.color.primary):this._modified[a]=Object(g.a)(r),this._modified[a].color&&delete this._modified[a].color.toRGB;break;case"color":if("string"==typeof r){var n=zt.fromString(r);this._modified.textColor={color:n.data,type:T.FillType.FillTypeSolidColor}}break;case"fontNameAscii":case"fontNameSymbol":case"fontNameComplex":case"fontNameAsiaEast":case"shareHint":r&&"string"==typeof r.name&&(this._modified[a]={name:r.name});break;case"bold":case"italic":case"strikeThrough":case"shadow":case"vanish":case"normalizeHeight":case"smartTagClean":case"noProofing":case"kumimoji":case"rightToLeft":case"underlineFollowText":this._modified[a]=!!r;break;case"underline_color":case"language":case"altLanguage":case"fieldRtfDateTimeExt":case"fieldId":"string"==typeof r&&(this._modified[a]=r);break;case"underline":case"underlineType":case"fontSize":case"position":case"emboss":case"spacing":case"kerning":case"mormalizeHeights":case"capitalization":case"spellFlag":case"fieldType":"number"==typeof r&&(this._modified[a]=r);break;case"actions":case"underlineFill":this._modified[a]=Object(g.a)(r)}}}}]),t}(Yt),oa=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Actions",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var a=this._modifiers[e],r=a.tag,n=a.val;switch(r){case"mouseClick":this._modified.mouseClick=Object(g.a)(n);break;case"mouseOver":this._modified.mouseOver=Object(g.a)(n);break;default:ye()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_modifyByTag",this).call(this,r,n)}}}}]),t}(Yt),sa=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"InkData",e));return a._inkdata=new Gt(a._modified),a}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"color.rgb":case"opacity":this._modifyColor(a,r);break;case"trace":this._inkdata.appendPoint(r.px,r.py);break;case"width":case"height":this._inkdata.setAllBrushProperty(a,r.lineWidth/12700);break;default:this._inkdata.setAllBrushProperty(a,r)}}}},{key:"_modifyColor",value:function(e,t){for(var a in this._modified.brushMap){var r=this._modified.brushMap[a],n=new Zt(r.color);n.modify("color.rgb"===e?"rgb":e,t),r.color=n.modifiedData()}}}]),t}(Yt),la=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"TextFrameProps",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"autoFit":case"verticalType":case"fontScale":case"frameRotation":case"anchorType":case"columnSpacing":case"paraSpacing":case"horOverflow":case"column":case"columnRightToLeft":case"textWrap":case"lineSpaceReduction":"number"==typeof r&&(this._modified[a]=r);break;case"rotateText":case"anchorCenter":case"antiAlias":case"fromWordArt":case"upRight":case"lineSpacing":case"flatText":"boolean"==typeof r&&(this._modified[a]=r);break;case"textInset":this._modified[a]=r}}}}]),t}(Yt),ca=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Bevel",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers,a=t.tag,r=t.val;switch(a){case"width":case"height":case"presetBevel":"number"==typeof r&&(this._modified[a]=r)}}}}]),t}(Yt),da=(function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Shape3D",e))}u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"topBevel":case"bottomBevel":this._modifyBevel(a,r);break;case"extrusionColor":case"contourColor":this._modifyColor(a,r);break;case"extrusionHeight":case"contourWidth":case"presetMaterialType":case"shapeDepth":case"legacyExtrusionFrontHeight":"number"==typeof r&&(this._modified[a]=r);break;default:this._modifiers[a]=r}}}},{key:"_modifyColor",value:function(e,t){var a=this._modified;a&&new Zt(a).modify(e,t)}},{key:"_modifyBevel",value:function(e,t){var a=this._modified;a&&new ca(a).modify(e,t)}}])}(Yt),function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Scene3D",e))}u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"fieldOfView":case"backdropPlane":"number"==typeof r&&(this._modified[a]=r);break;case"camera":case"light":this._modified[a]=r}}}}])}(Yt),function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Media",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;this._modified[a]=r}}}]),t}(Yt)),pa=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"TblStyle",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;this._modified[a]=r}}}]),t}(Yt),ua=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Whiteboard",e));return a.setCanAcceptNames(["type"]),a}return u()(t,e),t}(Yt),ha=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"TblCellBorder",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"allBorder":case"middleBorder":case"leftBorder":case"rightBorder":case"topBorder":case"bottomBorder":case"insideHBorder":case"insideVBorder":case"outBorder":case"nonBorder":this._modified[a]=r}}}}]),t}(Yt),fa=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"AnimSet",e))}return u()(t,e),l()(t,[{key:"setDirection",value:function(e){this.modify("direction",e)}},{key:"setAmount",value:function(e){this.modify("amount",e)}},{key:"setColor",value:function(e){var t=e.indexOf("#");-1!==t&&(e=e.substr(t+1,e.length)),this.modify("colorTo",e.toLowerCase())}},{key:"setRelative",value:function(e){this.modify("relative",e)}},{key:"setTo",value:function(e){this.modify("to",e)}},{key:"setToType",value:function(e){this.modify("toType",e)}},{key:"setByX",value:function(e){this.modify("byX",e)}},{key:"setByY",value:function(e){this.modify("byY",e)}},{key:"setByAngle",value:function(e){this.modify("byAngle",e)}},{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"direction":case"amount":case"size":case"colorTo":case"relative":case"toType":"number"==typeof r&&(this._modified[a]=r);break;case"to":this._modified[a]=r}}}}]),t}(Yt),ma=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"AnimTimer",e))}return u()(t,e),l()(t,[{key:"setStart",value:function(e){this.modify("restart",e)}},{key:"setDelay",value:function(e){this.modify("delay",e)}},{key:"setDuration",value:function(e){this.modify("duration",e)}},{key:"setRepeat",value:function(e){this.modify("repeat",e)}},{key:"setTrigger",value:function(e){this.modify("trigger",e)}},{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"restart":case"delay":case"duration":case"repeatCount":case"accelerate":case"decelerate":case"triggerType":"number"==typeof r&&(this._modified[a]=r);break;case"rewindAtEnd":case"smoothStart":case"smoothEnd":case"autoReverse":"boolean"==typeof r&&(this._modified[a]=r)}}}}]),t}(Yt),va=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"AnimInfo",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"afterEfffect":case"buildLevel":case"textUint":case"textInterval":"number"==typeof r&&(this._modified[a]=r);break;case"background":case"textInRevserse":"boolean"==typeof r&&(this._modified[a]=r)}}}}]),t}(Yt),ga=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"AnimPlay",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"soundType":case"interval":"number"==typeof r&&(this._modified[a]=r);break;case"hideNoPlay":case"loopUntilStop":case"playOnEntry":case"rewindMovie":case"pauseAnim":case"stopAfterSlides":"number"==typeof r&&(this._modified[a]=r)}}}}]),t}(Yt),ya=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"TimeNode",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"repeateCount":case"hideWhenStopped":case"endAfterSlide":"number"==typeof r&&(this._modified[a]=r)}}}}]),t}(Yt),Ta=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Transition",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;this._modified[a]=r}}}]),t}(Yt),Ca=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ShapeExtData",e))}return u()(t,e),l()(t,[{key:"modify",value:function(e,t){for(var a=!0,r=0;r<this._modifiers.length;r++)if(e!=this._modifiers[r].tag){a=!1;break}a?this._modifiers.push({tag:e,val:t}):console.error(" Only one field is allowed in Shape's extendData !!")}},{key:"_doModify",value:function(){this._modified={};for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"processOn":"boolean"==typeof r&&(this._modified[a]=r);break;case"whiteboard":"string"==typeof r&&(this._modified[a]=r);break;case"explainData":"object"===(void 0===r?"undefined":Rt()(r))&&(this._modified[a]=r);break;default:this._modified[a]=r}}}}]),t}(Yt),_a=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setName("PasteModifier"),a}return u()(t,e),t}(Xt),ba=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setName("PageSetup"),a}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"firstSlideNum":case"slideSizeType":case"slideWidth":case"slideHeight":case"slideOrientation":case"notesOrientation":case"notesPageWidth":case"notesPageHeight":case"paperWidth":case"paperHeight":case"scaleMode":"number"==typeof r&&(this._modified.private[a]=r);break;default:console.warn("Invalid tag in PageSetupModifier !!")}}}}]),t}(Yt),Sa=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setName("ShowSettings"),a}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;this._modified.private[a]=r}}}]),t}(Yt),ka=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setName("DocCustomProps"),a}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"docConfig":return this._modifyDocConfig(a,r)}}}},{key:"_ensureCustomProp",value:function(e){var t=this._modified,a=function(e){for(var a=void 0,r=0;r<t.vector.length;++r){var n=t.vector[r];n.private&&n.private[e]&&(a=n.private[e])}return a},r=a(e);if(r)return r;var n,i=new Wt.AbsObject,o=function(){switch(e){case"docConfig":return"e04242b7-d752-4081-b5b7-9aad2bb55b7e"}}(),s=((n=new Wt.AbsObject).private={},n.__isNew=!0,n.__modify=!1,n);return i.private={uuid:o,docConfig:s},i.__isNew=!0,i.__modify=!1,t.push(i),a(e)}},{key:"_modifyDocConfig",value:function(e,t){var a=this._ensureCustomProp(e);a.private=Object.assign({},a.private,t)}}]),t}(Yt),Pa=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setName("Connector"),a}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"startConnector":case"endConnector":this._modified[a]=r}}}}]),t}(Yt),wa=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setName("Tags"),a}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;++e){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"KSO_WEBWPP_OBJECT_TOKEN":return this._modifyTags(a,r);default:this._modifyTags(a,r)}}}},{key:"_modifyTags",value:function(e,t){for(var a=0;a<this._modified.length;++a)if(this._modified[a].name===e){this._modified.splice(a,1);break}""!==t&&this._modified.push({name:e,value:t})}}]),t}(Yt),xa=function(e){function t(e){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Comment",e))}return u()(t,e),l()(t,[{key:"_doModify",value:function(){for(var e=0;e<this._modifiers.length;e++){var t=this._modifiers[e],a=t.tag,r=t.val;switch(a){case"position":this._modified[a]={x:r.x,y:r.y};break;case"text":this._modified[a]=r}}}}]),t}(Yt);function Ia(e,t){switch(e){case"Property":return new Xt(t);case"Color":return new Zt(t);case"Fill":return new $t(t);case"Outline":return new ea(t);case"Effects":return new ta(t);case"BlipFill":return new aa(t);case"Transform2D":return new ra(t);case"Geometry2D":return new na(t);case"TextFont":return new ia(t);case"Actions":return new oa(t);case"InkData":return new sa(t);case"TextFrameProps":return new la(t);case"Media":return new da(t);case"TblStyle":return new pa(t);case"TblCellBorder":return new ha(t);case"Whiteboard":return new ua(t);case"AnimSet":return new fa(t);case"AnimTimer":return new ma(t);case"AnimInfo":return new va(t);case"AnimPlay":return new ga(t);case"TimeNode":return new ya(t);case"Transition":return new Ta(t);case"PasteModifier":return new _a(t);case"ShapeExtData":return new Ca(t);case"ShowSettings":return new Sa(t);case"DocCustomProps":return new ka(t);case"Connector":return new Pa(t);case"PageSetup":return new ba(t);case"Tags":return new wa(t);case"Comment":return new xa(t);default:return null}}var Ra=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(e,t,a){}}]),e}(),Oa=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_none,e}},{key:"apply",value:function(){var e=this.op,t=this.pres,a=this.selection.transaction,r=e.param&&e.param.data;if(r){var n=void 0,i=void 0;if(r.docConfig)n=Ia("DocCustomProps"),i=r.docConfig;else if(r.showSettings)n=Ia("ShowSettings"),i=r.showSettings;else{if(!r.pageSetup)return;n=Ia("PageSetup"),i=r.pageSetup}if(n&&i){for(var o in i)n.modify(o,i[o]);var s=t.selection;a.beginTransact(),s.modifyPresentationProps(n),a.addCommand(e.name,e.param),this.commitTransact(a)}}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Ra}}]),t}(O),Aa=function(){function e(){o()(this,e)}return l()(e,[{key:"defaultCommand",value:function(e,t,a){}}]),e}(),Ba=function(e){function t(e,a,r){return o()(this,t),d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,r))}return u()(t,e),l()(t,[{key:"_toSelectionRange",value:function(e){return e.state=T.SelectType.select_shape,e}},{key:"apply",value:function(){var e=this.op,t=this.pres,a=this.selection,r=a.transaction;if(a.getChartSelection()){var n=e.param,i=n.category,o=n.layerType,s=n.slideIdx,l=n.shapePath,c=t.getBuddy().fetchShape({category:i,layerType:o,slideIdx:s,shapePath:l});c&&c.hasChart()?(r.beginTransact(),r.addCommand(e.name,e.param,e.cmdFlag),this.commitTransact(r)):console.warn("invalid shape, apply shape")}}},{key:"reverse",value:function(){var e=Object(g.a)(this.op);return this._createWrapper(e,this.pres,this.selection)}},{key:"transforms",value:function(){return new Aa}}]),t}(O),Da=function(){function e(){o()(this,e),this._constructors={}}return l()(e,[{key:"setContext",value:function(e,t){this.pres=e,this.selection=t}},{key:"get",value:function(e){var t=this._constructors[e.name],a=null;return(a=t?new t(e,this.pres,this.selection):new O(e,this.pres,this.selection))._factory=this,a}},{key:"register",value:function(e,t){this._constructors||(this._constructors={}),this._constructors[e]=t}},{key:"hasRegisted",value:function(e){return!(!this._constructors||!this._constructors[e])}}]),e}();var Fa=function(){var e=new Da;e.register(v.default.selection,D),e.register(v.default.txtStrmInsert,M),e.register(v.default.txtStrmDelete,E),e.register(v.default.txtStrmFmtChpxV2,W),e.register(v.default.txtStrmFmtPapxV2,G),e.register(v.default.shapeInsert,K),e.register(v.default.shapeDelete,J),e.register(v.default.slideInsert,$),e.register(v.default.slideDelete,te),e.register(v.default.slideMove,re),e.register(v.default.modifyShapeProps,z),e.register(v.default.modifySlideProps,ie),e.register(v.default.paste,de),e.register(v.default.modifySlideLayout,se),e.register(v.default.effectAdd,je),e.register(v.default.effectRemove,Ne),e.register(v.default.effectMove,Fe),e.register(v.default.modifyEffectProps,Ve),e.register(v.default.behaviorAdd,ft),e.register(v.default.behaviorRemove,vt),e.register(v.default.behaviorMove,ut),e.register(v.default.modifyBehaviorProps,yt),e.register(v.default.commentAdd,ue),e.register(v.default.commentDelete,fe),e.register(v.default.commentModify,ve),e.register(v.default.batchCommands,rt),e.register(v.default.shapeMove,X),e.register(v.default.tableHandler,tt),e.register(v.default.shapeGroup,lt),e.register(v.default.shapeUngroup,ct),e.register(v.default.modifyTextFrameProps,Ct),e.register(v.default.formatBrush,St),e.register(v.default.documentBeautify,Pt),e.register(v.default.docTemplate,xt),e.register(v.default.modifyPresentation,Oa),e.register(v.default.woChart,Ba);for(var t=v.default.UsedCommands,a=0;a<t.length;a++)e.hasRegisted(t[a])||console.error("Command "+t[a]+" not register wrapper");return e}();function Ma(e,t,a,r,n){var i=e.wrapper.transforms();if(!i)return!1;if("function"==typeof i.needTransform){if(!i.needTransform(e,t))return!1}else if(e.category!==t.category||e.layerType!==t.layerType)return!1;if(n&&t.wrapper&&t.wrapper.needCollectPreferDone()){for(var o=!1,s=t.wrapper.convertFromDoneItems([t])[0],l=s.collectItems(),c=[],d=0;d<l.length;d++){var p=l[d].clone(),u=[];Ma(e,p,a,u,!1)&&u.length>0?(c=c.concat(u),o=!0):c.push(p)}if(o){var h=s.convertFromItems(c)[0].collectDoneItems();if(h.length>0)for(var f=0;f<h.length;f++)r.push(h[f])}return o}var m=i.bPreferKeep;i.bPreferKeep=a;var v=t.name,g=i[v]?v:"defaultCommand",y=!1;return i[g]&&e.isValid()&&t.isValid()&&(y=i[g](e,t,r)),i.bPreferKeep=m,y}function ja(e,t,a,r){if(e.isOnlyServerCmd())return!1;if("function"!=typeof e.transforms)throw new Error("{ transCommand: "+JSON.stringify(e.op)+"}");var n=e.transforms();if(!n)return!1;if("function"==typeof n.needTransform&&!n.needTransform(e,t))return!1;var i=[];if(function(e,t,a,r){return Ea(e,t,a,r,Ma)}(e.collectDoneItems(t),t.collectItems(),a,i)&&i.length>0){for(var o={},s=[],l=0;l<i.length;l++){var c=i[l];if(c.getProp("bFakeCmd")){var d=c.getProp("fakeCmdToken"),p=o[d]||[];p.push(c),o[d]=p}else s.push(c)}var u=t.convertFromItems(s);if(u&&u.length>0)for(var h=0;h<u.length;h++)r.push(u[h]);for(var f=Object.keys(o),m=0;m<f.length;m++){var v=f[m],g=o[v],y=g[0].wrapper.convertFromItems(g);if(y&&y.length>0)for(var T=0;T<y.length;T++)y[T].setCommandProp("bFakeCmd",!0),y[T].setCommandProp("fakeCmdToken",v),r.push(y[T])}return!0}return!1}function Ea(e,t,a,r,i){if(!e||0===e.length||!t||0===t.length)return!1;for(var o=!1,s=e.slice(0),l=[],c=0;c<t.length;c++)l.push({doing:t[c],doneIdx:0});for(var d=l.length>1,p=[],u=0;u<l.length;u++)for(var h=l[u].doneIdx;h<s.length;){var f=l[u].doing,m=s[h],v=h+1;if(d){var g=!1;p=[],i(f,m.clone(),!a,p,!0)&&p.length>0&&(g=!0),g&&p.length>0&&(v=h+p.length,s.splice.apply(s,[h,1].concat(n()(p))))}if(h=v,i(m,f,a,p=[],!1)&&p.length>0){for(var y=[],T=0;T<p.length;T++)y.push({doing:p[T],doneIdx:v});l.splice.apply(l,[u,1].concat(y)),o=!0}}return o&&l.forEach((function(e){return r.push(e.doing)})),o}function Na(){for(var e,t={mst:{},svt:{}},a=(e={},f()(e,v.default.txtStrmInsert,new F),f()(e,v.default.txtStrmDelete,new j),f()(e,v.default.txtStrmFmtChpxV2,new N),f()(e,v.default.txtStrmFmtPapxV2,new L),f()(e,v.default.shapeInsert,new q),f()(e,v.default.shapeDelete,new Q),f()(e,v.default.shapeMove,new Y),f()(e,v.default.slideInsert,new Z),f()(e,v.default.slideDelete,new ee),f()(e,v.default.slideMove,new ae),f()(e,v.default.modifySlideLayout,new oe),f()(e,v.default.paste,new ce),f()(e,v.default.effectAdd,new Me),f()(e,v.default.effectRemove,new Ee),f()(e,v.default.effectMove,new De),f()(e,v.default.modifyEffectProps,new Le),f()(e,v.default.behaviorAdd,new ht),f()(e,v.default.behaviorRemove,new mt),f()(e,v.default.behaviorMove,new pt),f()(e,v.default.modifyBehaviorProps,new gt),f()(e,v.default.commentAdd,new pe),f()(e,v.default.commentDelete,new he),f()(e,v.default.batchCommands,new at),f()(e,v.default.tableHandler,new et),f()(e,v.default.shapeGroup,new it),f()(e,v.default.shapeUngroup,new ot),f()(e,v.default.formatBrush,new bt),f()(e,v.default.documentBeautify,new kt),f()(e,v.default.docTemplate,new wt),e),r=function(e,r,n){e.mst&&(t.mst[r]||(t.mst[r]={})),e.svt&&(t.svt[r]||(t.svt[r]={}));var i=a[n],o=function(e){return function(t,a,r){var n=[],i=function(e,t,a,r){return Ea(e,t,a,r,ja)}(t.collectDoneCommands(a),a.collectCommands(),e,n);if(i){var o=a.mergeCommands(n);if(o)for(var s=0;s<o.length;s++)r.push(o[s])}return i}};i&&(i[r]||i.defaultCommand)&&(e.mst&&(t.mst[r][n]=o(!0)),e.svt&&(t.svt[r][n]=o(!1)))},n=[v.default.selection,v.default.txtStrmInsert,v.default.txtStrmDelete,v.default.txtStrmFmtChpxV2,v.default.txtStrmFmtPapxV2,v.default.slideInsert,v.default.slideDelete,v.default.slideMove,v.default.modifySlideProps,v.default.shapeInsert,v.default.shapeDelete,v.default.shapeMove,v.default.modifyShapeProps,v.default.modifySlideLayout,v.default.paste,v.default.effectAdd,v.default.effectMove,v.default.effectRemove,v.default.modifyEffectProps,v.default.commentAdd,v.default.commentDelete,v.default.commentModify,v.default.tableHandler,v.default.batchCommands,v.default.shapeGroup,v.default.shapeUngroup,v.default.behaviorAdd,v.default.behaviorRemove,v.default.behaviorMove,v.default.formatBrush,v.default.documentBeautify,v.default.docTemplate],i=0;i<n.length;i++)for(var o=0;o<n.length;o++)r({mst:!0,svt:!0},n[i],n[o]);return t}var La=function(e){function t(e,a){o()(this,t);var r=d()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.pres=a,r.retobj=e,r.wrapperFactory=Fa,r.wrapperFactory.setContext(a,a.selection),r.maps=Na(),r.mstMap=r.maps.mst,r.svtMap=r.maps.svt,r}return u()(t,e),l()(t,[{key:"process",value:function(){if(!this.retobj)return[];var e=this.retobj,t=e.localVersions,a=e.localCommitedVersion;if(a||(a=[]),t)for(var r=0;r<t.length;)!0===t[r]._cmdSended?a.push(t.splice(r,1)):r++;var n=this.getLocalCmds(t,!0),i=this.getLocalCmds(a);return 0===n.length?n:this.transInner(n,i,e).lcCmds}},{key:"transInner",value:function(e,t,a){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=this;a=this.cancelOut(a);var i={};return i.trans=n.getMainOps(a.applyVersions,!1,r),i.trans_Reverser=n.getMainOps(a.resetBaseVersions,!0,!1),i.trans_othersReverser=n.getMainOps(a.resetBaseVersions,!0,!0),["trans_othersReverser","trans"].forEach((function(e){var a=i[e],r=n[e];if(a){var o=a[n.getCmdMainId()];if(o)for(var s=0;s<t.length;++s){var l=[t[s]];r.call(n,o,l)&&(t.splice.apply(t,[s,1].concat(l)),s+=l.length-1)}}})),["trans_Reverser","trans"].forEach((function(t){var a=i[t],r=n[t],o=a[n.getCmdMainId()];if(o)for(var s=0;s<e.length;++s){var l=[e[s]];r.call(n,o,l)&&(e.splice.apply(e,[s,1].concat(l)),s+=l.length-1)}})),n.updateShapeIdxPath(e),{lcCmds:e,lcCmtCmds:t}}},{key:"getMainOps",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n={};return e?(e.forEach((function(e){if(!(r&&e.isSelf||t&&a&&e.isVerOfCurExec))for(var i in e.mainOperstes)if(e.mainOperstes.hasOwnProperty(i)){var o=e.mainOperstes[i];if(!(o.length<=0)){for(var s=[],l=0;l<o.length;l++){var c=window.serverOnlyCommandAffects(o[l]);if(c&&c.length>0){var d=o[l],p=d.name,u=d.param,h=!1;if(p===v.default.batchCommands)for(var f=u.commands,m=0;m<f.length;m++)f[m].param.fakeCmds&&(s=s.concat(f[m].param.fakeCmds)),f[m].param.cvCmds&&(s=s.concat(f[m].param.cvCmds),h=!0);else p===v.default.documentBeautify||(u.fakeCmds&&(s=s.concat(u.fakeCmds)),u.cvCmds&&(s=s.concat(u.cvCmds),h=!0));e.isSelf||h||s.unshift(o[l])}else a&&e.isVerOfCurExec||s.push(o[l])}0!==s.length&&(null==i&&(i=0),n[i]=i in n?n[i].concat(s):s)}}})),n):n}},{key:"trans_Reverser",value:function(e,t){var a=this.reverse(e);if(a.length<=0)return!1;var r=this.trans(a,t),i=this.reverse(a);return e.splice(0),e.splice.apply(e,[0,0].concat(n()(i))),r}},{key:"trans_othersReverser",value:function(e,t){var a=this.reverse(e);if(a.length<=0)return!1;var r=this.trans(a,t),i=this.reverse(a);return e.splice(0),e.splice.apply(e,[0,0].concat(n()(i))),r}},{key:"getLocalCmds",value:function(e,t){var a=[];return e?(e.forEach((function(e){if(e.localCommand){var r=e.localCommand,n={name:r.name,param:r.param};n.needClose=!0!==t||e.closed,a.push(n)}})),a):a}},{key:"reverse",value:function(e){if(!e||0===e.length)return[];var t=[];e.reverse();for(var a=e.length-1;a>=0;--a){var r=e[a],n=this.wrapperFactory.get(r).reverse();t.push(n.op)}return t}},{key:"getWrapOpDones",value:function(e){for(var t=[],a=0;a<e.length;++a)e[a]&&t.push(this.wrapperFactory.get(e[a]));return t}},{key:"getWrapOps",value:function(e){for(var t=[],a=0;a<e.length;++a)e[a]&&t.push(this.wrapperFactory.get(e[a]));return t}},{key:"OpTrsOp",value:function(e,t,a,r){var n=r[t.name];if(!n)return console.warn(!1,"没有"+t.name+"的操作变换方法"),!1;var i=n[e.name];return!!i&&i.call(this,e,t,a)}},{key:"getOpsFromWraper",value:function(e,t){t.splice(0,t.length);for(var a=0;a<e.length;++a){var r=e[a].op;t.push(r)}return t}},{key:"getOpsDoneFromWraper",value:function(e,t){t.splice(0,t.length);for(var a=0;a<e.length;++a){var r=e[a].op;t.push(r)}}},{key:"getCmdMainId",value:function(){return this.pres.getBuddy().getObjID()}},{key:"transExtRanges",value:function(e){if(e){var t=e.localVersions,a=e.localCommitedVersion,r=this.getExtRangeCmds(t),n=this.getExtRangeCmds(a);if(r||n){var i=this.transInner(r?r.beginRgs:[],n?n.beginRgs:[],e),o=this.transInner(r?r.endRgs:[],n?n.endRgs:[],e);r&&this._applyVersionExtRanges(r.versions,i.lcCmds,o.lcCmds),n&&this._applyVersionExtRanges(n.versions,i.lcCmtCmds,o.lcCmtCmds)}}}},{key:"transReuseExtRanges",value:function(e,t){for(var a=e.applyVersions,r=e.resetBaseVersions,n=0;n<t.length;n++){var i=t[n],o=r.indexOf(i);if(!(o<0)){var s=this._getTransactIndex(a,i);if(!(s<0)){var l=a[s],c={localVersions:[i],localCommitedVersion:[],applyVersions:a.slice(0,s+1),resetBaseVersions:r.slice(0,o+1)},d=(c=this.cancelOut(c,i)).resetBaseVersions;d[d.length-1]===i&&d.splice(d.length-1,1);var p=c.applyVersions;p[p.length-1]===l&&p.splice(p.length-1,1),this.transExtRanges(c)}}}}},{key:"_getTransactIndex",value:function(e,t){if(!t)return-1;for(var a=0;a<e.length;a++){var r=e[a];if(r&&(r.bornTaskVer===t.bornTaskVer||r.bornTaskVer===t.taskVer))return a}return-1}},{key:"cancelOut",value:function(e,t){var a=[],r=[],n=e.applyVersions.length,i=e.resetBaseVersions.length;if(0===n||0===i)return e;for(var o=0;o<n;++o)for(var s=this.retobj.applyVersions[o],l=0;l<i;++l){var c=e.resetBaseVersions[l];if(s.bornTaskVer===c.bornTaskVer||s.bornTaskVer===c.taskVer){r[o]=!0,a[l]=!0;break}}if(0===a.length||0===r.length)return this.retobj;var d={};d.localVersions=e.localVersions,d.localCommitedVersion=e.localCommitedVersion,d.applyVersions=[],d.resetBaseVersions=[];for(var p=0;p<n;++p)!0!==r[p]&&d.applyVersions.push(e.applyVersions[p]);for(var u=0;u<i;++u)!0!==a[u]&&d.resetBaseVersions.push(e.resetBaseVersions[u]);return d}},{key:"transSelectionRange",value:function(e,t){if(t){var a=this.getFakeExtRangeCmd(e),r=this.transInner([a],[],t);return r.lcCmds&&r.lcCmds.length>0?r.lcCmds[0].param.range:void 0}}},{key:"transCopyRange",value:function(e,t){if(t){var a=this.getFakeExtRangeCmd(e),r=this.transInner([a],[],t,!1);return r.lcCmds&&r.lcCmds.length>0?r.lcCmds[0].param.range:void 0}}},{key:"_applyVersionExtRanges",value:function(e,t,a){for(var r=this.pres.selection,n=0;n<e.length;n++){var i=e[n].extRanges.get(r);i&&(i.beginRgs=t[n].param.range,i.endRgs=a[n].param.range)}}},{key:"getFakeExtRangeCmd",value:function(e){return{name:v.default.selection,param:{range:e,bExtRange:!0}}}},{key:"getExtRangeCmds",value:function(e){if(!e||0===e.length)return null;var t={beginRgs:[],endRgs:[],versions:[]},a=this,r=this.pres.selection;return e.forEach((function(e){if(e.extRanges){var n=e.extRanges.get(r);if(n){var i=a.getFakeExtRangeCmd(n.beginRgs),o=a.getFakeExtRangeCmd(n.endRgs);t.beginRgs.push(i),t.endRgs.push(o),t.versions.push(e)}}})),t}}]),t}(m.a),Va=a(2262),Wa=a(262),Ga=window.CoreExports,Ha=Ga.Slide,Ua=Ga.helper,za=function(){function e(t,a){o()(this,e),this.parent=t,this.selectData=a,this._modifyCallback={Background:this._modifySlideBackground,Transition:this._modifySlideTransition,Tags:this._modifySlideTags}}return l()(e,[{key:"insertSlide",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t||(t=0);var r=this.presentation;if(r.getLoaderMgr().setTopPriority(r.getLayouts()),this.transaction.isInTransaction())console.error("Insert Slide failed: in transaction.");else{var n=Ha.createNewSlide(e,t,r.slides,!a);if(n instanceof Ha){this.transaction.beginTransact(),r.slides.insertSlide(e,n),this.transaction.markData("insertSlide",n),n._isLocalNew=!0;var i={slideIdx:e,slideProps:{layoutId:n.private.following.private.slideId,localId:n.private.slideId,noPh:a}};this.transaction.endTopTransact("slideInsert",i);var o=this.coreSlt.getSlideMarker();o.clear(!1),this.coreSlt.selectSlide(n)}}}},{key:"insert3rdpartySlide",value:function(e,t,a){var r={sourceIdx:t},n={timestamp:Date.now(),slideIdx:e,docObj:r,uploadId:a};this.coreSlt.startDocTemplateCommand(n);var i=this.coreSlt.transaction;i.beginTransact(),n.genid&&i.setUserData("genid",n.genid),i.endTopTransact("docTemplate",n)}},{key:"insert3rdpartySlides",value:function(e){var t=this,a={slideIdx:this.parent.getActiveSlideIdx()+1,timestamp:Date.now(),actionType:T.DocerSlideActionType.InsertSlides,extArgs:{type:"importSlide",data:e}};this.coreSlt.startDocTemplateCommand(a);var r=this.presentation;r.on(r.constructor.EventTypes.NOTIY_BACKEND_CMD,(function(e){var a=e.event,n=e.param;if(a===Wa.default.server_doctemplate_end)if(n.success){var i=n.data;if(!i.cvCmds)return;i&&i.slideIdx&&t.parent.selectSlideAt(i.slideIdx);var o=i.cvCmds,s=[];o.forEach((function(e){var t=e.name,a=e.param;if("slideInsert"===t&&"slides"===a.category){var n=a.category,i=a.layerType,o=a.slideIdx,l=r.getSlideByIdx(i,n,o);s.push(r.getSlideProxy(l))}}));var l=t.parent.getSlideMarker();l&&l.update("slides",s)}else console.error("Insert3rdpartySlides error !!")}));var n=this.coreSlt.transaction;n.beginTransact(),a.genid&&n.setUserData("genid",a.genid),n.endTopTransact("docTemplate",a)}},{key:"deleteSlide",value:function(e){var t=this.presentation,a=this.coreSlt.getActiveSlide();if(!a)return{error:"invalid"};var r=null;if("number"==typeof e){var n=e,i=t.getContainerByCategory(a.getCategory());if(n<0||n>=i.getSlideCount())return{error:"invalid"};r=i.getSlideAt(n)}else r=e||a;var o=this.transaction;o.beginTransact();var s=this._doDeleteSlide(r);return"success"!==s.error&&o.rollback(),o.endTransact(),s}},{key:"deleteSlideV2",value:function(){var e=this.presentation,t=this.transaction,a=this.coreSlt.getSlideMarker().fetchIdxs();if(a.length<=0)return this.deleteSlide();t.beginTransact(),t.setCooperHandler("slideDelete");for(var r=a.length-1;r>=0;r--){var n=a[r],i=e.slides.getSlideAt(n),o=this._doDeleteSlide(i).error;if("success"!==o)return t.rollback(),{error:o}}return 0===e.getSlideCount()&&this.parent.clearSlideSelect(),t.endTransact(),{error:"success"}}},{key:"_doDeleteSlide",value:function(e){if(!e)return{error:"invalid"};var t=this.presentation,a=e.getCategory();if("slides"!==a&&"slideLayouts"!==a&&"slideMasters"!==a)return console.error("Unsupported operateion: deleteSlide in category "+a),{error:"unsupport"};if(!t.slides.isAllLoaded())return console.log("wait for all slides loaded!!!"),{error:"waitForLoad"};if(e.isLayoutSlide&&e.isDefLayout())return console.log("default layout"),{error:"defaultMaster"};if(e.isMasterSlide&&e.isDefMaster())return console.log("default layout"),{error:"defaultMaster"};if(t.isSlideFollowedByOthers(e))return console.warn("layout/master "+e.getId()+" is used!"),{error:"used"};if("slideLayouts"===a||"slideMasters"===a){var r={category:a,name:e.getName()};this.transaction.setCooperHandler("deleteSlideLayout"),this.transaction.setUserData("slideInfo",r)}var n=t.getContainerByCategory(a),i=n.getSlideIdx(e),o=n.getSlideIdxProxy(i),s=e.getId(),l=null;if("slideMasters"===a){l=t.nextSlideProxy(o)||t.previousSlideProxy(o);for(var c=t.getSlideProxy(e).followed.slice(0),d=t.getLayouts(),p=0;p<c.length;p++){var u=c[p].idx,h=d.getSlideAt(u),f=h.getId();d.deleteSlide(u),this.transaction.addCommand("slideDelete",{category:"slideLayouts",slideIdx:u,slideProps:{slideId:f,masterId:s,name:h.getName()}})}}else l=this.coreSlt.getNextSlideProxy(o)||this.coreSlt.getPreviousSlideProxy(o);var m=null,v=e.getMaster();v&&v.isMasterSlide&&(m=v.getId()),n.deleteSlide(i),this.transaction.addCommand("slideDelete",{category:a,slideIdx:i,slideProps:{slideId:s,masterId:m,name:e.getName()}});var g=!1;if("slides"!==a||!v||t.isSlideFollowedByOthers(v)||v.isPreserved||(g=!0),g){var y=t.getContainerByCategory("slideMasters");y.getSlideCount()>1&&(i=y.getSlideIdx(v),y.deleteSlide(i),this.transaction.addCommand("slideDelete",{category:"slideMasters",slideIdx:i,slideProps:{slideId:v.getId(),masterId:m,name:v.getName()}}))}return l?this.coreSlt.selectSlide(l):this.coreSlt.clearSlideSelect(),{error:"success"}}},{key:"moveSlide",value:function(e,t){var a=this.presentation,r=a.slides.children.length;if(!(0===t||e<0||e>=r||e+t<0||e+t>r)){var n=a.slides.getSlideAt(e);return this.transaction.beginTransact(),a.slides.moveSlide(e,t),this.transaction.endTopTransact("slideMove",{slideIdx:e,slideProps:{from:e,offset:t,to:e+t}}),this.coreSlt.selectSlide(n),!0}}},{key:"calOffset",value:function(e,t){var a=0;return e>t?a=t-e:e<t&&(a=t-e+1),a}},{key:"moveImpl",value:function(e,t,a){var r=this.presentation,n=this.transaction,i=this.calOffset(e,t);return 0===i||!(e+i<0||e+i>a||e<0||e>=a)&&(r.slides.moveSlide(e,i),n.addCommand("slideMove",{slideIdx:e,slideProps:{from:e,offset:i,to:e+i}}),!0)}},{key:"batchMoveImpl",value:function(e,t,a){var r=e.length,n=e[0],i=e[r-1];if(t<=n)for(var o=0;o<r;o++){var s=e[o];if(!this.moveImpl(s,t++,a))return!1}else if(t>=i)for(var l=r-1;l>=0;l--){var c=e[l];if(!this.moveImpl(c,t--,a))return!1}else{for(var d=this.coreSlt.getSlideMarker().binarySearch(t),p=t,u=d;u>=0;u--){var h=e[u];if(e[u]!==t&&h!==p){if(!this.moveImpl(h,p,a))return!1;p--}}p=t;for(var f=d+1;f<r;++f){var m=e[f];if(p!==m){if(!this.moveImpl(m,p,a))return!1;p++}}}return!0}},{key:"moveSlideV2",value:function(e){var t=this.presentation.slides.children.length,a=this.coreSlt.getActiveSlideProxy(),r=this.coreSlt.getSlideMarker().fetchIdxs(a);if(!r||r.length<=0){var n=this.coreSlt.getActiveSlideIdx();return this.moveSlide(n,this.calOffset(n,e))}var i=this.transaction;return i.beginBatchCommand(),i.setCooperHandler("slideMove"),this.batchMoveImpl(r,e,t)?(i.endBatchCommand(),!0):(i.rollback(),!1)}},{key:"applyModifier",value:function(e,t){if(e&&t){var a=this.presentation,r=Ua.getEditObjectPath(a,e);r.slideProps={};return!!function(a){var n=t.name(),i=a._modifyCallback[n],o=void 0;if(i?o=i.apply(a,[e,t]):console.error("Not found modify callback for:",n),o)return Object.assign(r.slideProps,o),r.slideProps.modifiers=t.trimmedModifiers(),r.slideProps.cmdFlags=t.flags(),r}(this)&&(this.transaction.addCommand("modifySlideProps",r),!0)}}},{key:"modifySlideProperties",value:function(e){var t=this.coreSlt.getActiveSlide();return!!t&&(this.transaction.beginBatchCommand(),this.applyModifier(t,e)?(this.transaction.endBatchCommand(),!0):(this.transaction.rollback(),!1))}},{key:"modifySlidePropertiesV2",value:function(e){if(!e||e.length<=0)return!1;this.transaction.beginBatchCommand();for(var t=0;t<e.length;++t){var a=e[t],r=a.slide,n=a.modifier;if(!this.applyModifier(r,n))return this.transaction.rollback(),!1}return this.transaction.endBatchCommand(),!0}},{key:"modifyLocalLayout",value:function(e,t){var a=this.coreSlt;if(a.state===T.SelectType.select_slide||a.state===T.SelectType.select_multi_slide){var r=this.coreSlt.getSlideMarker().fetch();if(!(r.length<=0)){var n=this.presentation;this.transaction.beginTransact(),r.length>1&&(this.transaction.setCooperHandler("modifySlideLayout"),this.transaction.setUserData("layoutDesp",t)),n.getLoaderMgr().setTopPriority(this.presentation.getLayouts());for(var i=0;i<r.length;++i){var o=r[i].idx,s=n.slides.getSlideAt(o),l={activeSlide:o};this.doModifyLayout(s,l,e,t)}this.transaction.endTransact()}}}},{key:"doModifyLayout",value:function(e,t,a,r){a||(a=0);var n=this.presentation.layouts.getSlideById(a);if(!n)return console.error("Not found layout:"+a),!1;var i=n.getFollowing();if(!i)return console.error("Not found layout:"+a),!1;var o={select:t,layoutId:a,masterId:i.getId(),layoutDesp:r},s=Ha.modifySlideLayout(this.presentation,e,a);if(s){if(Object.isEmpty(s.cvCmds))this.transaction.addCommand("modifySlideLayout",o);else{o.cvCmds=s.cvCmds;this.transaction.addCommand("modifySlideLayout",o,(function(e){var t=Object.assign({name:e.name,param:Object(g.a)(e.param)});return t.param&&t.param.cvCmds&&delete t.param.cvCmds,t}))}return!0}return!1}},{key:"_commentThumbsUp",value:function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"t",i=null,o=r.commentId;if(!o)return i;var s=e.getComments(),l=s.queryComment(o);if(l<=-1)return i;var c=this.transaction;if(c.beginTransact(),e.replyComment(t,r),t.replyName=r.authName,t.replyId=r.commentId,(i=Ua.getEditObjectPath(this.presentation,e)).comment=t,i.author=a,i.commentType=n,i.commentId=o,t.shape){var d=t.shape,p=d.visual.getRootShape(),u=p.visual.getAnchorRect(),h={x:Math.floor(u.x()),y:Math.floor(u.y())};t.pos=h,delete t.shape}return c.setUserData("userName",r.authName),c.setUserData("commentType",n),c.endTopTransact("commentAdd",i),i}},{key:"commentHandler",value:function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=function(e){return{date:e.getFullYear()<<16|e.getMonth()+1<<12|e.getDay()<<8|e.getDate(),time:e.getHours()<<24|e.getMinutes()<<16|e.getSeconds()<<10|0}};if(r&&r.time){var o=new Date(r.time),s=i(o),l=s.date,c=s.time;r.date=l,r.time=c}var d=null;if(!e)return d;try{switch(t){case T.CommentActionType.AddComment:d=this._commentInsert(e,a,r,n);break;case T.CommentActionType.DeleteComment:d=this._commentDelete(e,r);break;case T.CommentActionType.ThumbsUpComment:r.content="/like",d=this._commentThumbsUp(e,r,a,n,"t");break;case T.CommentActionType.OnceMoreComment:r.content="/+1",d=this._commentThumbsUp(e,r,a,n,"o")}}catch(e){console.error(e)}return d}},{key:"_commentInsert",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!t||!a)return null;var n="n",i=this.transaction;i.beginTransact(),r?(n="r",a.replyName=r.authName,a.replyId=r.commentId,e.replyComment(a,r)):e.addComment(a);var o=Ua.getEditObjectPath(this.presentation,e);if(a.shape){var s=a.shape,l=s.visual.getRootShape(),c=l.visual.getAnchorRect(),d={x:Math.floor(c.x()),y:Math.floor(c.y())};a.pos=d,a.shapeId=s.getId(),delete a.shape}return o.commentId=a.commentId,o.author=t,o.comment=a,o.commentType=n,i.setUserData("userName",t.authName),i.setUserData("commentType",n),i.addCommand("commentAdd",o),i.endTransact(),o}},{key:"_commentDelete",value:function(e,t){var a,r=!0,n=t.commentId;if(!n)return null;var i=this.transaction;i.beginTransact(),(a=e.deleteComment(n))||(r=!1);var o=null;return r?((o=Ua.getEditObjectPath(this.presentation,e)).commentId=n,i.setUserData("userName",a.authName),i.setUserData("commentType",a.commentType),i.endTopTransact("commentDelete",o)):i.rollback(),o}},{key:"commentModify",value:function(e,t,a){var r=!0,n=this.transaction;n.beginTransact();var i={};if(a.hasTag("position")){var o=a.modifiedData().position;r=e.updateCommentPos(t,o),i.pos=o}if(r&&a.hasTag("text")){var s=a.modifiedData().text;i.content=s}if(r){var l=Ua.getEditObjectPath(this.presentation,e);l.commentId=t.getCommentId(),l.comment=i,n.endTopTransact("commentModify",l)}else n.rollback()}},{key:"matchCommentShape",value:function(e,t){if(!t||!t.getAnchor())return null;var a=t.getAnchor(),r=a.x,n=a.y;if(0===r&&0===n)return null;for(var i=e.getShapeCount(),o=0;o<i;++o){var s=e.getShapeAt(o),l=s.visual.getRootShape().visual.getAnchorRect(),c=Math.floor(l.x()),d=Math.floor(l.y());if(Math.abs(c-r)<=1&&Math.abs(d-n)<=1)return s}return null}},{key:"fetchAvailPh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.coreSlt.getActiveSlide();if(t&&"slides"===t.getCategory()){for(var a=t.getSpTree(),r=a.childShapes,n=0;n<r.length;++n){var i=r[n];if(i.isPlaceHolder()){var o=i.getPlaceHolder();if((null==o.type||o.type===T.PlaceholderType.Object||o.type===e)&&!i.hasContent())return i}}return null}}},{key:"_applyBackgroundForAll",value:function(e,t){var a=function(e,t){for(var a=e.length(),r=0;r<a;r++){var n=e.getSlideAt(r);if(n&&!n.visual.setBackgroundProperties(t||{_REMOVE:!0}))return!1}return!0};if("slides"!==e&&"slideLayouts"!==e&&"slideMasters"!==e)return!1;var r=!0,n=this.presentation;if((r=a(n.getMasters(),t))&&(r=a(n.getLayouts(),null)),"slides"===e&&r&&(r=a(n.getSlides(),null)),r){var i=!t||t._REMOVE,o=t&&t.props;return i?{_REMOVE:!0}:{props:o}}}},{key:"_modifySlideBackground",value:function(e,t){var a=e.visual.getBackgroundVisual();a&&t.setSource(a.getPicture()||a.getFill()||{});var r=t.modifiedData(),n=r?{props:{fill:r}}:{_REMOVE:!0};if(!t.getFlag("applyForAll"))return e.visual.setBackgroundProperties(n);var i={applyForAll:{background:n}};return this._applyBackgroundForAll(e.getCategory(),n)?i:void 0}},{key:"_applyTransitionForAll",value:function(e,t){var a=this.presentation,r=function(e,t){for(var a=e.length(),r=0;r<a;r++){var n=e.getSlideAt(r);if(!n)return!1;var i=n.getPropertyValue("transition");t.setSource(i||{});var o=t.modifiedData();if(!n.modifyProperties({transition:o}))return!1}return!0};if("slides"!==e&&"slideLayouts"!==e&&"slideMasters"!==e)return!1;var n=!0;return n&&(n=r(a.getMasters(),t)),n&&(n=r(a.getLayouts(),t)),"slides"===e&&n&&(n=r(a.getSlides(),t)),n}},{key:"_modifySlideTransition",value:function(e,t){t.setSource({});var a=t.modifiedData(),r=null;if(t.getFlag("applyForAll"))this._applyTransitionForAll(e.getCategory(),t)&&(r={applyForAll:{transition:a}});else{var n=e.getPropertyValue("transition");t.setSource(n||{});var i=t.modifiedData();(r=e.modifyProperties({transition:i}))&&(r.transition=a)}return r}},{key:"_modifySlideTags",value:function(e,t){t.setSource(e.getTags()||[]);var a=t.modifiedData(),r=e.modifyProperties({tags:a});return r&&(r.tags=a),r}},{key:"applySlidesBeautify",value:function(e){var t=e.uploadId,a=e.fileKey;return t?Va.a.applySlideBeautify(this,t,a):{err:T.WppErrStr.E_WPP_INVALID_IN_PARAMETER}}},{key:"coreSlt",get:function(){return this.parent}},{key:"presentation",get:function(){return this.parent.presentation}},{key:"transaction",get:function(){return this.parent.transaction}}]),e}(),qa=a(2867),Ka=a(304),Qa=a(2241),Ja=window.CoreExports.utils,Ya=Ja.deepClone,Xa=Ja.deepMergeWithConfigs,Za=window.CoreExports.helper,$a=Za.getEditObjectPath,er=Za.canGroup,tr=window.CoreExports.TypeDefines,ar=tr.TextAutoFitType,rr=tr.PresetShapeType,nr=tr.ShapeGroupType,ir=window.CoreExports.Qt.QRect,or=window.CoreExports.animation,sr=or.AnimHelper,lr=or.AnimNodeType,cr=or.AnimPresetType,dr=or.AnimTriggerType,pr=or.AnimCategory,ur=window.CoreExports,hr=ur.GroupShape,fr=ur.PlaceHolderHelper,mr=ur.InkData;function vr(e){return"number"==typeof e&&!isNaN(e)}var gr=function(){function e(t,a){var r=this;o()(this,e),this.setBackGroundMusic=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=r.parent,a=t.getAnimSelection(),n=t.getActiveSlide(),i=n&&n.getTiming(),o=i&&i.getTimeLine();if(o){var s=t.transaction;s.beginBatchCommand(),s.setWaitCommands({all:!0,exclude:["slideInsert","paste"]}),s.setCooperHandler("modifyMedia"),e?s.setUserData("bgmFlag","setBgm"):s.setUserData("bgmFlag","cancelBgm");var l=Ia("Media");if(l.modify("backgroundMusic",e?1:0),l.modify("loopUntilStop",e?1:0),l.modify("hideWhileNotPlay",e?1:0),r.doModifyShapeProperties(l)){for(var c=t.getActiveShapes(),d=0;d<c.length;++d){var p=c[d];if(p.isMedia()){o.getMediaNode(p)||o.addMediaNode(p,T.MediaDataType.MediaDataTypeSound);var u=o.getMediaNode(p),h=Ia("TimeNode");if(e){var f=999,m=t.getSlideCount()>f?10*f+9:f-t.presentation.getSlideIdxById(n.getId());h.modify("repeateCount",-1),h.modify("hideWhenStopped",1),h.modify("endAfterSlide",m),t.selectAnimation(u),a.modifyAnimPropertiesBatch(h);var v=a.helper.getMediaEffect(p);if(!v){t.selectShape(p);var g=a.insertAnimBatch(pr.MediaCall,cr.MediaPlay,!0);v=g&&g[0]}v||s.rollback(),t.selectAnimation(v),a.moveAnimBatch(0,0),r.setMediaAutoPlayMode(!0)}else h.modify("repeateCount",1),h.modify("hideWhenStopped",0),h.modify("endAfterSlide",-1),t.selectAnimation(u),a.modifyAnimPropertiesBatch(h),r.setMediaAutoPlayMode(!1)}}s.endBatchCommand()}}},this.setMediaAutoPlayMode=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=r.parent,a=t.getActiveShapes(),n=t.transaction;n.beginBatchCommand(),n.setCooperHandler("modifyMedia"),r._setMediaAutoPlayModeInner(a,e,n)?t.transaction.endBatchCommand():n.rollback()},this.parent=t,this.selectData=a,this._modifyCallback={Transform2D:this._modifyShapeTransform2D,Fill:this._modifyShapeFill,Outline:this._modifyShapeOutline,Modify_Picture:this._modifyShapePicture,Modify_Picture_Props:this._modifyPictureProps,Processon:this._modifyShapeProcessOn,Media:this._modifyShapeMedia,Table:this._modifyShapeTable,Chart:this._modifyShapeChart,Geometry2D:this._modifyShapeGeometry,TextFont:this._modifyTextFont,InkData:this._modifyShapeInkData,TextFrameProps:this._modifyTextFrameProps,Property:this._modifySimpleProperty,Whiteboard:this._modifyWhiteboard,ShapeExtData:this._modifyShapeExtData,Effects:this._modifyShapeEffects,Connector:this._modifyShapeConnector,Tags:this._modifyShapeTags,Actions:this._modifyShapeActions}}return l()(e,[{key:"check",value:function(){if(this.parent.state===y.SelectType.select_shape||this.parent.state===y.SelectType.select_multi_shape||this.parent.state===y.SelectType.select_text){var e=this.parent.getActiveShapes();if(!e||0===e.length)throw this.parent.state===y.SelectType.select_text?new Error("wrong select state:"+this.parent._getStateString()):new Error("wrong select len is 0.")}}},{key:"fire",value:function(e,t){this.parent.fire(e,t)}},{key:"insertTypeToName",value:function(e){for(var t=Object.keys(T.ShapeTreeInsertCommandTypes),a=0;a<t.length;a++){var r=t[a];if(T.ShapeTreeInsertCommandTypes[r]===e)return r.substr(0,1).toLowerCase()+r.substr(1)}}},{key:"insertNameToType",value:function(e){for(var t=e.substr(0,1).toUpperCase()+e.substr(1),a=Object.keys(T.ShapeTreeInsertCommandTypes),r=0;r<a.length;r++){var n=a[r];if(n==t)return T.ShapeTreeInsertCommandTypes[n]}}},{key:"_insertShapeNoTransact",value:function(e,t){var a=this;if(this.parent.getActiveSlide()){var r=t.rect,n=t.bCopyDefProps,i=t.bDefCreate;void 0===n&&(n=!0),void 0===i&&(i=!0),r=r||{x:0,y:0,width:1440,height:1440},t.rect=r,t.bCopyDefProps=n,t.bDefCreate=i;var o=this.parent.getActiveSlide(),s=this.parent.getPresentation(),l={};l.slideIdx=s.getSlideIdxById(o.getId()),l.slideProps={};var c=o.getShapeTree(),d=null;if(null!=c&&(d=c.insertShape(e,t)),null!=d){var p=this.insertTypeToName(e),u=$a(s,d),h={};h[p]=t,h.cmdName=p,d._isLocalNew=!0,h.localId=d.private.shapeId,u.slideProps=h,this.parent._doNotAutoRemoveTextBox((function(){a.parent.clearShapeSelect(),a.parent.addSelectShape(d)}));var f=window.getTransaction();return f.isInTransaction()&&f.markData(p,d),{shape:d,sendparam:u,param:t}}return null}}},{key:"_insertShapeCommonV2",value:function(e,t){if(!this.parent._fireReadOnly()){if(!this.parent.getActiveSlide())throw new Error("wrong select state:"+this.parent._getStateString());var a=this,r=window.getTransaction();r.beginBatchCommand();var n=this._insertShapeNoTransact(e,t);if(n){var i=n.shape,o=n.sendparam,s=a.insertTypeToName(e);if("insertTable"===s){var l=o.slideProps[s],c=t.phShape;if(c){var d=c.getShapeTree(),p=d.getShapeIndex(c);i.setPropertyValue("placeholder",c.getPlaceHolder());var u=d.getChildCount();d.removeAt(u-1),d.deleteShape(c),d.insert(p,i),l.phShape&&delete l.phShape,l.bReplace=!0,l.phIndex=p}var h=i.getTableFrame();h.border&&(l.border=Ya(h.border),delete h.border)}return r.addCommand("shapeInsert",o),r.registerEndNotify((function(t){if(!t){var r=a.insertTypeToName(e),n=o.slideProps[r];n.rect=Ya(i.visual.getRealTransform2D());var s=n.modifyProps;if("insertInk"===r){var l=new mr(i.private.inkData);n.drawingToken=i.drawingToken,n.bBroadcast=i.bBroadcast,n.inkData=l.getCommandData(),s&&delete s.inkData,delete n.trace}s||(s={});var c=i.getTextFrame();if(c){var d=c.getProperty(),p=d.autoFit;d.autoFit=null==p?0:p;var u=s&&s.textFrameProps;u=Object.assign({},u||{},Ya(d)),s=Object.assign({},s||{},{textFrameProps:u})}s.rect=i.visual.getAnchorRect().getBounds();var h=i.getTransform2D();s.transform2DInfo={flipRotation:{}},["rotation","horizontalFlipped","verticalFlipped"].forEach((function(e){null!=h[e]&&(s.transform2DInfo.flipRotation[e]=h[e])})),n.modifyProps=s}})),r.endBatchCommand(),{shape:i}}r.rollback()}}},{key:"insertShape",value:function(e){var t=this,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertShape,e);return a&&this.parent._doNotAutoRemoveTextBox((function(){t.parent.selectShape(a.shape),t.parent.clearTextSelect()})),a}},{key:"insertTextBox",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.CompositionState.NoComposition,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertTextBox,t);return a&&this.parent._doNotAutoRemoveTextBox((function(){e.parent.selectShape(a.shape),e.parent.selectText(0,0)})),a}},{key:"insertPicture",value:function(e){var t=this,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertPicture,e);return a&&this.parent._doNotAutoRemoveTextBox((function(){t.parent.selectShape(a.shape)})),a}},{key:"insertProcessOn",value:function(e){var t=this,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertProcessOn,e);return a&&this.parent._doNotAutoRemoveTextBox((function(){t.parent.selectShape(a.shape)})),a}},{key:"insertSvgPicture",value:function(e){var t=this,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertSvgPicture,e);if(a){var r=a.shape;this.parent._doNotAutoRemoveTextBox((function(){t.parent.selectShape(r)})),this.parent.transaction.isInCensorTransaction()&&delete r.private.picture}return a}},{key:"insertMedia",value:function(e){var t=this,a=e.mediaDataType,r=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertMedia,e);if(r){this.parent._doNotAutoRemoveTextBox((function(){t.parent.selectShape(r.shape)}));var n=this.parent.getAnimSelection(),i=r.shape,o=this.parent.getActiveSlide(),s=o.getTiming();if(!s)return r;var l=s.getTimeLine();l||(l=sr.createNode(lr.TimingRoot),s.setTimeline(l));var c=this.parent.transaction;c.setCooperHandler("insertMedia"),a===T.MediaDataType.MediaDataTypeMovie||a===T.MediaDataType.MediaDataTypeOnlineVideo?(c.setUserData("mediaFlag","insertVideo"),l.addMediaNode(i,T.MediaDataType.MediaDataTypeMovie)):a===T.MediaDataType.MediaDataTypeSound&&(c.setUserData("mediaFlag","insertAudio"),l.addMediaNode(i,T.MediaDataType.MediaDataTypeSound));var d=n.insertAnimBatch(pr.MediaCall,cr.MediaPlay,!0),p=Ia("TimeNode");d&&d.forEach((function(e){e&&(t.parent.selectAnimation(e),p.modify("triggerType",dr.OnPageClick),n.modifyAnimPropertiesBatch(p))}));var u=o.getCategory();"slideLayouts"!==u&&"slideMasters"!==u||this._setMediaAutoPlayModeInner([i],!0),this.parent.selectShape(i)}return r}},{key:"insertInk",value:function(e){var t=this,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertInk,e);return a&&this.parent._doNotAutoRemoveTextBox((function(){t.parent.clearShapeSelect()})),a}},{key:"insertTable",value:function(e){var t=this,a=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertTable,e);return a&&this.parent._doNotAutoRemoveTextBox((function(){t.parent.selectShape(a.shape)})),a}},{key:"insertTable2Ph",value:function(e,t){var a=this;if(t.isPlaceHolder()){e.phShape=t;var r=this._insertShapeCommonV2(T.ShapeTreeInsertCommandTypes.InsertTable,e);return r&&this.parent._doNotAutoRemoveTextBox((function(){a.parent.selectShape(r.shape)})),r}}},{key:"_deletePhShapeNoTransact",value:function(e,t){if(t&&0!==t.length){var a={},r=[],n=this.parent.getPresentation(),i=n.getSlideIdxById(e.getId()),o=[],s=[];return t.forEach((function(e){var t=e.shape;if(!Object.isEmpty(t)&&t.isShape&&t.parent&&!t.isGroupShape()&&t.isPlaceHolder()){var a=$a(n,t);a.props={extendProps:{shapeReplace:!0},cmdExtends:{actionType:y.actionType.Shape_Replace}},r[r.length]=a,o.push(t);var i=t.parent.deleteShape(t);i&&s.push(i)}})),a.slideIdx=i,a.shapes=r,{sendparam:a,keeps:s}}console.log("deleteShapes: empty shape list")}},{key:"_deleteShapeNoTransact",value:function(e,t){if(t&&0!==t.length){var a=[],r=[],n={},i=[],o=this.parent.getPresentation(),s=o.getSlideIdxById(e.getId()),l=[];t.forEach((function(e){if(!Object.isEmpty(e)&&e.isShape&&e.parent){for(var t=$a(o,e),n=e;n;){var c=n.parent;if(c&&c.isShapeTree)break;n=c}n&&n.isGroupShape()&&(t.props={data:n.childrenTree(),slideIdx:s,shapePath:[t.shapePath[0]]});var d=e.getSlide();if(d){var p=!1;"slides"===d.getCategory()&&(p=e.isPlaceHolder()&&e.hasContent())&&fr.isIgnoreType(e.getPlaceHolder().type)&&(p=!1),e.isChildShape()&&(p=!1);var u=e.getSlideFollowing();if(p&&u&&u.matchPhShapeCommon(e))e.savedTrans2D=e.visual.getTransform2D(),r.push({shape:e});else{i[i.length]=t,e.savedTrans2D=e.visual.getTransform2D(),l.push({shape:e,info:t});var h=e.visual.getRootShape();h&&a.indexOf(h)<0&&a.push(h)}}}}));var c=[],d=[];l.forEach((function(e){var t=e.shape,a=e.info,r=t.parent,n=r.private.childs;if(a.shapeCount=n.length,!r.isShapeTree&&2===n.length){var i=n.indexOf(t);d.push(n[1===i?0:1])}r.deleteShape(t),c.push(t)})),n.slideIdx=s,n.shapes=i;for(var p=[],u=0;u<d.length;u++)d[u].parent&&d[u].parent.isShapeTree&&p.push(d[u]);if(0===p.length)for(var h=0;h<a.length;h++)a[h].getSlide()&&p.push(a[h]);return{sendparam:n,keeps:p,deleted:l,replaced:r}}console.log("deleteShapes: empty shape list")}},{key:"_deriveDeleteShape",value:function(e,t){var a=this,r=this.parent.transaction;if(t&&!(t.length<=0)){var n=e.getComments();n&&t.forEach((function(t){var i=a.parent.getPresentation(),o=t.shape,s=o.savedTrans2D;if(s){for(var l=Math.floor(s.x/635),c=Math.floor(s.y/635),d=n.childs,p=0;p<d.length;++p){var u=d[p],h=u.getAnchor(),f=h.x,m=h.y;if(Math.abs(l-f)<=1&&Math.abs(c-m)<=1){var v=u.getCommentId(),g=e.deleteComment(v);if(g){p--;var y=$a(i,e);y.commentId=v,r.setUserData("userName",g.authName),r.setUserData("commentType",g.commentType),r.addCommand("commentDelete",y)}}}delete o.savedTrans2D}}))}}},{key:"_deriveModifyShape",value:function(e){for(var t=this.parent.transaction,a=this.parent.getPresentation(),r=0;r<e.length;++r){var n=e[r],i=n.slide,o=n.shape,s=n.modifier;if("Transform2D"===s.name()){var l=i.getComments();if(l){var c=s.primary();if(c)for(var d=o.visual.getTransform2D(),p=Math.floor(d.x/635),u=Math.floor(d.y/635),h=Math.floor(c.x/635),f=Math.floor(c.y/635),m=l.childs,v=0;v<m.length;++v){var g=m[v],y=g.getAnchor(),T=y.x,C=y.y;if(!(Math.abs(T-h)>1||Math.abs(C-f)>1)&&(d.x!==c.x||d.y!==c.y)){g.setPropertyValue("pos",{x:p,y:u});var _=$a(a,i);_.commentId=g.getCommentId(),_.comment={pos:{x:p,y:u}},t.addCommand("commentModify",_)}}}}}}},{key:"_deleteShapes",value:function(e,t){var a=this;if(!this.parent._fireReadOnly()){if(e&&t&&0!==t.length){var r=this.parent.transaction;r.beginBatchCommand(),this.beforeDeleteShape(t);var n=function(e,t){var n=[],i=a._deleteShapeNoTransact(e,t),o=i.sendparam,s=i.keeps,l=i.deleted,c=i.replaced;if(l.length>0&&r.addCommand("shapeDelete",o),s&&s.length>0&&(n=n.concat(s)),c.length>0){var d=a._deletePhShapeNoTransact(e,c),p=d.sendparam,u=d.keeps;r.addCommand("modifyShapeProps",p),u&&u.length>0&&(n=n.concat(u))}return a.parent._doNotAutoRemoveTextBox((function(){n&&n.length>0?a.parent.selectShapes(n):a.parent.clearShapeSelect()})),{deleted:l,replaced:c}}(e,t);return this.afterDeleteShape(e,n),r.endBatchCommand(),n}console.log("deleteShapes: invalid param")}}},{key:"deleteShape",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.parent.getActiveSlide();null==e&&(this.check(),e=this.parent.getActiveShapes());var a=this.parent.transaction;a.beginBatchCommand(),this._deleteShapes(t,e),a.endBatchCommand()}},{key:"beforeDeleteShape",value:function(e){e&&(this.deleteEffectBeforeShapeDelete(e),this.modifyConnectorBeforeShapeDelete(e))}},{key:"afterDeleteShape",value:function(e,t){if(t){var a=t.deleted,r=t.replaced;a.length>0&&this._deriveDeleteShape(e,a),r.length>0&&this._deriveDeleteShape(e,r);var n=this.parent.transaction;n.setCooperHandler("DeleteShapes");var i={bDelete:a&&a.length>0,bReplace:r&&r.length>0};n.setUserData("deleteShape",i)}}},{key:"modifyConnectorBeforeShapeDelete",value:function(e){var t=this;if(e){var a=function(e){r.getChildShapesRecurse((function(a){if(a.isConnector()){var r=a.getConnector();if(r){var n=Ia("Connector"),i=r.startConnector,o=r.endConnector;i&&i.shapeId===e.getId()&&n.modify("startConnector",null),o&&o.shapeId===e.getId()&&n.modify("endConnector",null),n.empty()||t.parent.applyShapeModifiers([n],[a])}}}))},r=this.parent.getActiveSlide().getShapeTree(),n=this.parent.transaction;n.beginBatchCommand();for(var i=0;i<e.length;++i){a(e[i])}n.endBatchCommand()}}},{key:"deleteEffectBeforeShapeDelete",value:function(e){var t=this,a=!1;if(!e)return a;var r=this.parent.getAnimSelection();return(e||this.parent.getActiveShapes()).forEach((function(e){var n=r.helper.getEffects(e);n&&n.length&&(a=!0,t.parent.selectAnimsDirectly(n),r.deleteAnimBatch(!0))})),a}},{key:"canAcceptThisModify",value:function(e,t,a){var r=a.name();if("Outline"===r){var n=t.getShapeType();if(n!=y.ShapeType.NormalShape&&n!=y.ShapeType.TextBox&&n!=y.ShapeType.Ink&&n!=y.ShapeType.Picture&&n!=y.ShapeType.Processon)return!1}return!!(t.getShapeGroup()!=nr.LineGroup||t.isCustomCurve()||"Fill"!==r&&"Picture"!==r&&"Processon"!==r)}},{key:"modifyShapeProperties",value:function(e){if(null!=e){var t=this.parent,a=t._doingShapes;t._doingShapes=[];var r=t.getShapeSelection();if(a&&1===a.length){var n=a[0],i=n.slide,o=n.shape;if(i&&t.isValidShape(o))return o.hasTable()?t.getTableSelection().modifyTableProperty(e):r.modifyShapePropertiesBatch([{slide:i,shape:o,modifier:e}]);var s=e.name();if("Processon"===s){var l=e.getFlag("rect"),c=e.getFlag("uploadId"),d=e.getFlag("category"),p=e.getFlag("fileId"),u=e.getFlag("definition");return t.insertProcessOn(l,c,d,p,u)}if("Picture"===s){var h=e.getFlag("rect"),f=e.getFlag("uploadId"),m=e.getFlag("extParams");return t.insertPicture(h,f,m)}}var v=t.getActiveShapes();if(v&&0!==v.length){var g=t.transaction,y={};g.beginBatchCommand();var T=e.name();if("Outline"===T||"Fill"===T){for(var C=[],_=t.getActiveSlide(),b=t.getTableSelection(),S=0;S<v.length;S++){var k=v[S];if(k.hasTable()){if(!(y=b.modifyTableProperty(e,k.getTableFrame())))break}else C.push({slide:_,shape:k,modifier:e})}y&&C.length>0&&(y=r.modifyShapePropertiesBatch(C))}else y=r.doModifyShapeProperties(e);return y?g.endBatchCommand():g.rollback(),y}}}},{key:"_doModifyShapeProperty",value:function(e,t){var a=e.slide,r=e.shape,n=e.modifier;if(!a||!r||!n)return!1;var i=this.parent.getPresentation();if(!this.canAcceptThisModify(a,r,n))return!0;var o=function(e,t){var a=t.name(),r=t.flags();if(r&&r.actionType)return r.actionType;if(("Fill"===a||"Outline"===a||"InkData"===a)&&e.isInk())return y.actionType.Modify_InkData;switch(a){case"Transform2D":var n=t.modifiers()[0].val;return r.rotateType?y.actionType.Rotate_Shape:r.tileType?y.actionType.Tile_Shapes:r.hasOwnProperty("type")?r.type:n.width||n.height?y.actionType.Resize_Shape:n.x||n.y?y.actionType.Move_Shape:null;case"Fill":return y.actionType.Modify_Fill;case"Outline":return y.actionType.Modify_Outline;case"Modify_Picture":return y.actionType.Modify_Picture;case"Processon":return y.actionType.Modify_Processon;case"Media":return y.actionType.Modify_Media;case"Table":return y.actionType.Modify_Table;case"Chart":return y.actionType.Modify_Chart;case"Geometry2D":return r.hasOwnProperty("type")?r.type:y.actionType.Modify_Geometry;case"TextFont":return y.actionType.Modify_TextFont;case"Hyperlink":return y.actionType.Modify_Hyperlink;case"InkData":return y.actionType.Modify_InkData;case"TextFrameProps":return y.actionType.Modify_TextFrameProps;case"Property":return y.actionType.Modify_Property;case"Effects":return y.actionType.Modify_Effects;case"ShapeExtData":return y.actionType.Modify_ExtData;case"Actions":return y.actionType.Modify_Actions}}(r,n),s=$a(i,r),l={};s.props=l,null!=o&&(l.cmdExtends={actionType:o});var c=null,d=n.name(),p=this._modifyCallback[d];if(p?c=p.apply(this,[r,n]):console.error("Not found modify callback for:",d),c){for(var u in null!=o&&(l.cmdExtends.actionType=o),c.newval)l[u]=c.newval[u];return l.modifiers=n.trimmedModifiers(),l.cmdFlags=n.flags(),l.shapeType=r.getShapeType(),t.shapes[t.shapes.length]=s,!0}return!1}},{key:"modifyShapePropertiesBatch",value:function(e){if(!this.parent._fireReadOnly()&&e&&0!=e.length){this.check();var t=this,a={shapes:[]},r=window.getTransaction();r.beginBatchCommand();for(var n=[],i=0;i<e.length;i++){var o=e[i],s=o.slide,l=o.shape,c=o.modifier;if(!s||!l||!c)return void r.rollback();var d=this._createShapeModifierBatch([c],[l]);d&&(n=n.concat(d))}if(n.length<=0)return console.warn("invalid batch command"),void r.rollback();e=n;if(function(){for(var r=0;r<e.length;r++)if(!t._doModifyShapeProperty(e[r],a))return!1;return!0}()){var p=e[0].modifier.flags();return null!=p.tileType&&(a.tileType=p.tileType),a.shapes.length>0&&(r.addCommand("modifyShapeProps",a),this._deriveModifyShape(e)),r.endBatchCommand(),{batchList:e}}r.rollback()}}},{key:"doModifyShapeProperties",value:function(e){var t=this._createShapeModifierBatch([e]);if(t&&0!=t.length)return this.modifyShapePropertiesBatch(t)}},{key:"modifyConnectorRoute",value:function(e,t){var a=this.parent.transaction;if(a.beginBatchCommand(),qa.a.updateSingleConnector(e,t)){var r={shapes:[]},n=$a(this.parent.presentation,e),i={};n.props=i;var o=e.getTransform2D(),s={x:o.x,y:o.y,width:o.width,height:o.height},l={horizontalFlipped:o.horizontalFlipped,verticalFlipped:o.verticalFlipped,rotation:o.rotation},c=e.visual.getAnchorRect(),d={rect:s,flipRotation:l};i.rect={left:c.left(),top:c.top(),right:c.right(),bottom:c.bottom()},i.transform2DInfo=d;var p=e.getGeometry2D();i.newGeometry2D=Ya(p.private);var u=i.newGeometry2D.presetType;i.newGeometry2D.presetTypeNum=Object(Vt.shapeTypeStr2Enum)(u),r.shapes.push(n),a.addCommand("modifyShapeProps",r),a.endBatchCommand()}else a.endBatchCommand()}},{key:"_createShapeModifierBatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this.parent,r=[];if(t)for(var n=0;n<t.length;n++){var i=t[n],o=i&&i.getSlide();o&&i&&r.push({slide:o,shape:i})}else{var s=a.getActiveSlide(),l=a.getActiveShapes();if(s&&l)for(var c=0;c<l.length;c++)r.push({slide:s,shape:l[c]})}if(0==r.length)return[];for(var d=[],p=0;p<r.length;p++)for(var u=r[p],h=u.slide,f=u.shape,m=0;m<e.length;m++){var v=e[m],g=v.name();if("Outline"===g)if(f.isGroupShape())for(var y=f.getChildShapesRecurse(),T=0;T<y.length;T++)d.push({slide:h,shape:y[T],modifier:v});else d.push({slide:h,shape:f,modifier:v});else d.push({slide:h,shape:f,modifier:v})}return d}},{key:"_modifyShapeTransform2D",value:function(e,t){var a=this;return t.applyOperate(e,(function(r,n,i){var o=e.visual.getAnchorRect().getRect();if(t.setSource(e.visual.getRealTransform2D()),"anchorRect"===r){if(n&&vr(n.x)&&vr(n.y)&&vr(n.width)&&vr(n.height)){e.visual.setAnchorRect(n);var s={rect:{left:n.x,right:n.x+n.width,top:n.y,bottom:n.y+n.height}};return o.width!=n.width||o.height!=n.height?(t.setFlag("type",y.actionType.Resize_Shape),a._afterResizeShape(e,s)):t.setFlag("type",y.actionType.Move_Shape),{newval:s}}}else{var l=e.visual.modifyShapeTransform2D(t.modifiedData());if(l)return Xa([i.newval,l.newval],{names:["rect","transform","flipRotation"],merger:function(e,t,a,r){return"rect"==t||"transform"==t?r:"flipRotation"==t?Object.assign(a||{},r||{}):void 0}})}}))}},{key:"_afterResizeShape",value:function(e,t){if(e){var a=e.getTextFrame();if(a&&a.private.prop&&a.private.prop.autoFit===ar.AdvancedAutoFit){var r=Ia("TextFrameProps",a.getProperty());r.modify("autoFit",T.AutoFit.None),r.modify("textWrap",T.TextWrap.Square);var n=r.modifiedData();delete n.textInset,a.modifyProps(n);var i={textFrameProps:n};t=Object.assign(t,i)}}}},{key:"_modifyShapeFill",value:function(e,t){if(e.isInk()){var a=new sa(e.getInkData());return a.assign(t),this._modifyShapeInkData(e,a)}return t.applyOperate(e,(function(a,r){if("fill"===a){if(null==r)return e.visual.setFill({type:0},!0);t.setSource(e.visual.getFill());var n=t.modifiedData();return e.visual.setFill(n,!0)}if("opacity"!==a){t.setSource(e.visual.getFill());var i=t.modifiedData();return e.visual.setFill(i,!0)}var o=e.visual.setOpacity(r,!0);if(o){var s=o.newval.fill||{};return s.opacity=r,{newval:{fill:s}}}}))}},{key:"_modifyShapeOutline",value:function(e,t){if(e.isInk()){var a=new sa(e.getInkData());return a.assign(t),this._modifyShapeInkData(e,a)}return t.apply(e,(function(){return e.visual.getOutline()}),(function(t){return e.visual.setOutline(t)}))}},{key:"_modifyShapePicture",value:function(e,t){var a=t.getFlag("rect"),r=t.getFlag("uploadId"),n=t.getFlag("svgData"),i=!!t.getFlag("isStretched"),o=t.getFlag("blipDip")||96;if(a&&vr(a.x)&&vr(a.y)&&a.width&&a.height){var s=e.visual.getAnchorRect();s.scale(635,635);var l=t.apply(e,(function(){var t=e.private.picture;return t||(t={blip:{blipAtom:{imageId:""}},isStretched:i,type:rr.ShapeRectangle}),t}),(function(t){if(t&&t.blip&&t.blip.blipAtom&&""!==t.blip.blipAtom.imageId)return e.setPicture(t)}));if(l){if(!1===i&&e.isPlaceHolder()){var c=t.getFlag("imageWidth")/o*1440*635,d=t.getFlag("imageHeight")/o*1440*635,p=(a=s).width(),u=a.height(),h=u/p,f=d/c;c<=p&&d<=u?a.setSize({width:c,height:d}):h>f?a.setHeight(p*f):a.setWidth(u/f);var m=(p-a.width())/2,v=(u-a.height())/2;a.setOffset(m,v),t.setFlag("rect",a.getRect())}if(r&&(l.newval.newPicture=r),n&&(l.newval.newPicture=n,l.newval.isSvgPicture=!0,t.clearAll()),!a)return l;(a=ir.create(a)).scale(1/635,1/635);var g=e.visual.setAnchorRect(a);if(g)return l.newval=Object.assign({},l.newval,g.newval),l}}}},{key:"_modifyPictureProps",value:function(e,t){t.setSource(e.getPicture());var a=t.modifiedData(),r=e.setPicture(a);return r&&(t.setSource({}),r.newval.picture=t.modifiedData(),r.newval.picture.bModify=!0),r}},{key:"_modifyShapeProcessOn",value:function(e,t){var a=t.getFlag("rect"),r=t.getFlag("uploadId"),n=t.getFlag("category"),i=t.getFlag("fileId"),o=t.getFlag("definition");if(a&&!Object.isEmpty(a.x)&&!Object.isEmpty(a.y)&&a.width&&a.height&&n&&i&&o){var s=t.apply(e,(function(){var t=e.private.picture;return t||(t={blip:{blipAtom:{imageId:""}},isStretched:!0,type:rr.ShapeRectangle}),t}),(function(t){if(t&&t.blip&&t.blip.blipAtom&&""!==t.blip.blipAtom.imageId)return e.setPicture(t)}));if(s){r&&(s.newval.newPicture=r),e.private.extData={isProcessOn:!0},s.newval.extData={isProcessOn:!0},s.newval.processon={category:n,fileId:i,definition:o},(a=ir.create(a)).scale(1/635,1/635);var l=e.visual.setAnchorRect(a);if(l)return s.newval=Object.assign({},s.newval,l.newval),s}}}},{key:"_modifyShapeMedia",value:function(e,t){t.setSource(e.getMedia());var a=t.modifiedData();return e.setMedia(a)}},{key:"_modifyShapeTable",value:function(e,t){}},{key:"_modifyShapeChart",value:function(e,t){}},{key:"_modifyShapeGeometry",value:function(e,t){var a=function(e){var t=e.getGeometry2D();if(!t&&e.isPlaceHolder())for(var a=e.getSlide(),r=a&&a.getPhShapes(e),n=0;n<r.length;++n){var i=r[n].shape.getGeometry2D();if(null!=i)return i.clone()}return t}(e);if(a){if(t.hasTag("paths")){var r=this.parent.transaction.getMarkDatas(),n=r&&r.insertShape;if(!n||n!=e)return;t.setSource(a,!1)}else t.setSource(a,!0);var i=t.modifiedData(),o=e.visual.setGeometry2D(i),s=o&&o.newval.geometry2D;return s.isCustomGeometry()?{newval:{newGeometry2D:{paths:s.getPaths()}}}:{newval:{newGeometry2D:s.private}}}console.error("Can not get geometry from shape !!")}},{key:"_modifyTextFont",value:function(e,t){var a=e.getTextFrame();if(a){var r=a.getTextStream();if(!r)return;var n=t.modifiedData(),i=r.begin,o=r.end;return r.initTransact(window.getTransaction()),r.fmtChpx(i,o,n),r.initTransact(null),{newval:{textFont:n}}}}},{key:"_modifyShapeActions",value:function(e,t){t.setSource(e.getActions()||{});var a=t.modifiedData();return e.setActions(a)}},{key:"_modifyTextFrameProps",value:function(e,t){var a=e.getTextFrame();if(a){t.setSource(a.getProperty());var r=t.modifiedData();return a.modifyProps(r),{newval:{textFrameProps:r}}}}},{key:"_modifyShapeInkData",value:function(e,t){var a=t.modifiedData();return t.getFlag("isInsert")?(e.private.inkData=a,e._fireChanged(),{}):(e.setInkData(a),{newval:{newInkData:new mr(a).getCommandData()}})}},{key:"_modifySimpleProperty",value:function(e,t){t.setSource({});var a=t.modifiedData();return e.visual.setSimpleProperties(a)}},{key:"_modifyWhiteboard",value:function(e,t){t.setSource(e.private.whiteboard||{});var a=t.modifiedData();if(e.setWhiteboard(a))return{newval:{whiteboard:JSON.stringify(a)}}}},{key:"_modifyShapeExtData",value:function(e,t){t.setSource(e.private.extData||{});var a=t.modifiedData();return e.setExtData(a)}},{key:"_modifyShapeEffects",value:function(e,t){return t.setSource(e.private.effects||{}),e.setEffects(t.modifiedData())}},{key:"_modifyShapeConnector",value:function(e,t){return t.setSource(e.getConnector()||{}),e.setConnector(t.modifiedData())}},{key:"_modifyShapeTags",value:function(e,t){return t.setSource(e.getTags()||[]),e.setTags(t.modifiedData())}},{key:"moveShape",value:function(e){var t=this.parent.getActiveShapes();if(t&&0!==t.length){this.check();var a=this.parent.getActiveSlide();this._moveShape(a,t,e)}else console.log("moveShape: empty shape list")}},{key:"_moveShape",value:function(e,t,a){var r=t[0].getParent().getChilds(),n=r.length;if(!(n<2)){for(var i=void 0,o=[],s={},l=0;l<t.length;++l)s[t[l]]=!1;switch(a){case T.ShapeMoveType.Front:i=n;for(var c=n-1;c>=0;--c)t.includes(r[c])&&(c!=i-1?o.push({shape:r[c],targetIndex:i--}):i--);break;case T.ShapeMoveType.Back:i=0;for(var d=0;d<n;++d)t.includes(r[d])&&(d!=i?o.push({shape:r[d],targetIndex:i++}):i++);break;case T.ShapeMoveType.Forward:for(var p=n-2;p>=0;--p)t.includes(r[p])&&(t.includes(r[p+1])&&!s[r[p+1]]||(o.push({shape:r[p],targetIndex:p+2}),s[r[p]]=!0));break;case T.ShapeMoveType.Backward:for(var u=1;u<n;++u)t.includes(r[u])&&(t.includes(r[u-1])&&!s[r[u-1]]||(o.push({shape:r[u],targetIndex:u-1}),s[r[u]]=!0))}var h=this.parent.transaction;h.beginTransact();var f=this.moveShapeNoTransact(e,o,h);f?(f.slideProps={actionType:a},h.endTopTransact("shapeMove",f)):h.rollback()}}},{key:"moveShapeNoTransact",value:function(e,t){if(0!==t.length){var a={},r=[],n=this.parent.getPresentation(),i=n.getSlideIdxById(e.getId());return t.forEach((function(e){var t=e.shape;if(null!==t){var a=e.targetIndex,i=$a(n,t);i.targetIndex=a,r[r.length]=i;var o=t.getParent().getChilds().indexOf(t);t.getParent().move(o,a-o)}})),a.slideIdx=i,a.shapes=r,a}}},{key:"_removeAllAnimationShapeGroup",value:function(e,t){var a=this.parent.getPresentation(),r=e.getTiming(),n=r&&r.getTimeLine();if(n){for(var i=[],o=[],s=0;s<t.length;s++){var l=t[s],c=$a(a,l),d=n.removeAllShapeNodes(l);if(d&&d.length>0)for(var p=0;p<d.length;p++){var u=d[p],h=Object.assign({},c,{sPath:u.nodePath,type:-1});"media"===u.type?i.push({node:u,shape:l}):o.push({name:"effectRemove",param:h})}}return{mediaNodes:i,sendparam:o}}}},{key:"_addAllMediaNodesShapeGroup",value:function(e,t){var a=this.parent.getPresentation(),r=e.getTiming(),n=[];if(t.length>0)for(var i=r.getTimeLine(),o=i.length,s=0;s<t.length;++s){var l=t[s],c=l.node.node,d=l.shape,p=$a(a,d);if(p){var u=l.node.nodePath,h=[o+s],f=Object.assign({},p,{sPath:u,dstPath:h,type:-1});i.insertSubNode(o+s,c),c.setProperty("repeateCount",1),c.setProperty("hideWhenStopped",0),c.setProperty("endAfterSlide",-1),c.setProperty("duration",0),u[0]!==h[0]&&n.push({name:"effectMove",param:f})}}return{sendparam:n}}},{key:"groupShapesNoTransact",value:function(e){var t=er(e);if("NOERROR"===t.errtype){for(var a=t.slide,r=t.shapetree,n=t.shapes,i=this.parent.getPresentation(),o={shapes:[]},s=-1,l=null,c={},d=0;d<n.length;d++){var p=$a(i,n[d]);o.shapes.push(p);var u=r.indexOf(n[d]);c[u]=n[d],u>s&&(s=u,l=n[d])}var h=Object.keys(c);h.sort((function(e,t){return e>t?1:e<t?-1:0})),n=[];for(var f=0;f<h.length;f++){var m=c[h[f]];n.push(m)}for(var v=this._removeAllAnimationShapeGroup(a,n),g=hr.createGroupShape(n),y=0;y<n.length;y++)n[y]!==l&&r.remove(n[y]);s=r.indexOf(l),r.remove(l),r.insert(s,g);var T={sendparam:o,groupshape:g};if(v){var C=this._addAllMediaNodesShapeGroup(a,v.mediaNodes);T.mediaRemoved=v.sendparam,T.mediaInserted=C&&C.sendparam}return T}console.log(t.errtype)}},{key:"ungroupShapesNoTransact",value:function(e){if(e&&e.isGroupShape()&&e.getSlide()){for(var t=e.getChilds(),a=this.parent.getPresentation(),r=e.getSlide(),n=$a(a,e),i={category:n.category,layerType:n.layerType,shapeid:n.shapeid,slideIdx:n.slideIdx,targetPath:n.shapePath,shapes:[]},o=e.parent,s=o.indexOf(e),l=0;l<t.length;l++){var c=$a(a,t[l]);i.shapes.push(c)}var d=t.slice(0);d.push(e);for(var p=this._removeAllAnimationShapeGroup(r,d),u=0;u<t.length;u++){var h=t[u],f=h.visual.getRealTransform2D();o.insert(s+u,t[u]);var m=h.visual.transform2DRelativeToParent(f);h.setTransform2D(m)}o.remove(e),o.isGroupShape()&&!o.isShapeTree&&o.visual.updatePosInfo();var v={sendparam:i};if(p){var g=this._addAllMediaNodesShapeGroup(r,p.mediaNodes);v.mediaRemoved=p.sendparam,v.mediaInserted=g&&g.sendparam}return v}}},{key:"shapeGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null==e&&(e=this.parent.getActiveShapes()),e&&!(e.length<2)){var t=window.getTransaction();t.beginBatchCommand();var a=this.groupShapesNoTransact(e);if(a){var r=a.groupshape,n=a.sendparam,i=a.mediaRemoved,o=a.mediaInserted;t.setMainCommand("shapeGroup"),t.setWaitCommands({all:!0,exclude:["slideInsert","paste"]}),t.addCommand("shapeGroup",n);var s=r.getSlide(),l=s.getComments();if(l)for(var c=this.parent.getPresentation(),d=r.visual.getAnchorRect(),p=l.childs,u=0;u<p.length;++u){var h=p[u],f=r.matchCommentShape(h);if(f){var m=Math.floor(d.x()),v=Math.floor(d.y());h.setPropertyValue("pos",{x:m,y:v});var g=$a(c,s);g.commentId=h.getCommentId(),g.comment={pos:{x:m,y:v}},t.addCommand("commentModify",g)}}if(i)for(var y=0;y<i.length;y++)t.addCommand(i[y].name,i[y].param);if(o)for(var T=0;T<o.length;T++)t.addCommand(o[T].name,o[T].param);return this.parent.selectShapes([r]),t.endBatchCommand(),r}t.rollback()}}},{key:"shapeUngroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null==e&&(e=this.parent.getActiveShapes()),e&&0!==e.length){for(var t=[],a=0;a<e.length;a++){var r=e[a].visual.getRootShape();r&&r.isGroupShape()&&!r.hasSmartArt()&&t.indexOf(r)<0&&t.push(r)}if(0!==t.length){var n=[],i=window.getTransaction();i.beginBatchCommand();for(var o=!1,s=0;s<t.length;s++){var l=t[s],c=l.getSlide();if(l&&l.isGroupShape()){l.savedTrans2D=l.visual.getTransform2D(),n=n.concat(l.getChilds()),i.beginTransact();var d=this.ungroupShapesNoTransact(l);if(!d){o=!0;break}var p=d.sendparam,u=d.mediaRemoved,h=d.mediaInserted;if(i.setMainCommand("shapeUngroup"),i.setWaitCommands({all:!0,exclude:["slideInsert","paste"]}),i.addCommand("shapeUngroup",p),this._deriveDeleteShape(c,[{shape:l}]),u)for(var f=0;f<u.length;f++)i.addCommand(u[f].name,u[f].param);if(h)for(var m=0;m<h.length;m++)i.addCommand(h[m].name,h[m].param);i.endBatchCommand()}}o?i.rollback():(this.parent.selectShapes(n),i.endBatchCommand())}}}},{key:"_setMediaAutoPlayModeInner",value:function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.parent,n=r.getAnimSelection(),i=0;i<e.length;++i){var o=e[i];if(o.isMedia()){var s=n.helper.getMediaEffect(o);if(!s){r.selectShape(o);var l=n.insertAnimBatch(pr.MediaCall,cr.MediaPlay,!0);s=l&&l[0]}if(!s)return!1;r.selectAnimation(s);var c=Ia("AnimTimer"),d=o.getMedia();if(t){n.replaceAnimBatch(pr.MediaCall,cr.MediaPlay);var p=d.duration;if(!p){var u=d.mediaId;window.mediaManager.getMediaDuration({mediaId:u},(function(e){p=Number(e.duration)}))}o.isAudio()?(p=-1!==d.nEndAfterSlide?1:p,a&&a.setUserData("mediaFlag","setAudioAutoPlay")):a&&a.setUserData("mediaFlag","setVideoAutoPlay"),c.modify("duration",p),c.modify("trigger",dr.AfterPrevious),n.modifyAnimPropertiesBatch(c)}else{o.isAudio()?a&&a.setUserData("mediaFlag","cancelAudioAutoPlay"):a&&a.setUserData("mediaFlag","cancelVideoAutoPlay");var h=d.mediaType,f=cr.MediaPlay;h!==T.MediaType.presMediaVideo&&h!==T.MediaType.presMediaAviVideo||(f=cr.MediaPause),n.replaceAnimBatch(pr.MediaCall,f),c.modify("trigger",dr.OnPageClick),n.modifyAnimPropertiesBatch(c)}}}return!0}},{key:"modifyShapeTransform2D",value:function(e){var t=this.parent.getActiveSlide();if(t)if(Array.isArray(e))e=e.map((function(e){var a=new ra({});return a.modify("transform",e.param.transform),e.tileType&&a.setFlag("tileType",e.tileType),e.slide=t,e.modifier=a,e})),this.modifyShapePropertiesBatch(e);else{var a=new ra({});a.modify("transform",e.transform),this.doModifyShapeProperties(a)}}},{key:"insertCloneShapes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.parent.getActiveSlide(),a=t.getShapeTree(),r=!1;if(e||(e=this.parent.getActiveShapes(),r=!0),e&&0!==e.length){if(r){for(var n=[],i=e[0].parent,o=i.childShapes,s=0;s<e.length;s++){var l=o.indexOf(e[s]);n[l]=e[s]}e=[];for(var c=0;c<n.length;c++)n[c]&&e.push(n[c])}for(var d=[],p=0;p<e.length;p++){var u=e[p].createFakeShape();u.private.transform2D=e[p].visual.getRealTransform2D(),a.push(u),d.push(u)}return d}}},{key:"applyShapesBeautify",value:function(e){return Va.a.applyShapesBeautify(this,e)}},{key:"insertDiagram",value:function(e,t){return Va.a.insertDiagram(this,e,t)}},{key:"insertInkNoTransact",value:function(e){var t=this.parent.getActiveSlide();if(t&&t.getSpTree()){var a=this.parent.getConnId()+"_"+Object(C.a)(),r=t.getSpTree(),n=r._createInk(e);n.drawingToken=a,n.parent=r,n.bLocalNoTransact=!0,t.drawingShapes||(t.drawingShapes=[]);var i=t.drawingShapes,o=Qa.TransactionInstances.getInstance("inkShapes");o.beginTransact(),i.push(n),o.addCommand({shapetree:r,obj:t.drawingShapes,data:n,type:"insert",index:i.length-1}),o.endTransact();var s={opType:Ka.default.otInsert,data:r,op:Wa.default.op_add,vals:[n],isDrawingShape:!0};return r._fireChanged(s),{shape:n}}return{shape:null}}},{key:"deleteInkNoTransact",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=this.parent.getActiveSlide()),t&&t.getSpTree()){var a=t.getSpTree();if(!t.drawingShapes||0===t.drawingShapes.length)return;var r=t.drawingShapes,n=function(){for(var t=0;t<r.length;++t)for(var a=0;a<e.length;++a)if(r[t].getId()===e[a].getId())return t;return-1}();if(-1===n)return;var i=Qa.TransactionInstances.getInstance("inkShapes");i.beginTransact(),r.splice(n,e.length),i.addCommand({shapetree:a,obj:r,data:e,type:"delete",index:n}),i.endTransact();var o={opType:Ka.default.otRemove,data:a,op:Wa.default.op_remove,vals:e,isDrawingShape:!0};a._fireChanged(o)}}},{key:"modifyShapePropsBatchNoTransact",value:function(e){if(e&&0!=e.length){this.check();for(var t=this,a={shapes:[]},r=[],n=0;n<e.length;n++){var i=e[n],o=i.slide,s=i.shape,l=i.modifier;if(!o||!s||!l)return;var c=this._createShapeModifierBatch([l],[s]);c&&(r=r.concat(c))}if(r.length<=0)console.warn("invalid batch command");else{e=r;if(function(){for(var r=0;r<e.length;r++)if(!t._doModifyShapeProperty(e[r],a))return!1;return!0}()){var d=e[0].modifier.flags();return null!=d.tileType&&(a.tileType=d.tileType),a.shapes.length>0&&this._deriveModifyShape(e),{batchList:e}}}}}},{key:"readonly",get:function(){return this.selectData.readonly}}]),e}(),yr=a(809),Tr=function(){function e(){o()(this,e)}return l()(e,null,[{key:"doReplaceShapeTextFrameProp",value:function(e,t){return!!e&&e.replaceProps(t)}},{key:"doModifyShapeTextFrame",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.hasTable()){var r=e.getTextFrame();return!r||r.modifyProps(t)}var n=e.getTableFrame();if(!a){for(var i=n.getChilds(),o=0;o<i.length;++o){var s=i[o].getTextFrame();if(s&&!s.modifyProps(t))return!1}return!0}for(var l=a.startRow;l<a.endRow;++l)for(var c=a.startCol;c<a.endCol;++c){var d=n.getCell(l,c),p=d.getTextFrame();if(p&&!p.modifyProps(t))return!1}return!0}}]),e}(),Cr=function(){function e(){o()(this,e)}return l()(e,null,[{key:"adjustCmdFmtForCoreVersion",value:function(e){if(e)return e.actions&&(e.actions_v1=e.actions,delete e.actions),e}},{key:"getAutoFit",value:function(e,t){if(e&&e.parent&&e.parent.getShapeType){var a=e.parent.getShapeType();if(a===T.ShapeType.NormalShape||a===T.ShapeType.TextBox)for(var r=e.parent.getId(),n=t.autoFit,i=0;i<n.length;i++){var o=n[i][r];if(o)return o}}return null}},{key:"checkIsFromStyle",value:function(e,t){var a=t&&t.outline||0,r=e.visual.getOutlineStyle(a).paraStyles,n=r&&r.prop&&r.prop.leftIndent;return!(!t.leftIndent||!n)&&(t.leftIndent.isCh===n.isCh&&t.leftIndent.value===n.value)}},{key:"dealTabs",value:function(e,t,a,r){for(var n=[],i=e.visual,o=0,s=t.length;o<s;++o){var l=t[o],c=l.getBegin(),d=l.getCcp()-1;i.adjustSpanBeforeTab(c,a.tabIndent);var p=Object.assign({},a),u=i.calTabLeftIndent(c,a.tabIndent);u&&(p.leftIndent=u);var h=i[r](c,d,p);h&&n.push(h)}return n}},{key:"calcLeftIndent",value:function(t,a,r,n){var i=t.visual.getCompleteTextPropsByGcp(r),o=i.paraProp,s=i.chpProp;if(!e.checkIsFromStyle(t,o)){var l=o&&o.leftIndent;if(!l)return console.error("paraProp incomplete !"),!1;var c=l.value,d=l.isCh;if(d){var p=s&&s.fontSize/20,u=s&&s.spacing;if(!p||u)return void console.error("chpProp incomplete !");var h=Math.max(0,p/100+20*u/100);n.value=Math.max(-80640,Math.min(h*c/100,80640))}else n.value=a.tabIndent>0?c+720:c-720;return n.isCh=d,!0}}},{key:"avaliableTextFontProps",value:function(e){var t=window.CoreUtils.createModifier("TextFont",{});for(var a in e)t.modify(a,e[a]);return t.modifiedData()}},{key:"updateTextFrameRect",value:function(e){var t=e&&e.parent;if((t&&t.private.prop.autoFit)===T.AutoFit.Advanced){var a=t.parent,r=window.APP.uil.coreView.getShapeLayout(a).getExactRect(),n=r.width,i=r.height;a.visual.setAnchorSize({width:n,height:i})}}},{key:"clearProps",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=e.getItems(t,a);if(n&&!(n.length<=0))for(var i=0;i<n.length;++i){var o=n[i],s=o.getBegin(),l=o.getProp(),c=l?l.private:{},d=[];for(var p in c)r&&r(p)||d.push(p);e.clearProps(s,d)}}}]),e}(),_r=window.CoreExports.utils.deepClone,br=window.CoreExports.helper,Sr=br.getEditObjectPath,kr=br.fillEditObjectPath,Pr=window.langCode,wr=function(){function e(t,a){o()(this,e),this.parent=t,this.selectData=a}return l()(e,[{key:"_checkTextFrameForEdit",value:function(e){if(e){e.getTextStream();for(var t=e.activeSlide,a=!1,r=e.textStream;r;){if(r.isSlideType&&r===t){a=!0;break}r=r.parent}return!!a||void console.error("Edit in text stream failed, text stream has deleted!")}}},{key:"_checkAndEndPreviewTransact",value:function(e,t){if(e&&t){e.getTextStream();var a=e.textStream;if(!t.isInBatchCommand()){var r=Sr(this.coreSlt.presentation,a);t.lastCmdIsSameTextFrameWith(r)||t.endTransact()}}}},{key:"insertText",value:function(e){if(null!==e&&0!==e.length){var t=this.parent;if(t.state!==T.SelectType.select_text)throw new Error("wrong select state:"+t._getStateString());var a={data:t._data,fontProp:t._fontProp,currentFontStyle:t._currentFontStyle,currentState:!0};delete t._fontProp;var r=t.transaction;if(this._checkTextFrameForEdit(a.data),this._checkAndEndPreviewTransact(a.data,r),r.beginTransact(),this._insertTextOnce(a,e))1===a.data.textStream.getCharCount()?r.endTransact():r.delayEndTransact(["txtStrmInsert","txtStrmDelete"],800);else r.endTransact()}}},{key:"deleteText",value:function(e){var t=this.parent;if(t.state!==T.SelectType.select_text)throw new Error("wrong select state:"+t._getStateString());var a=t._data.getTextStream();if(t._isValidTextStream(a)){var r=a.getCharCount()-1;if(t._data.begin>r&&(t._data.begin=r),t._data.end>r&&(t._data.end=r),t._data.end<=t._data.begin)return!1;var n=t._data.begin,i=a.getChpTbl().getItemByCP(n);this._checkTextFrameForEdit(this.selectData),this._checkAndEndPreviewTransact(this.selectData,t.transaction),t.transaction.beginTransact(),t.transaction.addServerOnlyAffects(["effectAdd","effectRemove","effectMove","modifyEffectProps"]);var o=t._data.end-t._data.begin,s=a.getText(t._data.begin,o);a.deleteText(t._data.begin,o,e),t._data.end=t._data.begin,t.transaction.addCommand("txtStrmDelete",kr(t.presentation,a,{gcp:n,text:s.join(""),optype:e}));var l=a.getParaTbl().getItemByCP(t._data.begin);return t._data.begin===l.getBegin()?a._fontProp||(a._fontProp=Object.assign({},i.getProp().private)):(delete a._fontProp,delete t._fontProp),1===a.getCharCount()?t.transaction.endTransact():t.transaction.delayEndTransact(["txtStrmInsert","txtStrmDelete"]),!0}}},{key:"backspace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=this.parent;if(t.state!==T.SelectType.select_text)throw new Error("wrong select state:"+t._getStateString());var a=t._data.begin,r=t._data.end,n=t._data.getTextStream();if(t._isValidTextStream(n)){if(a===r){var i=n.getParaTbl().getItemByCP(a);if(i&&i.getBegin()===a){var o=t._data.getTextFrame(),s=o.visual.getCompleteTextPropsByGcp(a),l=s.paraProp.listType;if(l&&l>0)return void this.fmtInner({listType:0},!1,"fmtPapx","txtStrmFmtPapxV2")}}if(t._data.begin<1&&t._data.begin>=t._data.end)return!1;t._data.end<=t._data.begin&&(a=t._data.begin-1,r=t._data.begin);var c=n.getCharCount()-1;if(a>c&&(a=c),r>c&&(r=c),r<=a)return!1;var d=r-a;if(-1!==e){if(0===e)return;if(!(r-e>=0))return void console.error("Param of len error !!");a=r-(d=e)}var p=n.getChpTbl().getItemByCP(a);this._checkTextFrameForEdit(this.selectData),this._checkAndEndPreviewTransact(this.selectData,t.transaction),t.transaction.beginTransact(),t.transaction.addServerOnlyAffects(["effectAdd","effectRemove","effectMove","modifyEffectProps"]);var u=n.getText(a,d);n.deleteText(a,d),t._data.begin=a,t._data.end=a,t.transaction.addCommand("txtStrmDelete",kr(t.presentation,n,{gcp:a,text:u.join(""),optype:"backspace"}));var h=n.getParaTbl().getItemByCP(t._data.begin);return t._data.begin===h.getBegin()?n._fontProp||(n._fontProp=Object.assign({},p.getProp().private)):(delete n._fontProp,delete t._fontProp),1===n.getCharCount()?t.transaction.endTransact():t.transaction.delayEndTransact(["txtStrmInsert","txtStrmDelete"]),!0}}},{key:"deleteChar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=this.parent;if(t.state!==T.SelectType.select_text)throw new Error("wrong select state:"+t._getStateString());if(this._checkTextFrameForEdit(this.selectData),this._checkAndEndPreviewTransact(this.selectData,t.transaction),-1!==e){if(0===e)return;var a=t._data.getTextStream();if(t._data.begin+e>a.end-1)return void console.error("Param of len error !!")}t.transaction.beginBatchCommand(),t.beginBatchSelect(),t._data.end<=t._data.begin&&t.selectText(t._data.begin,t._data.begin+1),-1!==e&&t.selectText(t._data.begin,t._data.begin+e);var r=this.deleteText("deleteChar");return t.endBatchSelect(),t.transaction.endBatchCommand(),r}},{key:"replaceText",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e&&0!==e.length&&a&&0!==a.length&&!(t.length>1e4)){var n=this.parent;if(null==r&&(r=n._data.textStream),r){for(var i=Sr(n.getPresentation(),r),o=r.getCharCount()-1,s=0;s<a.length;++s){var l=a[s];l.begin>o&&(l.begin=o),l.end>o&&(l.end=o);var c=r.getChpTbl().getItemByCP(l.begin),d=c.getProp().private;d&&(l.props=d)}n.transaction.beginTransact(),r.initTransact(n.transaction);var p=r.replaceText(e,t,_r(a));if(p){for(var u=t.length-e.length,h=0;h<a.length;++h){var f=a[h];f.props=Cr.avaliableTextFontProps(f.props),n.transaction.addCommand("txtStrmDelete",Object.assign({text:e,gcp:f.begin+u*h},i));var m={text:t,gcp:f.begin+u*h,prop:Cr.adjustCmdFmtForCoreVersion(f.props)};n.transaction.addCommand("txtStrmInsert",Object.assign(m,i))}return n.transaction.endTransact(),!0}return n.transaction.rollback(),!1}console.error("Empty textstream. call: replaceText !!")}}},{key:"insertPara",value:function(e){var t=this.parent,a=t._data.getTextStream();t._isValidTextStream(a)&&(a.isTextStyleTitle()||e&&e.bShiftPressed?this.insertText(yr.d.EndLine):this.insertText(yr.d.EndPara))}},{key:"insertTextBoxWithContent",value:function(e,t){if("object"===(void 0===t?"undefined":Rt()(t))){var a=this.parent;if(!a.getActiveSlide())throw new Error("wrong select state:"+a._getStateString());var r=a.transaction;r.beginBatchCommand();var n=a.getShapeSelection().insertTextBox({orientation:"horizontal",rect:t,bCopyDefProps:!0,bDefCreate:!1});if(n){var i={data:a._data,fontProp:a._fontProp,currentFontStyle:a._currentFontStyle,currentState:!0},o=n.shape.getTextFrame();o.private.prop.anchorType=0,this._insertTextOnce(i,e)?(o.getTextStream().fmtPapx(0,e.length+1,{lineSpacing:{rule:"auto",value:120}}),r.endBatchCommand()):r.rollback()}}else console.error("Invalid param rect")}},{key:"tabPress",value:function(e){var t=this.parent;if(t.state!==T.SelectType.select_text)throw new Error("wrong select state:"+t._getStateString());var a=t._data.begin,r=t._data.end,n=t._data.getTextStream();if(n){var i=n.getParaTbl().getItemByCP(a);if(i){var o=e.value,s=o.shift,l=o.listType,c=i.getBegin();c+i.getCcp()<r||c>a||c===a&&(l>0||a!==r)?this.fmtInner({tabIndent:s?-1:1},!1,"fmtPapx","txtStrmFmtPapxV2"):this.insertText(yr.d.Tab)}}}},{key:"fmtInner",value:function(e,t,a,r,n,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=this.parent,l=s._data,c=l.begin,d=l.end;null!=n&&(c=n),null!=i&&(d=i);var p=s.category();o||(o=this._getAllTextStreams());var u=!1;if(1===o.length){var h=o[0].parent,f=h&&h.visual.getIndividualVisual(),m="slideLayouts"===p||"slideMasters"===p;u=!!(f&&f.coredata.isPlaceHolder()&&m)}s.state!==T.SelectType.select_text||c!==d||u||("fmtChpx"===a&&o[0]&&(o[0]._fontProp?(Object.assign(o[0]._fontProp,e),delete s._fontProp):(s._fontProp||(s._fontProp={}),Object.assign(s._fontProp,e))),s.fireDirect(s.EventTypes.CHANGE,{}));var v="fmtChpx"===a&&e.hasOwnProperty("autoFit"),g="fmtPapx"===a&&e.tabIndent;if(0===o.length)throw new Error("wrong select state:"+s._getStateString());if(o.length>1&&(n=null,i=null,g))throw new Error("wrong select state:"+s._getStateString());var y=[];if(s.state===T.SelectType.select_text){if(c<d){var C=o[0].getAllText();C[d]!==yr.d.EndPara||e.actions||(d+=1)}y.push({stream:o[0],begin:c,end:d})}else for(var _=0;_<o.length;_++){var b=o[_];b&&(n||(c=b.begin),i||(d=b.end),y.push({stream:b,begin:c,end:d}))}if(g&&1===y.length){var S=y[0],k=S.stream,P=S.begin,w=S.end;if(!k.canTabIndent(e.tabIndent<0,P,w-P))return}for(var x=[],I=0;I<y.length;I++){var R=y[I],O=R.begin,A=R.end-R.begin;if(0===A)if(u){var B=R.stream.getParaTbl().getItemByCP(O);O=B.getBegin(),A=B.getCcp()}else if("fmtChpx"===a)continue;R.gcp=O,R.ccp=A,x.push(R)}if(0!==x.length){s.transaction.beginTransact();var D=s.getActiveSlide(),F=s.getPresentation(),M=F.getSlideIdxById(D.getId()),j={slideIdx:M,shapes:[]},E=_r(e);v&&delete e.autoFit;for(var N=function(t){var r=x[t],n=r.stream,i=r.gcp,o=r.ccp,l=n.parent,c=_r(E);if(delete c.autoFit,v){var d=Cr.getAutoFit(l,E);if(null!=d){var p=l.private.prop.autoFit;l.private.prop.autoFit=d,c.autoFit=d,c.oldval={autoFit:p}}}n.initTransact(s.transaction);var u=Sr(s.presentation,n);if(e.tabIndent){var h=n.getParaTbl().getItems(i,o),f=Cr.dealTabs(l,h,e,a,j);f.length>0&&f.forEach((function(e){for(var t=0;t<e.length;t++){var r=_r(u),n=e[t],i="fmtChpx"===a?Cr.avaliableTextFontProps(n.fmt):n.fmt;r.props={gcp:n.gcp,ccp:n.ccp,fmt:i},j.shapes.push(r)}}))}else{var m=l.visual[a](i,o,e);if(m)for(var g=0;g<m.length;g++){var y=_r(u),T=m[g],C="fmtChpx"===a?Cr.avaliableTextFontProps(T.fmt):T.fmt;y.props={gcp:T.gcp,ccp:T.ccp,fmt:Cr.adjustCmdFmtForCoreVersion(C)},j.shapes.push(y)}}},L=0;L<x.length;L++)N(L);s.transaction.endTopTransact(r,j)}}},{key:"cmdFmtChpx",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=this.parent,i=r;if(r?(i=r.getTextStream())&&i.initTransact(n._data.transaction):(n._data.getTextFrame(),i=n._data.getTextStream()),null==i)throw new Error("wrong select state:"+n._getStateString());this._cmdFmtChpxInner(i,e,t,a)}},{key:"cmdFmtChpxCell",value:function(e,t,a,r){for(var n=this._data.tableCells,i=null,o=0;o<n.length;o++)if(n[o].getIdx()===t){i=n[o];break}if(null==i)throw new Error("wrong select state:"+this._getStateString());var s=i.getTextFrame();s&&this._cmdFmtChpxInner(s.getTextStream(),e,a,r)}},{key:"cmdFmtPapx",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=this.parent,i=r;if(r?i=r.getTextStream():(n._data.getTextFrame(),i=n._data.getTextStream()),null==i)throw new Error("wrong select state:"+n._getStateString());return this.fmtInner(e,!1,"fmtPapx","txtStrmFmtPapxV2",t,t+a,[i])}},{key:"_cmdFmtChpxInner",value:function(e,t,a,r){if(e)try{var n=this.parent,i=t.isGrowUp;delete t.isGrowUp;var o=n.getActiveSlide(),s=n.getPresentation(),l={slideIdx:s.getSlideIdxById(o.getId()),shapes:[]};a<e.begin&&(a=e.begin),a+r>e.end&&(r=e.getCharCount()),e.fmtChpx(a,r,t);var c=Sr(s,e),d=Cr.avaliableTextFontProps(t);c.props={gcp:a,ccp:r,fmt:Cr.adjustCmdFmtForCoreVersion(d)},Object.isEmpty(i)||(c.props.isGrowUp=!!i),l.shapes.push(c),n.transaction.addCommand("txtStrmFmtChpxV2",l)}catch(e){console.error(e)}}},{key:"_insertTextOnce",value:function(e,t){if(!(null===t||t.length<=0||"string"!=typeof t))if(t.length>1e4)console.error("Exceeding the 10000 of characters");else try{var a=this.parent,r=e.data,n=t.length;e.currentState&&e.data.getTextStream();var i=r.textStream;if(!a._isValidTextStream(i))return void console.error("Insert text failed, text stream has deleted!");var o=i.getCharCount()-1;r.begin>o&&(r.begin=o),r.end>o&&(r.end=o);var s=r.begin,l=r.end,c=e.fontProp||i._fontProp,d=null;if(t===yr.d.EndPara||l>s)if(c)d=c;else{var p=s,u=!1;t===yr.d.EndPara&&l===s&&s>0&&e.currentFontStyle&&(u=!0);var h={};if(e.currentState){var f=a._data.getTextFrame().visual.getSelfTextPropsByGcp(p);f&&f.chpProp&&(h=f.chpProp)}else h=e.styleProp;h&&(d=Object.assign({},u?e.currentFontStyle:{},h),t!==yr.d.EndPara&&(c=d))}a.transaction.addServerOnlyAffects(["effectAdd","effectRemove","effectMove","modifyEffectProps"]),i.initTransact(a.transaction),r.end>r.begin&&(this.cmdDeleteText(e),r.end=r.begin);for(var m=[],v=void 0,g=0,y=t.length;g<y;++g){var T=t[g],C=Pr.getLangCode(T);v&&(v.lc===C||void 0===C&&(Pr.isPunctuation(T)||Pr.isSpace(T)))?++v.ccp:(v&&m.push(v),(v={}).begin=g,v.ccp=1,v.lc=C)}v&&m.push(v);for(var _=Sr(a.getPresentation(),i),b=r.begin,S=0,k=m.length;S<k;++S){var P=m[S],w=P.lc;0===S&&c&&(w=Object.assign({},c,w));var x=t.slice(P.begin,P.begin+P.ccp);if(x.length>0){i.insertText(x,b,_r(w));var I=w&&Cr.avaliableTextFontProps(w);a.transaction.addCommand("txtStrmInsert",Object.assign({text:x,gcp:b,prop:Cr.adjustCmdFmtForCoreVersion(I)},_)),b+=P.ccp}}return r.begin+=n,r.end=r.begin,c?i._fontProp=d||c:d&&(i._fontProp=d),!0}catch(e){console.error(e)}}},{key:"cmdDeleteText",value:function(e){try{var t=this.parent,a=e.data,r=a.begin,n=a.end,i=a.textStream,o=n-r,s=i.getText(r,o);i.deleteText(r,o);var l=Sr(t.getPresentation(),i);t.transaction.addServerOnlyAffects(["effectAdd","effectRemove","effectMove","modifyEffectProps"]),t.transaction.addCommand("txtStrmDelete",Object.assign({text:s.join(""),gcp:r},l))}catch(e){console.error(e)}}},{key:"modifyTextFrameProperty",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.coreSlt.presentation,r=this._collectTexframeShapes((function(e){return{shape:e,path:Sr(a,e)}}));if(0!==r.length){var n=!1,i={shapes:[]},o=this.coreSlt,s=this.coreSlt.transaction;t&&s.beginTransact();for(var l=0;l<r.length;l++){var c=null,d=null,p=r[l],u=p.shape,h=p.path,f=_r(e);switch(o.state){case T.SelectType.select_cell:case T.SelectType.select_multi_cell:d=o.getActiveTableRange(),(c=Tr.doModifyShapeTextFrame(u,f,d))&&i.shapes.push(Object.assign({},h,{cellRange:d},{props:f}));break;case T.SelectType.select_text:var m=o.getActiveTableCells();m&&m.length>0&&(d=o.getActiveTableRange()),(c=Tr.doModifyShapeTextFrame(u,f,d))&&i.shapes.push(Object.assign({},h,{cellRange:d},{props:f}));break;case T.SelectType.select_shape:case T.SelectType.select_multi_shape:var v={startRow:-1,endRow:-1,startCol:-1,endCol:-1};if(u.hasTable()){var g=u.getTableFrame();v.startRow=0,v.startCol=0,v.endRow=g.getRowCount(),v.endCol=g.getColumnCount()}(c=Tr.doModifyShapeTextFrame(u,f))&&i.shapes.push(Object.assign({},h,{cellRange:v},{props:f}))}c&&(n=!0)}t&&(n?s.endTopTransact("modifyTextFrameProps",i):s.rollback())}}},{key:"_collectTexframeShapes",value:function(e){var t=[],a=this.coreSlt;switch(a.state){case T.SelectType.select_text:case T.SelectType.select_shape:case T.SelectType.select_multi_shape:for(var r=a.getActiveShapes(),n=[],i=0;i<r.length;i++){var o=r[i];if(o.isGroupShape()){var s=o.getChildShapesRecurse();n=n.concat(s)}else n.push(o)}t=t.concat(n);break;case T.SelectType.select_cell:case T.SelectType.select_multi_cell:var l=a.getActiveShapes();t=t.concat(l)}var c=[];return t.forEach((function(t){if(t.getTextFrame()||t.hasTable()){var a=t&&e(t);a&&c.push(a)}})),c}},{key:"_getAllText",value:function(e){var t=this.parent,a=[],r=t.state,n=function(e){var t=[];return e.forEach((function(e){return t.push(e.getTextFrame())})),t};if(r===T.SelectType.select_text)a.push(t._data.getTextFrame());else if(r===T.SelectType.select_shape||r===T.SelectType.select_multi_shape||r===T.SelectType.select_table){for(var i=t.getActiveShapes(),o=[],s=0;s<i.length;s++){var l=i[s];if(l.isGroupShape()){var c=l.getChildShapesRecurse();o=o.concat(c)}else o.push(l)}o.forEach((function(e){var t=e.getTextFrame();if(t)a.push(t);else if(e.getTableFrame){var r=e.getTableFrame();r&&(a=a.concat(n(r.getChilds())))}}))}else r!==T.SelectType.select_cell&&r!==T.SelectType.select_multi_cell||(a=n(t.getActiveTableCells()));var d=[];return a.forEach((function(t){var a=t&&e(t);a&&d.push(a)})),d}},{key:"_getAllTextStreams",value:function(){return this._getAllText((function(e){return e&&e.getTextStream()}))}},{key:"updateRemark",value:function(e){var t=null,a=null,r=this.parent,n=r.saveCurrentState(),i=n.getSavedState();r.selectRemark();var o=r.getActiveSlide(),s=r.getActiveShapes();if(s&&1===s.length){var l=s[0],c=r.transaction;c.beginBatchCommand();var d=l.ensureTextFrame(),p=d.ensureTextStream();if(r._data.textFrame||(r._data.textFrame=d),r._data.textStream||(r._data.textStream=p,r.selectText(0,0)),p){var u=p.getAllText();if(e.split("").toString()!==u){c.setCooperHandler("modifyRemarks"),1===u.length?(t="start",c.setUserData("markFlag","addMark")):t="edit";var h=p.getCharCount()-1;""!==e&&e?(r.selectText(0,h),r.insertText(e)):(r.selectText(0,h),r.deleteText(0,h))}return c.endBatchCommand(),r.clearShapeSelect(),null!=i.shapes&&(a=i.shapes[0]),a&&a.layerType===y.WppLayerType.notePage&&o.getId()===i.slideId&&s[0]===a?n.discard():n.restore(),{state:t}}n.discard()}}},{key:"coreSlt",get:function(){return this.parent}}]),e}(),xr=window.CoreExports.table.TableHelper,Ir=window.CoreExports.utils.deepClone,Rr=window.CoreExports.helper.getEditObjectPath;function Or(e){if(!e)return!0;var t=e.fill;return!(t&&(!t.type||t.type===T.FillType.FillTypeNone))}function Ar(e){switch(e.name()){case"Fill":return y.actionType.Modify_Fill;case"Outline":return y.actionType.Modify_Outline;case"Picture":return y.actionType.Modify_Picture;case"TblCellBorder":return y.actionType.Modify_Border}}var Br=function(){function e(t,a){o()(this,e),this.parent=t,this.selectData=a,this.tableSelect=t.getTableSelection(),this._modifyCellCb={Fill:this._modifyCellFill,Outline:this._modifyCellOutline,Picture:this._modifyCellPicture,TblStyle:this._modifyTblStyle,TblCellBorder:this._modifyCellBorder},this._modifyTblCb={Fill:this._modifyTblFill,Outline:this._modifyTblOutline,TblCellBorder:this._modifyTblBorder}}return l()(e,[{key:"getTableRange",value:function(){return this.selectData.tableRange.range()}},{key:"createTblCommandInner",value:function(e,t,a,r){if(t){var n=t.parent;if(n){if(n.getSlide()){var i=this.parent.getPresentation(),o=Rr(i,n);a&&(o.range=a),o.optType=e;var s={};switch(e){case T.TableOPT.InsertRow:s.bAbove=r.bAbove;break;case T.TableOPT.InsertCol:s.bLeft=r.bLeft;break;case T.TableOPT.DeletRows:case T.TableOPT.DeleteCols:break;case T.TableOPT.MergeCells:case T.TableOPT.UnMergeCells:break;case T.TableOPT.DistributeRows:s.avgHeight=r.avgHeight,s.maxHeight=r.maxHeight;break;case T.TableOPT.DistributeCols:case T.TableOPT.ModCells:case T.TableOPT.ModTable:break;case T.TableOPT.SetRowHeight:case T.TableOPT.SetColWidth:s.val=r.val;break;case T.TableOPT.SetHoriPos:case T.TableOPT.SetVertPos:s.pos=r.pos}return o.extraDatas=s,o}console.error("Invalid slide, opt=",e)}else console.error("Invalid table, opt=",e)}else console.error("Invalid table, opt=",e)}},{key:"_modifyTblFill",value:function(e,t){var a={startRow:0,endRow:e.getRowCount(),startCol:0,endCol:e.getColumnCount()};return this._modifyCellFill(e,a,t)}},{key:"_modifyTblOutline",value:function(e,t){var a={startRow:0,endRow:e.getRowCount(),startCol:0,endCol:e.getColumnCount()};return this._modifyCellOutline(e,a,t)}},{key:"_modifyTblBorder",value:function(e,t){var a={startRow:0,endRow:e.getRowCount(),startCol:0,endCol:e.getColumnCount()};return this._modifyCellBorder(e,a,t)}},{key:"_modifyCellFill",value:function(e,t,a){for(var r=null,n=t.startRow;n<t.endRow;++n)for(var i=function(t){var i=e.getCell(n,t);if(!(r=a.applyOperate(i,(function(e,t){if("fill"===e){if(null===t)return i.visual.setFill({type:0});a.setSource(i.visual.getFill());var r=a.modifiedData();return i.visual.setFill(r)}if("opacity"!==e){a.setSource(i.visual.getFill());var n=a.modifiedData();return i.visual.setFill(n)}var o=i.visual.setOpacity(t);if(o){var s=o.newval.fill||{};return s.opacity=t,{newval:{fill:s}}}}))))return{v:!1}},o=t.startCol;o<t.endCol;++o){var s=i(o);if("object"===(void 0===s?"undefined":Rt()(s)))return s.v}return r}},{key:"_modifyCellOutline",value:function(e,t,a){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=e.getRowCount(),i=e.getColumnCount(),o=null,s=function(e,t,a,n){return!(!r||Or(a))||t.apply(e,(function(){return a}),(function(a){var r=e.visual.setOutLine(a,n);return o||(o=t.modifiedData()),r}))},l=this._collectCells(e,t),c=0;c<l.length;++c){for(var d=l[c],p=e.visual.getCellGridData(d.row,d.col),u=p.startRow;u<p.endRow;++u)for(var h=p.startCol;h<p.endCol;++h){if(u===t.startRow&&t.startRow>0){var f=e.visual.getCellGridData(t.startRow-1,h);if(f.startCol===h){var m=e.getCell(f.startRow,f.startCol),v=m.visual.getBorder();s(m,a,v.bottom,T.TblBorderType.Bottom)}else{var g=e.getCell(f.endRow-1,h),y=g.visual.getBorder();s(g,a,y.bottom,T.TblBorderType.Bottom)}}if(u===t.endRow-1&&t.endRow<n){var C=e.visual.getCellGridData(t.endRow,h);if(C.startCol===h){var _=e.getCell(C.startRow,C.startCol),b=_.visual.getBorder();s(_,a,b.top,T.TblBorderType.Top)}else{var S=e.getCell(C.startRow,h),k=S.visual.getBorder();s(S,a,k.top,T.TblBorderType.Top)}var P=e.getCell(u,h),w=P.visual.getBorder();s(P,a,w.bottom,T.TblBorderType.Bottom)}if(h===t.startCol&&t.startCol>0){var x=e.visual.getCellGridData(u,t.startCol-1);if(x.startRow===u){var I=e.getCell(x.startRow,x.startCol),R=I.visual.getBorder();s(I,a,R.right,T.TblBorderType.Right)}else{var O=e.getCell(u,p.endCol-1),A=O.visual.getBorder();s(O,a,A.right,T.TblBorderType.Right)}}if(h===t.endCol-1&&t.endCol<i){var B=e.visual.getCellGridData(u,t.endCol);if(B.startRow===u){var D=e.getCell(B.startRow,B.startCol),F=D.visual.getBorder();s(D,a,F.left,T.TblBorderType.Left)}else{var M=e.getCell(u,B.startCol),j=M.visual.getBorder();s(M,a,j.left,T.TblBorderType.Left)}var E=e.getCell(u,h),N=E.visual.getBorder();s(E,a,N.right,T.TblBorderType.Right)}}var L=e.getCell(p.startRow,p.startCol),V=L.visual.getBorder();s(L,a,V.left,T.TblBorderType.Left),s(L,a,V.right,T.TblBorderType.Right),s(L,a,V.top,T.TblBorderType.Top),s(L,a,V.bottom,T.TblBorderType.Bottom)}if(o){var W=a.modifiers()[0],G={outline:o,tag:W.tag};console.log("---------modify data:",G);var H={outlineData:G};return{newval:H}}return!1}},{key:"_modifyCellPicture",value:function(e,t,a){var r=this.parent.getActiveTableFrame(),n=a.getFlag("uploadId"),i=!!a.getFlag("isStretched"),o=r.getCell(e,t),s=a.apply(o,(function(){var e=o.private.blip;return e?e.blipAtom||(e.blipAtom={imageId:""}):e={blip:{blipAtom:{imageId:""}},isStretched:i},e}),(function(e){if(e&&e.blipAtom&&""!==e.blipAtom.imageId)return o.visual.setPicture(e.blipAtom)}));return s&&n&&(s.newval.newPicture=n),s}},{key:"_modifyTblStyle",value:function(e){return this.parent.getActiveTableFrame().visual.updateStyle(e)}},{key:"_modifyAllBorder",value:function(e,t,a){for(var r=a.modifiedData(),n=e.getRowCount(),i=e.getColumnCount(),o=this._collectCells(e,t),s=0;s<o.length;++s){for(var l=o[s],c=e.visual.getCellGridData(l.row,l.col),d=c.startRow;d<c.endRow;++d)for(var p=c.startCol;p<c.endCol;++p){if(d===t.startRow&&t.startRow>0){var u=e.visual.getCellGridData(t.startRow-1,p);if(u.startCol===p)e.getCell(u.startRow,u.startCol).visual.setBorderLineStyle(T.TblBorderType.Bottom,r);else e.getCell(u.endRow-1,p).visual.setBorderLineStyle(T.TblBorderType.Bottom,r)}if(d===t.endRow-1&&t.endRow<n){var h=e.visual.getCellGridData(t.endRow,p);if(h.startCol===p)e.getCell(h.startRow,h.startCol).visual.setBorderLineStyle(T.TblBorderType.Top,r);else e.getCell(h.startRow,p).visual.setBorderLineStyle(T.TblBorderType.Top,r);e.getCell(d,p).visual.setBorderLineStyle(T.TblBorderType.Bottom,r)}if(p===t.startCol&&t.startCol>0){var f=e.visual.getCellGridData(d,t.startCol-1);if(f.startRow===d)e.getCell(f.startRow,f.startCol).visual.setBorderLineStyle(T.TblBorderType.Right,r);else e.getCell(d,f.endCol-1).visual.setBorderLineStyle(T.TblBorderType.Right,r)}if(p===t.endCol-1&&t.endCol<i){var m=e.visual.getCellGridData(d,t.endCol);if(m.startRow===d)e.getCell(m.startRow,m.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,r);else e.getCell(d,m.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,r);e.getCell(d,p).visual.setBorderLineStyle(T.TblBorderType.Right,r)}}var v=e.getCell(c.startRow,c.startCol);v.visual.setBorderLineStyle(T.TblBorderType.Left,r),v.visual.setBorderLineStyle(T.TblBorderType.Right,r),v.visual.setBorderLineStyle(T.TblBorderType.Top,r),v.visual.setBorderLineStyle(T.TblBorderType.Bottom,r)}return!0}},{key:"_collectCells",value:function(e,t){for(var a=[],r=t.startRow;r<t.endRow;r++)for(var n=t.startCol;n<t.endCol;n++){if(e.getCell(r,n).getTextFrame()){var i={row:r,col:n};a.push(i)}}return a}},{key:"_collectCellsBy",value:function(e,t,a){for(var r=[],n=t.startRow;n<t.endRow;++n)if(a===T.TblBorderType.Left){var i=e.visual.getCellGridData(n,t.startCol);r.push(i),n=i.endRow-1}else if(a===T.TblBorderType.Right){var o=e.visual.getCellGridData(n,t.endCol-1);r.push(o),n=o.endRow-1}if(r.length>0)return r;for(var s=t.startCol;s<t.endCol;++s)if(a===T.TblBorderType.Top){var l=e.visual.getCellGridData(t.startRow,s);r.push(l),s=l.endCol-1}else if(a===T.TblBorderType.Bottom){var c=e.visual.getCellGridData(t.endRow-1,s);r.push(c),s=c.endCol-1}return r}},{key:"_modifyMiddleBorder",value:function(e,t,a){var r=this._collectCells(e,t);return this._doModifyInsideHBorder(e,t,r,a),this._doModifyInsideVBorder(e,t,r,a),!0}},{key:"_doModLeftBorder",value:function(e,t,a){for(var r=a.modifiedData(),n=this._collectCellsBy(e,t,T.TblBorderType.Left),i=0;i<n.length;++i){for(var o=n[i],s=o.startRow;s<o.endRow;++s)if(t.startCol>0){var l=e.visual.getCellGridData(s,t.startCol-1);if(l.startRow===s)e.getCell(l.startRow,l.startCol).visual.setBorderLineStyle(T.TblBorderType.Right,r);else e.getCell(s,l.endCol-1).visual.setBorderLineStyle(T.TblBorderType.Right,r)}e.getCell(o.startRow,o.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,r)}}},{key:"_modifyLeftBorder",value:function(e,t,a){return this._doModLeftBorder(e,t,a),!0}},{key:"_doModTopBorder",value:function(e,t,a){for(var r=a.modifiedData(),n=this._collectCellsBy(e,t,T.TblBorderType.Top),i=0;i<n.length;++i){for(var o=n[i],s=o.startCol;s<o.endCol;++s)if(t.startRow>0){var l=e.visual.getCellGridData(o.startRow-1,s);if(l.startCol===s)e.getCell(l.startRow,l.startCol).visual.setBorderLineStyle(T.TblBorderType.Bottom,r);else e.getCell(l.endRow-1,s).visual.setBorderLineStyle(T.TblBorderType.Bottom,r)}e.getCell(o.startRow,o.startCol).visual.setBorderLineStyle(T.TblBorderType.Top,r)}}},{key:"_modifyTopBorder",value:function(e,t,a){return this._doModTopBorder(e,t,a),!0}},{key:"_doModRightBorder",value:function(e,t,a){for(var r=a.modifiedData(),n=e.getColumnCount(),i=this._collectCellsBy(e,t,T.TblBorderType.Right),o=0;o<i.length;++o){for(var s=i[o],l=s.startRow;l<s.endRow;++l)if(t.endCol<n){var c=e.visual.getCellGridData(l,t.endCol);if(c.startRow===l)e.getCell(c.startRow,c.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,r);else e.getCell(l,c.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,r)}e.getCell(s.startRow,s.startCol).visual.setBorderLineStyle(T.TblBorderType.Right,r)}}},{key:"_modifyRightBorder",value:function(e,t,a){return this._doModRightBorder(e,t,a),!0}},{key:"_doModBottomBorder",value:function(e,t,a){for(var r=a.modifiedData(),n=e.getRowCount(),i=this._collectCellsBy(e,t,T.TblBorderType.Bottom),o=0;o<i.length;++o){for(var s=i[o],l=s.startCol;l<s.endCol;++l)if(t.endRow<n){var c=e.visual.getCellGridData(t.endRow,l);if(c.startCol===l)e.getCell(c.startRow,c.startCol).visual.setBorderLineStyle(T.TblBorderType.Top,r);else e.getCell(c.startRow,l).visual.setBorderLineStyle(T.TblBorderType.Top,r)}e.getCell(s.startRow,s.startCol).visual.setBorderLineStyle(T.TblBorderType.Bottom,r)}}},{key:"_modifyBottomBorder",value:function(e,t,a){return this._doModBottomBorder(e,t,a),!0}},{key:"_doModifyInsideVBorder",value:function(e,t,a,r){for(var n=r.modifiedData(),i=0;i<a.length;++i){var o=a[i],s=e.visual.getCellGridData(o.row,o.col);if(s.startCol>t.startCol&&s.endCol<t.endCol)for(var l=s.startRow;l<s.endRow;++l){var c=e.visual.getCellGridData(l,s.startCol-1);if(c.startRow===l)e.getCell(c.startRow,c.startCol).visual.setBorderLineStyle(T.TblBorderType.Right,n);else e.getCell(l,c.endCol-1).visual.setBorderLineStyle(T.TblBorderType.Right,n);var d=e.visual.getCellGridData(l,s.endCol);if(d.startRow===l)e.getCell(d.startRow,d.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,n);else e.getCell(l,d.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,n)}var p=!(s.startCol===t.startCol),u=!(s.endCol===t.endCol),h=e.getCell(s.startRow,s.startCol);s.startCol===t.startCol&&u?h.visual.setBorderLineStyle(T.TblBorderType.Right,n):s.endCol===t.endCol&&p?h.visual.setBorderLineStyle(T.TblBorderType.Left,n):p&&u&&(h.visual.setBorderLineStyle(T.TblBorderType.Left,n),h.visual.setBorderLineStyle(T.TblBorderType.Right,n))}}},{key:"_modifyInsideVBorder",value:function(e,t,a){var r=this._collectCells(e,t);return this._doModifyInsideVBorder(e,t,r,a),!0}},{key:"_doModifyInsideHBorder",value:function(e,t,a,r){for(var n=r.modifiedData(),i=0;i<a.length;++i){var o=a[i],s=e.visual.getCellGridData(o.row,o.col);if(s.startRow>t.startRow&&s.endRow<t.endRow)for(var l=s.startCol;l<s.endCol;++l){var c=e.visual.getCellGridData(s.startRow-1,l);if(c.startCol===l)e.getCell(c.startRow,c.startCol).visual.setBorderLineStyle(T.TblBorderType.Bottom,n);else e.getCell(c.endRow-1,l).visual.setBorderLineStyle(T.TblBorderType.Bottom,n);var d=e.visual.getCellGridData(s.endRow,l);if(d.startCol===l)e.getCell(d.startRow,d.startCol).visual.setBorderLineStyle(T.TblBorderType.Top,n);else e.getCell(d.startRow,l).visual.setBorderLineStyle(T.TblBorderType.Top,n)}var p=e.getCell(s.startRow,s.startCol),u=!(s.startRow===t.startRow),h=!(s.endRow===t.endRow);s.startRow===t.startRow&&h?p.visual.setBorderLineStyle(T.TblBorderType.Bottom,n):s.endRow===t.endRow&&u?p.visual.setBorderLineStyle(T.TblBorderType.Top,n):u&&h&&(p.visual.setBorderLineStyle(T.TblBorderType.Top,n),p.visual.setBorderLineStyle(T.TblBorderType.Bottom,n))}}},{key:"_modifyInsideHBorder",value:function(e,t,a){var r=this._collectCells(e,t);return this._doModifyInsideHBorder(e,t,r,a),!0}},{key:"_modifyOutBorder",value:function(e,t,a){return this._modifyLeftBorder(e,t,a),this._modifyRightBorder(e,t,a),this._modifyTopBorder(e,t,a),this._modifyBottomBorder(e,t,a),!0}},{key:"_modifyNoneBorder",value:function(e,t,a){for(var r=e.getRowCount(),n=e.getColumnCount(),i={fill:{type:0}},o=this._collectCells(e,t),s=0;s<o.length;++s){for(var l=o[s],c=e.visual.getCellGridData(l.row,l.col),d=c.startRow;d<c.endRow;++d)for(var p=c.startCol;p<c.endCol;++p){if(d===t.startRow&&t.startRow>0){var u=e.visual.getCellGridData(t.startRow-1,p);if(u.startCol===p)e.getCell(u.startRow,u.startCol).visual.setBorderLineStyle(T.TblBorderType.Bottom,i);else e.getCell(u.endRow-1,p).visual.setBorderLineStyle(T.TblBorderType.Bottom,i)}if(d===t.endRow-1&&t.endRow<r){var h=e.visual.getCellGridData(t.endRow,p);if(h.startCol===p)e.getCell(h.startRow,h.startCol).visual.setBorderLineStyle(T.TblBorderType.Top,i);else e.getCell(h.startRow,p).visual.setBorderLineStyle(T.TblBorderType.Top,i);e.getCell(d,p).visual.setBorderLineStyle(T.TblBorderType.Bottom,i)}if(p===t.startCol&&t.startCol>0){var f=e.visual.getCellGridData(d,t.startCol-1);if(f.startRow===d)e.getCell(f.startRow,f.startCol).visual.setBorderLineStyle(T.TblBorderType.Right,i);else e.getCell(d,c.endCol-1).visual.setBorderLineStyle(T.TblBorderType.Right,i)}if(p===t.endCol-1&&t.endCol<n){var m=e.visual.getCellGridData(d,t.endCol);if(m.startRow===d)e.getCell(m.startRow,m.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,i);else e.getCell(d,m.startCol).visual.setBorderLineStyle(T.TblBorderType.Left,i);e.getCell(d,p).visual.setBorderLineStyle(T.TblBorderType.Right,i)}}var v=e.getCell(c.startRow,c.startCol);v.visual.setBorderLineStyle(T.TblBorderType.Left,i),v.visual.setBorderLineStyle(T.TblBorderType.Right,i),v.visual.setBorderLineStyle(T.TblBorderType.Top,i),v.visual.setBorderLineStyle(T.TblBorderType.Bottom,i)}return!0}},{key:"_modifyCellBorder",value:function(e,t,a){var r=this;return a.applyOperate(e,(function(a,n){var i=window.CoreUtils.createModifier("Outline",{});switch(i.modify("outline",n),a){case"allBorder":return r._modifyAllBorder(e,t,i);case"middleBorder":return r._modifyMiddleBorder(e,t,i);case"leftBorder":return r._modifyLeftBorder(e,t,i);case"rightBorder":return r._modifyRightBorder(e,t,i);case"topBorder":return r._modifyTopBorder(e,t,i);case"bottomBorder":return r._modifyBottomBorder(e,t,i);case"insideHBorder":return r._modifyInsideHBorder(e,t,i);case"insideVBorder":return r._modifyInsideVBorder(e,t,i);case"outBorder":return r._modifyOutBorder(e,t,i);case"nonBorder":return r._modifyNoneBorder(e,t,i)}}))}},{key:"modifyTableProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=this.parent.getActiveTableFrame())||(t=this.selectData.getTableFrame()),!t)return!1;var a=window.getTransaction();a.beginBatchCommand();var r=this.createTblCommandInner(T.TableOPT.ModTable,t),n=null;return r&&(n=this._doModifyTblProperty(t,e,r)),n?(a.addCommand("tableHandler",r),a.endBatchCommand(),!0):(a.rollback(),!1)}},{key:"modifyCellsPropertyNoTransact",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t||(t=this.parent.getActiveTableFrame()),t&&t.parent){var r=a||this.getTableRange();if(r){var n=this.createTblCommandInner(T.TableOPT.ModCells,t,r);return this._doModifyCellProperty(t,r,e,n)}}}},{key:"modifyCellsProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t||(t=this.parent.getActiveTableFrame()),t&&t.parent){var r=a||this.getTableRange();if(r){var n=window.getTransaction();n.beginBatchCommand();var i=this.createTblCommandInner(T.TableOPT.ModCells,t,r),o=null;return i&&(o=this._doModifyCellProperty(t,r,e,i)),o?(n.addCommand("tableHandler",i),n.endBatchCommand(),!0):(n.rollback(),!1)}}}},{key:"_doModifyTblProperty",value:function(e,t,a){if(!(e&&t&&e.parent&&a))return!1;var r=a.extraDatas,n={},i=Ar(t);y.actionType&&(n.cmdExtends={actionType:i});var o=null,s=t.name(),l=this._modifyTblCb[s];if(l?o=l.apply(this,[e,t]):console.error("Not found modify callback for:",s),o){for(var c in null!=i&&(n.cmdExtends.actionType=i),o.newval)n[c]=o.newval[c];return n.modifiers=t.trimmedModifiers(),n.cmdFlags=t.flags(),r.props=n,!0}return!1}},{key:"_doModifyCellProperty",value:function(e,t,a,r){if(!(e&&a&&e.parent&&r))return!1;var n=r.extraDatas,i={},o=Ar(a);y.actionType&&(i.cmdExtends={actionType:o});var s=null,l=a.name(),c=this._modifyCellCb[l];if(c?s=c.apply(this,[e,t,a]):console.error("Not found modify callback for:",l),s){for(var d in null!=o&&(i.cmdExtends.actionType=o),s.newval)i[d]=s.newval[d];return i.modifiers=a.trimmedModifiers(),i.cmdFlags=a.flags(),n.props=i,!0}return!1}},{key:"setRowHeight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=-1,r=this.parent.getActiveTableFrame();r||(r=this.selectData.getTableFrame());var n=Ir(this.getTableRange()),i=this.parent.getActiveTableCells();a=i&&i.length>1?Math.floor(e):Math.floor(e/(n.endRow-n.startRow)),t&&(a=Math.floor(e),n.startRow=0,n.endRow=r.getRowCount());var o=!1,s=window.getTransaction();s.beginBatchCommand();for(var l=n.startRow;l<n.endRow;++l){var c=xr.setRowHeight(r,l,a);c&&(o=!0)}r.visual.autoFit();var d=this.createTblCommandInner(T.TableOPT.SetRowHeight,r,n,{val:a});return o&&d?(s.addCommand("tableHandler",d),s.endBatchCommand(),!0):(s.rollback(),!1)}},{key:"setColumnWidth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=-1,r=this.parent.getActiveTableFrame();r||(r=this.selectData.getTableFrame());var n=Ir(this.getTableRange()),i=this.parent.getActiveTableCells();a=i&&i.length>1?Math.floor(e):Math.floor(e/(n.endCol-n.startCol)),t&&(a=Math.floor(e),n.startCol=0,n.endCol=r.getColumnCount());var o=window.getTransaction();o.beginBatchCommand();var s=xr.setColWidth(r,n.startCol,a);r.visual.autoFit();var l=this.createTblCommandInner(T.TableOPT.SetColWidth,r,n,{val:a});return s&&l?(o.addCommand("tableHandler",l),o.endBatchCommand(),!0):(o.rollback(),!1)}},{key:"insertRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.parent.getActiveTableFrame();t||(t=this.selectData.getTableFrame());var a=this.getTableRange(),r=Ir(a),n=Ir(a),i=window.getTransaction();i.beginTransact();var o=!1;if(e)o=t.insertRowAbove(a);else{o=t.insertRowBellow(a);var s=r.endRow-r.startRow;r.startRow=r.endRow,r.endRow=r.startRow+s,n.startRow=r.startRow,n.endRow=r.endRow}t.visual.autoFit(),r.startCol=0,r.endCol=t.getColumnCount();var l=this.createTblCommandInner(T.TableOPT.InsertRow,t,n,{bAbove:e});return o&&l?(i.endTopTransact("tableHandler",l),this.parent.selectTableCells(r.startRow,r.startCol,r.endRow,r.endCol),!0):(i.rollback(),!1)}},{key:"tabExtend",value:function(){var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=this.getTableRange(),a=Ir(t),r=window.getTransaction();r.beginTransact();var n=e.insertRowBellow(t);e.visual.autoFit();var i=a.endRow-a.startRow;a.startRow=a.endRow,a.endRow=a.startRow+i,a.startCol=0,a.endCol=e.getColumnCount();var o=this.createTblCommandInner(T.TableOPT.InsertRow,e,a,{bAbove:!1});return n&&o?(r.endTopTransact("tableHandler",o),!0):(r.rollback(),!1)}},{key:"insertColumn",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.parent.getActiveTableFrame();t||(t=this.selectData.getTableFrame());var a=this.getTableRange(),r=Ir(a),n=Ir(a),i=window.getTransaction();i.beginTransact();var o=!1;if(e)o=t.insertColLeft(a);else{o=t.insertColRight(a);var s=n.endCol-n.startCol;n.startCol=n.endCol,n.endCol=n.startCol+s,r.startCol=n.startCol,r.endCol=n.endCol}n.startRow=0,n.endRow=t.getRowCount(),t.visual.autoFit();var l=this.createTblCommandInner(T.TableOPT.InsertCol,t,r,{bLeft:e});return o&&l?(i.endTopTransact("tableHandler",l),this.parent.selectTableCells(n.startRow,n.startCol,n.endRow,n.endCol),!0):(i.rollback(),!1)}},{key:"removeRow",value:function(){var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=this.getTableRange(),a=e.getRowCount();if(t.endRow-t.startRow>=a)return this.parent.deleteShape([e.parent]);t.startCol=0,t.endCol=e.getColumnCount();var r=window.getTransaction();r.beginTransact();var n;n=e.removeRows(t),e.visual.autoFit();var i=this.createTblCommandInner(T.TableOPT.DeleteRows,e,t);return n&&i?(r.endTopTransact("tableHandler",i),a=e.getRowCount(),t.endRow=t.startRow+1,t.endRow>=a&&(t.startRow=a-1,t.endRow=a),this.parent.selectTableCells(t.startRow,t.startCol,t.endRow,t.endCol),!0):(r.rollback(),!1)}},{key:"removeColumn",value:function(){var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=this.getTableRange(),a=e.getColumnCount();if(t.endCol-t.startCol>=a)return this.parent.deleteShape([e.parent]);t.startRow=0,t.endRow=e.getRowCount();var r=window.getTransaction();r.beginTransact();var n=e.removeCols(t);e.visual.autoFit();var i=this.createTblCommandInner(T.TableOPT.DeleteCols,e,t);return n&&i?(r.endTopTransact("tableHandler",i),a=e.getColumnCount(),t.endCol=t.startCol+1,t.endCol>=a&&(t.endCol=a,t.startCol=a-1),this.parent.selectTableCells(t.startRow,t.startCol,t.endRow,t.endCol),!0):(r.rollback(),!1)}},{key:"distributeRows",value:function(e,t){var a=this.parent.getActiveTableFrame();a||(a=this.selectData.getTableFrame());var r=window.getTransaction();r.beginBatchCommand();var n=Ir(this.getTableRange());e&&(n.startRow=0,n.endRow=a.getRowCount());var i=n.startRow,o=n.endRow,s=a.distributeRows(i,o,t);if(s){var l=s.avgHeight,c=s.maxHeight,d=this.createTblCommandInner(T.TableOPT.DistributeRows,a,n,{avgHeight:Math.floor(l),maxHeight:Math.floor(c)});if(d)return r.addCommand("tableHandler",d),r.endBatchCommand(),!0}return r.rollback(),!1}},{key:"distributeCols",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.parent.getActiveTableFrame();t||(t=this.selectData.getTableFrame());var a=window.getTransaction();a.beginBatchCommand();var r=Ir(this.getTableRange());e&&(r.startCol=0,r.endCol=t.getColumnCount());var n=r.startCol,i=r.endCol,o=t.distributeCols(n,i),s=this.createTblCommandInner(T.TableOPT.DistributeCols,t,r);return o&&s?(a.addCommand("tableHandler",s),a.endBatchCommand(),!0):(a.rollback(),!1)}},{key:"mergeCells",value:function(){var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=window.getTransaction();t.beginTransact();var a=this.getTableRange(),r=Ir(a),n=e.mergeCells(a),i=this.createTblCommandInner(T.TableOPT.MergeCells,e,r);return n&&i?(t.endTopTransact("tableHandler",i),this.parent.selectTableCell(r.startRow,r.startCol),!0):(t.rollback(),!1)}},{key:"unMergeCells",value:function(){var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=this.tableSelect.mergedCells();if(0!==t.length){var a=this.getTableRange(),r=!1,n=window.getTransaction();n.beginBatchCommand();for(var i=0;i<t.length;++i){var o=e.visual.getCellGridDataByCell(t[i]),s={startRow:o.startRow,startCol:o.startCol,endRow:o.endRow,endCol:o.endCol},l=e.unMergeCells(s),c=this.createTblCommandInner(T.TableOPT.UnMergeCells,e,s);l&&c&&(n.addCommand("tableHandler",c),r=!0)}return r?(this.parent.selectTblRange(a),n.endBatchCommand(),!0):(n.rollback(),!1)}}},{key:"setVertBorderPos",value:function(e,t){var a=this.parent.getActiveTableFrame();a||(a=this.selectData.getTableFrame()),t=Math.floor(t);var r=window.getTransaction();r.beginBatchCommand();var n=this.getTableRange();if(a.visual.modifyHoriBorderPos(e,t)){n.endRow=e,n.startRow=e-1;var i=this.createTblCommandInner(T.TableOPT.SetHoriPos,a,n,{pos:t});if(i)return r.addCommand("tableHandler",i),r.endBatchCommand(),!0}return r.rollback(),!1}},{key:"setHoriBorderPos",value:function(e,t){var a=this.parent.getActiveTableFrame();a||(a=this.selectData.getTableFrame()),t=Math.floor(t);var r=window.getTransaction();r.beginBatchCommand();var n=this.getTableRange();if(a.visual.modifyVertBorderPos(e,t)){n.endCol=e,n.startCol=e-1;var i=this.createTblCommandInner(T.TableOPT.SetVertPos,a,n,{pos:t});if(i)return r.addCommand("tableHandler",i),r.endBatchCommand(),!0}return r.rollback(),!1}},{key:"backspace",value:function(){try{if(this.parent.state!==T.SelectType.select_multi_cell&&this.parent.state!==T.SelectType.select_cell)return;var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=window.getTransaction();t.beginBatchCommand();for(var a=this.getTableRange(),r=a.startRow;r<a.endRow;++r)for(var n=a.startCol;n<a.endCol;++n){var i=e.getCell(r,n);if(i&&i.getTextFrame()){var o=i.getTextFrame().getTextStream();if(o&&!(o.getCharCount()<=1)){var s=this.parent.getPresentation(),l=Rr(s,o),c=o.getText(0,o.getCharCount()-1);o.deleteText(0,o.getCharCount()-1),t.addCommand("txtStrmDelete",Object.assign({text:c.join(""),gcp:0},l))}}}return t.endBatchCommand(),!0}catch(e){console.error(e)}}},{key:"cutCellRange",value:function(){if(this.parent.state!==T.SelectType.select_cell&&this.parent.state!==T.SelectType.select_multi_cell)return!1;var e=this.parent.getActiveTableFrame();e||(e=this.selectData.getTableFrame());var t=this.getTableRange(),a=e.getRowCount(),r=e.getColumnCount();if(t.endRow===a&&0===t.startRow&&(t.startCol>0||t.endCol<r)){var n=window.getTransaction();n.beginTransact();var i=e.removeCols(t);if(e.visual.autoFit(),i){var o=Ir(t),s=this.createTblCommandInner(T.TableOPT.DeleteCols,e,o);if(s)return n.endTopTransact("tableHandler",s),a=e.getRowCount(),r=e.getColumnCount(),t.startRow=0,t.startCol=0,t.endRow=a,t.endCol=r,this.parent.selectTableCells(t.startRow,t.startCol,t.endRow,t.endCol),!0}return n.rollback(),!1}if(t.endCol===r&&0===t.startCol&&t.startRow>0&&t.endRow<a){var l=window.getTransaction();l.beginTransact();var c=e.removeRows(t);if(e.visual.autoFit(),c){var d=Ir(t),p=this.createTblCommandInner(T.TableOPT.DeleteRows,e,d);if(p)return l.endTopTransact("tableHandler",p),a=e.getRowCount(),r=e.getColumnCount(),t.startRow=0,t.startCol=0,t.endRow=a,t.endCol=r,this.parent.selectTableCells(t.startRow,t.startCol,t.endRow,t.endCol),!0}return l.rollback(),!1}return this.backspace()}},{key:"readonly",get:function(){return this.selectData.readonly}}]),e}(),Dr=a(2245),Fr=a(258),Mr=window.CoreExports.utils.deepClone,jr=window.CoreExports.helper,Er=jr.getEditObjectPath,Nr=jr.effectNodePath,Lr=jr.collectPath,Vr=window.CoreExports.animation,Wr=Vr.AnimHelper,Gr=Vr.AnimPresetType,Hr=Vr.AnimNodeType,Ur=Vr.AnimLevel,zr=Vr.animCategoryStr,qr=Vr.AnimTriggerType,Kr=Vr.AnimCategory;function Qr(e,t){var a=e.getTiming();if(!a)return null;var r=a.getTimeLine();return r?t<0||t>=r.length?null:r.subNode(t):null}function Jr(e,t){if(e instanceof Array&&t instanceof Array&&e.length===t.length){for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}return!1}var Yr=function(){function e(t,a){o()(this,e),this.parent=t,this.selectData=a,this._modifyCb={AnimSet:this._modifyAnimSet,AnimTimer:this._modifyAnimTimer,AnimInfo:this._modifyAnimInfo,AnimPlay:this._modifyAnimPlay,TimeNode:this._modifyTimeNode}}return l()(e,[{key:"checkState",value:function(){return this.parent.state===T.SelectType.select_shape||this.parent.state===T.SelectType.select_multi_shape||this.parent.state===T.SelectType.select_text||this.parent.state===T.SelectType.select_cell||this.parent.state===T.SelectType.select_multi_cell||this.parent.state===T.SelectType.select_multi_animation}},{key:"fire",value:function(e,t){this.parent.fire(e,t)}},{key:"insertAnimBatch",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parent.getActiveShapes();if(r&&!(r.length<=0)&&this.checkState()){var n=this.parent.getActiveSlide();if(n){var i=n.getTiming();if(i){var o=[],s=[],l=window.getTransaction();l.beginBatchCommand();for(var c=0;c<r.length;++c){var d=qr.OnPageClick;c>0&&(d=qr.WithPrevious);var p=r[c];a||(p=r[c].visual.getRootShape()),(o=this._insertOneAnimation(p,e,t,d)).length>0?o.forEach((function(e){var t=e.effectNode,r=e.sendparam;t&&s.push(t),2===r.nCategory?r.nCategory=3:3===r.nCategory&&(r.nCategory=2),a&&(r.isMediaEffect=!0),l.addCommand("effectAdd",r)})):l.rollback()}if(this._modifyLevels){var u=Ia("AnimInfo");u.modify("buildLevel",this._modifyLevels.level),this.modifyAnimPropertiesBatch(u,this._modifyLevels.list),delete this._modifyLevels}this.parent.selectAnimsDirectly(s),s&&s.length>1&&l.setCooperHandler("batchInsertAnime"),l.endBatchCommand();var h=Wr.filterPreviewAnims(s);return h.length>0&&i._firePreview(h),s.length>0?s:null}}}}},{key:"_insertOneAnimation",value:function(e,t,a,r){if(!this.parent.getActiveSlide())return!1;var n=!1,i=e.getPlaceHolder();if(i){var o=Dr.PlaceHolderHelper.phTypeFollowCommon(i);o&&o===T.PlaceholderType.Body&&(n=!0)}var s=Wr.findEffectLevel(e);if(!(e.hasChartTemp()&&s!==Ur.LevelNone)&&(a===Gr.ChangeFillColor||a===Gr.ChangeLineColor))return this._insertOneSpecialAnimation(e,t,a,r);var l=this.parent.getRange(),c=l.begin,d=l.end;return this.parent.state===T.SelectType.select_text&&d-c>0&&null!=e.getTextFrame()?this._insertOneParaAnimation(e,l,t,a,r,Fr.FollowType.FollowLastPara):Wr.canAddParaEffect(e,s)?this._insertMultiAnimation(e,t,a,r,s,n):n?this._insertOneShapeAnimation(e,t,a,r,0):this._insertOneShapeAnimation(e,t,a,r)}},{key:"_insertMultiAnimation",value:function(e,t,a,r,n,i){var o=this,s=function(i){if(Wr.canAddObjectEffect(e,t,a)){r=i===Fr.FollowType.FollowLastPara?qr.WithPrevious:qr.OnPageClick;var s=o._insertOneShapeAnimation(e,t,a,r,0);return o._modifyLevels=function(e){var t={level:n,list:[]};return e&&0!==e.length?(e.forEach((function(e){e.effectNode&&t.list.push(e.effectNode)})),t):t}(s),s||[]}return[]},l=function(n){var i=e.getTextFrame(),s=i&&i.getTextStream();if(s){var l={begin:0,end:s.end};o.parent.selectText(l.begin,l.end);var c=o._insertOneParaAnimation(e,l,t,a,r,n);return o.parent.clearTextSelect(),c||[]}return[]},c=[];if(t===Kr.Exit){var d=i?Fr.FollowType.FollowNone:Fr.FollowType.FollowLastPara;c=l(d).concat(s(d))}else{var p=i?Fr.FollowType.FollowNone:Fr.FollowType.FollowShape;c=s(Fr.FollowType.FollowNone).concat(l(p))}return c}},{key:"_insertOneShapeAnimation",value:function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=this.parent.getPresentation(),o=this.parent.getActiveSlide(),s=Er(i,e),l=o.getTiming(),c=l.mainSequence;if(!c){var d=l.getTimeLine();c=Wr.createNode(Hr.MainSeq),d.insertSubNode(0,c)}var p={presetType:a,presetClass:zr(t),animCategory:t,targetShapeId:e.getId(),triggerType:r,nodeType:Hr.Effect,repeat:1},u=Wr.createNode(Hr.Effect,p);if(!u)return!1;if(c.insertSubNode(c.length,u),!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var h=window.aeoFactory.get(t,a);if(h)return h.create(u),s.nEffectType=a,s.nCategory=t,s.sPath=Nr(o,c,u),s.extendProps={triggerType:r},null!==n&&(s.extendProps.level=n),[{effectNode:u,sendparam:s}];console.error("effect wrapper not found")}},{key:"_insertOneParaAnimation",value:function(e,t,a,r,n,i){var o=this.parent.getPresentation(),s=this.parent.getActiveSlide(),l=t.begin,c=t.end,d=s.getTiming(),p=d.mainSequence;if(!p){var u=d.getTimeLine();p=Wr.createNode(Hr.MainSeq),u.insertSubNode(0,p)}var h=e.getTextFrame(),f=h&&h.getTextStream();if(!f)return!1;for(var m=[],v=f.papTbl.getItems(l,c-l),g=0;g<v.length;++g){var y=v[g],T=y.getBegin(),C=y.getCcp();if(!(C<=1)){n=i===Fr.FollowType.FollowShape||i===Fr.FollowType.FollowLastPara&&g>0?qr.WithPrevious:qr.OnPageClick;var _=Er(o,e),b={presetType:r,presetClass:zr(a),animCategory:a,targetShapeId:e.getId(),triggerType:n,nodeType:Hr.Effect,repeat:1},S=Wr.createNode(Hr.Effect,b);if(!S)return!1;if(p.insertSubNode(p.length,S),!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var k=window.aeoFactory.get(a,r);if(!k)return console.error("effect wrapper not found"),!1;k.create(S);for(var P=p.getEffect(e.getId()),w=0;w<P.length;++w){var x=P[w],I=x.findBuildLevel();if(I===Ur.LevelNone){I=Ur.TextByAllLevels,x.setBuildLevel(I);break}}var R=f.papTbl.findIndex(T);S.setParaStart(R),S.setParaEnd(R),_.nEffectType=r,_.nCategory=a,_.sPath=Nr(s,p,S),_.gcp=T,_.ccp=C,_.extendProps={triggerType:n},m.push({effectNode:S,sendparam:_})}}return m}},{key:"_insertOneSpecialAnimation",value:function(e,t,a,r){var n=this.parent.getPresentation(),i=this.parent.getActiveSlide(),o=Er(n,e),s=i.getTiming(),l=s.mainSequence;if(!l){var c=s.getTimeLine();l=Wr.createNode(Hr.MainSeq),c.insertSubNode(0,l)}var d={presetType:a,presetClass:zr(t),animCategory:t,targetShapeId:e.getId(),trigger:r,nodeType:Hr.Effect,repeat:1},p=Wr.createNode(Hr.Effect,d);if(!p)return!1;if(l.insertSubNode(l.length,p),!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var u=window.aeoFactory.get(t,a);if(u)return u.create(p),p.setParaStart(-1),p.setParaEnd(-1),o.nEffectType=a,o.nCategory=t,o.sPath=Nr(i,l,p),o.extendProps={triggerType:r},[{effectNode:p,sendparam:o}];console.error("effect wrapper not found")}},{key:"deleteAnimBatch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.parent.state===T.SelectType.select_multi_animation){var t=this.parent.getActiveAnimations();if(t&&!(t.length<=0)){var a=this.parent.getPresentation(),r=this.parent.getActiveSlide(),n=window.getTransaction();n.beginBatchCommand();for(var i=0;i<t.length;++i){var o=t[i],s=o.parent;if(s){var l=r.findShapeById(o.getShapeId()),c=l;o.getCategory()!==Kr.MediaCall&&(c=l.visual.getRootShape());for(var d=o.getBehaviors(),p=0;p<d.length;++p){var u=d[p];if(u.isExplainBehavior){var h=r.findShapeById(u.getTargetShapeId());this.parent.deleteShape([h])}}var f=Er(a,c);f.sPath=Nr(r,s,o);var m=s.effectIndex(o);s.deleteSubNode(m),e&&(f.type=-1),n.addCommand("effectRemove",f)}}n.setCooperHandler("effectRemove"),n.endBatchCommand()}}}},{key:"replaceAnimBatch",value:function(e,t){if(this.parent.state===T.SelectType.select_multi_animation){var a=this.parent.getActiveSlide();if(!a)return!1;var r=a.getTiming();if(!r)return!1;var n=this.parent.getActiveAnimations();if(n&&!(n.length<=0)){var i=!1,o=window.getTransaction();o.beginBatchCommand();for(var s=0;s<n.length;++s){var l=n[s];(i=this.replaceOneAnimationNoTransact(l,e,t))?o.addCommand("modifyEffectProps",i.sendparam):o.rollback()}if(this.parent.selectAnimsDirectly(n),o.endBatchCommand(),i){var c=Wr.filterPreviewAnims(n);c.length>0&&r._firePreview(c)}}}}},{key:"replaceOneAnimationNoTransact",value:function(e,t,a){var r=this.parent.getPresentation(),n=this.parent.getActiveSlide(),i=e.parent;if(i){var o=n.findShapeById(e.getShapeId());if(o&&o.parent){var s=o;e.getCategory()!==Kr.MediaCall&&(s=o.visual.getRootShape());var l={presetId:a,accelarate:-1,decelerate:-1};e.setPropertyBatch(l);var c=Mr(e.getInfoProperty());c&&(c.textUnit=-1,c.interval=0,c.intervalType=1,e.setPropertyValue("info",c));var d=e.subNode(0);if(d){var p=d.getParaStart(),u=d.getParaEnd();if(e.deleteAll(),!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var h=window.aeoFactory.get(t,a);if(!h)return void console.error("effect wrapper not found");h.create(e),e.setParaStart(p),e.setParaEnd(u)}var f=Er(r,s);return f.nEffectType=a,f.nCategory=t,f.sPath=Nr(n,i,e),f.extendProps={AnimReplace:!0},{effectNode:e,sendparam:f}}}}},{key:"moveAnimBatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.parent.state===T.SelectType.select_multi_animation){var a=this.parent.getActiveAnimations();if(a&&!(a.length<=0)&&!(t<0||e<0)){var r=this.parent.getPresentation(),n=this.parent.getActiveSlide(),i=Qr(n,t),o=!0,s=window.getTransaction();s.beginBatchCommand();for(var l=0;l<a.length;++l){var c=a[l],d=c.parent;if(d){var p=n.findShapeById(c.getShapeId()),u=p;c.getCategory()!==Kr.MediaCall&&(u=p.visual.getRootShape());var h=Er(r,u),f=Nr(n,d,c);if(f){var m=[t,e];Jr(f,m)||(d===i&&d.moveSubNode(f[1],e),o=!0,h.sPath=f,h.tPath=m,s.addCommand("effectMove",h))}else o=!1}else o=!1}o?(this.parent.selectAnimsDirectly(a),s.endBatchCommand()):s.rollback()}}}},{key:"modifyAnimPropertiesBatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==t&&(t=this.parent.getActiveAnimations()),t&&!(t.length<=0)){var a=this.parent.getPresentation(),r=this.parent.getActiveSlide();if(r){var n=!1,i=window.getTransaction();i.beginBatchCommand();for(var o=0;o<t.length;++o){var s=t[o],l=s.getTargetShapeId(),c=r.findShapeById(l);if(c&&c.parent){var d=c;s.isMediaNode||(d=c.visual.getRootShape());var p=s.parent;if(p){var u=Er(a,d),h={};Lr(s,h),u.sPath=h.nodePath,(n=this._doModifyAnimProperty(s,e,u))&&i.addCommand("modifyEffectProps",u)}}}n?i.endBatchCommand():i.rollback()}}}},{key:"_doModifyAnimProperty",value:function(e,t,a){var r=null,n=t.name(),i={},o=this._modifyCb[n];return o?r=o.apply(this,[e,t]):console.error("Not found modify callback for:",n),!!r&&(i[n]=r.newval,i.modifiers=t.trimmedModifiers(),i.cmdFlags=t.flags(),a.extendProps=i,!0)}},{key:"_modifyAnimSet",value:function(e,t){var a=e.getCategory(),r=e.getpresetType();if(!window.aeoFactory)return console.assert("aeoFactory not load"),!1;var n=window.aeoFactory.get(a,r);return!!n&&t.applyOperate(e,(function(t,a){n.apply(e,t,a);var r={};return r[t]=a,e.animType&&(r.animType=e.animType,delete e.animType),{newval:r}}))}},{key:"_modifyAnimTimer",value:function(e,t){return t.applyOperate(e,(function(t,a){switch(t){case"restart":e.setProperty("restart",a);break;case"delay":case"duration":e.setDuration(a);break;case"repeat":e.setProperty("repeat",a);break;case"trigger":e.setProperty("triggerType",a)}var r={};return r[t]=a,{newval:r}}))}},{key:"_modifyAnimInfo",value:function(e,t){return t.applyOperate(e,(function(t,a){var r=e.getInfoProperty();switch(t){case"buildLevel":e.setBuildLevel(a);break;case"textUnit":r[t]=a,e.modifyInfoProperty(r)}var n={};return n[t]=a,{newval:n}}))}},{key:"_modifyAnimPlay",value:function(e,t){return t.applyOperate(e,(function(){t.setSource(e.getPlayProperty());var a=t.modifiedData();return e.setPlayProperty(a)}))}},{key:"_modifyTimeNode",value:function(e,t){t.setSource({});var a=t.modifiedData();return e.setPropertyBatch(a)}},{key:"addBehavior",value:function(e,t){if(!e)return null;var a=this.parent.getActiveAnimations();if(a.length>1)console.error("effects's length should equal 1");else{var r=a[0];if(a){var n=t.behaviorType,i=Wr.createNode(n,t);if(i){var o=Er(this.parent.presentation,e);o.extendProps=t;var s=this.parent.transaction;s.beginBatchCommand(),r.insertSubNode(r.length,i);var l=Er(this.parent.presentation,i);o.sPath=l.sPath,s.addCommand("behaviorAdd",o),s.endBatchCommand()}}}}},{key:"removeBehavior",value:function(e){if(null!=e){var t=this.parent.getActiveAnimations();if(t.length>1)console.error("effects's length should equal 1");else{var a=t[0];if(t){var r=a.subNode(e);if(r){var n=a.getShapeId(),i=this.parent.getActiveSlide(),o=i&&i.findShapeById(n),s=Er(this.parent.presentation,r),l=Er(this.parent.presentation,o),c=Object.assign({},s,l),d=this.parent.transaction;d.beginBatchCommand(),a.deleteSubNode(e),d.addCommand("behaviorRemove",c),d.endBatchCommand()}}}}}},{key:"moveBehavior",value:function(e,t){if(null!=e&&null!=t){var a=this.parent.getActiveAnimations();if(a.length>1)console.error("effects's length should equal 1");else{var r=a[0];if(a){var n=r.subNode(e);if(n){var i=this.parent.getPresentation(),o=this.parent.getActiveSlide(),s=r.getShapeId(),l=o&&o.findShapeById(s),c=Er(i,n),d=Er(this.parent.presentation,l),p=Object.assign({},c,d);p.tPath=function(e,t){var a=e.slice(0);return a[a.length-1]=t,a}(p.sPath,t);var u=this.parent.transaction;u.beginBatchCommand(),r.moveSubNode(e,t)?(u.addCommand("behaviorMove",p),u.endBatchCommand()):u.rollback()}}}}}},{key:"modifyBehavior",value:function(e,t){if(e&&null!=t){var a=this.parent.getActiveAnimations();if(a.length>1)console.error("effects's length should equal 1");else{var r=a[0];if(a){var n=r.subNode(t);if(n){var i=r.getShapeId(),o=this.parent.getActiveSlide(),s=o&&o.findShapeById(i),l=Er(this.parent.presentation,n),c=Er(this.parent.presentation,s),d=Object.assign({},l,c);d.extendProps=e;var p=this.parent.transaction;for(var u in p.beginBatchCommand(),e)n.setProperty(u,e[u]);p.addCommand("modifyBehaviorProps",d),p.endBatchCommand()}}}}}},{key:"readonly",get:function(){return this.selectData.readonly}}]),e}(),Xr=a(6132),Zr=function(){function e(t,a){o()(this,e),this.coreSlt=t,this.selectData=a,this._modifyCallback={DocConfig:this._modifyPresentationDocConfig,ShowSettings:this._modifyPresentationShowSettings,PageSetup:this._modifyPresentationPageSetup}}return l()(e,[{key:"modifyPresentationProps",value:function(e){return this.applyModifierToPresentation(this.presentation,e)}},{key:"applyModifierToPresentation",value:function(e,t){var a=this;if(t){var r={data:{}};this.transaction.beginBatchCommand();var n=function(){var n=t.name(),i=a._modifyCallback[n],o=void 0;if(i?o=i.apply(a,[e,t,r]):console.error("Not found modify callback for:",n),o)return r.data=Object.assign({},r.data,o),r.data.modifiers=t.trimmedModifiers(),r.data.cmdFlags=t.flags(),r.genid&&a.transaction.setUserData("genid",r.genid),r}();n?(this.transaction.addCommand("modifyPresentation",n),this.transaction.endBatchCommand()):this.transaction.rollback()}}},{key:"deleteAllInkNoTransact",value:function(){var e=this.presentation.slides;if(e){var t=e.getSlideCount(),a=Qa.TransactionInstances.getInstance("inkShapes");a.beginTransact();for(var r=0;r<t;++r){var n=e.getSlideAt(r),i=n.drawingShapes&&n.drawingShapes.slice(0);if(i&&0!==i.length)this.coreSlt.getShapeSelection().deleteInkNoTransact(i,n)}a.endTransact()}}},{key:"setAllInkHidden",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this.presentation;if(null==t)a.setLocalConfigs({hideAllInk:e,hiddenInkSlides:null,shownInkSlides:null});else if(t.length>0){for(var r=[],n=0;n<t.length;n++){var i=t[n];i&&r.push(i.getId())}if(r.length>0){var o=a.getLocalConfigs(),s=o.hiddenInkSlides||[],l=o.shownInkSlides||[];e?s=s.concat(r):l=l.concat(r);var c=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];r.indexOf(i)<0&&t.indexOf(i)<0&&a.getSlideById(i)&&r.push(i)}return r},d=c(s,e?[]:r),p=c(l,e?r:[]);a.setLocalConfigs({hiddenInkSlides:d,shownInkSlides:p})}}a._fireChanged();var u=this.coreSlt._checkHiddenInkShapes(this.coreSlt.getActiveShapes());u&&this.coreSlt.selectShapes(u)}},{key:"removeAllInk",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.coreSlt,a=t.transaction;try{var r=t.getShapeSelection();a.beginBatchCommand(),a.setCooperHandler("removeAllInk"),a.setUserData("allSlides",!1==!!e),e||(e=t.presentation.slides.children);for(var n=0;n<e.length;n++){for(var i=[],o=e[n].getSpTree(),s=o.childShapes,l=0;l<s.length;l++)s[l].isInk()&&i.push(s[l]);i.length>0&&r._deleteShapes(e[n],i)}return a.endBatchCommand(),!0}catch(e){a.rollback(),console.error(e)}}},{key:"modifyPresentationConfigs",value:function(e){var t=this.presentation,a=this.transaction;a.beginBatchCommand(),t.setLocalConfigs(e),a.addCommand("modifyPresentation",{data:{docConfig:JSON.stringify(e)}}),a.endBatchCommand()}},{key:"_modifyPresentationDocConfig",value:function(e,t){var a=e.getCustomProps();t.setSource(a);var r=t.modifiedData();return e.setCustomProps(r),{docConfig:e.getConfigs()}}},{key:"_modifyPresentationShowSettings",value:function(e,t){t.setSource(e.getShowSettings()||{private:{}});var a=t.modifiedData();return e.setShowSettings(a),{showSettings:a.private}}},{key:"_modifyPresentationPageSetup",value:function(e,t,a){t.setSource(e.getPageSetup()||{private:{}});var r=t.modifiedData();return this.coreSlt.startPageSetupCommand(a),{pageSetup:r.private}}},{key:"presentation",get:function(){return this.coreSlt.presentation}},{key:"transaction",get:function(){return this.coreSlt.transaction}}]),e}(),$r=a(1907),en=a(360),tn=Dr.animation.AnimNodeType,an=Dr.animation.AnimHelper,rn=Dr.format_brush.FormatBrushType,nn=Dr.format_brush.FormatHelper,on=window.CoreExports.utils.deepClone,sn=window.CoreExports.helper,ln=sn.getEditObjectPath,cn=sn.effectNodePath,dn=window.CoreExports.getPtLength,pn=function(){function e(){o()(this,e)}return l()(e,null,[{key:"fmtInner",value:function(t,a,r,n){if(!t)return!1;var i=t.getTextStream();if(!i)return!1;var o=n.begin,s=n.end,l=t.getShape(),c=l.getSlide(),d=i.begin,p=i.end;if(o<d||s>p)return!1;var u=c.getCategory(),h=!1,f=t.visual.getIndividualVisual(),m="slideLayouts"===u||"slideMasters"===u;h=!!(f&&f.coredata.isPlaceHolder()&&m);var v="fmtChpx"===r&&a.hasOwnProperty("autoFit"),g="fmtPapx"===r&&a.tabIndent;if(g&&!i.canTabIndent(a.tabIndent<0,o,s-o))return!1;var y=o,T=s-o;if(0===T&&h){var C=i.getParaTbl().getItemByCP(o);y=C.getBegin(),T=C.getCcp()}var _=on(a);if(v){delete a.autoFit;var b=Cr.getAutoFit(t);if(b){var S=t.private.prop.autoFit;t.private.prop.autoFit=b,_.autoFit=b,_.oldval={autoFit:S}}}if(_.fontNameAscii){var k=_.fontNameAscii;"minor"!==k.themeIndex&&"major"!==k.themeIndex||(k.name=null)}if(_.fontNameAsiaEast){var P=_.fontNameAsiaEast;"minor"!==P.themeIndex&&"major"!==P.themeIndex||(P.name=null)}if(_.fontNameComplex){var w=_.fontNameComplex;"minor"!==w.themeIndex&&"major"!==w.themeIndex||(w.name=null)}var x=i.getParaTbl(),I=i.getChpTbl(),R=function(e){return"actions"===e};if("fmtPapx"===r&&Cr.clearProps(x,n.begin,n.end-n.begin,null),"fmtChpx"===r&&e.clearProps(i,I,n,R),a.tabIndent){var O=x.getItems(y,T);Cr.dealTabs(t,O,_,r)}else t.visual[r](y,T,_);return!0}},{key:"clearProps",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=e.end,i=t.findIndex(a.begin),o=t.getItemAt(i);if(o){var s=o.getBegin()+o.getCcp();(s=Object(en.o)(s,a.begin))>0&&t.splitItem(s)}var l=t.findIndex(a.end),c=t.getItemAt(l);if(c){var d=c.getBegin();(d=Object(en.n)(d,a.end))<n-1&&t.splitItem(d)}Cr.clearProps(t,a.begin,a.end-a.begin,r)}},{key:"modifyTextProp",value:function(t,a){var r=-1,n=-1,i=t.getTextFrame();if(!i)return!0;var o=a.txtFrameProp;if(o&&!Tr.doReplaceShapeTextFrameProp(i,o))return!1;var s=i.getTextStream();if(!s)return!0;var l=a.textProp;if(l){r=s.begin,n=s.end;var c=l.chpProp;if(c&&!e.fmtInner(i,c,"fmtChpx",{begin:r,end:n}))return!1;var d=l.paraProp;if(d&&!e.fmtInner(i,d,"fmtPapx",{begin:r,end:n}))return!1}return!0}},{key:"modifyChildTextProp",value:function(t,a){for(var r=t.getChildCount(),n=0;n<r;++n){var i=t.getChildAt(n);if(i.isGroupShape()&&!e.modifyChildTextProp(i,a))return!1;if(!i.isInk()&&(!i.hasTable()&&!e.modifyTextProp(i,a)))return!1}return!0}},{key:"setInkOutline",value:function(e,t){if(e.isInk()&&t){for(var a=t.fill,r=on(e.getInkData()),n=Object.keys(r.brushMap),i=0;i<n.length;++i){var o=n[i],s=r.brushMap[o];if(a.pretColor&&a.type===T.FillType.FillTypeSolidColor){var l=window.APP.utils.createModifier("Color",s.color);l.modify("color",a.pretColor),s.color=l.modifiedData()}s.widthUnit=T.UnitsLength.in,s.width=t.width/914400}return e.setInkData(r),!0}}},{key:"modifyChildOutline",value:function(t,a){for(var r=t.getChildCount(),n=0;n<r;++n){var i=t.getChildAt(n);if(i.isGroupShape()&&!e.modifyChildOutline(i,a))return!1;i.isInk()?e.setInkOutline(i,a):i.visual.setOutline(a)}return!0}},{key:"modifyOutlineByInk",value:function(e,t){if(e.isInk()){var a=null;for(var r in t)if(t[r]){a=t[r];break}if(!a)return!1;var n=on(e.getInkData()),i=Object.keys(n.brushMap);for(var o in a)for(var s=0;s<i.length;++s){var l=i[s];n.brushMap[l][o]=a[o]}e.setInkData(n)}else{var c=null;for(var d in t)if(t[d]){c=t[d];break}if(!c)return!1;var p=c.color,u=dn(c.width,c.widthUnit);c.lineWidth=u;var h={alignment:0,compoundLine:0,dashType:0,endingCap:0,fill:{color:p,type:2},joinType:0,miterLimit:8,width:12700*u};e.visual.setOutline(h)}return!0}},{key:"modifyChildOutlineByInk",value:function(t,a){for(var r=t.getChildCount(),n=0;n<r;++n){var i=t.getChildAt(n);if(i.isGroupShape()&&!e.modifyChildOutlineByInk(i,a))return!1;if(!e.modifyOutlineByInk(i,a))return!1}return!0}},{key:"modifyShapeStyle",value:function(e,t){return e.isInk()||e.setShapeStyle(t),!0}},{key:"modifyChildShapeStyle",value:function(t,a){for(var r=t.getChildCount(),n=0;n<r;++n){var i=t.getChildAt(n);i.isGroupShape()&&e.modifyChildShapeStyle(i,a),e.modifyShapeStyle(i,a)}return!0}},{key:"makeAnimation",value:function(e,t,a,r,n){var i=r.getSlide();if(!i)return null;var o=i.getPresentation();if(a)for(var s=0;s<a.length;++s){var l={},c=a[s];nn.copyData(l,c),n&&n.begin&&(l.paraStart=n.begin),n&&n.end&&(l.paraEnd=n.end);var d=an.createNode(c.nodeType,l);e.insertSubNode(e.length,d)}var p=t.animCategory;2===p?p=3:3===p&&(p=2);var u=ln(o,r);return u.nEffectType=t.presetType,u.nCategory=p,u.extendProps={triggerType:t.triggerType},u}},{key:"hasPara",value:function(e){var t=e.getTextFrame();if(!t)return!1;var a=t.getTextStream();if(!a)return!1;if(a){var r=a.getParaTbl(),n=a.getCharCount();if(0===r.getItems(0,n).length)return!1}return!0}},{key:"createParaAnimation",value:function(t,a,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i={},o=a.behaviors;if(o&&delete a.behaviors,nn.copyData(i,a),i.targetShapeId=r.getId(),a.behaviors=o,!e.hasPara(r))return!0;var s=r.getTextFrame();if(!s)return!0;var l=s.getTextStream();if(l)for(var c=l.getParaTbl(),d=0,p=l.getCharCount(),u=c.getItems(d,p),h=0;h<u.length;++h){var f=h,m=f,v=an.createNode(tn.Effect,i);if(!v)return!1;t.insertSubNode(t.length,v);var g={begin:f,end:m},y=e.makeAnimation(v,a,o,r,g);if(!y)return console.warn("--------invalid param animation brush"),!1;if(!Object.isEmpty(n)){var T=r.getSlide();y.sPath=cn(T,t,v),n.push({name:"effectAdd",param:y})}}return!0}},{key:"createObjAnimaiton",value:function(t,a,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i={},o=a.behaviors;o&&delete a.behaviors,nn.copyData(i,a),i.targetShapeId=r.getId(),a.behaviors=o;var s=an.createNode(tn.Effect,i);if(!s)return!1;if(t.insertSubNode(t.length,s),!Object.isEmpty(n)){var l=r.getSlide(),c=e.makeAnimation(s,a,o,r);if(!c)return console.warn("--------invalid param animation brush"),!1;c.sPath=cn(l,t,s),n.push({name:"effectAdd",param:c})}return!0}}]),e}(),un=function(){function e(t){o()(this,e),this.pres=t}return l()(e,[{key:"applyFormat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch(this.brushType){case rn.Common:return this.applyCommon();case rn.Transform2D:return this.applyTransform2D();case rn.Animation:return this.applyAnimation()}e&&(this.pres.brushType=rn.Invalid,this.stashCache&&(delete this.pres.stashCache,this.pres.stashCache=null))}},{key:"applyCommon",value:function(){var e=this.pres.selection,t=e.state,a=e.transaction;a.beginBatchCommand();var r=!1;switch(t){case T.SelectType.select_slide:break;case T.SelectType.select_text:var n=e.getActiveTextFrame(),i=n&&n.getTextStream(),o=i&&i.text;if(!o||0===o.length)break;var s=e.getRange();s.end===o.length-1&&(s.end=o.length),r=this.applyText(a,n,s,t);break;case T.SelectType.select_shape:var l=e.getActiveShapes();1===l.length&&(r=this.applyShape(a,l[0],t));break;case T.SelectType.select_cell:case T.SelectType.select_multi_cell:var c=e.getActiveShapes(),d=e.getActiveTableCells(),p=e.getActiveTableRange();r=this.applyCells(a,c[0],d,p,t)}r?a.endBatchCommand():a.rollback()}},{key:"_applySlide",value:function(e){}},{key:"applyTextInner",value:function(e,t,a){var r=e.getTextStream();if(!r)return!1;var n=t.textProp,i=r.getParaTbl(),o=r.end,s=a.begin===a.end,l=i.getItems(a.begin,a.end-a.begin);if(s){if(a.end===o)return!1;if(a.end=a.begin+1,!n||!n.chpProp)return!1;var c=n.chpProp;if(!pn.fmtInner(e,c,"fmtChpx",{begin:a.begin,end:a.end}))return!1}else if(1===l.length){var d=t.textProp;if(!d||!d.chpProp)return!1;var p=d.chpProp;if(!pn.fmtInner(e,p,"fmtChpx",{begin:a.begin,end:a.end}))return!1}else{var u=n.chpProp;if(u&&!pn.fmtInner(e,u,"fmtChpx",{begin:a.begin,end:a.end}))return!1;var h=n.paraProp;if(h&&!pn.fmtInner(e,h,"fmtPapx",{begin:a.begin,end:a.end}))return!1}return!0}},{key:"applyText",value:function(e,t,a,r){if("text"!==this.stashCache.stashType)return!1;if(!t)return!1;var n=on(a);if(!this.applyTextInner(t,this.stashCache,n))return!1;var i=ln(this.pres,t);return i.gcp=a.begin,i.ccp=a.end-a.begin,i.brushType=this.brushType,i.stashCache=on(this.stashCache),i.state=r,e.addCommand("formatBrush",i),!0}},{key:"applyCellsInner",value:function(e,t){if(!e||e.length<=0)return!1;for(var a=[],r=0;r<e.length;++r){var n=e[r].getTextFrame();n&&a.push(n)}for(var i=t.textProp,o=i.paraProp,s=0;s<a.length;++s){var l=a[s],c=l.getTextStream();if(c){var d=c.begin,p=c.end,u=i.chpProp;if(u&&!pn.fmtInner(l,u,"fmtChpx",{begin:d,end:p}))return!1;if(o&&!pn.fmtInner(l,o,"fmtPapx",{begin:d,end:p}))return!1}}return!0}},{key:"applyCells",value:function(e,t,a,r,n){if("text"!==this.stashCache.stashType)return!1;this.applyCellsInner(a,this.stashCache);var i=ln(this.pres,t);return i.cellRange=r,i.brushType=this.brushType,i.stashCache=on(this.stashCache),i.state=n,e.addCommand("formatBrush",i),!0}},{key:"applyShape",value:function(e,t,a){if("shape"!==this.stashCache.stashType)return!1;if(!this.applyShapeInner(t,this.stashCache))return!1;var r=ln(this.pres,t);return r.brushType=this.brushType,r.stashCache=on(this.stashCache),r.state=a,e.addCommand("formatBrush",r),!0}},{key:"applyShapeInner",value:function(e,t){if(!e)return!1;if(e.hasTable()||e.hasChart()||e.hasSmartArt()||e.isOle()||e.isMath()||e.isControlShape())return!1;if(e.isGroupShape()&&!pn.modifyChildTextProp(e,t))return!1;if(!pn.modifyTextProp(e,t))return!1;var a=t.fill;e.isInk()||e.visual.setFill(a,!0);var r=t.outline;if(e.isGroupShape()&&!pn.modifyChildOutline(e,r))return!1;e.isInk()?pn.setInkOutline(e,r):e.visual.setOutline(r);var n=t.brushMap;if(n){if(e.isGroupShape()&&!pn.modifyChildOutlineByInk(e,n))return!1;if(!pn.modifyOutlineByInk(e,n))return!1}var i=t.shapeStyle;return e.isGroupShape()&&pn.modifyChildShapeStyle(e,i),pn.modifyShapeStyle(e,i),!0}},{key:"applyTrans2DInner",value:function(e,t){var a=window.APP.utils.createModifier("Transform2D");a.modify("x",t.x),a.modify("y",t.y),a.applyOperate(e,(function(){a.setSource(e.visual.getRealTransform2D()),e.visual.modifyShapeTransform2D(a.modifiedData())}))}},{key:"applyTransform2D",value:function(){var e=this.pres.selection,t=e.transaction,a=e.getActiveShapes();if(a&&1===a.length){var r=a[0];if("trans2D"===this.stashCache.stashType){var n=this.stashCache.trans2D;t.beginTransact(),this.applyTrans2DInner(r,n);var i=ln(this.pres,r);i.brushType=this.brushType,i.stashCache=on(this.stashCache),i.state=e.state,t.endTopTransact("formatBrush",i)}}}},{key:"applyAnimInner",value:function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=r.animations;if(!i||i.length<=0)return!1;null!==r.validAnims&&(delete r.validAnims,r.validAnims=null);var o=[],s=function(e,t,a){for(var r=0;r<t.length;++r){var n=t[r],i=n.animCategory,o=n.presetType;$r.a.isAnimLegal(e,i,o)&&a.push(n)}};if(s(a,i,o),o.length<=0)return!1;r.validAnims=o;var l=t.getTiming(),c=l.mainSequence;if(!c){var d=l.getTimeLine();c=an.createNode(tn.MainSeq),d.insertSubNode(0,c)}var p=c.getEffect(a.getId());if(p.length>0)for(var u=0;u<p.length;++u){var h=p[u],f=ln(this.pres,a);f.sPath=cn(t,c,h);var m=c.effectIndex(h);c.deleteSubNode(m),e.addCommand("effectRemove",f)}for(var v=0;v<o.length;++v){var g=o[v];if(g.isPara&&pn.hasPara(a)){if(!pn.createParaAnimation(c,g,a,n))return!1}else if(!pn.createObjAnimaiton(c,g,a,n))return!1}return!0}},{key:"applyAnimation",value:function(){var e=this.pres.selection,t=e.transaction,a=e.getActiveSlide();if(a){var r=e.getActiveShapes();if(r&&1===r.length)if("animation"===this.stashCache.stashType){var n=[],i=r[0].visual.getRootShape();if(t.beginBatchCommand(),this.applyAnimInner(t,a,i,this.stashCache,n)){var o=ln(this.pres,i),s=this.stashCache.animations;delete this.stashCache.animations,this.stashCache.animations=this.stashCache.validAnims,o.brushType=this.brushType,o.stashCache=on(this.stashCache),o.state=e.state,n.length<=0?t.addCommand("formatBrush",o):(o.cvCmds=n,t.addCommand("formatBrush",o,(function(e){var t=Object.assign({name:e.name,param:on(e.param)});return t.param&&t.param.cvCmds&&delete t.param.cvCmds,t}))),t.setMainCommand("formatBrush"),t.endBatchCommand(),this.stashCache.animations=s}else t.rollback()}}}},{key:"brushType",get:function(){return this.pres.brushType}},{key:"stashCache",get:function(){return this.pres.stashCache}}]),e}();window.OpWrapperFactory=Fa,window.OperationTransform=La;var hn={SlideSelection:za,ShapeSelection:gr,TextSelection:wr,TableSelection:Br,AnimationSelection:Yr,ChartSelection:Xr.ChartSelection,PresentationSelection:Zr},fn={FormatApplyer:un}},6132:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChartSelection=void 0;var r=a(6133),n="dataSource",i="chartType",o="layout",s="color",l="style",c="element",d="chartTitle",p="axisTitle",u=function(){function e(e,t){this.parent=e,this.selectData=t}return e.prototype.initManager=function(){this.chartManager=new r.ChartManager(this.presentation)},e.prototype.getChartManager=function(){return this.chartManager||this.initManager(),this.chartManager},Object.defineProperty(e.prototype,"readonly",{get:function(){return this.selectData.readonly},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coreSlt",{get:function(){return this.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"presentation",{get:function(){return this.parent.presentation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transaction",{get:function(){return this.parent.transaction},enumerable:!1,configurable:!0}),e.prototype.insertChart=function(e,t,a,r){if(void 0===r&&(r=null),this.parent._fireReadOnly())return!1;var n=this.presentation,i=this.transaction,o=this.coreSlt.getActiveSlide(),s=[o.getSpTree().getChildCount()],l=window.CoreExports.helper.getEditObjectPath(n,o);l.shapePath=s;var c={rect:e,chartType:t,style:a};if(r){var d=r.getShapeTree().getShapeIndex(r);c.bReplace=!0,c.phIndex=d,c.shapeId=r.getId(),l.shapePath=[d]}var p={cmdName:"insertChart",insertChart:c};return l.slideProps=p,this.coreSlt.startInsertChart(l),i.beginTransact(),l.genid&&i.setUserData("genid",l.genid),i.endTopTransact("shapeInsert",l),!0},e.prototype.checkChartShape=function(){var e=this.coreSlt.getActiveShapes();if(!e||e.length<=0)return console.warn("set chart data source, invalid shape"),null;if(e.length>1)return null;var t=e[0];return t.hasChart()?t:null},e.prototype.setDataSource=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart dataSource failed: in transaction..."),!1;var i=window.CoreExports.helper.getEditObjectPath(a,t);return i.chartData={dataSource:e},i.opt=n,r.beginTransact(),r.endTopTransact("woChart",i),!0},e.prototype.applyElement=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart element failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.opt=c,n.chartData={array:e},r.beginTransact(),r.endTopTransact("woChart",n),!0},e.prototype.applyLayout=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart layout failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.opt=o,n.chartData={layoutIdx:e},r.beginTransact(),r.endTopTransact("woChart",n),!0},e.prototype.setChartColor=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart color failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.chartData={colorIdx:e},n.opt=s,r.beginTransact(),r.endTopTransact("woChart",n),!0},e.prototype.setChartType=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart type failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.opt=i,n.chartData={type:e},r.beginTransact(),r.endTopTransact("woChart",n),!0},e.prototype.setChartStyle=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("modify chart style failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.opt=l,n.chartData={styleIdx:e},r.beginTransact(),r.endTopTransact("woChart",n),!0},e.prototype.setChartTitle=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart title failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.opt=d,n.chartData={text:e},r.beginTransact(),r.endTopTransact("woChart",n),!0},e.prototype.setAxisTitle=function(e){if(this.parent._fireReadOnly())return!1;var t=this.checkChartShape();if(!t)return!1;var a=this.presentation,r=this.transaction;if(r.isInTransaction())return console.error("set chart axis title failed: in transaction..."),!1;var n=window.CoreExports.helper.getEditObjectPath(a,t);return n.opt=p,n.chartData={array:e},r.beginTransact(),r.endTopTransact("woChart",n),!0},e}();t.ChartSelection=u},6133:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChartManager=void 0;var r=a(6134),n=function(){function e(e){this.pres=e}return e.prototype.queryData=function(e){var t=this.pres,a=t.session,r=window.CoreExports.helper;return new Promise((function(n,i){e&&e.hasChart()||i(!1);var o=r.getEditObjectPath(t,e);o.queryType="chartData",a.execSimpleQuery("chart.queryChart",o,(function(e){n(e)}))}))},e.prototype.queryEditReady=function(e){var t=this.pres,a=t.session,r=window.CoreExports.helper;return new Promise((function(n,i){e&&e.hasChart()||i(!1);var o=r.getEditObjectPath(t,e);o.queryType="editReady",a.execSimpleQuery("chart.queryChart",o,(function(e){n(e)}))}))},e.prototype.queryEditFinish=function(e){var t=this.pres,a=t.session,r=window.CoreExports.helper;return new Promise((function(n,i){e&&e.hasChart()||i(!1);var o=r.getEditObjectPath(t,e);o.queryType="editFinish",a.execSimpleQuery("chart.queryChart",o,(function(e){n(e)}))}))},e.prototype.presetColors=function(e){return r.ChartHelper.interpretChangeClr(e)},e}();t.ChartManager=n},6134:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChartHelper=void 0;var r=function(){function e(){}return e.interpretChangeClr=function(e){var t=[],a=[];if(!e)return t;for(var r=e.visual.getTheme(),n=e.visual.getColorScheme(),i=window.CoreExports.color,o=i.TransformOperation,s=i.interpretColorInner,l=window.CoreExports.utils.deepClone,c=0;c<6;++c){var d=r.getColorIndex(4+c),p=s(l(r.getColorAt(d)),n).hex;a.push(p)}t.push(a),a=[];for(c=0;c<6;c+=2){var u=r.getColorIndex(4+c);p=s(l(r.getColorAt(u)),n).hex;a.push(p)}for(c=0;c<6;c+=2){var h=r.getColorIndex(4+c),f=l(r.getColorAt(h));f.transOp=[{op:o.LuminanceModulation,val:.6}];p=s(f,n).hex;a.push(p)}t.push(a),a=[];for(c=1;c<=6;c+=2){var m=r.getColorIndex(4+c);p=s(l(r.getColorAt(m)),n).hex;a.push(p)}for(c=1;c<=6;c+=2){var v=r.getColorIndex(4+c),g=l(r.getColorAt(v));g.transOp=[{op:o.LuminanceModulation,val:.6}];p=s(g,n).hex;a.push(p)}t.push(a),a=[];for(c=0;c<3;++c){var y=r.getColorIndex(9-c);p=s(l(r.getColorAt(y)),n).hex;a.push(p)}for(c=0;c<3;++c){var T=r.getColorIndex(9-c),C=l(r.getColorAt(T));C.transOp=[{op:o.LuminanceModulation,val:.6}];p=s(C,n).hex;a.push(p)}t.push(a),a=[];for(c=0;c<6;++c){var _=r.getColorIndex(4+c),b=l(r.getColorAt(_));b.transOp=[{op:o.Shade,val:.5}];var S=s(b,n);S&&a.push(S.hex),(b=l(r.getColorAt(_))).transOp=[{op:o.Shade,val:.7}],(S=s(b,n))&&a.push(S.hex),(b=l(r.getColorAt(_))).transOp=[{op:o.Shade,val:.9}],(S=s(b,n))&&a.push(S.hex),(b=l(r.getColorAt(_))).transOp=[{op:o.Tint,val:.9}],(S=s(b,n))&&a.push(S.hex),(b=l(r.getColorAt(_))).transOp=[{op:o.Tint,val:.7}],(S=s(b,n))&&a.push(S.hex),(b=l(r.getColorAt(_))).transOp=[{op:o.Tint,val:.5}],(S=s(b,n))&&a.push(S.hex),t.push(a),a=[]}a=[];var k=r.getColorIndex(0),P=l(r.getColorAt(k));P.transOp=[{op:o.Tint,val:.885}];var w=s(P,n);w&&a.push(w.hex),(P=l(r.getColorAt(k))).transOp=[{op:o.Tint,val:.55}],(w=s(P,n))&&a.push(w.hex),(P=l(r.getColorAt(k))).transOp=[{op:o.Tint,val:.75}],(w=s(P,n))&&a.push(w.hex),(P=l(r.getColorAt(k))).transOp=[{op:o.Tint,val:.985}],(w=s(P,n))&&a.push(w.hex),(P=l(r.getColorAt(k))).transOp=[{op:o.Tint,val:.3}],(w=s(P,n))&&a.push(w.hex),(P=l(r.getColorAt(k))).transOp=[{op:o.Tint,val:.6}],(w=s(P,n))&&a.push(w.hex),t.push(a),a=[];for(c=4;c<10;c++){for(var x=5;x>=0;x--)a.push(t[c][x]);t.push(a),a=[]}return t},e}();t.ChartHelper=r}}]);