(window.webpackJsonp=window.webpackJsonp||[]).push([[328],{6211:function(e,t,n){"use strict";n.r(t);var a=n(147),i=n.n(a),s=n(0),o=n.n(s),l=n(3),c=n.n(l),r=n(25),u=n.n(r),d=n(42),p=n.n(d),h=n(142),m=n.n(h),S=n(145),f=n(151),v=n.n(f),w=n(146),y=n(162),_=n(148),g=n(6212),b=n.n(g),E=window.__WPSPLUGIN__,O=E.helper,F=E.loader,C=O.has(O.types.FileStatusInfo),k=function(e){function t(e){o()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={status:b.a.autoSave,visible:!1},n.disconnectBeforeStatus=b.a.autoSave,n.isInited=!1,n.saveTimer=null,n.refFileStatus=m.a.createRef(),n.handleDocumentSaving=n.handleDocumentSaving.bind(n),n.handleDocumentSaveSuccess=n.handleDocumentSaveSuccess.bind(n),n.handleSaveVersion=n.handleSaveVersion.bind(n),n.handleClick=n.handleClick.bind(n),n.refreshCallback=null,n}var n;return p()(t,e),c()(t,[{key:"componentDidMount",value:function(){window.addEventListener(w.default.names.cooper.ON_DOCUMENT_SAVEING,this.handleDocumentSaving),window.addEventListener(w.default.names.cooper.ON_DOCUMENT_SAVE_SUCCESS,this.handleDocumentSaveSuccess),window.addEventListener(w.default.names.file.ON_SAVE_VERSION,this.handleSaveVersion),C&&this.props.isAppReady&&this._initPlugin()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),clearTimeout(this.saveTimer),window.removeEventListener(w.default.names.cooper.ON_DOCUMENT_SAVEING,this.handleDocumentSaving),window.removeEventListener(w.default.names.cooper.ON_DOCUMENT_SAVE_SUCCESS,this.handleDocumentSaveSuccess),window.removeEventListener(w.default.names.file.ON_SAVE_VERSION,this.handleSaveVersion)}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,a=n.connected,i=n.isAppReady;if(C&&!e.isAppReady&&i&&this._initPlugin(),a&&!e.connected)return clearTimeout(this.timer),void this._setStatus(this.disconnectBeforeStatus);!a&&e.connected&&(this.disconnectBeforeStatus=this.state.status,this._setStatus(b.a.disconnect),this.popToast())}},{key:"_initPlugin",value:(n=i()(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInited){e.next=2;break}return e.abrupt("return");case 2:return this.isInited=!0,e.next=5,F.loadSingleInstance({pluginType:O.types.FileStatusInfo});case 5:this._pluginInstance=e.sent,this._pluginInstance.init({container:this.refFileStatus.current,onChange:function(e){t.refreshCallback=function(t){e(t)},e(t.state.status)},onlyShowText:window.officeType===y.default.pdf,whiteBg:this.props.whiteBg,showPanel:this.handleClick,readonly:this.props.readonly,readOnlyComment:window.APP.isReadOnlyComment()});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"popToast",value:function(){S.isSupportOfflineEditing&&(clearTimeout(this.timer),this.timer=setTimeout((function(){window.Toast.warn(_i18n("applications.public.components.commandbars.Header.HeaderLeft.FileInfo.FileStatus.offlineTips", "与服务器断开，正在重新连接…"))}),6e3))}},{key:"handleDocumentSaving",value:function(){clearTimeout(this.saveTimer),this.handleSetStatus(b.a.saving)}},{key:"handleDocumentSaveSuccess",value:function(){var e=this;clearTimeout(this.saveTimer),this.saveTimer=setTimeout((function(){e.handleSetStatus(b.a.saveSuccess)}),500)}},{key:"handleSaveVersion",value:function(e){"ok"===e.detail.result?this.handleSetStatus(b.a.saveVSSuccess):e.detail.error&&this.handleSetStatus(b.a.saveVSFail)}},{key:"handleSetStatus",value:function(e){this.props.connected?this._setStatus(e):this.disconnectBeforeStatus=e}},{key:"_setStatus",value:function(e){this.setState({status:e}),this.refreshCallback&&this.refreshCallback(e)}},{key:"handleClick",value:function(){!this.props.readonly&&S.getPageOfficeType()!==y.default.pdf&&window.__CONFIG__.isShowHistoryRecord&&w.default.dispatchEvent(w.default.names.cooper.ON_COOPER_VISIBLE_CHANGE)}},{key:"renderStatusEl",value:function(e){var t=e.title||e.text;return m.a.createElement(v.a,{title:t},m.a.createElement("span",{className:"status-text"},e.text))}},{key:"getReadOnlyStatus",value:function(){return this.readOnlyStatus?this.readOnlyStatus:this.readOnlyStatus=window.APP.isReadOnlyComment()?b.a.readOnlyComment:b.a.readOnly}},{key:"render",value:function(){if(C)return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{ref:this.refFileStatus,className:"file-status"}),m.a.createElement("div",{id:"file-status-other-tips"}));var e=this.props,t=e.readonly,n=e.isAppReady,a=this.state.status,i="status-wrap";if(t&&!n)return null;t&&(a=this.getReadOnlyStatus(),i+=" is-read-only"),!this.props.readonly&&S.getPageOfficeType()!==y.default.pdf&&window.__CONFIG__.isShowHistoryRecord||(i+=" disable");var s=this.renderStatusEl(a);return m.a.createElement("div",{className:"file-status"},m.a.createElement("div",{className:i,onClick:this.handleClick},!!a.icon&&m.a.createElement(_.default,{type:"16 "+a.icon+" 1"}),s),m.a.createElement("div",{id:"file-status-other-tips"}))}}]),t}(h.PureComponent);t.default=k},6212:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0});var i=(0,n(143).__importDefault)(n(162)),s="readOnly",o="readOnlyComment",l="autoSave",c="disconnect",r="saving",u="saveSuccess",d="saveVSSuccess",p="saveVSFail",h=function(e,t,n,a){void 0===n&&(n="save_success"),void 0===a&&(a=""),this.type=e,this.icon=n,this.text=t,this.title=a},m=window.officeType===i.default.whiteboard;t.default=((a={})[s]=new h(s,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.readonly", "只读"),""),a[o]=new h(o,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.readonlyComment", "可评论"),""),a[l]=new h(l,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.autoSave", "自动保存所有内容")),a[c]=new h(c,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.disconnect", "重连中..."),"disconnect",_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.disconnectTip", "与服务器断开链接，正在重连")),a[r]=new h(r,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saving", "正在保存到云端..."),"saving"),a[u]=new h(u,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveSuccess", "已自动保存到云端")),a[p]=new h(p,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveFail", "内容保存失败"),"save_fail"),a[d]=new h(d,m?_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveSuccess", "已自动保存到云端"):_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveVSSuccess", "版本保存成功")),a)}}]);