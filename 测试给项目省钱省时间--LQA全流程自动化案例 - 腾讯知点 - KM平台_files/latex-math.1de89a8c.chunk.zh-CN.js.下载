(window.webpackJsonp=window.webpackJsonp||[]).push([[365],{2857:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(143),i=(0,a.__importStar)(n(142)),u=n(2858),r=(0,a.__importDefault)(n(205)),o=(0,a.__importDefault)(n(4147)),c=(0,a.__importDefault)(n(164)),l=n(568);t.default=function(e){var t=(0,i.useState)(!1),n=t[0],s=t[1],f=(0,i.useState)(""),d=f[0],p=f[1],m=(0,i.useState)(!1),k=m[0],g=m[1],b=k||e.visible;return(0,i.useEffect)((function(){e.readOnly||(0,u.getBackupData)(e.userId).then((function(e){s(!0)})).catch((function(e){s(!1)})),(0,l.getUrlByPlugin)(l.linkTypes.AboutLaTeX).then((function(e){e&&p(e)}))}),[]),n&&!e.disableBackup?i.default.createElement(r.default,{onOk:function(){g(!0),s(!1)},onCancel:function(){(0,u.deleteBackupData)(),s(!1)},drag:!1},i.default.createElement("div",null,_i18n("applications.public.latexMath.errorNoticeOfLateX", "检测到你编辑的公式异常退出，是否要恢复数据？"))):b?(0,c.default)(o.default,(0,a.__assign)((0,a.__assign)({},e),{onCancel:function(){e.onCancel(),g(!1)},onCommit:function(t){e.onCommit(t),g(!1)},documentationLink:d})):null}},2858:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBackupUnexpired=t.storeBackupData=t.deleteBackupData=t.getBackupData=t.getBackupKey=void 0;var a,i=(0,n(143).__importDefault)(n(576));function u(){var e=window.fileInfo,t=e.office_type,n=e.id,a="lateXbc-".concat(t,"-").concat(n);return{dataKey:a,timeKey:"time-"+a}}function r(){var e=i.default.getInstance(),t=u(),n=t.dataKey,a=t.timeKey;e.delete(n),e.delete(a)}function o(){var e=i.default.getInstance(),t=u().timeKey;return new Promise((function(n,i){e.read(t,(function(e,t){if(e)i(e);else{var u=parseInt(window.localStorage.getItem("LateXBackupExistenceTime"),10)||86400;Date.now()-t<=1e3*u?n(a.AVAILABLE):(r(),i(a.EXPIRED))}}))}))}!function(e){e.EXPIRED="lateX backup expired",e.AVAILABLE="available"}(a||(a={})),t.getBackupKey=u,t.getBackupData=function(e){var t=u().dataKey,n=i.default.getInstance();return o().then((function(){return new Promise((function(a,i){n.read(t,(function(t,n){if(!t){var u=JSON.parse(n);u.userId!==e?(r(),i()):a(u)}i(t)}))}))}))},t.deleteBackupData=r,t.storeBackupData=function(e,t,n){var a=i.default.getInstance(),r=u(),o=r.dataKey,c=r.timeKey;a.write(o,JSON.stringify({userId:t,data:e,positionInfo:n})),a.write(c,Date.now())},t.isBackupUnexpired=o},4147:function(e,t,n){e.exports=function(e,t){n.e(366).then(n.t.bind(null,4638,7)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},568:function(e,t,n){"use strict";n.r(t),n.d(t,"linkTypes",(function(){return r})),n.d(t,"getUrlByPlugin",(function(){return o}));var a=n(147),i=n.n(a),u=n(331),r={RangePermission:"RangePermission",Calculate:"Calculate",CellHistory:"CellHistory",AboutWps:"AboutWps",CellPicture:"CellPicture",AboutLaTeX:"AboutLaTeX",AboutFileSlim:"AboutFileSlim",FeedbackForm:"FeedbackForm",UncertainSubtotal:"UncertainSubtotal",RecordPermission:"RecordPermission"},o=function(e){return new Promise((t=i()(regeneratorRuntime.mark((function t(n){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!u.default.has(u.default.types.Links)){t.next=6;break}return t.next=3,u.default.exec(u.default.types.Links,{type:e});case 3:return a=t.sent,n(a),t.abrupt("return");case 6:n(null);case 7:case"end":return t.stop()}}),t,void 0)}))),function(e){return t.apply(this,arguments)}));var t}}}]);