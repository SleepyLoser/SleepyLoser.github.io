(window.webpackJsonp=window.webpackJsonp||[]).push([[327],{8193:function(e,t,n){"use strict";n.r(t);var r=n(147),i=n.n(r),a=n(0),s=n.n(a),o=n(3),c=n.n(o),u=n(25),l=n.n(u),p=n(42),d=n.n(p),f=n(142),h=n.n(f),g=n(327),m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n={fileids:[e]};return{types:g.default.HTTP_TYPES,callAPI:function(e){return e.get("/api/kdocs/tags/"+t+"/files").query(n).end()}}},v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"file",i={tagid:n,fileid:e,groupid:t,source:r};return{types:g.default.HTTP_TYPES,callAPI:function(e){return e.post("/api/kdocs/tags/"+n+"/items").send(i).end()}}},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{types:g.default.HTTP_TYPES,callAPI:function(n){return n.del("/api/kdocs/tags/"+t+"/files/"+e).end()}}},w=n(151),b=n.n(w),T=function(e){function t(e){s()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.loading=!0,n.refDiv=h.a.createRef(),n.handleClick=n.handleClick.bind(n);var r=e.file;return n.state={isTag:null,groupid:r.group_id,fileid:r.id},n}var n,r,a,o;return d()(t,e),c()(t,[{key:"checkStar",value:(o=i()(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.fileid,e.next=3,this.props.dispatch(m(t));case 3:return n=e.sent,this.loading=!1,r=!1,n.error||(i=n.response.body.item_map)[t]&&i[t].some((function(e){return"star"===e.tag.name}))&&(r=!0),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"componentDidMount",value:(a=i()(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.__WPSENV__.commandbars.push({el:this.refDiv,text:_i18n("applications.public.components.commandbars.Header.FileInfo.FileTag.addStar", "星标")}),!this.props.visible){e.next=6;break}return e.next=4,this.checkStar();case 4:t=e.sent,this.setState({isTag:t});case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"componentDidUpdate",value:(r=i()(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.visible||t.visible){e.next=5;break}return e.next=3,this.checkStar();case 3:r=e.sent,this.setState({isTag:r});case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"handleClick",value:(n=i()(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:return this.loading=!0,t=this.props.dispatch,n=this.state,r=n.groupid,i=n.fileid,e.next=7,this.checkStar();case 7:if(a=e.sent,s=null,!a){e.next=15;break}return e.next=12,t(k(i));case 12:s=e.sent,e.next=18;break;case 15:return e.next=17,t(v(i,r));case 17:s=e.sent;case 18:s.error||this.setState({isTag:!a}),this.loading=!1,window.collection2("filestar_"+!a),window.collectionOnce();case 22:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this.props.visible,t=this.state.isTag,n=t?_i18n("applications.public.components.commandbars.Header.FileInfo.FileTag.cancelStar", "取消星标"):_i18n("applications.public.components.commandbars.Header.FileInfo.FileTag.addStar", "星标"),r="file-star";return e&&null!==t||(r+=" visibility0"),h.a.createElement(b.a,{title:n},h.a.createElement("div",{ref:this.refDiv,className:r,onClick:this.handleClick},h.a.createElement("div",{className:"star-icon "+(t?" selected":"")})))}}]),t}(f.PureComponent);t.default=T}}]);