(window.webpackJsonp=window.webpackJsonp||[]).push([[364],{3166:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=n(147),a=(r=i)&&r.__esModule?r:{default:r};t.default=(o=(0,a.default)(regeneratorRuntime.mark((function e(t){var n,r,o=t.method,i=t.responseType,a=t.requestType,u=t.url,s=t.formData,c=t.timeout;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new XMLHttpRequest).open(o,u),n.responseType=i,a&&n.setRequestHeader("content-type",a),n.timeout=c,r=new Promise((function(e,t){n.onload=function(t){e(t.currentTarget.response)},n.onerror=function(e){t(e)},n.ontimeout=function(e){t(e)}})),n.send(s),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,void 0)}))),function(e){return o.apply(this,arguments)})},4329:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(3),a=n.n(i),u=n(292),s=(n(3166),n(145)),c=n(144),f="pc",l="x",d="m",p="ipad",v=function(){function e(t){var n=this;o()(this,e),this.uploadIfNeed=function(){n.getConfig().then((function(e){var t=e.enable,r=e.interval;t&&(n.upload(),setInterval((function(){n.upload()}),1e3*r))})).catch((function(e){console.error("上报失败，无法获取配置",e)}))},this.upload=function(){if(!0===n.isUploading)return!1;var e=n.getData(),t=e.data,r=e.storeKeys;if(null===t)return!1;n.isUploading=!0;var o={office_type:s.getPageOfficeType(),version:window.__WPSENV__&&window.__WPSENV__.file_version?window.__WPSENV__.file_version:"20200101000000-0000000000"},i=f;c.isInMiniProgram?i=l:c.isMobile?i=d:c.isPad&&(i=p),o.device=i,o.data=t;var a=JSON.stringify(o);window.__WPSENV__.callAPI({method:"post",url:"/api/v3/office/jsmetric",body:a}).then((function(e){"ok"===e.body.result&&(r.forEach((function(e){n.storage.removeItem(e)})),n.storage.removeItem(u.reportIndexKey)),n.isUploading=!1})).catch((function(){console.error("数据上报失败，请稍后再试"),n.isUploading=!1}))},this.getData=function(){var e=n.getIndexCollection();if(!Array.isArray(e)||0===e.length)return{data:null};var t=[],r=[];e.forEach((function(e){var o=u.reportPrefix+"-"+e;r.push(o);var i=n.storage.getItem(o);t=t.concat(JSON.parse(i))}));var o={};return Object.values(u.TYPE).forEach((function(e){o[e]=[]})),t.forEach((function(e){var t=e.type,n=e.event,r=e.value;o[t].push({event:n,value:r})})),{data:o,storeKeys:r}},this.storage=t,this.isUploading=!1,this.uploadIfNeed()}return a()(e,[{key:"getIndexCollection",value:function(){var e=this.storage.getItem(u.reportIndexKey);return e&&Array.isArray(JSON.parse(e))?JSON.parse(e):[]}},{key:"getConfig",value:function(){return new Promise((function(e,t){window.__WPSENV__.callAPI({method:"get",url:"/api/v3/office/jsmetric/config"}).then((function(t){e(t.body)})).catch((function(e){console.error("获取配置信息失败",e),t(e)}))}))}}]),e}();t.default=v}}]);