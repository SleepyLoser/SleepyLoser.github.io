(window.webpackJsonp=window.webpackJsonp||[]).push([[326],{1164:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=n(142),p=n.n(d),h=n(160),f=n.n(h),m=n(205),v=n(348),w=n(145),b=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.state={showModal:!1},i.timer=null,i.holdingTime=350,i.lastTime=0,i.handleMouseDown=function(e){clearTimeout(i.timer),i.lastTime=performance.now(),i.timer=setTimeout((function(){i.setState({showModal:!0})}),i.holdingTime)},i.handleMouseUp=function(e){performance.now()-i.lastTime<i.holdingTime?(clearTimeout(i.timer),i.timer=null):Object(w.stopBubble)(e)},i.handleModalClose=function(){i.setState({showModal:!1})},i.handleModalOk=function(){i.setState({showModal:!1});var e=window.__WPSENV__||{},t={userAgent:window.navigator.userAgent,fileInfo:e.file_info,fileVersion:e.file_version,error:window.errorRecords};console.error("要复制的错误信息：",t),Object(v.copyToClipboard)(JSON.stringify(t))},o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){f.a.findDOMNode(this).addEventListener("mousedown",this.handleMouseDown,!0),f.a.findDOMNode(this).addEventListener("mouseup",this.handleMouseUp,!0)}},{key:"componentWillUnmount",value:function(){f.a.findDOMNode(this).removeEventListener("mousedown",this.handleMouseDown,!0),f.a.findDOMNode(this).removeEventListener("mouseup",this.handleMouseUp,!0),clearTimeout(this.timer)}},{key:"render",value:function(){var e=this.props.children,t=this.state.showModal;return p.a.createElement(p.a.Fragment,null,e,t&&p.a.createElement(m.default,{onCancel:this.handleModalClose,onOk:this.handleModalOk},_i18n("applications.public.components.other.CopyError.ok", "点击确定，复制工作环境日志信息。")))}}]),t}(d.PureComponent);t.a=b},1302:function(e,t,n){"use strict";t.a={pc:{wechatTips:"wechat-tips",summaryConstruct:"summary_construct",webMode:"web_mode",inviteCooper:"invite_cooper"},pcClick:{summaryGuideAssist:"frontend_summary_guide_assist"},mobile:{},mobileClick:{guideCard:"frontend_guide-card"}}},166:function(e,t,n){"use strict";n.r(t);var i=n(26),a=n.n(i),o=n(0),r=n.n(o),s=n(3),l=n.n(s),c=n(25),u=n.n(c),d=n(42),p=n.n(d),h=(n(259),n(142)),f=n.n(h),m=n(160),v=n.n(m),w=n(144),b=n(146),g=n(191),y=n(229),_=n(182),C=n(283),E={click:"click",hover:"hover"},k=function(e){function t(e){r()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.btnDom=null,n.delayCloseTimer=null,n.checkMouseEvent=function(){return n.props.trigger===E.hover&&!w.isTouchScreen},n.refDropDown=f.a.createRef(),n.handleMouseEnter=n.handleMouseEnter.bind(n),n.handleMouseLeave=n.handleMouseLeave.bind(n),n.handleClick=n.handleClick.bind(n),n.handleContentClose=n.handleContentClose.bind(n),n.handleContentMouseEnter=n.handleContentMouseEnter.bind(n),n.handleContentMouseLeave=n.handleContentMouseLeave.bind(n),n}return p()(t,e),l()(t,[{key:"componentDidMount",value:function(){this.initBtnDOM(),this.props.visible&&this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.clearDelayClose()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,i=n.visible,a=n.destroyOnHide;!i&&e.visible&&!a&&void 0!==a&&this.refDropDown.current&&(1===this.refDropDown.current.getLevel()&&b.default.dispatchEvent(b.default.names.CLOSE_DROPDOWN_PANEL,{isCloseSub:!0}))}},{key:"initBtnDOM",value:function(){var e=this.props.getElement;this.btnDom=e?e():null,this.btnDom=this.btnDom||v.a.findDOMNode(this)}},{key:"getRect",value:function(){if(!this.btnDom)return null;var e=this.props.offsetX,t=this.btnDom.getBoundingClientRect(),n={bottom:t.bottom,height:t.height,left:t.left,right:t.right,top:t.top,width:t.width};return e&&(n.left-=e,n.right+=e,n.width+=2*e),n}},{key:"handleTrigger",value:function(e){this.clearDelayClose(),e&&this.initBtnDOM(),this.props.onVisibleChange(e)}},{key:"handleClick",value:function(e){var t=this.props,n=t.visible,i=t.onClick,a=t.trigger;i?i(e):a===E.hover&&!w.isTouchScreen&&(e.clientX>0||e.clientY>0)||this.handleTrigger(!n)}},{key:"startDelayClose",value:function(){var e=this;this.clearDelayClose(),this.delayCloseTimer=setTimeout((function(){e.props.onVisibleChange(!1)}),200)}},{key:"clearDelayClose",value:function(){clearTimeout(this.delayCloseTimer)}},{key:"handleMouseEnter",value:function(){var e=this.props,t=e.visible,n=e.onMouseEnter;this.checkMouseEvent()&&(this.clearDelayClose(),t||this.handleTrigger(!0)),n&&n()}},{key:"handleMouseLeave",value:function(e){this.props.visible&&this.checkMouseEvent()&&this.startDelayClose(),this.props.onMouseLeaveDropBtn&&this.props.onMouseLeaveDropBtn()}},{key:"handleContentMouseEnter",value:function(){this.checkMouseEvent()&&this.clearDelayClose()}},{key:"handleContentMouseLeave",value:function(e){if(!this.props.disableContentMouseLeave&&this.checkMouseEvent()){var t=document.getElementsByClassName("wowui-tooltip-content")[0]||document.getElementsByClassName("component-tooltip-content")[0];if(t){var n=t.getBoundingClientRect(),i=n.left,a=n.right,o=n.top,r=n.bottom,s=e.pageX,l=e.pageY;if(s>=i&&s<=a&&l>=o&&l<=r)return}b.default.dispatchEvent(b.default.names.DROPDOWN_BTN_CONTENT_MOUSE_LEAVE,e),this.startDelayClose()}}},{key:"handleContentClose",value:function(){this.clearDelayClose(),this.props.onVisibleChange(!1)}},{key:"renderContent",value:function(){var e=this.getRect(),t=this.props,n=t.isSetHeight,i=t.panel,a=t.visible,o=t.placement,r=t.distance,s=t.panelClass,l=t.isAuto,c=t.offsetX;return f.a.createElement(y.default,{ref:this.refDropDown,isAuto:l,className:s,triggerElement:this.btnDom,rect:e,offsetX:c,visible:a,placement:o,distance:r,isSetHeight:n,onClose:this.handleContentClose,onMouseEnter:this.handleContentMouseEnter,onMouseLeave:this.handleContentMouseLeave},i)}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.children,i=e.visible,a=e.destroyOnHide;t=t||n.props.disabled;var o=this.getRect();if(!t){var r=n.props.title;r&&i&&(r=null),n=f.a.cloneElement(n,{title:r,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick})}return f.a.createElement(f.a.Fragment,null,n,!!o&&f.a.createElement(g.default,{visible:i,destroyOnHide:a},this.renderContent()))}}]),t}(h.PureComponent);k.placementTypes=y.default.placementTypes,k.DropdownPanel=_.default,k.triggerTypes=E,k.defaultProps={visible:!1,trigger:E.click,distance:4,offsetX:0},t.default=k;var O=function(e){function t(){return r()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),l()(t,[{key:"componentDidMount",value:function(){var e=this.props.commandBarId;window.__WPSENV__.reduxDispatch(Object(C.altLazyLoad)({id:e}))}},{key:"render",value:function(){return f.a.createElement(_.default,a()({},this.props,{ref:this.forwardRef}),this.props.children)}}]),t}(h.PureComponent);O.Item=_.default.Item,O.Divider=_.default.Divider,k.AltDropdownPanel=O},172:function(e,t,n){"use strict";n.r(t);var i=n(44),a=n.n(i),o=n(0),r=n.n(o),s=n(3),l=n.n(s),c=n(25),u=n.n(c),d=n(42),p=n.n(d),h=n(142),f=n.n(h),m=n(145),v=n(151),w=n.n(v),b=function(e){function t(e){r()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.refDiv=f.a.createRef(),n.handleClick=n.handleClick.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n}return p()(t,e),l()(t,[{key:"handleClick",value:function(e){this.props.onClick&&this.props.onClick(this.props.value,e)}},{key:"handleMouseMove",value:function(){for(var e=this.refDiv.current,t=e.parentNode.getElementsByClassName("hover"),n=0;n<t.length;n++){var i=t[n];if(i!==e){i.classList.remove("hover");break}}e.classList.add("hover")}},{key:"handleMouseOut",value:function(e){Object(m.isMouseInElement)(e,this.refDiv.current)||this.refDiv.current.classList.remove("hover")}},{key:"getClassName",value:function(){var e=this.props,t=e.selected,n=e.disabled,i=e.disabledTag,o=e.children,r=e.className,s="component-menu-item",l=this.refDiv.current;l&&-1!==l.className.indexOf(" hover")&&(s+=" hover"),t&&(s+=" selected"),n&&(s+=" disabled"),i&&(s+=" disabled-tag"),r&&(s+=" "+r);var c=void 0===o?"undefined":a()(o);return"string"!==c&&"number"!==c||(s+=" only-text"),r&&(s+=" "+r),s}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.children,i=e.keepEdit,a=e.dataKey,o=e.title,r=e.draggable,s=e.onDragStart,l=e.onDragEnd,c=this.getClassName();return f.a.createElement(w.a,{title:o},f.a.createElement("div",{ref:this.refDiv,id:t,className:c,"data-keep-edit":i||void 0,"data-key":a||void 0,draggable:r,onClick:this.handleClick,onMouseMove:this.handleMouseMove,onMouseOut:this.handleMouseOut,onDragStart:s,onDragEnd:l},n))}}]),t}(h.PureComponent);t.default=b},174:function(e,t,n){var i;!function(){"use strict";var n={}.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)){if(i.length){var r=a.apply(null,i);r&&e.push(r)}}else if("object"===o)if(i.toString===Object.prototype.toString)for(var s in i)n.call(i,s)&&i[s]&&e.push(s);else e.push(i.toString())}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(i=function(){return a}.apply(t,[]))||(e.exports=i)}()},1750:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(1751),n(142)),p=n.n(d),h=n(1164),f=n(151),m=n.n(f),v=n(162),w=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.getProductIcon=function(){if(window.__CONFIG__&&window.__CONFIG__.header.productIcons){var e=window.officeType,t=window.__CONFIG__.header.productIcons,n=t.w,i=t.p,a=t.s,o=t.f,r=t.b;switch(e){case v.default.spreadsheet:return a||r;case v.default.writer:return n||r;case v.default.presentation:return i||r;case v.default.pdf:return o||r;default:return r}}},o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"getOfficeType",value:function(){return this.props.officeType||window.officeType}},{key:"getClassName",value:function(){var e="component-logo";return this.props.hoverSwitch&&(e+=" hover-switch"),e}},{key:"render",value:function(){var e=this.getProductIcon(),t=this.props,n=t.title,i=t.onClick,a=this.getOfficeType(),o=this.getClassName();return p.a.createElement(h.a,null,p.a.createElement(m.a,{title:n},p.a.createElement("div",{className:o},e?p.a.createElement("img",{style:{height:"24px",width:"24px"},src:e,alt:"productIcon"}):p.a.createElement("div",{className:"logo-icon "+a,onClick:i}))))}}]),t}(d.PureComponent);t.a=w},1751:function(e,t,n){},1752:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var i=n(147),a=n.n(i),o=n(0),r=n.n(o),s=n(3),l=n.n(s),c=n(25),u=n.n(c),d=n(42),p=n.n(d),h=n(142),f=n.n(h),m=n(276),v=n(146),w=n(144),b=n(145),g={groupNotExist:_i18n("applications.public.helpers.saveDocVersion.groupNotExist", "团队不存在"),permissionDenied:_i18n("applications.public.helpers.saveDocVersion.permissionDenied", "权限不足"),userNotLogin:_i18n("applications.public.helpers.saveDocVersion.userNotLogin", "用户未登录"),ServerError:_i18n("applications.public.helpers.saveDocVersion.ServerError", "服务器出错"),SessionIDNotExist:_i18n("applications.public.helpers.saveDocVersion.SessionIDNotExist", "会话不存在"),fileNameLengthExceed:_i18n("applications.public.helpers.saveDocVersion.fileNameLengthExceed", "文件名长度超出限制"),illegalFname:_i18n("applications.public.helpers.saveDocVersion.illegalFname", "非法文件名"),Unknown:_i18n("applications.public.helpers.saveDocVersion.Unknown", "未知错误"),InvalidArgument:_i18n("applications.public.helpers.saveDocVersion.InvalidArgument", "无效参数"),Canceled:_i18n("applications.public.helpers.saveDocVersion.Canceled", "已取消"),fileNotExists:_i18n("applications.public.helpers.saveDocVersion.fileNotExists", "文件不存在"),fileNotUploaded:_i18n("applications.public.helpers.saveDocVersion.fileNotUploaded", "文件未上传"),InternalError:_i18n("applications.public.helpers.saveDocVersion.InternalError", "内部错误")},y=function(e,t){return function(n){function i(){var n,o,s,l,c=this;r()(this,i);for(var d=arguments.length,p=Array(d),h=0;h<d;h++)p[h]=arguments[h];return o=s=u()(this,(n=i.__proto__||Object.getPrototypeOf(i)).call.apply(n,[this].concat(p))),s.isSaveFail=!1,s.handleAutoSave=function(e){e.error&&!s.isSaveFail&&s.handleSaveResult({error:!0}),!e.error&&s.isSaveFail&&s.handleSaveResult(e)},s.timer=null,s.showTimestamp=0,s.showLong=6,s.loading=!1,s.handleSave=function(t){t.detail.triggerSave&&(s.loading||(s.props.connected?(s.isSaveFail&&window.Notice.close(),s.loading=!0,!w.isMobile&&window.__WPSENV__.draft||window.Toast.success(_i18n("applications.public.helpers.saveDocVersion.saving", "正在保存"),void 0,0,void 0,"16 loading"),window.RPCClient.saveVersion(!0,s.handleSaveResult)):window.Toast.error(e.fail)))},s.handleSaveResult=function(n){s.loading=!1;var i=n.error?n.reason:n.result;if(v.default.dispatchEvent(v.default.names.file.ON_SAVE_VERSION,{result:i,size:n.size,error:n.error}),window.collection2("versionnotice_"+i),w.isMobile||!window.__WPSENV__.draft)if(window.Toast.close(),(w.isMobile||s.isSaveFail)&&window.Notice.close(),s.isSaveFail=!1,"ok"!==i){var a=e[i];if(a)window.Toast.warn(a);else{s.isSaveFail=!0;var o={icon:t,content:s.renderFail(n)};!w.isMobile&&(o.top=144),window.Notice.show(o)}}else{var r=w.isMobile?e.ok:s.renderSaveHistoryLink();window.Toast.success(r)}},s.handleRetry=function(){s.loading||(s.loading=!0,window.Notice.close(),window.Toast.success(_i18n("applications.public.helpers.saveDocVersion.saving", "正在保存"),void 0,0,void 0,"16 loading"),window.RPCClient.saveVersion(!0,s.handleSaveResult))},s.handleDetailsClick=a()(regeneratorRuntime.mark((function e(){var t,n,i,a,o,r,l,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.props.dispatch(Object(m.loadFileInfo)(window.urlFileId));case 2:t=window.location,n=t.origin,i=t.pathname,a=t.search,o=window.fileInfo,r=o.version,l=o.history_id,u=""+n+i,d=(d=a.substr(1).split("&").filter((function(e){return e}))).filter((function(e){return!/^version=/i.test(e)&&!/^history_id=/i.test(e)})),null!==r&&d.push("version="+r),null!==l&&d.push("history_id="+l),d.length&&(u+="?"+d.join("&")),window.open(u),window.collectionOnce(),window.collection("revisions_detailview");case 13:case"end":return e.stop()}}),e,c)}))),s.renderSaveHistoryLink=function(){if(e.ok.indexOf("{historyLink}")>=0){var t=e.ok.split(/[{}]/).map((function(e){return"historyLink"===e?f.a.createElement("a",{onClick:s.handleDetailsClick,className:"save-version-history-link"},_i18n("applications.public.helpers.saveDocVersion.enterHistoryLink", "历史版本")):e}));return f.a.createElement("span",null,t)}return e.ok},l=o,u()(s,l)}return p()(i,n),l()(i,[{key:"componentDidMount",value:function(){window.RPCClient.on("file.autosave",this.handleAutoSave),window.addEventListener(v.default.names.file.ON_SAVE_VERSION,this.handleSave)}},{key:"componentWillUnmount",value:function(){window.RPCClient.off("file.autosave",this.handleAutoSave),window.removeEventListener(v.default.names.file.ON_SAVE_VERSION,this.handleSave),w.isMobile&&this.stopTimer()}},{key:"componentDidUpdate",value:function(e){var t=this.props.connected,n=e.connected;w.isMobile?b.isSupportOfflineEditing&&n!==t&&(t?(this.stopTimer(),this.isSaveFail&&v.default.dispatchEvent(v.default.names.file.ON_SAVE_VERSION,{triggerSave:!0})):this.startTimer()):t!==n&&t&&this.isSaveFail&&v.default.dispatchEvent(v.default.names.file.ON_SAVE_VERSION,{triggerSave:!0})}},{key:"startTimer",value:function(){var e=this;this.timer=setTimeout((function(){e.showTimestamp=window.performance.now(),window.Toast.error(_i18n("applications.public.helpers.saveDocVersion.disconnectTips", "与服务器断开，正在重新连接…"),null,e.showLong)}),6e3)}},{key:"stopTimer",value:function(){clearTimeout(this.timer),window.performance.now()-this.showTimestamp<1e3*this.showLong&&window.Toast.close(),this.showTimestamp=0}},{key:"renderFail",value:function(e){var t=window.__CONFIG__.isShowErrorCode&&e.errno,n=void 0;if(e.message)n=e.message;else if(e.reason){var i=g[e.reason];i&&(n=_i18n("applications.public.helpers.saveDocVersion.saveFail", "{0}，保存失败").replace("{0}",i))}return n||(n=_i18n("applications.public.helpers.saveDocVersion.unknownError", "未知错误，保存失败")),f.a.createElement("div",{className:"save-version-fail"},n+" "+(t?"（Error Code: "+e.errno+"）":""),f.a.createElement("span",{className:"save-version-retry",onClick:this.handleRetry},_i18n("applications.public.helpers.saveDocVersion.retry", "重试")))}},{key:"render",value:function(){return!1}}]),i}(h.PureComponent)}},182:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(209),n(142)),p=n.n(d),h=n(144),f=n(146),m=n(145),v=n(148),w=n(226),b=n(245),g=n(169),y="right",_="down",C="rightDown",E=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={width:null,height:null,minWidth:null,minHeight:null},n.timer=null,n.scrollSelectedChildren=function(){for(var e=n.refContent.current,t=function(t){var i=e.children[t];if(i.classList.contains("selected"))return n.timer=setTimeout((function(){i.scrollIntoViewIfNeeded(),clearTimeout(n.timer)}),500),"break"},i=0;i<e.childElementCount;i++){if("break"===t(i))break}},n.handleScroll=function(){f.default.dispatchEvent(f.default.names.DROPDOWN_PANEL_SCROLL);var e=n.props,t=e.scrollEndBottom,i=e.onScroll;if(i){var a=n.refPanel.current,o=a.scrollTop;o+a.clientHeight+t>=a.scrollHeight&&i({scrollTop:o})}},n.scrollToTop=function(){n.refPanel.current.scrollTop=0},n.scrollToView=function(e){e.scrollIntoViewIfNeeded()},n.selectFirstItem=function(){var e=n.getHoverItem();e&&e.classList.remove("hover");var t=n.refPanel.current.getElementsByClassName("panel-item");t[0].classList.add("hover"),n.scrollToTop(),n.showPreSelectItem(t[0])},n.refPanel=p.a.createRef(),n.refContent=p.a.createRef(),n.handleDragMouseDown=n.handleDragMouseDown.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOver=n.handleMouseOver.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n.handleWindowKeyDown=n.handleWindowKeyDown.bind(n),n.officeType=Object(m.getPageOfficeType)(),n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){if(this.props.isListenEvent&&this.bindEvents(),this.props.canResize){var e=this.refPanel.current,t=e.offsetWidth,n=e.offsetHeight;this.setState({width:t,height:n,minWidth:t,minHeight:n})}this.scrollSelectedChildren()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.isListenEvent,i=t.visible;n!==e.isListenEvent&&(n?this.bindEvents():this.unbindEvents()),i!==e.visible&&i&&this.scrollSelectedChildren()}},{key:"componentWillUnmount",value:function(){this.unbindEvents()}},{key:"bindEvents",value:function(){window.addEventListener("keydown",this.handleWindowKeyDown,!0)}},{key:"unbindEvents",value:function(){clearTimeout(this.timer),window.removeEventListener("keydown",this.handleWindowKeyDown,!0)}},{key:"handleMouseOver",value:function(){h.isTouchScreen||this.bindEvents()}},{key:"handleMouseOut",value:function(){h.isTouchScreen||(this.props.isListenEvent||this.unbindEvents(),this.handleMouseMove(),this.props.onMouseOut&&this.props.onMouseOut())}},{key:"handleMouseMove",value:function(){if(this.props.onItemHover&&!h.isTouchScreen){var e=this.getHoverItem();this.props.onItemHover(e,!0)}}},{key:"handleDragMouseDown",value:function(e){var t=this,n=document.activeElement;Object(m.stopBubble)(e);var i=e.clientX,a=e.clientY,o=e.target,r=e.currentTarget.getAttribute("data-orien");o.setCapture&&o.setCapture();var s=this.state,l=s.width,c=s.height,u=s.minWidth,d=s.minHeight;document.onmousemove=function(e){Object(m.stopBubble)(e);var n=e.clientX,o=e.clientY,s=Math.max(u,l+n-i),p=Math.max(d,c+o-a);r===y?p=c:r===_&&(s=l),t.setState({width:s,height:p},(function(){f.default.dispatchEvent(f.default.names.FREE_SCROLL_BAR_RESIZE,{target:t.refPanel.current})}))},document.onmouseup=function(e){Object(m.stopBubble)(e),document.onmousemove=null,document.onmouseup=null,o.releaseCapture&&o.releaseCapture(),n.focus()}}},{key:"handleWindowKeyDown",value:function(e){if(this.props.enabledHotKey){var t=document.activeElement,n=t.tagName;if(!("TEXTAREA"===n||"INPUT"===n||"true"===t.contentEditable)||t.hasAttribute("data-keep-wsad")){var i=Object(g.getKey)(e);switch(i){case g.Keys.Enter:var a=this.getHoverItem();a&&(Object(m.stopBubble)(e),a.click());break;case g.Keys.ArrowUp:case g.Keys.ArrowDown:if(window.__WPSENV__.store.getState().public.alt.isInMode)break;var o=i===g.Keys.ArrowUp;this.setPreSelectItem(o,e),this.props.isPreSelectCloseDropdown&&f.default.dispatchEvent(f.default.names.CLOSE_DROPDOWN_PANEL)}}}}},{key:"getHoverItem",value:function(){return this.refPanel.current.getElementsByClassName("hover")[0]}},{key:"setPreSelectItem",value:function(e,t){var n=this.refPanel.current.getElementsByClassName("panel-item");if(n.length){Object(m.stopBubble)(t);var i=this.getHoverItem();i&&i.classList.remove("hover");var a=this.getPreSelectItem(e,n,i);a.classList.add("hover"),this.showPreSelectItem(a)}}},{key:"getPreSelectItem",value:function(e,t,n){for(var i=-1,a=0;a<t.length;a++)if(t[a]===n){i=a;break}if(e){for(var o=i-1;o>=0;o--)if(-1===t[o].className.indexOf("disabled")){i=o;break}}else for(var r=i+1;r<t.length;r++)if(-1===t[r].className.indexOf("disabled")){i=r;break}return t[Math.max(0,i)]}},{key:"showPreSelectItem",value:function(e){e.scrollIntoViewIfNeeded(),this.props.onItemHover&&this.props.onItemHover(e,!1)}},{key:"getElement",value:function(){return this.refPanel.current}},{key:"getContentElement",value:function(){return this.refContent.current}},{key:"getPanelStyle",value:function(){if(this.props.canResize){var e=this.state;return{width:e.width,height:e.height}}var t=this.props,n=t.width,i=t.minWidth,a=t.maxWidth;if(n||i||a)return{width:n,minWidth:i,maxWidth:a}}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.children,i=e.canResize,a="dropdown-panel";e.isAuto&&(a+=" "+this.officeType),i&&(a+=" can-resize"),t&&(a+=" "+t);var o=this.getPanelStyle();return p.a.createElement("div",{ref:this.refPanel,className:a,style:o,tabIndex:0,onKeyDown:this.handleWindowKeyDown,onMouseMove:this.handleMouseMove,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onScroll:this.handleScroll,"data-keep-edit":!0},p.a.createElement("div",{ref:this.refContent,className:"dropdown-panel-content","data-keep-edit":!0},n),p.a.createElement("div",{className:"drag-hand rightBottom","data-orien":C,onMouseDown:this.handleDragMouseDown},p.a.createElement(v.default,{type:v.default.types.other.drag_right_bottom})),p.a.createElement("div",{className:"drag-hand right","data-orien":y,onMouseDown:this.handleDragMouseDown}),p.a.createElement("div",{className:"drag-hand bottom","data-orien":_,onMouseDown:this.handleDragMouseDown}))}}]),t}(d.PureComponent);E.Item=w.default,E.Divider=b.a,E.defaultProps={isAuto:!0,scrollEndBottom:10,enabledHotKey:!0},t.default=E},185:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runScrollLeft=t.runOpacity=t.runTranslateY=t.runTranslateX=t.runRotate=t.runHeight=t.runStyle=t.run=t.StyleNames=t.defaultTransition=t.IRunOption=void 0;var i=n(143),a=n(405);function o(e){e.start,e.end,e.element}Object.defineProperty(t,"IRunOption",{enumerable:!0,get:function(){return a.IRunOption}}),Object.defineProperty(t,"StyleNames",{enumerable:!0,get:function(){return a.StyleNames}});function r(e){var t=e.setValue,n=e.start,i=e.end,a=e.keepEnd,r=e.onDone;r=r||Function.prototype,o(e);var s=!1,l=null,c=function(){window.cancelAnimationFrame(l),s=!0};if(n===i)return r(),c;var u=window.performance.now(),d=u,p=n,h=0;return t(p),l=window.requestAnimationFrame((function e(){s?r():(p=function(e,t,n,i,a){var o=window.performance.now(),r=(180-o+e)/Math.max(15,o-t);return r=Math.ceil(r),r=Math.min(10-n,r),i=(i+=(a-i)/(r=Math.max(4-n,r,1)))>a?Math.max(a,i):Math.min(a,i)}(u,d,h++,p,i),d=window.performance.now(),p===i&&(s=!0,p=a?i:""),t(p),window.requestAnimationFrame(e))})),c}t.defaultTransition="all 0.2s ease-in-out";var s=null,l=[];function c(e){return e.useFrame?r(e):function(e){var t=e.element,n=e.setValue,i=e.start,a=e.end,r=e.keepEnd,c=e.onDone,u=e.transition;if(c=c||Function.prototype,u=u||"all 0.2s ease-in-out",o(e),i.toFixed(2)===a.toFixed(2))return c(),null;n(i);var d=null;clearTimeout(s),l.push((function(){t.style.transition=u,n(a);var e=u.split(" ")[1],i=e.includes("ms")?parseFloat(e):1e3*parseFloat(e);d=setTimeout((function(){h()}),i+=100)})),s=setTimeout((function(){for(;l.length;){l.shift()()}}),10);var p=!1,h=function e(){p||(p=!0,t.removeEventListener("transitionend",e),t.style.transition="",n(r?a:""),c(),clearTimeout(d),d=null)};return t.addEventListener("transitionend",h),h}(e)}function u(e,t){return c((0,i.__assign)((0,i.__assign)({},t),{setValue:function(n){var i=e,o="".concat(n,"px");switch(e){case a.StyleNames.translateX:case a.StyleNames.translateY:n&&window.rightToLeft&&(n=-n),i="transform",o="".concat(e,"(").concat(n,"%)");break;case a.StyleNames.rotate:i="transform",o="rotate(".concat(n,"deg)");break;case a.StyleNames.opacity:o=n}t.element.style[i]=""===n?"":o}}))}t.run=c,t.runStyle=u,t.runHeight=function(e){return u(a.StyleNames.height,e)},t.runTranslateX=function(e){return u(a.StyleNames.translateX,e)},t.runTranslateY=function(e){return u(a.StyleNames.translateY,e)},t.runRotate=function(e){return u(a.StyleNames.rotate,e)},t.runOpacity=function(e){return u(a.StyleNames.opacity,e)},t.runScrollLeft=function(e){return c((0,i.__assign)((0,i.__assign)({},e),{useFrame:!0,setValue:function(t){e.element.scrollLeft=t}}))}},1936:function(e,t,n){"use strict";t.a={ExportImg:"ExportImg",ExportPdf:"ExportPdf",ExportOfd:"ExportOfd",CloseNoSave:"CloseNoSave",FileRename:"FileRename",FileSlim:"FileSlim",HistoryRecord:"HistoryRecord",HistoryVersion:"HistoryVersion",Print:"Print",SaveAsCopy:"SaveAsCopy",SaveVersion:"SaveVersion",ImmersionMode:"ImmersionMode",OnlineMode:"OnlineMode",EnterDraft:"EnterDraft",ExitDraft:"ExitDraft",ExportAsSheet:"ExportAsSheet"}},1937:function(e,t,n){"use strict";t.a={pc:{headerMoreBtn:"header-more-btn",versionUpdateMenu:"version-update-menu",headerHistoryBtn:"header-history-btn",headerHistoryFileUpdateMenu:"header-history-file-update-menu",etInsertTab:"commandbar-tab1",etDataTab:"commandbar-tab2",etInsertCheckbox:"et-insert-checkbox",etInsertDate:"et-insert-date",etSmartFill:"et-smart-fill"},mobile:{headerMoreBtn:"m-more-btn",versionUpdateMenu:"version-update-menu"}}},203:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(295),n(142)),p=n.n(d),h=n(146),f=n(145),m=n(241),v=n(172),w=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.scrollSelectedChildren=function(){var e=n.refContent.current;if(e)for(var t=0;t<e.childElementCount;t++){var i=e.children[t];if(i.classList.contains("selected")){i.scrollIntoViewIfNeeded();break}}},n.refPanel=p.a.createRef(),n.refContent=p.a.createRef(),n.handleKeyDown=n.handleKeyDown.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n.officeType=Object(f.getPageOfficeType)(),n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){var t=e.refPanel.current;t&&(t.focus(),e.scrollSelectedChildren())}),10)}},{key:"getHoverItem",value:function(){return this.refPanel.current.getElementsByClassName("hover")[0]}},{key:"handleKeyDown",value:function(e){if(this.props.enabledHotKey){var t=document.activeElement,n=t.tagName;if(!("TEXTAREA"===n||"INPUT"===n||"true"===t.contentEditable)||t.hasAttribute("data-keep-wsad"))switch(e.keyCode){case 13:var i=this.getHoverItem();i&&(Object(f.stopBubble)(e),i.click());break;case 38:case 40:var a=38===e.keyCode;this.setPreSelectItem(a,e);break;case 9:case 39:var o=this.getHoverItem();if(o){Object(f.stopBubble)(e);var r={visible:!0,element:o,parent:this.refPanel.current};h.default.dispatchEvent(h.default.names.SUB_MENU_VISIBLE_CHANGE,r)}break;case 37:Object(f.stopBubble)(e),this.props.onLeftArrow&&this.props.onLeftArrow()}}}},{key:"handleMouseMove",value:function(e){var t=this.refPanel.current;if(!t.contains(document.activeElement)&&t.contains(e.target)&&t.focus(),this.props.onItemHover){var n=this.getHoverItem();this.props.onItemHover(n,t)}}},{key:"handleMouseOut",value:function(){if(this.props.onItemHover){var e=this.getHoverItem();this.props.onItemHover(e,this.refPanel.current)}}},{key:"setPreSelectItem",value:function(e,t){var n=this.refPanel.current.getElementsByClassName("component-menu-item");if(n.length){Object(f.stopBubble)(t);var i=this.getHoverItem();i&&i.classList.remove("hover");var a=this.getPreSelectItem(e,n,i);if(a.classList.add("hover"),a.scrollIntoViewIfNeeded(),i!==a){var o={visible:!1,element:i,parent:this.refPanel.current};h.default.dispatchEvent(h.default.names.SUB_MENU_VISIBLE_CHANGE,o)}this.props.onItemHover&&this.props.onItemHover(a,this.refPanel.current)}}},{key:"getPreSelectItem",value:function(e,t,n){for(var i=-1,a=0;a<t.length;a++)if(t[a]===n){i=a;break}if(e){for(var o=i-1;o>=0;o--)if(-1===t[o].className.indexOf("disabled")){i=o;break}}else for(var r=i+1;r<t.length;r++)if(-1===t[r].className.indexOf("disabled")){i=r;break}return t[Math.max(0,i)]}},{key:"preSelectFirst",value:function(){this.setPreSelectItem(!0,null),this.refPanel.current.focus()}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.isAuto,i=e.children,a=e.onScroll,o=e.onMouseEnter,r="component-menu";return n&&(r+=" "+this.officeType),t&&(r+=" "+t),p.a.createElement("div",{ref:this.refPanel,className:r,tabIndex:0,onKeyDown:this.handleKeyDown,onScroll:a,onMouseMove:this.handleMouseMove,onMouseEnter:o,onMouseOut:this.handleMouseOut},p.a.createElement("div",{ref:this.refContent,className:"menu-content"},i))}}]),t}(d.PureComponent);w.Divider=m.default,w.Item=v.default,w.defaultProps={isAuto:!0,enabledHotKey:!0},t.default=w},209:function(e,t,n){},213:function(e,t,n){"use strict";t.a={topCenter:"topCenter",topRight:"topRight",topLeft:"topLeft",bottomLeft:"bottomLeft",bottomRight:"bottomRight",rightBottom:"rightBottom",leftBottom:"leftBottom"}},219:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=n(142),p=n.n(d),h=n(146),f=n(145),m=n(286),v=n(166),w=n(203),b=v.default.triggerTypes,g=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={visible:!1},n.isUnmount=!1,n.preSelectFirst=!1,n.delayShowSubMenuTimer=null,n.isMouseOut=!1,n.refDiv=p.a.createRef(),n.refMenu=p.a.createRef(),n.refDropDownBtn=p.a.createRef(),n.handleVisibleChange=n.handleVisibleChange.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.onMouseLeaveDropBtn=n.onMouseLeaveDropBtn.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n.handleSubMenuVisible=n.handleSubMenuVisible.bind(n),n.handleSubMenuLeftArrow=n.handleSubMenuLeftArrow.bind(n),n.startDelayVisibleChange=n.startDelayVisibleChange.bind(n),n.clearDelayShowSubMenu=n.clearDelayShowSubMenu.bind(n),n.onMouseEnterMenu=n.onMouseEnterMenu.bind(n),n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){window.addEventListener(h.default.names.SUB_MENU_VISIBLE_CHANGE,this.handleSubMenuVisible),window.addEventListener(h.default.names.CLEAR_DELAY_SHOW_SUB_MENU,this.clearDelayShowSubMenu)}},{key:"componentWillUnmount",value:function(){this.isUnmount=!0,window.removeEventListener(h.default.names.SUB_MENU_VISIBLE_CHANGE,this.handleSubMenuVisible),window.removeEventListener(h.default.names.CLEAR_DELAY_SHOW_SUB_MENU,this.clearDelayShowSubMenu)}},{key:"handleSubMenuVisible",value:function(e){var t=e.detail,n=t.visible,i=t.element,a=t.parent;i===this.refDiv.current&&(n?(this.isMouseOut=!1,this.state.visible?this.refMenu.current.preSelectFirst():(this.preSelectFirst=!0,this.parentNode=a,this.refDiv.current.click())):this.state.visible&&(this.setState({visible:!1}),this.parentNode&&this.parentNode.focus()))}},{key:"startDelayVisibleChange",value:function(e){var t=this;e?(h.default.dispatchEvent(h.default.names.CLEAR_DELAY_SHOW_SUB_MENU),this.delayShowSubMenuTimer=setTimeout((function(){t.handleVisibleChange(!0)}),250)):this.handleVisibleChange(!1)}},{key:"clearDelayShowSubMenu",value:function(){clearTimeout(this.delayShowSubMenuTimer)}},{key:"handleVisibleChange",value:function(e){var t=this;if(!this.isUnmount){if(!e&&this.state.visible){var n=Object(m.a)(this.refDiv.current);if(Object(m.b)(n+2))return;this.props.onItemHover&&this.props.onItemHover(null,null)}this.setState({visible:e},(function(){e&&t.preSelectFirst&&(t.preSelectFirst=!1,t.refMenu.current.preSelectFirst()),e||t.isMouseOut&&t.refDiv.current.classList.remove("hover"),t.props.onVisibleChange&&t.props.onVisibleChange(e)}))}}},{key:"handleMouseMove",value:function(){this.isMouseOut=!1,this.activateSubMenuHover()}},{key:"onMouseLeaveDropBtn",value:function(){this.clearDelayShowSubMenu()}},{key:"activateSubMenuHover",value:function(){for(var e=this.refDiv.current,t=e.parentNode.getElementsByClassName("hover"),n=0;n<t.length;n++){var i=t[n];if(i!==e){i.classList.remove("hover");break}}e.classList.add("hover")}},{key:"onMouseEnterMenu",value:function(){h.default.dispatchEvent(h.default.names.CLEAR_DELAY_SHOW_SUB_MENU),this.activateSubMenuHover()}},{key:"handleMouseOut",value:function(e){this.isMouseOut=!0,this.state.visible||Object(f.isMouseInElement)(e,this.refDiv.current)||this.refDiv.current.classList.remove("hover")}},{key:"handleSubMenuLeftArrow",value:function(){var e=this;this.props.onItemHover&&this.props.onItemHover(null,null),this.setState({visible:!1},(function(){e.refDiv.current.focus()}))}},{key:"getClassName",value:function(){var e=this.props,t=e.visible,n=e.selected,i=e.disabled,a=e.className,o="component-menu-item sub-menu-item";a&&(o+=" "+a);var r=this.refDiv.current;return(t||r&&-1!==r.className.indexOf(" hover"))&&(o+=" hover"),n&&(o+=" selected"),this.state.visible&&(o+=" sub-visible"),i&&(o+=" disabled"),o}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,i=e.subClassName,a=e.destroyOnHide,o=e.trigger,r=e.onItemHover,s=e.showScrollBar,l=e.offsetX,c=e.disableContentMouseLeave,u=e.placement,d=e.enabledHotKey,h=this.state.visible,f=this.getClassName(),m=p.a.createElement(w.default,{ref:this.refMenu,className:i,showScrollBar:s,onItemHover:r,onMouseEnter:this.onMouseEnterMenu,onLeftArrow:this.handleSubMenuLeftArrow,enabledHotKey:d},t);return p.a.createElement(v.default,{isAuto:!0,panel:m,visible:h,distance:0,offsetX:l,trigger:o,destroyOnHide:a,onVisibleChange:this.startDelayVisibleChange,onMouseLeaveDropBtn:this.onMouseLeaveDropBtn,placement:u,disableContentMouseLeave:c,ref:this.refDropDownBtn},p.a.createElement("div",{ref:this.refDiv,className:f,tabIndex:0,onMouseMove:this.handleMouseMove,onMouseOut:this.handleMouseOut},n))}}]),t}(d.PureComponent);g.triggerTypes=b,g.defaultProps={trigger:b.hover,offsetX:8,placement:v.default.placementTypes.rightBottom},t.default=g},226:function(e,t,n){"use strict";n.r(t);var i=n(26),a=n.n(i),o=n(44),r=n.n(o),s=n(0),l=n.n(s),c=n(3),u=n.n(c),d=n(25),p=n.n(d),h=n(42),f=n.n(h),m=n(142),v=n.n(m),w=n(145),b=n(151),g=n.n(b),y=function(e){function t(e){l()(this,t);var n=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isHover:!1},n.refDiv=v.a.createRef(),n.handleClick=n.handleClick.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n}return f()(t,e),u()(t,[{key:"handleClick",value:function(e){this.props.onClick&&this.props.onClick(this.props.value,e)}},{key:"handleMouseMove",value:function(){for(var e=this.refDiv.current,t=e.parentNode.getElementsByClassName("hover"),n=0;n<t.length;n++)if(t[n]!==e){t[n].classList.remove("hover");break}e.classList.add("hover")}},{key:"handleMouseOut",value:function(e){Object(w.isMouseInElement)(e,this.refDiv.current)||this.refDiv.current.classList.remove("hover")}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"getClassName",value:function(){var e=this.props,t=e.disabled,n=e.selected,i=e.className,a=e.children,o="panel-item",s=this.refDiv.current;s&&-1!==s.className.indexOf(" hover")&&(o+=" hover"),t&&(o+=" disabled"),n&&(o+=" selected");var l=void 0===a?"undefined":r()(a);return"string"!==l&&"number"!==l||(o+=" only-text"),i&&(o+=" "+i),o}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.title,i=e.value,o=e.children,r=e.getStyle,s=e.visible,l=e.dataKey,c=e.keepEdit,u=e.draggable,d=e.onMouseEnter,p=e.onMouseLeave,h=e.onDragEnter,f=e.onDragStart,m=e.onDragEnd;if(!s)return!1;var w=this.getClassName(),b=r?r(i):null,y={};return d&&(y.onMouseEnter=d),p&&(y.onMouseLeave=p),v.a.createElement(g.a,a()({title:n},y),v.a.createElement("div",a()({ref:this.refDiv,id:t,className:w,style:b,"data-key":l||void 0,"data-keep-edit":c||void 0,draggable:u,onClick:this.handleClick,onMouseMove:this.handleMouseMove,onMouseOut:this.handleMouseOut,onDragStart:f,onDragEnter:h,onDragEnd:m},y),o))}}]),t}(m.PureComponent);y.defaultProps={visible:!0},t.default=y},229:function(e,t,n){"use strict";n.r(t);var i=n(150),a=n.n(i),o=n(0),r=n.n(o),s=n(3),l=n.n(s),c=n(25),u=n.n(c),d=n(42),p=n.n(d),h=(n(260),n(142)),f=n.n(h),m=n(144),v=n(145),w=n(169),b=n(146),g=n(213),y=n(286),_=n(26),C=n.n(_);var E=function(e,t,n,i){n=function(e){var t=C()({},e),n=window.scrollY;return e&&n&&(t.top+=n,t.bottom+=n),t}(n);var a=void 0;switch(window.rightToLeft&&(e=/(Left|left)/.test(e)?e.replace("Left","Right").replace("left","right"):e.replace("Right","Left").replace("right","left")),e){case g.a.topCenter:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body.clientHeight,r=t.left+t.width/2-i/2,s=t.top-n,l=o-t.bottom-n,c=t.top-n-a,u=t.bottom+n;return{left:r,top:s>=a?c:l>=a?u:s>=50||s>=l?c:u}}(t,n,i);break;case g.a.topRight:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body,r=o.clientWidth,s=o.clientHeight,l=t.right,c=r-t.left,u=t.right-i,d=t.left,p=void 0;p=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var h=s-t.bottom-n,f=t.top-n,m=t.bottom+n,v=t.top-n-a;return{left:p,top:f>=a?v:h>=a||h>=50||h>=f?m:v}}(t,n,i);break;case g.a.topLeft:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body,r=o.clientWidth,s=o.clientHeight,l=t.right,c=r-t.left,u=t.right-i,d=t.left,p=void 0;p=c>=i?d:l>=i||l>=50||l>=c?u:d;var h=s-t.bottom-n,f=t.top-n,m=t.bottom+n,v=t.top-n-a;return{left:p,top:f>=a?v:h>=a||h>=50||h>=f?m:v}}(t,n,i);break;case g.a.bottomLeft:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body,r=o.clientWidth,s=o.clientHeight,l=r-t.left,c=t.right,u=t.left,d=t.right-i,p=void 0;p=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var h=s-t.bottom-n,f=t.top-n,m=t.bottom+n,v=t.top-n-a;return{left:p,top:h>=a?m:f>=a?v:h>=50||h>=f?m:v}}(t,n,i);break;case g.a.bottomRight:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body,r=o.clientWidth,s=o.clientHeight,l=t.right,c=r-t.left,u=t.right-i,d=t.left,p=void 0;p=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var h=s-t.bottom-n,f=t.top-n,m=t.bottom+n,v=t.top-n-a;return{left:p,top:h>=a?m:f>=a?v:h>=50||h>=f?m:v}}(t,n,i);break;case g.a.rightBottom:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body,r=o.clientWidth,s=o.clientHeight,l=r-t.right-n,c=t.left-n,u=t.right+n,d=t.left-n-i,p=void 0;p=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var h=s-t.top,f=t.bottom,m=t.top,v=t.bottom-a;return{left:p,top:h>=a?m:f>=a?v:h>=50||h>=f?m:v}}(t,n,i);break;case g.a.leftBottom:a=function(e,t,n){var i=e.offsetWidth,a=e.offsetHeight,o=document.body,r=o.clientWidth,s=o.clientHeight,l=r-t.right-n,c=t.left-n,u=t.right+n,d=t.left-n-i,p=void 0;p=c>=i?d:l>=i||l>=50||l>=c?u:d;var h=s-t.top,f=t.bottom,m=t.top,v=t.bottom-a;return{left:p,top:h>=a?m:f>=a?v:h>=50||h>=f?m:v}}(t,n,i);break;default:throw new Error("what is this？"+e)}return window.rightToLeft&&(a.right=document.body.clientWidth-a.left-t.offsetWidth,delete a.left),a},k=function(e){function t(e){r()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={visible:!1},n.panelW=void 0,n.panelH=void 0,n.timestamp=void 0,n.handleClose=function(e){var t=e.target,i=n.refPanel.current,a=n.props.triggerElement;!i||i.contains(t)||function(e,t){if(e){var n=e.getBoundingClientRect(),i=t.changedTouches&&t.changedTouches[0]?t.changedTouches[0]:t,a=i.pageX,o=i.pageY;return a>=n.left&&a<=n.right&&o>=n.top&&o<=n.bottom}return!1}(a,e)||y.a(e.target)<n.level&&n.props.onClose()},n.handleOrientationchange=function(){n.props.onClose()},n.handleWheel=function(e){n.handleClose(e)},n.origin=null,n.style=null,n.maxHeight=void 0,n.refPanel=f.a.createRef(),n.handleWindowKeyDown=n.handleWindowKeyDown.bind(n),n.handleWindowResize=n.handleWindowResize.bind(n),n.handleClosePanel=n.handleClosePanel.bind(n),n.handleDisconnected=n.handleDisconnected.bind(n),n.handleWindowMouseDown=n.handleWindowMouseDown.bind(n),n.timestamp=window.performance.now(),n}return p()(t,e),l()(t,[{key:"componentDidMount",value:function(){this.props.visible&&(this.bindEvents(),this.setState({visible:!0}))}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.visible;e.visible!==n&&(n?(this.bindEvents(),this.origin=null,this.style=null,this.maxHeight=void 0):this.unbindEvents(),this.setState({visible:n}))}},{key:"componentWillUnmount",value:function(){this.unbindEvents()}},{key:"observerPanel",value:function(){var e=this;if(void 0===this.panelW){var t=this.refPanel.current;this.panelW=t.clientWidth,this.panelH=t.clientHeight,new MutationObserver((function(){var n=t.clientWidth,i=t.clientHeight;e.panelW===n&&e.panelH===i||(e.panelW=n,e.panelH=i,e.origin=null,e.style=null,e.forceUpdate())})).observe(t,{childList:!0,subtree:!0})}}},{key:"handleClosePanel",value:function(e){if(this.state.visible){var t=e.detail.isCloseSub;t&&this.level>1?this.props.onClose():t||1!==this.level||this.props.onClose()}}},{key:"handleDisconnected",value:function(){this.props.onClose()}},{key:"handleWindowKeyDown",value:function(e){w.getKey(e)===w.Keys.Esc&&(y.b(this.level+1)||(Object(v.stopBubble)(e),this.props.onClose()))}},{key:"handleWindowMouseDown",value:function(e){window.performance.now()-this.timestamp>300&&this.handleClose(e)}},{key:"handleWindowResize",value:function(){m.isTouchScreen?(this.style=null,this.forceUpdate()):this.props.onClose()}},{key:"bindEvents",value:function(){this.observerPanel(),b.default.dispatchEvent(b.default.names.ON_DROPDOWN_PANEL_VISIBLE_CHANGE,{visible:!0}),window.addEventListener(b.default.names.CLOSE_DROPDOWN_PANEL,this.handleClosePanel),window.addEventListener(b.default.names.network.ON_DISCONNECTED,this.handleDisconnected),window.addEventListener("keydown",this.handleWindowKeyDown,!0),window.addEventListener("mousedown",this.handleWindowMouseDown,!0),window.addEventListener("resize",this.handleWindowResize),window.addEventListener("touchstart",this.handleClose,!0),window.addEventListener("orientationchange",this.handleOrientationchange),window.addEventListener("wheel",this.handleWheel,!0),window.visualViewport&&window.visualViewport.addEventListener("resize",this.handleWindowResize)}},{key:"unbindEvents",value:function(){b.default.dispatchEvent(b.default.names.ON_DROPDOWN_PANEL_VISIBLE_CHANGE,{visible:!1}),window.removeEventListener(b.default.names.CLOSE_DROPDOWN_PANEL,this.handleClosePanel),window.removeEventListener(b.default.names.network.ON_DISCONNECTED,this.handleDisconnected),window.removeEventListener("keydown",this.handleWindowKeyDown,!0),window.removeEventListener("mousedown",this.handleWindowMouseDown,!0),window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("touchstart",this.handleClose,!0),window.removeEventListener("orientationchange",this.handleOrientationchange),window.removeEventListener("wheel",this.handleWheel,!0),window.visualViewport&&window.visualViewport.removeEventListener("resize",this.handleWindowResize)}},{key:"getAnimationOrigin",value:function(e){var t=this.refPanel.current;return t?(this.origin||(this.origin=function(e,t,n){var i=void 0;i=window.rightToLeft?document.body.clientWidth-e.right-t.offsetWidth/2:e.left+t.offsetWidth/2;var a=e.top+(e.height||t.offsetHeight)/2;return(i>=n.left+n.width/2?"right":"left")+"-"+(a>=n.top+n.height/2?"bottom":"top")}(e,t,this.props.rect)),this.origin):""}},{key:"createStyle",value:function(e){var t,n=(t={visibility:this.state.visible?"":"hidden"},a()(t,window.rightToLeft?"right":"left",0),a()(t,"top",0),t),i=this.props,o=i.placement,r=i.rect,s=i.distance,l=i.isAuto,c=i.triggerElement;if(c){var u=c.getBoundingClientRect(),d=u.top,p=u.bottom;r=Object.assign({},r,{top:d,bottom:p})}var h=E(o,e,r,s);return l&&(h=function(e,t){var n=e.left,i=e.right,a=e.top,o=t.offsetWidth,r=t.offsetHeight,s=document.body,l=s.clientWidth,c=s.clientHeight;return window.rightToLeft?(i+o+4>l&&(i=l-o-4),i=Math.max(4,i)):(n+o+4>l&&(n=l-o-4),n=Math.max(4,n)),a+r+4>c&&(a=c-r-4),a=Math.max(4,a),window.rightToLeft?{right:i,top:a}:{left:n,top:a}}(h,e)),Object.assign(n,h),n}},{key:"getPanelStyle",value:function(){var e=this.state.visible,t=this.refPanel.current;if(!t){var n,i=(n={visibility:e?"":"hidden"},a()(n,window.rightToLeft?"right":"left",0),a()(n,"top",0),n);return this.maxHeight=this.createStyle(document.body).height,i.maxHeight=this.maxHeight,i}var o=this.props,r=o.distance,s=o.isSetHeight;if(!this.style){this.style=this.createStyle(t),s&&(this.style.height=function(e,t,n){var i=document.body.clientHeight,a=i-e-n;return e<0&&(a=i-2*n),t.offsetHeight<a?void 0:a}(this.style.top,t,r));var l=t.getBoundingClientRect().height;Math.abs(l-this.maxHeight)<2&&(this.style.height=this.maxHeight)}return this.style}},{key:"calcTransparentPlaceholder",value:function(e){if(0===this.props.offsetX)return null;var t={left:/left/.test(e)?"auto":"-"+this.props.offsetX+"px",right:/right/.test(e)?"auto":"-"+this.props.offsetX+"px"};return f.a.createElement("div",{className:"transparent-placeholder",style:t})}},{key:"getLevel",value:function(){return this.level}},{key:"render",value:function(){void 0===this.level&&(this.level=y.a(this.props.triggerElement)+1,this.showAnimation=!1);var e=this.props,t=e.children,n=e.onMouseEnter,i=e.onMouseLeave,a=e.className,o=this.state.visible,r=null;"function"==typeof t.type&&(r={isListenEvent:o});var s=f.a.cloneElement(t,r),l=this.getPanelStyle(),c=this.getAnimationOrigin(l),u=this.calcTransparentPlaceholder(c),d=y.c;return o&&(this.showAnimation&&(d+=" animation-fade-scaleY-in"),d+=" origin-"+c,a&&(d+=" "+a)),f.a.createElement("div",{ref:this.refPanel,className:d,style:l,"data-level":this.level,onMouseEnter:n,onMouseLeave:i},u,s)}}]),t}(h.PureComponent);k.placementTypes=g.a,k.defaultProps={placement:g.a.bottomLeft,distance:0,offsetX:0,isSetHeight:!1};t.default=k},241:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=n(142),p=n.n(d),h=function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props.className,t="component-menu-divider";return e&&(t+=" "+e),p.a.createElement("div",{className:t})}}]),t}(d.PureComponent);t.default=h},245:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(209),n(142)),p=n.n(d),h=function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"render",value:function(){return p.a.createElement("div",{className:"divider-line"})}}]),t}(d.PureComponent);t.a=h},259:function(e,t,n){},260:function(e,t,n){},261:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canRequestForAuthForSecurityDoc=t.requestForAuth=t.isPrintLimitedSecurityDoc=t.isCopyLimitedSecurityDoc=t.isEditLimitedSecurityDoc=t.isSupportSecurityDoc=t.AUTH_TYPES=void 0;var i=(0,n(143).__importDefault)(n(162)),a={EDIT:"edit",COPY:"copy",PRINT:"print",SAVE_AS:"saveAs"};t.AUTH_TYPES=a;var o={pluginType:window.__WPSPLUGIN__.helper.types.SecureDocApplyAuth};var r=[i.default.writer,i.default.spreadsheet,i.default.presentation].includes(window.officeType);t.isSupportSecurityDoc=r,t.isEditLimitedSecurityDoc=function(){return window.APP.isSecurityDoc()&&!window.APP.canEdit()},t.isCopyLimitedSecurityDoc=function(){return window.APP.isSecurityDoc()&&!window.APP.canCopy()},t.isPrintLimitedSecurityDoc=function(){return window.APP.isSecurityDoc()&&!window.APP.canPrint()},t.requestForAuth=function(e){return void 0===e&&(e={type:a.EDIT}),window.__WPSPLUGIN__.loader.loadSingleInstance(o).then((function(t){return t.show(e.type)}))};var s=r&&!!window.__WPSPLUGIN__.loader.search(o);t.canRequestForAuthForSecurityDoc=s},2744:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(142),n(702)),p=window.makeCommandBarComponent(d.b),h=p.cmbIds.$public,f=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,h.HistoryVersion));n.name=d.k.HistoryVersion,n.text=_i18n("applications.public.components.commandbars.Header.MoreBtn.historyVersion", "历史版本"),n.visible=window.__CONFIG__.isShowHistory&&!d.g&&!d.d&&!window.__WPSENV__.draft;var i=window.__WPSENV__.cache_preview||window.APP.isPreview;return n.disabled=i||window.APP.isReadOnly()&&!window.__CONFIG__.isShowHistoryInReadonly,n.disabledTips=_i18n("applications.public.components.commandbars.Header.MoreBtn.toast_doc_readOnly", "文档为只读"),n}return u()(t,e),r()(t,[{key:"onExecute",value:function(){d.a.dispatchEvent(d.a.names.cooper.ON_HISTORY_VISIBLE_CHANGE)}}]),t}(p);t.a=f},2745:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(142),n(702)),p=window.makeCommandBarComponent(d.b),h=p.cmbIds.$public,f=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,h.HistoryRecord));n.name=d.k.HistoryRecord,n.text=_i18n("applications.public.components.commandbars.Header.MoreBtn.historyRecord", "协作记录");var i=(d.e||d.f)&&!window.__WPSENV__.draft||d.i||d.j||d.h;return n.visible=window.__CONFIG__.isShowHistoryRecord&&i,n.disabled=window.APP.isReadOnly(),n.disabledTips=_i18n("applications.public.components.commandbars.Header.MoreBtn.toast_doc_readOnly", "文档为只读"),n}return u()(t,e),r()(t,[{key:"onExecute",value:function(){d.a.dispatchEvent(d.a.names.cooper.ON_COOPER_VISIBLE_CHANGE)}}]),t}(p);t.a=f},295:function(e,t,n){},3196:function(e,t,n){},3197:function(e,t,n){},3198:function(e,t,n){},3199:function(e,t,n){},3200:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={openshare:"openshare"}},3201:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTextChatPlugin=t.initTextChatPlugin=t.textChatEnabled=void 0;var i,a=window.__WPSPLUGIN__.helper,o=a.types.Chat,r={pluginType:o};t.textChatEnabled=a.has(o),t.initTextChatPlugin=function(e){t.textChatEnabled&&(i=function(e){return new Promise((function(t){window.__WPSPLUGIN__.loader.load(r).then((function(n){var i=window.fileInfo,a=new n({layout:{getPluginContainer:function(){return e}},initParams:{fileInfo:{group_id:i.group_id,file_id:i.id,link_id:window.urlFileId,officeType:window.officeType}}});t(a.plugin)}))}))}(e))},t.getTextChatPlugin=function(){return t.textChatEnabled?i||Promise.reject("[".concat(o,"] is not inited.")):Promise.reject("[".concat(o,"] is disabled."))}},3202:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVoiceChatPlugin=t.initVoiceChatPlugin=t.voiceChatEnabled=void 0;var i,a=window.__WPSPLUGIN__.helper,o=a.types.VoiceChatFull,r={pluginType:o};t.voiceChatEnabled=a.has(o),t.initVoiceChatPlugin=function(e){i=null,t.voiceChatEnabled&&(i=function(e){return new Promise((function(t){var n={getWrapper:function(){return e}};window.__WPSPLUGIN__.loader.load(r).then((function(e){var i=new e({layout:n});t(i.plugin)}))}))}(e)).then((function(e){e.init()}))},t.getVoiceChatPlugin=function(){return t.voiceChatEnabled?i||Promise.reject("[".concat(o,"] is not inited.")):Promise.reject("[".concat(o,"] is disabled."))}},3203:function(e,t,n){"use strict";n.r(t);n(3204);var i=n(162),a=n(1752),o=n(252),r=_i18n("applications.public.components.commandbars.Header.SaveVersion.saveSuccess", "保存成功，可在{historyLink}中查看");(window.officeType===i.default.whiteboard||window.officeType===i.default.dbsheet||window.__IN_SANDBOX__&&Object(i.isEtLike)(window.officeType)||!window.__CONFIG__.showHistoryLinkInSavingToast)&&(r=_i18n("applications.public.components.commandbars.Header.SaveVersion.saveOk", "保存成功"));var s={ok:r,nochange:_i18n("applications.public.components.commandbars.Header.SaveVersion.noChange", "文档无更新，无需保存"),SavedEmptyFile:_i18n("applications.public.components.commandbars.Header.SaveVersion.savedEmptyFile", "暂不支持保存空文件"),SpaceFull:_i18n("applications.public.components.commandbars.Header.SaveVersion.spaceFull", "空间已满，无法继续保存，请及时联系客服"),QueneFull:_i18n("applications.public.components.commandbars.Header.SaveVersion.queneFull", "保存中，请勿频繁操作"),fail:_i18n("applications.public.components.commandbars.Header.SaveVersion.saveFail", "当前内容保存失败"),fileNotExists:_i18n("applications.public.components.commandbars.Header.SaveVersion.fileNotExists", "文件(夹)不存在")},l=Object(a.a)(s,o.size16.warning_red);t.default=l},3204:function(e,t,n){},348:function(e,t,n){"use strict";n.r(t),n.d(t,"copyToClipboard",(function(){return a}));function i(e,t){var n,i,a,o,r,s,l=!1;t||(t={}),n=t.debug||!1;try{if(a=function(){var e=document.getSelection();if(!e.rangeCount&&0!==e.rangeCount)return function(){};for(var t=document.activeElement,n=[],i=0;i<e.rangeCount;i++)n.push(e.getRangeAt(i));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}}(),o=document.createRange(),r=document.getSelection(),(s=document.createElement("span")).textContent=e,s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",document.body.appendChild(s),o.selectNode(s),r.addRange(o),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");l=!0}catch(a){n&&console.error("unable to copy using execCommand: ",a),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData("text",e),l=!0}catch(a){n&&console.error("unable to copy using clipboardData: ",a),n&&console.error("falling back to prompt"),i=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(i,e)}}finally{r&&("function"==typeof r.removeRange?r.removeRange(o):r.removeAllRanges()),s&&document.body.removeChild(s),a()}return l}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=null;t&&(a=t.getContainer||null);var o=n||_i18n("applications.public.helpers.copy2clipboard.success", "复制成功");return i(e,t)?(window.Toast.success(o,a),!0):(window.Toast.error(_i18n("applications.public.helpers.copy2clipboard.fail", "复制失败"),a),!1)}},377:function(e,t,n){"use strict";n.r(t);n(590);var i=n(144),a=n(0),o=n.n(a),r=n(3),s=n.n(r),l=n(25),c=n.n(l),u=n(42),d=n.n(u),p=n(142),h=n.n(p),f=n(168),m=n.n(f),v=n(166),w=n(148),b=function(e){function t(){return o()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.children,i=e.iconContent,a=e.disabled,o=e.iconType,r=e.visible,s=e.onVisibleChange,l=this.getClassName();return h.a.createElement(v.default,{visible:r,panel:n,disabled:a,onVisibleChange:s},h.a.createElement("div",{ref:this.refWrap,id:t,className:l},h.a.createElement("div",{className:"left-btn"},o&&h.a.createElement(w.default,{type:o}),i),h.a.createElement("div",{className:"right-btn"})))}}]),t}(n(421).a);b.propTypes={id:m.a.string,visible:m.a.bool.isRequired,className:m.a.string,disabled:m.a.bool,title:m.a.oneOfType([m.a.object,m.a.string]),iconType:m.a.string,iconContent:m.a.oneOfType([m.a.object,m.a.string]),onIconClick:m.a.func,iconSelected:m.a.bool,onVisibleChange:m.a.func.isRequired};var g=b,y=n(569),_=i.isPad?g:y.default;t.default=_},405:function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.StyleNames=void 0,function(e){e.width="width",e.height="height",e.left="left",e.top="top",e.marginLeft="marginLeft",e.marginTop="marginTop",e.translateX="translateX",e.translateY="translateY",e.rotate="rotate",e.opacity="opacity"}(i||(i={})),t.StyleNames=i},408:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(505),n(142)),p=n.n(d),h=n(145),f=n(151),m=n.n(f),v=n(148),w=function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"renderAvators",value:function(e){var t=this.props.avatar,n=t&&t.length>0;return e.map((function(e,t){return p.a.createElement("div",{key:t,className:"avatar-img"},n?p.a.createElement("img",{src:e}):p.a.createElement(v.default,{type:e}))}))}},{key:"getAvators",value:function(){var e=this.props,t=e.avatar,n=e.iconType,i=[];return Array.isArray(t)?i=t:t?i.push(t):Array.isArray(n)?i=n:n?i.push(n):i=[v.default.types.other.avatar_default],i.slice(0,4)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.title,i=e.borderColor,a=e.borderOpacity,o=e.isSmall,r={};i&&(r.borderColor=Object(h.hex2Rgb)(i,a));var s=this.getAvators(),l="component-avatar avatar-length-"+s.length;return o&&(l+=" small-size"),t&&(l+=" "+t),p.a.createElement(m.a,{title:n},p.a.createElement("div",{className:l,style:r},this.renderAvators(s)))}}]),t}(d.PureComponent);w.iconTypes=v.default.types,w.defaultProps={borderOpacity:.75},t.default=w},4190:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(3196),n(142)),p=n.n(d),h=n(149),f=n(166),m=n(151),v=n.n(m),w=n(162),b=n(145),g=(n(3197),n(408)),y=(n(3198),function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"renderTitle",value:function(){var e=this.props,t=e.owner,n=e.me,i=e.member,a=i.shortName;return n.id===i.id?t.id===i.id?a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.meOwnerTips", "（我，所有者）"):a?a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.meTips", "（我）"):_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.me", "我"):t.id===i.id?a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.ownerTips", "（所有者）"):i.isLogin?i.canWrite?a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.writeTips", "（可编辑）"):"comment"===i.permission?a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.commentTips", "（可评论）"):a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.readonlyTips", "（仅查看）"):a+_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.notLoginTips", "（未登录）")}},{key:"render",value:function(){var e=this.props,t=e.children;if(e.disabled)return t;var n=this.renderTitle();return p.a.createElement(v.a,{title:n},t)}}]),t}(d.PureComponent)),_=Object(b.getPageOfficeType)(),C=Object(w.isEtLike)(_)||_===w.default.writer,E=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClick=n.handleClick.bind(n),n}return u()(t,e),r()(t,[{key:"handleClick",value:function(){C&&this.props.onClick(this.props.member)}},{key:"renderName",value:function(){var e=this.props,t=e.me,n=e.member;if(!e.showName)return!1;var i=n.name;return t.id===n.id&&(i+=_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.meTips", "（我）")),p.a.createElement("div",{className:"member-name"},i)}},{key:"renderStatus",value:function(){var e=this.props,t=e.showName,n=e.online,i=e.owner,a=e.member;if(!t||i.id===a.id&&n)return!1;var o=_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.readonly", "仅查看");return i.id===a.id?o=_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.offline", "离线"):a.canWrite?o=_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.canEdit", "可编辑"):a.isLogin?"comment"===a.permission&&(o=_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.canComment", "可评论")):o=_i18n("applications.public.components.commandbars.Header.Cooperation.CooperAvatar.notLogin", "未登录"),p.a.createElement("div",{className:"member-status"},o)}},{key:"render",value:function(){var e=this.props,t=e.owner,n=e.member,i=e.showName,a=e.online,o=e.me,r=null;i&&n.id!==t.id&&(r=n._color);var s="component-cooper-avatar";return i&&(s+=" show-name"),a||(s+=" disabled"),p.a.createElement("div",{className:s,onClick:this.handleClick},p.a.createElement("div",{className:"avatar-wrap"},p.a.createElement(y,{member:n,me:o,owner:t,disabled:!a},p.a.createElement("div",{className:"avatar-box"},p.a.createElement(g.default,{avatar:n.avatar,borderColor:r}),this.renderName()))),this.renderStatus())}}]),t}(d.PureComponent);E.defaultProps={online:!0,showName:!1};var k=E,O=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.refDiv=p.a.createRef(),o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"getWidth",value:function(){return this.refDiv.current.clientWidth}},{key:"render",value:function(){var e=this.props,t=e.me,n=e.owner,i=e.members,a=e.onClick,o=e.disabled,r=i.map((function(e){return p.a.createElement(k,{key:e.id,owner:n,me:t,member:e,onClick:a})}));return p.a.createElement("div",{ref:this.refDiv,className:"cooper-avatars"+(o?" disabled":"")},r)}}]),t}(d.PureComponent),P=(n(3199),n(182)),S=P.default.Divider,M=function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props,t=e.owner,n=e.me,i=e.members,a=e.onClick;t=i.find((function(e){return e.id===t.id}))||t;var o=n.id===t.id||i.some((function(e){return e.id===t.id}));i=i.filter((function(e){return e.id!==t.id})),n.id!==t.id&&(i=i.filter((function(e){return e.id!==n.id}))).unshift(n);var r=i.map((function(e){return p.a.createElement(k,{key:e.id,showName:!0,owner:t,me:n,member:e,onClick:a})}));return p.a.createElement(P.default,{className:"cooper-members-panel"},p.a.createElement("div",{className:"title"},_i18n("applications.public.components.commandbars.Header.Cooperation.MemberPanel.owner", "所有者")),p.a.createElement(k,{showName:!0,online:o,owner:t,me:n,member:t,onClick:a}),p.a.createElement(S,null),p.a.createElement("div",{className:"title"},_i18n("applications.public.components.commandbars.Header.Cooperation.MemberPanel.cooperMembers", "正在协作的成员")),p.a.createElement("div",{className:"cooper-members"},r))}}]),t}(d.PureComponent),I=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.refWrap=p.a.createRef(),n.refAvatar=p.a.createRef(),n.handleVisibleChange=n.handleVisibleChange.bind(n),n.handleWindowResize=n.handleWindowResize.bind(n),n.handleClick=n.handleClick.bind(n);var i=e.user;return n.state={visible:!1,me:i,showMembers:[i]},n}return u()(t,e),r()(t,[{key:"updateMembers",value:function(){var e=this.props,t=e.members,n=e.user,i=e.file;if(0!==t.length){var a=t.find((function(e){return e.id===i.creator.id})),o=t.find((function(e){return e.id===n.id||!e.id}));o=o||n;var r=t.filter((function(e){return e.id!==o.id&&(!a||e.id!==a.id)}));a&&r.unshift(a),a&&o.id===a.id||r.unshift(o);var s=this.refWrap.current.clientWidth-2,l=parseInt(s/this.avatarWidth);l=Math.max(2,l),l=Math.min(6,l),r.length>l&&(l-=1),r=r.filter((function(e,t){return t<l})),this.setState({me:o,showMembers:r})}}},{key:"observerPanel",value:function(){var e=this,t=0;new MutationObserver((function(){var n=e.refWrap.current.clientWidth;t!==n&&(t=n,e.updateMembers())})).observe(this.refWrap.current.parentNode,{attributes:!0,childList:!0,subtree:!0})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleWindowResize),this.avatarWidth=this.refAvatar.current.getWidth(),this.updateMembers(),this.observerPanel()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"componentDidUpdate",value:function(e,t){this.props.members!==e.members&&this.updateMembers()}},{key:"handleWindowResize",value:function(){this.updateMembers()}},{key:"handleVisibleChange",value:function(e){this.setState({visible:e}),window.collection2("header_users_more")}},{key:"handleClick",value:function(e){switch(this.setState({visible:!1}),Object(b.getPageOfficeType)()){case w.default.spreadsheet:case w.default.ksheet:var t=window.APP.getUilCmdTool();t&&t.followCooperator(e.id);break;case w.default.writer:window.APP.data.selection.selCoop.jumpToUser(e.id);break;case w.default.presentation:window.APP.shell.doc.jumpToUser(e.id);break;case w.default.pdf:}window.collection2("cooper_avatar_location")}},{key:"render",value:function(){var e=this.props,t=e.file,n=e.members,i=t.creator,a=this.state,o=a.visible,r=a.me,s=a.showMembers,l=p.a.createElement(M,{me:r,members:n,owner:i,onClick:this.handleClick});return p.a.createElement("div",{ref:this.refWrap,className:"cooperation-wrap"},n.length>s.length&&p.a.createElement(f.default,{title:_i18n("applications.public.components.commandbars.Header.Cooperation.showMembers", "查看所有成员"),panel:l,visible:o,onVisibleChange:this.handleVisibleChange},p.a.createElement(v.a,{title:_i18n("applications.public.components.commandbars.Header.Cooperation.showMembers", "查看所有成员")},p.a.createElement("div",{className:"members-more-btn"+(o?" selected":"")},n.length))),p.a.createElement(O,{ref:this.refAvatar,me:r,owner:i,disabled:o,members:s,onClick:this.handleClick}))}}]),t}(d.PureComponent);t.default=Object(h.connect)((function(e){var t=e.public;return{user:t.user,file:t.file,members:t.cooperation.members}}))(I)},421:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=n(142),p=n.n(d),h=n(166),f=n(148),m=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.refWrap=p.a.createRef(),o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){}},{key:"getClassName",value:function(){var e=this.props,t=e.disabled,n=e.visible,i=e.iconSelected,a=e.iconContent,o=e.className;return p.a.classNames({"component-dropdown-group":1,disabled:t,selected:n,"icon-selected":i,"icon-text":"string"==typeof a},o)}},{key:"getElement",value:function(){return this.refWrap.current}}]),t}(d.PureComponent);m.iconTypes=f.default.types,m.DropdownPanel=h.default.DropdownPanel,t.a=m},4333:function(e,t,n){},4334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldMountLoginGuide=void 0;var i=n(261),a=n(45),o=n(583);t.shouldMountLoginGuide=function(e,t){var n=!t.isLogin||!e.user_acl.update,r=window.__WPSPLUGIN__.helper.has(window.__WPSPLUGIN__.type.LoginGuide);return!(0,a.hasQuery)("hideguide")&&(!!(t.isLogin&&i.canRequestForAuthForSecurityDoc&&(0,i.isEditLimitedSecurityDoc)())||!(!window.__CONFIG__.isLoginGuide||!r)&&((0,o.isSuperPreview)()?((0,o.isReadOnlyAfterReload)(),!0):n))}},4335:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(143),o=(0,a.__importDefault)(n(142)),r=(0,a.__importDefault)(n(174));n(5208),function(e){e.Dot="dot",e.Count="count",e.Custom="custom"}(i||(i={})),t.default=function(e){var t,n,a=e.className,s=e.show,l=void 0!==s&&s,c=e.color,u=void 0===c?"#ff4d4f":c,d=e.dot,p=e.count,h=e.content,f=e.children,m={backgroundColor:u},v=l;switch(!0){case d:t=i.Dot,n="";break;case void 0!==p:t=i.Count,n=p.toString();break;case void 0!==h:t=i.Custom,n=h;break;default:v=!1}return o.default.createElement("div",{className:"component-badge-wrapper"},f,o.default.createElement("sup",{className:(0,r.default)("component-badge",t,a,{"is-visible":v}),style:m},n))}},4336:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBadgeVisible=t.getWOAChatPlugin=t.initWOAChatPlugin=t.WOAChatPluginEnabled=void 0;var i=(0,n(143).__importDefault)(n(146)),a=window.__WPSPLUGIN__.type.WOAChat,o={pluginType:a},r=window.__WPSPLUGIN__.helper.has(a);t.WOAChatPluginEnabled=r;var s,l=!1;t.getBadgeVisible=function(){return l},t.initWOAChatPlugin=function(){r&&!s&&(s=new Promise((function(e){window.__WPSPLUGIN__.loader.load(o).then((function(t){var n=new t({utils:{showEntryBadge:function(){l=!0,i.default.dispatchEvent(i.default.names.WOAChat.TOGGLE_BADGE_VISIBLE,{visible:!0})},hideEntryBadge:function(){l=!1,i.default.dispatchEvent(i.default.names.WOAChat.TOGGLE_BADGE_VISIBLE,{visible:!1})}}});e(n.plugin)}))}))).then((function(e){e.init()}))},t.getWOAChatPlugin=function(){return r?s||Promise.reject("[".concat(a,"] is not inited.")):Promise.reject("[".concat(a,"] is disabled."))}},4337:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AtMessageBtnplugin=t.initAtMessageBtnPlugin=t.pluginVisible=void 0;var i=window.__WPSPLUGIN__.helper,a=i.types.AtInBox,o=null;t.AtMessageBtnplugin=o,t.pluginVisible=i.has(a),t.initAtMessageBtnPlugin=function(e){t.pluginVisible&&window.__WPSPLUGIN__.loader.loadSingleInstance({pluginType:a}).then((function(n){t.AtMessageBtnplugin=o=n;var i=function(){};e&&(i=e.setCount),n.init({setCount:i})}))}},437:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=(0,i.__importDefault)(n(142)),o=(0,i.__importDefault)(n(166)),r=(0,i.__importDefault)(n(168)),s=(0,i.__importDefault)(n(456)),l=(0,i.__importDefault)(n(251)),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.commandBarId,r=t.children,c=t.altChildIds,u=t.panel,d=t.altRef,p=t.isLazy;return u?(e=p?a.default.cloneElement(u,{ref:d||this.refPanel}):a.default.createElement(s.default,{commandBarId:n},a.default.cloneElement(u,{ref:d||this.refPanel})),a.default.createElement(l.default,{commandBarId:n,ref:this.refAlt,altChildIds:c,iNotI:!0},a.default.createElement(o.default,(0,i.__assign)({},this.props,{onVisibleChange:this.onVisibleChange,panel:e}),r))):a.default.createElement(o.default,(0,i.__assign)({},this.props,{onVisibleChange:this.onVisibleChange,panel:u}),r)},t.placementTypes=o.default.placementTypes,t.DropdownPanel=o.default.DropdownPanel,t.triggerTypes=o.default.triggerTypes,t.propTypes=(0,i.__assign)({commandBarId:r.default.string.isRequired,altRef:r.default.object,isLazy:r.default.bool},o.default.propTypes),t}((0,i.__importDefault)(n(768)).default);t.default=c},438:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useWindowEvent=t.useEventCallback=void 0;var i=n(143),a=n(142);t.useEventCallback=function(e,t){void 0===t&&(t=[]);var n=(0,a.useRef)((function(e){console.log("Cannot call an event handler while rendering.",e)}));return(0,a.useEffect)((function(){n.current=e}),(0,i.__spreadArray)([e],t,!0)),(0,a.useCallback)((function(e){return(0,n.current)(e)}),[n])};t.useWindowEvent=function(e,n){var i=(0,t.useEventCallback)(n);(0,a.useEffect)((function(){return window.addEventListener(e,i),function(){window.removeEventListener(e,i)}}))}},456:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=(0,i.__importStar)(n(142)),o=n(283),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props.commandBarId;e?this.props.children&&"Bundle"===this.props.children.type.name||window.__WPSENV__.reduxDispatch((0,o.altLazyLoad)({id:e})):window.isDebugger&&console.error("AltPanelFragment id is null")},t.prototype.render=function(){return!!this.props.children&&a.default.cloneElement(this.props.children)},t}(a.PureComponent);t.default=r},464:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return c}));var i=n(344),a=n(656),o=function(e){return{types:[i.HTTP_REQUEST,a.a.LOAD_UPDATE_NOTICES_SUCCESS,i.HTTP_FAILURE],callAPI:function(t){return t.get("/api/v3/office/tip/type/"+e).end()}}},r=function(e){return{types:i.HTTP_TYPES,callAPI:function(t){return t.get("/api/v3/office/tip/name/"+e).end()}}},s=function(e){return{types:i.HTTP_TYPES,callAPI:function(t){return t.post("/api/v3/office/tip/"+e).end()}}},l=null,c=function(e,t){var n={content:t};return{types:i.HTTP_TYPES,callAPI:function(t){return l&&l.abort(),(l=t.post("/api/v3/office/search/func/"+e).send(n)).end()}}}},505:function(e,t,n){},5188:function(e,t,n){},5189:function(e,t,n){},5190:function(e,t,n){e.exports=function(e,t){n.e(329).then(n.bind(null,8047)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5191:function(e,t,n){e.exports=function(e,t){n.e(330).then(n.bind(null,6209)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5192:function(e,t,n){},5193:function(e,t,n){},5194:function(e,t,n){e.exports=function(e,t){n.e(328).then(n.bind(null,6211)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5195:function(e,t,n){e.exports=function(e,t){n.e(327).then(n.bind(null,8193)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5196:function(e,t,n){},5197:function(e,t,n){},5198:function(e,t,n){e.exports=function(e,t){n.e(338).then(n.bind(null,6213)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5199:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143);n(5200);var a=(0,i.__importDefault)(n(142)),o=(0,i.__importDefault)(n(160)),r=(0,i.__importDefault)(n(162)),s=(0,i.__importDefault)(n(192)),l=(0,i.__importDefault)(n(155)),c=(0,i.__importDefault)(n(377)),u=(0,i.__importDefault)(n(182)),d=n(45),p=(0,i.__importDefault)(n(3200)),h=u.default.Item,f=l.default.iconTypes.size16,m=window.__WPSPLUGIN__,v=window.CommandBarComponent,w=v.cmbIds.$public,b=function(e){function t(t){var n=e.call(this,t,w.ShareLink)||this;return n.loadSelfPlugin=function(){return(0,i.__awaiter)(n,void 0,void 0,(function(){var e,t,n,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return e=m.loader,t=m.type,[4,e.loadSingleInstance({pluginType:t.ShareFile})];case 1:return n=i.sent(),a=[],n.show?[4,n.show()]:[3,3];case 2:return a=i.sent(),[3,4];case 3:a=this.oldPluginPolyfill(n),i.label=4;case 4:return this.setState({items:a},this.setCmdBar),this.openShare(a),[2]}}))}))},n.openShare=function(e){if((0,d.hasQuery)(p.default.openshare)){if((0,d.removeQuery)(p.default.openshare),0===e.length)return;n.handleItemClick(e[0])}},n.setCmdBar=function(){var e=o.default.findDOMNode(n);window.__WPSENV__.commandbars.push({el:e,text:n.shareVisible?_i18n("applications.public.components.commandbars.Header.ShareLink.share", "分享"):_i18n("applications.public.components.commandbars.Header.ShareLink.invite", "邀请编辑")})},n.handleVisible=function(e){n.setState({visible:e})},n.handleBtnClick=function(){var e=n.state.items;0!==e.length&&n.handleItemClick(e[0])},n.handleItemClick=function(e){var t=n.props.file,i={fid:t.id,source:"weboffice",fname:t.name+t.ext,currentTimeStamp:(new Date).getTime(),eventFrom:"click"};n.setState({visible:!1}),e.click(i),window.collection2("header_share"),window.collectionOnce()},n.renderPanel=function(){return n.state.items.map((function(e,t){return a.default.createElement(h,{key:t,value:e,onClick:n.handleItemClick},e.btnName)}))},n.renderBtns=function(){var e=n.state,t=e.visible,i=e.items;return i.length<=1?a.default.createElement(s.default,{isAuto:!0,onClick:n.handleBtnClick},_i18n("applications.public.components.commandbars.Header.ShareLink.share", "分享")):a.default.createElement(c.default,{className:"share-dropdown-group",visible:t,iconContent:i[0].btnName,isAuto:!0,onIconClick:n.handleBtnClick,onVisibleChange:n.handleVisible},a.default.createElement(u.default,null,n.renderPanel()))},n.shareVisible=m.helper.has(m.type.ShareFile),n.state={items:[]},n}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.user,n=e.file,i=e.isAppReady;this.shareVisible&&i&&this.loadSelfPlugin();var a=n.office_type===r.default.pdf;window.__CONFIG__.isShowHeaderInviteBtn&&!a&&n.user_acl.share&&t.isLogin&&this.setCmdBar()},t.prototype.componentDidUpdate=function(e){var t=this.props.isAppReady;e.isAppReady!==t&&t&&this.shareVisible&&this.loadSelfPlugin()},t.prototype.oldPluginPolyfill=function(e){return[{btnName:_i18n("applications.public.components.commandbars.Header.ShareLink.share", "分享"),click:e.shareFile.bind(e)}]},t.prototype.handleInviteClick=function(){window.openEditInvite()},t.prototype.render=function(){var e=this.props,t=e.user,n=e.file,i=n.office_type===r.default.pdf;return this.shareVisible?this.renderBtns():!(!window.__CONFIG__.isShowHeaderInviteBtn||i||!n.user_acl.share||!t.isLogin)&&a.default.createElement(l.default,{ref:this.refEdit,showBorder:!0,title:_i18n("applications.public.components.commandbars.Header.ShareLink.invite", "邀请编辑"),iconType:f.invite_share,onClick:this.handleInviteClick})},t}(v);t.default=b},5200:function(e,t,n){},5201:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143);n(4333);var a=(0,i.__importDefault)(n(142)),o=(0,i.__importDefault)(n(172)),r=(0,i.__importDefault)(n(192)),s=(0,i.__importDefault)(n(146)),l=n(4334);t.default=function(e){var t=e.inSubMenu,n=e.file,i=e.user,c=i.isLogin,u=function(){s.default.dispatchEvent(s.default.names.ON_EDIT),t&&s.default.dispatchEvent(s.default.names.CLOSE_DROPDOWN_PANEL)};return!!(0,l.shouldMountLoginGuide)(n,i)&&(t?a.default.createElement(o.default,{onClick:u},c?_i18n("applications.public.components.commandbars.Header.HeaderRight.edit", "编辑"):_i18n("applications.public.components.commandbars.Header.HeaderRight.login", "登录")):a.default.createElement("div",{className:"login-guid-btn"},a.default.createElement(r.default,{isAuto:!0,onClick:u},c?_i18n("applications.public.components.commandbars.Header.HeaderRight.edit", "编辑"):_i18n("applications.public.components.commandbars.Header.HeaderRight.login", "登录"))))}},5202:function(e,t,n){},5203:function(e,t,n){},5204:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143);n(5205);var a=(0,i.__importStar)(n(142)),o=(0,i.__importDefault)(n(146)),r=(0,i.__importDefault)(n(192)),s=(0,i.__importDefault)(n(817)),l=(0,i.__importDefault)(n(182)),c=(0,i.__importStar)(n(162)),u=(0,i.__importDefault)(n(172)),d=(0,i.__importDefault)(n(219)),p=(0,i.__importDefault)(n(251)),h=(0,i.__importDefault)(n(456)),f=window.__WPSPLUGIN__.helper,m=window.__WPSPLUGIN__.loader,v=f.has(f.types.OpenWps),w=l.default.Item,b=window.CommandBarComponent.cmbIds.$public,g=(0,c.isEtLike)(window.officeType)||window.officeType===c.default.writer||window.officeType===c.default.pdf||window.officeType===c.default.presentation;t.default=a.default.memo((function(e){var t=this,n=e.user,c=e.openSuccess,y=e.isAppReady,_=e.inSubMenu,C=(0,a.useState)(!1),E=C[0],k=C[1],O=(0,a.useState)([]),P=O[0],S=O[1],M=(0,a.useRef)();(0,a.useEffect)((function(){y&&v&&m.loadSingleInstance({pluginType:f.types.OpenWps}).then((function(e){return(0,i.__awaiter)(t,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:return M.current=e,[4,M.current.show()];case 1:return(t=n.sent()).length>0&&(S(t),window.collection2("header_openwps_show_".concat(t.length))),[2]}}))}))}))}),[y]);var I=function(e){M.current.click(e),_?o.default.dispatchEvent(o.default.names.CLOSE_DROPDOWN_PANEL):k(!1),window.collection2("header_openwpsmore_".concat(e))},N=function(){M.current.click(P[0].id),k(!1),window.collection2("header_openwps")},R=function(e){k(e),e&&window.collection2("header_openwpsmore")},T=function(){return a.default.createElement(s.default,{className:"wps-open-group",visible:E,iconContent:P[0].btnName,onIconClick:N,onVisibleChange:R,commandBarId:b.WPSOpenBtn,altChildIds:[b.openWpsClient,b.openKdocsClient]},a.default.createElement(l.default,null,a.default.createElement(h.default,{commandBarId:b.WPSOpenBtn}),P.map((function(e){return a.default.createElement(p.default,{key:e.id,commandBarId:e.id},a.default.createElement(w,{key:e.id,value:e.id,onClick:I},e.btnName))}))))},D=function(){return P.map((function(e){var t=e.id,n=e.btnName;return a.default.createElement(p.default,{key:t,commandBarId:t},a.default.createElement(u.default,{key:t,value:t,onClick:I},n))}))};return v&&n.isLogin&&c&&g&&y&&P.length>0?_?1===P.length?a.default.createElement(p.default,{commandBarId:b.WPSOpenBtn,altChildIds:[b.openWpsClient,b.openKdocsClient]},a.default.createElement(a.default.Fragment,null,a.default.createElement(h.default,{commandBarId:b.WPSOpenBtn}),D())):a.default.createElement(p.default,{commandBarId:b.WPSOpenBtn,altChildIds:[b.openWpsClient,b.openKdocsClient]},a.default.createElement(d.default,{title:P[0].btnName},a.default.createElement(h.default,{commandBarId:b.WPSOpenBtn}),D())):1===P.length?a.default.createElement(r.default,{onClick:N},P[0].btnName):T():null}))},5205:function(e,t,n){},5206:function(e,t,n){},5207:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=n(149),o=(0,i.__importStar)(n(142)),r=(0,i.__importDefault)(n(155)),s=(0,i.__importDefault)(n(4335)),l=n(228),c=(0,i.__importDefault)(n(172)),u=n(4336),d=(0,i.__importDefault)(n(146)),p=r.default.iconTypes.other;t.default=(0,a.connect)((function(e){var t=e.public;return{connected:t.network.connected,isLogin:t.user.isLogin,isAppReady:t.network.isAppReady}}))((function(e){var t=e.connected,n=e.isLogin,i=e.isAppReady,a=e.inSubMenu,h=(0,u.getBadgeVisible)(),f=(0,o.useState)(!1),m=f[0],v=f[1],w=(0,o.useState)(h),b=w[0],g=w[1],y=(0,o.useCallback)((function(){window.collectionOtl("header_woa_chat"),n?(0,u.getWOAChatPlugin)().then((function(e){e.launch()})):(0,l.gotoLogin)(!1)}),[n]),_=function(e){var t=e.detail.visible;g(t)};return(0,o.useEffect)((function(){return i&&((0,u.initWOAChatPlugin)(),(0,u.getWOAChatPlugin)().then((function(){v(!0)}))),window.addEventListener(d.default.names.WOAChat.TOGGLE_BADGE_VISIBLE,_),function(){window.removeEventListener(d.default.names.WOAChat.TOGGLE_BADGE_VISIBLE,_)}}),[i]),m?a?o.default.createElement(c.default,{onClick:y,disabled:!t},_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.chat", "会话")):o.default.createElement(s.default,{show:b,dot:!0,color:"#ff4d4f"},o.default.createElement(r.default,{showBorder:!0,className:"chat-in-header",title:_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.chat", "会话"),iconType:p.woa_chat,disabled:!t,onClick:y})):null}))},5208:function(e,t,n){},5209:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143);n(5210);var a=(0,i.__importStar)(n(142)),o=(0,i.__importDefault)(n(192)),r=(0,i.__importDefault)(n(146)),s=(0,i.__importDefault)(n(5211)),l=n(438),c=(0,i.__importDefault)(n(172));t.default=function(e){var t=e.isAppReady,n=e.inSubMenu,i=(0,a.useState)(!1),u=i[0],d=i[1],p=(0,a.useState)(!0),h=p[0],f=p[1],m=function(){n&&r.default.dispatchEvent(r.default.names.CLOSE_DROPDOWN_PANEL)},v=function(){r.default.dispatchEvent(r.default.names.file.ON_TOGGLE_DRAFT,{enable:!1}),m()},w=function(){r.default.dispatchEvent(r.default.names.file.ON_SAVE_DRAFT),m()};(0,l.useWindowEvent)(r.default.names.file.ON_SAVE_VERSION,(function(){d(!0)}));var b=function(){f(!1),d(!1)};(0,a.useEffect)((function(){return t&&(f(!0),window.addEventListener("click",b),window.addEventListener("touchstart",b)),function(){window.removeEventListener("click",b),window.removeEventListener("touchstart",b)}}),[t]);return n?a.default.createElement(a.default.Fragment,null,a.default.createElement(c.default,{onClick:v},_i18n("applications.public.components.commandbars.Header.HeaderRight.Draft.exitDraft", "退出试算模式")),a.default.createElement(c.default,{onClick:w},_i18n("applications.public.components.commandbars.Header.HeaderRight.Draft.saveDraft", "保存"))):a.default.createElement("div",{className:"header-right-draft-btn",onClick:b,onTouchStart:b},a.default.createElement(s.default,{text:_i18n("applications.public.components.commandbars.Header.HeaderRight.Draft.exitTip", "当前文档处于试算模式"),show:h},a.default.createElement(o.default,{onClick:v,className:"exit-draft-btn"},_i18n("applications.public.components.commandbars.Header.HeaderRight.Draft.exitDraft", "退出试算模式"))),a.default.createElement(s.default,{text:_i18n("applications.public.components.commandbars.Header.HeaderRight.Draft.saveTip", "若要保存回原始⽂档，请点击此按钮"),show:u},a.default.createElement(o.default,{onClick:w},_i18n("applications.public.components.commandbars.Header.HeaderRight.Draft.saveDraft", "保存"))))}},5210:function(e,t,n){},5211:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143);n(5212);var a=(0,i.__importStar)(n(142)),o=(0,i.__importDefault)(n(148)),r=(0,a.memo)((function(e){var t=e.text,n=e.show,i=e.children;return a.default.createElement("div",{className:"notice-tip-wrap"},i,a.default.createElement("div",{className:"notice-tip "+(n?"show":"")},a.default.createElement(o.default,{type:"16 tip"}),a.default.createElement("div",{className:"notice-tip-content"},t)))}));t.default=r},5212:function(e,t,n){},5213:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=(0,i.__importStar)(n(142)),o=(0,i.__importDefault)(n(155)),r=(0,i.__importDefault)(n(146)),s=(0,i.__importDefault)(n(172)),l=(0,i.__importDefault)(n(4335)),c=n(4337),u=(0,i.__importDefault)(n(251));n(5214);var d=o.default.iconTypes,p=window.CommandBarComponent.cmbIds.$public,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={count:0},t.setCount=function(e){var n=parseInt(e.toString())||0;t.setState({count:n})},t.handleClick=function(){t.props.inSubMenu&&r.default.dispatchEvent(r.default.names.CLOSE_DROPDOWN_PANEL),c.AtMessageBtnplugin&&c.AtMessageBtnplugin.click()},t}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){if(c.AtMessageBtnplugin&&(c.AtMessageBtnplugin.setCountFunction&&c.AtMessageBtnplugin.setCountFunction(this.setCount),c.AtMessageBtnplugin.getCount)){var e=c.AtMessageBtnplugin.getCount();this.setCount(e||0)}},t.prototype.render=function(){var e=this.props,t=e.inSubMenu,n=e.user;if(!c.pluginVisible||!n.isLogin)return null;var i=this.state.count,r=i>99?"···":i,h=a.default.classNames({"component-badge-at-inbox":1,"component-badge-more":i>99});return t?a.default.createElement(u.default,{commandBarId:p.At},a.default.createElement(s.default,{onClick:this.handleClick},_i18n("applications.public.components.commandbars.Header.HeaderRight.AtBtn.title", "提及"))):a.default.createElement(l.default,{content:r,show:i>0,className:h,color:"#417FF9"},a.default.createElement(u.default,{commandBarId:p.At},a.default.createElement(o.default,{showBorder:!0,title:_i18n("applications.public.components.commandbars.Header.HeaderRight.AtBtn.title", "提及"),iconType:d.other.topbar_at_in_box,onClick:this.handleClick})))},t}(a.PureComponent);t.default=h},5214:function(e,t,n){},5215:function(e,t,n){},5216:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143);n(5217);var a=(0,i.__importStar)(n(142)),o=n(149),r=(0,i.__importDefault)(n(146)),s=(0,i.__importDefault)(n(252)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClose=function(){t.refFail.current&&window.Notice.close()},t.handleFail=function(){t.props.connected&&window.Notice.show({icon:s.default.size16.warning_red,content:t.renderFail()})},t.handleReloadCdn=function(){var e=window.__WPSENV__.reloadCdnHref;e?(window.location.href=e,window.collection2("load_error_change_cdn")):window.location.reload()},t.refFail=a.default.createRef(),t}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){window.addEventListener(r.default.names.file.ON_LOAD_FILE_FAIL,this.handleFail),window.addEventListener(r.default.names.network.ON_DISCONNECTED,this.handleClose)},t.prototype.componentWillUnmount=function(){window.removeEventListener(r.default.names.file.ON_LOAD_FILE_FAIL,this.handleFail),window.removeEventListener(r.default.names.network.ON_DISCONNECTED,this.handleClose)},t.prototype.renderFail=function(){return a.default.createElement("div",{className:"load-file-fail",ref:this.refFail},_i18n("applications.public.components.commandbars.Header.ErrorLoad.text", "局部功能加载异常，请重试"),a.default.createElement("span",{className:"load-file-retry",onClick:this.handleReloadCdn},_i18n("applications.public.components.commandbars.Header.ErrorLoad.btn", "刷新")))},t.prototype.render=function(){return!1},t}(a.PureComponent);t.default=(0,o.connect)((function(e){return{connected:e.public.network.connected}}))(l)},5217:function(e,t,n){},5218:function(e,t,n){e.exports=function(e,t){n.e(331).then(n.bind(null,8144)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5219:function(e,t,n){e.exports=function(e,t){n.e(337).then(n.bind(null,6221)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},5220:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=(0,i.__importStar)(n(142)),o=(0,i.__importDefault)(n(205)),r=window.screen.width,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showConfirm:!1},t.handleOrientation=function(){clearTimeout(t.delayTimer),t.delayTimer=window.setTimeout((function(){var e=Math.abs(window.orientation),n=document.body.clientHeight;90===e&&n>r?t.setState({showConfirm:!0}):t.setState({showConfirm:!1})}),200)},t.handleOk=function(){window.location.reload()},t.handleCancel=function(){t.setState({showConfirm:!1})},t}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){window.addEventListener("orientationchange",this.handleOrientation)},t.prototype.componentWillUnmount=function(){clearTimeout(this.delayTimer),window.removeEventListener("orientationchange",this.handleOrientation)},t.prototype.render=function(){return!!this.state.showConfirm&&a.default.createElement(o.default,{onOk:this.handleOk,onCancel:this.handleCancel,okBtnText:_i18n("applications.public.components.commandbars.Header.HeaderOthers.IpadWeixinReload.confirmText", "立即刷新")},_i18n("applications.public.components.commandbars.Header.HeaderOthers.IpadWeixinReload.content", "由于浏览器原因，导致页面布局错误，请刷新页面。"))},t}(a.PureComponent);t.default=s},569:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=n(142),p=n.n(d),h=n(168),f=n.n(h),m=n(145),v=n(166),w=n(148),b=n(151),g=n.n(b),y=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.handleIconClick=function(e){Object(m.stopBubble)(e),i.props.visible&&i.props.onVisibleChange(!1),i.props.onIconClick(e)},o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.children,i=e.iconContent,a=e.disabled,o=e.title,r=e.iconType,s=e.visible,l=e.onVisibleChange,c=a?void 0:this.handleIconClick,u=this.getClassName();return p.a.createElement(v.default,{visible:s,panel:n,disabled:a,onVisibleChange:l},p.a.createElement(g.a,{title:o},p.a.createElement("div",{ref:this.refWrap,id:t,className:u},p.a.createElement("div",{className:"left-btn",onClick:c},r&&p.a.createElement(w.default,{type:r}),i),p.a.createElement("div",{className:"right-btn"}))))}}]),t}(n(421).a);y.propTypes={id:f.a.string,visible:f.a.bool.isRequired,className:f.a.string,disabled:f.a.bool,title:f.a.oneOfType([f.a.object,f.a.string]),iconType:f.a.string,iconContent:f.a.oneOfType([f.a.object,f.a.string]),onIconClick:f.a.func,iconSelected:f.a.bool,onVisibleChange:f.a.func.isRequired},t.default=y},590:function(e,t,n){},638:function(e,t,n){"use strict";n.r(t),n.d(t,"rangeMap",(function(){return a}));var i=window.CommandBarComponent.cmbIds.et,a={cell:{value:"cell",text:_i18n("applications.public.constants.historyTypes.cell", "单元格最近的改动"),cmbId:i.RightMenuHistory},d1:{value:"d1",msg:_i18n("applications.public.constants.historyTypes.msg1", "今天没有任何改动"),text:_i18n("applications.public.constants.historyTypes.today", "今天的改动"),cmbId:i.RightMenuHistoryToady},d3:{value:"d3",msg:_i18n("applications.public.constants.historyTypes.msg2", "最近3天没有任何改动"),text:_i18n("applications.public.constants.historyTypes.threeDay", "最近3天的改动"),cmbId:i.RightMenuHistoryThreeDay},d7:{value:"d7",msg:_i18n("applications.public.constants.historyTypes.msg3", "最近7天没有任何改动"),text:_i18n("applications.public.constants.historyTypes.sevenDay", "最近7天的改动"),cmbId:i.RightMenuHistorySevenDay}};t.default={INVALID:0,MODIFY:1,ROLL_BACK:2,USER_JOIN:3,OFFLINE_UPDATE:4,INSERT_OBJECT:5}},701:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return u}));var i=n(146),a=n(656),o=0,r=0,s=function(e,t){o=e;var n=e+r;i.default.dispatchEvent(i.default.names.ON_TASK_PANE_WIDTH_CHANGE,{width:n}),!0!==t&&i.default.cooper.onContainerResize()},l=function(e){r=e},c=function(){return o},u=function(e){return function(t){t({type:a.a.LOGIN_GUIDE_VISIBLE,visible:e})}}},702:function(e,t,n){"use strict";n.d(t,"e",(function(){return g})),n.d(t,"f",(function(){return y})),n.d(t,"d",(function(){return _})),n.d(t,"j",(function(){return C})),n.d(t,"i",(function(){return E})),n.d(t,"h",(function(){return k})),n.d(t,"g",(function(){return O}));var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=n(142),p=n.n(d),h=n(228);n.d(t,"c",(function(){return h.gotoLogin}));var f=n(162),m=n(146);n.d(t,"a",(function(){return m.default}));var v=n(172),w=n(241),b=n(1936);n.d(t,"k",(function(){return b.a}));var g=window.officeType===f.default.spreadsheet,y=window.officeType===f.default.ksheet,_=window.officeType===f.default.dbsheet,C=window.officeType===f.default.writer,E=window.officeType===f.default.presentation,k=(window.officeType,f.default.pdf,window.officeType===f.default.outline),O=window.officeType===f.default.whiteboard,P=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.visible=!0,i.text="",i.disabled=!1,i.disabledTips="",i.bottomless=!1,i.handleClick=function(){var e=i.onClick();i.props.onClose(i.name,e)},o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"onClick",value:function(){return this.props.user.isLogin?this.disabled?(window.Toast.warn(this.disabledTips),!1):(this.onExecute(),!0):(Object(h.gotoLogin)(!1),!1)}},{key:"render",value:function(){if(!this.visible)return!1;var e=this.props,t=e.divider,n=e.user.isLogin&&this.disabled;return p.a.createElement(p.a.Fragment,null,p.a.createElement(v.default,{className:"header-menu-item",disabledTag:n,onClick:this.handleClick},p.a.createElement("div",{className:"menu-text"},this.text)),t&&p.a.createElement(w.default,null))}}]),t}(d.PureComponent);t.b=P},768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=(0,i.__importStar)(n(142)),o=(0,i.__importDefault)(n(160)),r=(0,i.__importDefault)(n(251)),s=(0,i.__importDefault)(n(994)),l=n(162),c=(0,i.__assign)((0,i.__assign)({},s.default[(0,l.getOfficeName)(window.officeType)]),s.default.$public),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.panelVisible=!1,t.refPanel=a.default.createRef(),t.refAlt=a.default.createRef(),t.isUnmount=!1,t.onVisibleChange=function(e){var n=t.props.onVisibleChange;t.panelVisible=e,n&&n(e)},t.getElement=function(){if(!t.isUnmount)return t.refAlt.current?t.refAlt.current.getElement():o.default.findDOMNode(t)},t.getAltChildren=function(){if(!t.panelVisible)return[];var e=t.props,n=e.refLazyPanel,i=e.altRef,a=i||t.refPanel,o=n?n.current:a.current;if(o){var r=o.getAltChildren;if(r)return r();var s=t.props.altChildIds;if((!s||0===s.length)&&t.refAlt.current){var l=t.props.commandBarId;s=t.refAlt.current.props.alt[l]}return s&&s.length>0&&t.refAlt&&t.refAlt.current?t.refAlt.current.getAltChildren():[]}return[]},t.getAltCfg=function(){var e=t.props.commandBarId;return c[e]?(0,i.__assign)((0,i.__assign)({},c[e]),{id:e}):{id:e}},t}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props.commandBarId;r.default.pushRef(e,{ref:this})},t.prototype.componentWillUnmount=function(){this.isUnmount=!0;var e=this.props.commandBarId;r.default.remove(e)},t}(a.PureComponent);t.default=u},8034:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(3),r=n.n(o),s=n(25),l=n.n(s),c=n(42),u=n.n(c),d=(n(5188),n(142)),p=n.n(d),h=n(149),f=n(162),m=n(45),v=n(147),w=n.n(v),b=(n(5189),n(168)),g=n.n(b),y=n(150),_=n.n(y),C=n(437),E=n.n(C),k=n(155),O=n(1936),P=n(164),S=n(5190),M=n.n(S),I=n(5191),N=n.n(I),R=k.default.iconTypes.size16,T=window.CommandBarComponent,D=T.cmbIds.$public,L=_()({},O.a.SaveAsCopy,N.a),A=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,D.MoreMenus));return n.state={visible:!1,subPanel:null},n.handleVisibleChange=function(e){window.collection2("click_moremenus"),n.setState({visible:e})},n.handleClose=function(e,t,i){var a=!1===t?null:L[e];n.setState({visible:i||!1,subPanel:a}),window.collection2("HeaderMoreMenu_"+e),window.collectionOnce()},n.handleCloseSubPanel=function(){n.setState({subPanel:null})},n}return u()(t,e),r()(t,[{key:"componentDidUpdate",value:function(e){e.isAppReady!==this.props.isAppReady&&Object(P.default)(M.a)}},{key:"renderPanel",value:function(){if(this.state.visible)return Object(P.default)(M.a,{onClose:this.handleClose})}},{key:"renderSubPanel",value:function(){var e=this.state.subPanel;if(e)return Object(P.default)(e,{onClose:this.handleCloseSubPanel})}},{key:"render",value:function(){var e=this.state.visible,t=this.renderPanel();return p.a.createElement(p.a.Fragment,null,p.a.createElement(E.a,{isSetHeight:!0,panel:t,visible:e,onVisibleChange:this.handleVisibleChange,commandBarId:D.MoreMenus},p.a.createElement(k.default,{className:"header-more-btn",selected:e,iconType:R.topbar_more,title:_i18n("applications.public.components.commandbars.Header.MoreBtn.more", "文件")})),this.renderSubPanel())}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.visible,i=t.subPanel;return e.connected||!n&&!i?null:{visible:!1,subPanel:null}}}]),t}(T),H=Object(h.connect)((function(e){var t=e.public.network;return{connected:t.connected,isAppReady:t.isAppReady}}))(A),B=n(1750),W=(n(5192),n(5193),n(145)),x=n(144),V=n(380),j=n(276),F=n(146),U=n(166),G=n(182),K=k.default.iconTypes.size16,z={path:"",path_url:""},q=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._unMount=!1,n.handleRename=function(){var e=n.props,t=e.onClose;(0,e.onRename)(),t()},n.handleOpenPath=function(){n.props.onClose(),window.open(n.state.path_url),window.collection2("header_filename_pathclick")},n.state={path:z.path,path_url:z.url,pathError:!1},n}return u()(t,e),r()(t,[{key:"componentWillUnmount",value:function(){this._unMount=!0}},{key:"_showNameOnly",value:function(){if(!this._unMount){var e=this.state,t=e.path,n=e.pathError;t||n||this.setState({pathError:!0})}}},{key:"render",value:function(){var e=this.props.file;return p.a.createElement(G.default,{className:"fileinfo-filename-panel"},p.a.createElement("div",{className:"name box"},p.a.createElement("div",{className:"file-name"},e.name),p.a.createElement(k.default,{className:"btn",iconType:K.edit_name,onClick:this.handleRename})))}}]),t}(d.PureComponent),Y=window.__WPSPLUGIN__,X=Y.helper,$=Y.loader,J=X.types.FilePathHover,Q=X.has(J),Z=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.state={visible:!1},i._isUnmount=!1,i._pluginInstance=null,i.refPanel=p.a.createRef(),o=n,l()(i,o)}var n;return u()(t,e),r()(t,[{key:"componentDidMount",value:(n=w()(regeneratorRuntime.mark((function e(){var t,n,i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.file,i=t.onClose,a=t.onRename,e.next=3,$.loadSingleInstance({pluginType:J});case 3:if(this._pluginInstance=e.sent,!this._pluginInstance.init){e.next=7;break}return e.next=7,this._pluginInstance.init(n.group_id,n.id);case 7:this._isUnmount||this.setState({visible:!0},(function(){var e=o.refPanel.current.getContentElement();o._pluginInstance.show({container:e,file:n,onClose:i,onRename:a})}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this._isUnmount=!0,this._pluginInstance&&this._pluginInstance.close()}},{key:"render",value:function(){return this.state.visible?p.a.createElement(G.default,{className:Q?"fileinfo-filename-plugin-panel":"",ref:this.refPanel}):null}}]),t}(d.PureComponent),ee=n(169),te=U.default.triggerTypes,ne=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.submiting=!1,n.state={onLine:!0,name:"",isEditing:!1,panelVisible:!1,readOnly:!1,readOnlyAndDisable:!1},n.delayTimer=null,n.handleMouseLeave=function(){clearTimeout(n.delayTimer)},n.refInput=p.a.createRef(),n.handleFilenameClick=n.handleFilenameClick.bind(n),n.handleInputChange=n.handleInputChange.bind(n),n.handleInputKeyDown=n.handleInputKeyDown.bind(n),n.setInputFocus=n.setInputFocus.bind(n),n.handleWindowClick=n.handleWindowClick.bind(n),n.handleOnline=n.handleOnline.bind(n),n.handleOffline=n.handleOffline.bind(n),n.handleHoverVisible=n.handleHoverVisible.bind(n),n.handleHoverClose=n.handleHoverClose.bind(n),n}var n;return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){window.addEventListener(F.default.names.file.ON_RENAME,this.handleFilenameClick),window.addEventListener("offline",this.handleOffline),window.addEventListener("online",this.handleOnline),window.addEventListener("mousedown",this.handleWindowClick,!0),window.addEventListener("touchend",this.handleWindowClick,!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener(F.default.names.file.ON_RENAME,this.handleFilenameClick),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("online",this.handleOnline),window.removeEventListener("mousedown",this.handleWindowClick,!0),window.removeEventListener("touchend",this.handleWindowClick,!0),clearTimeout(this.delayTimer)}},{key:"handleOffline",value:function(){this.setState({onLine:!1,isEditing:!1,name:""})}},{key:"handleOnline",value:function(){this.setState({onLine:!0})}},{key:"handleWindowClick",value:function(e){var t=this.refInput.current;this.state.isEditing&&!t.contains(e.target)&&(this.submitFileName()||W.stopBubble(e))}},{key:"setInputFocus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.refInput.current;t.focus(),e&&t.select()}},{key:"handleFilenameClick",value:function(e){var t=this;e&&e.preventDefault();var n=this.props.file,i=this.state,a=i.onLine,o=i.isEditing,r=i.readOnly,s=i.readOnlyAndDisable;o||window.__WPSENV__.draft||s||(r&&window.Toast.warn(_i18n("applications.public.components.commandbars.Header.FileInfo.FileName.tips1", "您无重命名权限")),a?(this.setState({isEditing:!0,name:n.name,readOnly:r},(function(){t.setInputFocus(!x.isPad)})),window.collection2("header_filename_edit")):window.Toast.error(_i18n("applications.public.components.commandbars.Header.FileInfo.FileName.tips2", "当前网络不可用，请检查网络设置")))}},{key:"handleInputChange",value:function(e){this.setState({name:e.target.value})}},{key:"handleInputKeyDown",value:function(e){Object(ee.isMatchShortCutKey)(e,[ee.Keys.Esc])?this.setState({isEditing:!1,name:"",panelVisible:!1}):Object(ee.isMatchShortCutKey)(e,[ee.Keys.Enter])&&(W.stopBubble(e),this.submitFileName())}},{key:"handleHoverVisible",value:function(e){var t=this;window.__WPSENV__.draft||this.state.readOnlyAndDisable||(clearTimeout(this.delayTimer),e?this.delayTimer=setTimeout((function(){t.setState({panelVisible:!0})}),500):this.setState({panelVisible:!1}))}},{key:"handleHoverClose",value:function(){clearTimeout(this.delayTimer),this.setState({panelVisible:!1})}},{key:"submitFileName",value:function(){var e=this.state.name.trim();return this.props.file.name!==e&&e?/[\\\/\:\*\?\"\<\>\|]/.test(e)?(window.Toast.error(_i18n("applications.public.components.commandbars.Header.FileInfo.FileName.fileNameError", "文件名不能包含下列任何字符：")+'\n\\ / " : * ? " < > |'),!1):(this.doSubmit(),!0):(this.setState({isEditing:!1,panelVisible:!1}),!0)}},{key:"doSubmit",value:(n=w()(regeneratorRuntime.mark((function e(){var t,n,i,a,o,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.submiting){e.next=2;break}return e.abrupt("return");case 2:return this.submiting=!0,t=this.props,n=t.dispatch,i=t.file,a=t.readonly,o=this.state.name,r=""+o.trim()+i.ext,e.next=8,n(j.changeFilename(window.urlFileId,r));case 8:(s=e.sent).error?"fileNameConflict"===s.result?this.setState({isEditing:!1,panelVisible:!1}):this.setInputFocus(!x.isPad):(a&&window.Toast.success(_i18n("applications.public.components.commandbars.Header.FileInfo.FileName.renameSuccess", "文件名修改成功")),F.default.dispatchEvent(F.default.names.cooper.ON_DOCUMENT_SAVEING),this.setState({isEditing:!1,panelVisible:!1}),F.default.dispatchEvent(F.default.names.cooper.ON_DOCUMENT_SAVE_SUCCESS),Object(V.refreshFileList)()),this.submiting=!1,window.collection2("header_filename_submit");case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this.props,t=e.file,n=e.dispatch,i=this.state,a=i.isEditing,o=i.name,r=i.panelVisible,s=i.readOnly,l=i.readOnlyAndDisable,c=p.a.classNames({"no-permission":l},"filename"),u=p.a.classNames({"filename-readonly":a&&s}),d=p.a.createElement(q,{file:t,dispatch:n,onClose:this.handleHoverClose,onRename:this.handleFilenameClick}),h=p.a.createElement(Z,{file:t,onClose:this.handleHoverClose,onRename:this.handleFilenameClick});return p.a.createElement("div",{className:"filename-wrap"},!a&&p.a.createElement(U.default,{panelClass:"filename-dropdown-panel",panel:Q?h:d,visible:r,trigger:te.hover,onVisibleChange:this.handleHoverVisible,onMouseLeaveDropBtn:this.handleMouseLeave,onClick:this.handleFilenameClick},p.a.createElement("div",{className:c},t.name)),a&&p.a.createElement("div",{className:"input-wrap"},p.a.createElement("input",{ref:this.refInput,className:u,maxLength:240,value:o,onChange:this.handleInputChange,readOnly:s,onKeyDown:this.handleInputKeyDown}),p.a.createElement("div",{className:"content-hidden"},o)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=!e.file.user_acl.rename;return t.readOnly!==n?{readOnly:n,readOnlyAndDisable:n&&!window.__CONFIG__.isShowNoPermissionComponent}:null}}]),t}(d.PureComponent),ie=n(5194),ae=n.n(ie),oe=n(5195),re=n.n(oe),se=window.__WPSPLUGIN__,le=se.helper,ce=se.loader,ue=le.has(le.types.FileLocation),de=window.CommandBarComponentFragment,pe=window.CommandBarComponent.cmbIds.$public,he=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleHeaderLeftInsertPluginRef=function(e){n.HeaderLeftInsertPluginRef=e},n.isInited=!1,n.refFileName=p.a.createRef(),n.HeaderLeftInsertType=le.types.FileTagsStatus,n.hasHeaderLeftInsertPlugin=le.has(n.HeaderLeftInsertType),n}var n,i;return u()(t,e),r()(t,[{key:"loadHeaderLeftInsertPlugin",value:(i=w()(regeneratorRuntime.mark((function e(){var t,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasHeaderLeftInsertPlugin){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,window.__WPSPLUGIN__.loader.load({pluginType:this.HeaderLeftInsertType});case 4:return t=e.sent,n=this.HeaderLeftInsertPluginRef,i=new t({messagePush:this.onHeaderLeftInsertPluginGet,layout:{getPluginContainer:function(){return n}}}),e.next=9,i.plugin;case 9:return(a=e.sent).init&&a.init(Object.assign({},this.props,{readOnlyComment:window.APP.isReadOnlyComment()})),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"componentDidMount",value:function(){ue&&this.props.isAppReady&&this._initPlugin(),this.hasHeaderLeftInsertPlugin&&this.props.isAppReady&&(this.HeaderLeftInsertPlugin=this.loadHeaderLeftInsertPlugin())}},{key:"componentDidUpdate",value:function(e){ue&&!e.isAppReady&&this.props.isAppReady&&this._initPlugin(),!e.isAppReady&&this.props.isAppReady&&(this.HeaderLeftInsertPlugin=this.loadHeaderLeftInsertPlugin())}},{key:"_initPlugin",value:(n=w()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInited){e.next=2;break}return e.abrupt("return");case 2:return this.isInited=!0,e.next=5,ce.loadSingleInstance({pluginType:le.types.FileLocation});case 5:this._pluginInstance=e.sent,this._pluginInstance.init({container:this.refFileName.current});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this.props,t=e.file,n=e.user,i=e.dispatch,a=e.contentReadonly,o=e.connected,r=e.whiteBg,s=e.isAppReady;if(t.user_acl.isDefault)return!1;var l=a||!t.user_acl.update,c=window.__CONFIG__.isFileStar&&n.isLogin&&!!t.supportTag;return p.a.createElement("div",{className:"component-header-file-info"},p.a.createElement(de,{cmbId:pe.FileName},p.a.createElement("div",{className:"file-name"},p.a.createElement(ne,{dispatch:i,file:t,readonly:l}),this.hasHeaderLeftInsertPlugin?p.a.createElement("div",{id:this.HeaderLeftInsertType+"_container",className:"file-star-status",ref:this.handleHeaderLeftInsertPluginRef}):p.a.createElement(p.a.Fragment,null,Object(P.default)(re.a,{dispatch:i,visible:c,file:t}),!window.__WPSENV__.draft&&Object(P.default)(ae.a,{dispatch:i,file:t,user:n,readonly:l,connected:o,isAppReady:s,whiteBg:r})))),p.a.createElement(de,{cmbId:pe.FileInfo},p.a.createElement("div",{className:"file-info"},ue&&p.a.createElement("div",{ref:this.refFileName,className:"file-info-path"}))))}}]),t}(d.PureComponent),fe=k.default.iconTypes.size16,me=window.CommandBarComponent,ve=me.cmbIds.$public,we=window.__WPSPLUGIN__.helper,be=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ve.HeaderLeft));n.backPlugin={pluginType:we.types.Back},n.timer=null,n.refBtn=p.a.createRef(),n.handleBack1=n.handleBack.bind(n,0),n.handleBack2=n.handleBack.bind(n,1);var i=n.getLogoTitle(),o=i.logoTitle,r=i.logoClick,s=window.__CONFIG__.header.isShowBrand;return n.state={showBrand:s,showFileInfo:!s,showBrandText:!1,logoTitle:o,logoClick:r},n}var n;return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){this.state.logoClick&&this.backPlugin&&window.__WPSENV__.commandbars.push({el:this.refBtn,text:this.state.logoTitle}),this.props.openSuccess&&this.startTimer()}},{key:"componentDidUpdate",value:function(e,t){e.openSuccess!==this.props.openSuccess&&this.startTimer()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"startTimer",value:function(){var e=this;this.state.showFileInfo||(this.setState({showBrandText:!0}),this.timer=setTimeout((function(){e.timer=null,e.setState({showFileInfo:!0,showBrandText:!1})}),2e3))}},{key:"handleBack",value:(n=w()(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.__WPSPLUGIN__.loader,e.next=3,n.loadSingleInstance(this.backPlugin);case 3:e.sent.tap({number:t}),window.collection2("header_logo");case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getLogoTitle",value:function(){var e=void 0,t=void 0;return window.__WPSPLUGIN__.loader.search(this.backPlugin)&&this.backPlugin&&(e=_i18n("applications.public.components.commandbars.Header.logoTitle", "{productTitle}首页"),t=this.handleBack2),{logoTitle:e,logoClick:t}}},{key:"renderLogoAndFile",value:function(e,t){var n=this.props,i=n.dispatch,a=n.contentReadonly,o=n.connected,r=n.user,s=n.file,l=n.whiteBg,c=n.isAppReady;return this.state.showFileInfo?p.a.createElement(p.a.Fragment,null,p.a.createElement(B.a,{hoverSwitch:window.__CONFIG__.header.isShowBrand,title:e,onClick:t}),p.a.createElement(he,{dispatch:i,contentReadonly:a,file:s,user:r,connected:o,isAppReady:c,whiteBg:l})):p.a.createElement(p.a.Fragment,null,p.a.createElement(B.a,{officeType:f.default.unknown}),p.a.createElement("div",{className:"brand-wrap"},p.a.createElement("div",{className:"brand-name"},_i18n("applications.public.components.commandbars.Header.brandName", "{productTitle}"))))}},{key:"render",value:function(){var e=this.props.style,t=this.state,n=t.showBrand,i=t.logoTitle,a=t.logoClick,o=this.renderLogoAndFile(i,a),r="component-header-left";return n&&(r+=" show-brand"),p.a.createElement("div",{className:r,style:e},a&&p.a.createElement(k.default,{ref:this.refBtn,className:"home-btn",title:i,iconType:fe.back_normal,onClick:this.handleBack1}),p.a.createElement(H,null),o)}},{key:"__visible",set:function(e){this.baseVisible=e,this.findDOMNode().style.visibility=e?"":"hidden"},get:function(){return this.baseVisible}}]),t}(me);be.propTypes={style:g.a.object.isRequired,contentReadonly:g.a.bool.isRequired,whiteBg:g.a.bool};var ge=Object(h.connect)((function(e){var t=e.public;return{user:t.user,file:t.file,connected:t.network.connected,openSuccess:t.network.openSuccess,isAppReady:t.network.isAppReady}}),null,null,{forwardRef:!0})(be),ye=(n(5196),n(2681)),_e=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e.commandBarId||"Tab"+e.info.tabKey));return n.handleClick=n.handleClick.bind(n),n}return u()(t,e),r()(t,[{key:"handleClick",value:function(){var e=this.props,t=e.selected,n=e.info;t||(this.props.onActive(n),window.collection2("header_tab_"+n.tabKey))}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.info,i=e.onImgLoad,a=-1!==n.text.indexOf("//"),o="tab-btn";return t&&(o+=" selected"),a&&(o+=" img-tab"),p.a.createElement("div",{id:n.tabKey,className:o,onClick:this.handleClick},a&&p.a.createElement("img",{src:n.text,alt:"",onLoad:i}),!a&&n.text)}}]),t}(window.CommandBarComponent);_e.propTypes={info:g.a.shape({tabKey:g.a.string.isRequired,text:g.a.string.isRequired}).isRequired,selected:g.a.bool.isRequired,onActive:g.a.func.isRequired,onImgLoad:g.a.func.isRequired,commandBarId:g.a.string};var Ce=_e,Ee=n(251),ke=n.n(Ee),Oe=window.CommandBarComponent,Pe=Oe.cmbIds.$public,Se=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Pe.HeaderMiddle));n.refDiv=p.a.createRef(),n.handleItemActive=n.handleItemActive.bind(n),n.handleSwitchTab=n.handleSwitchTab.bind(n);var i=W.getPageOfficeType(),o=Object(ye.a)(i);return n.state={officeType:i,items:o,activeItem:o.length?o[0]:null},n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){window.addEventListener(F.default.names.SWITCH_COMMANDBAR_TAB,this.handleSwitchTab)}},{key:"componentWillUnmount",value:function(){window.removeEventListener(F.default.names.SWITCH_COMMANDBAR_TAB,this.handleSwitchTab)}},{key:"handleSwitchTab",value:function(e){var t=e.detail.tabKey,n=this.state.items.find((function(e){return e.tabKey===t}));this.setState({activeItem:n})}},{key:"handleItemActive",value:function(e){this.setState({activeItem:e});var t={tabKey:e.tabKey};F.default.dispatchEvent(F.default.names.SWITCH_COMMANDBAR_TAB,t)}},{key:"getWidth",value:function(){return this.refDiv.current?this.refDiv.current.clientWidth:0}},{key:"render",value:function(){var e=this,t=this.props,n=t.visible,i=t.onImgLoad,a=this.state,o=a.officeType,r=a.items,s=a.activeItem,l=r.map((function(t,n){return p.a.createElement(ke.a,{key:t.tabKey,commandBarId:t.commandBarId||"Tab"+t.tabKey},p.a.createElement(Ce,{key:t.tabKey,commandBarId:t.commandBarId||"Tab"+t.tabKey,info:t,selected:t===s,onActive:e.handleItemActive,onImgLoad:i}))})),c="component-header-middle "+o;return n||(c+=" visibility0"),0===l.length?null:p.a.createElement("div",{ref:this.refDiv,className:c},l)}}]),t}(Oe);Se.altChildIds=Object(ye.a)(window.officeType).map((function(e){return"Tab"+e.tabKey})),Se.propTypes={commandBarId:g.a.string.isRequired,visible:g.a.bool.isRequired,onImgLoad:g.a.func.isRequired};var Me=Se,Ie=(n(5197),n(4190)),Ne="PLUGIN_UPDATE_MEMBERS",Re="UPDATE_CONNECTED",Te="INVITE_LOGIN",De="LAYOUT_BLUR",Le="LAYOUT_FOCUS",Ae="POSITIONING_MEMBER",He=window.CommandBarComponent,Be=He.cmbIds.$public,We=function(e){function t(e){var n=this;a()(this,t);var i,o,r=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Be.CooperationWrap));return r.cooperationPlugin=void 0,r.onCooperationMembersPush=(i=w()(regeneratorRuntime.mark((function e(t){var i=t.members,a=t.user;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.cooperationPlugin;case 2:e.sent.messageGet({detail:{members:i,user:a},pluginEvent:Ne,pluginType:r.cooperMemberAvatarsType});case 4:case"end":return e.stop()}}),e,n)}))),function(e){return i.apply(this,arguments)}),r.onCooperationConnectPush=(o=w()(regeneratorRuntime.mark((function e(t){var i=t.connected;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.cooperationPlugin;case 2:e.sent.messageGet({detail:{connected:i},pluginEvent:Re,pluginType:r.cooperMemberAvatarsType});case 4:case"end":return e.stop()}}),e,n)}))),function(e){return o.apply(this,arguments)}),r.onCooperationPluginGet=function(e){var t=e.detail,n=e.pluginEvent,i=t.me,a=t.member;switch(n){case Te:window.session.sendBroadcast({action:"inviteLogin",from:i,to:a});break;case De:case Le:break;case Ae:r.handleAvatarClick(a)}},r.handleAvatarClick=function(e){switch(window.officeType){case f.default.spreadsheet:case f.default.ksheet:var t=window.APP.getUilCmdTool();t&&t.followCooperator(e.id);break;case f.default.writer:window.APP.data.selection.selCoop.jumpToUser(e.id);break;case f.default.presentation:window.APP.shell.doc.jumpToUser(e.id);break;case f.default.pdf:break;case f.default.outline:window.APP.OTL.uilproxy.jumpToUser(e.id)}window.collection2("cooper_avatar_location")},r.hanlePluginRef=function(e){r.refCooperMemberAvatarsPluginRef=e},r.cooperMemberAvatarsType="CooperMemberAvatars",r.CooperationPluginConfig=window.__WPSPLUGIN__.loader.search({pluginType:r.cooperMemberAvatarsType}),r}var n;return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){this.props.isAppReady&&this.CooperationPluginConfig&&(this.cooperationPlugin=this.loadCooperationPlugin())}},{key:"componentDidUpdate",value:function(e,t){!this.cooperationPlugin&&this.CooperationPluginConfig&&e.isAppReady!==this.props.isAppReady&&(this.cooperationPlugin=this.loadCooperationPlugin()),this.cooperationPlugin&&(this.props.members!==e.members&&this.onCooperationMembersPush(this.props),this.props.connected!==e.connected&&this.onCooperationConnectPush(this.props))}},{key:"loadCooperationPlugin",value:(n=w()(regeneratorRuntime.mark((function e(){var t,n,i,a,o,r,s,l,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.CooperationPluginConfig){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,window.__WPSPLUGIN__.loader.load({pluginType:this.cooperMemberAvatarsType});case 4:return t=e.sent,n=this.props,i=n.file,a=n.user,o=n.members,r=n.connected,s={file:i,user:a,members:o||[],connected:r,zIndex:1e3,isPdf:i.office_type===f.default.pdf,readOnlyComment:window.APP.isReadOnlyComment(),supportReadOnlyComment:window.APP.supportReadOnlyComment()},l=this.refCooperMemberAvatarsPluginRef,c=new t({layout:{getPluginContainer:function(){return l}},messagePush:this.onCooperationPluginGet,initParams:s}),e.next=11,c.plugin;case 11:return(u=e.sent).init&&u.init(s),e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){return!!this.props.isAppReady&&p.a.createElement(p.a.Fragment,null,this.CooperationPluginConfig?p.a.createElement("div",{id:this.cooperMemberAvatarsType+"_container",ref:this.hanlePluginRef,className:"cooperation-wrap"}):p.a.createElement(Ie.default,null))}}]),t}(He),xe=Object(h.connect)((function(e){var t=e.public;return{user:t.user,file:t.file,members:t.cooperation.members,connected:t.network.connected,isAppReady:t.network.isAppReady}}))(We),Ve=(n(4333),n(228)),je=n(185),Fe=n(701),Ue=n(191),Ge=n(192),Ke=n(5198),ze=n.n(Ke),qe=n(4334),Ye=n(583),Xe=n(261),$e=k.default.iconTypes.size16,Je=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.autoCloseTimer=null,n.refBtn=p.a.createRef(),n.refPanel=p.a.createRef(),n.refShadow=p.a.createRef(),n.refModal=p.a.createRef(),n.handleBtn=n.handleBtn.bind(n),n.handlePanelBtn=n.handlePanelBtn.bind(n),n.handleClose=n.handleClose.bind(n),n.handleShowPanel=n.handleShowPanel.bind(n),n.handleSetRefModal=n.handleSetRefModal.bind(n);var i=e.file,o=e.user,r=e.contentReadonly,s=e.isAppReady,c=o.isLogin,u=i.user_acl.update,d=Object(qe.shouldMountLoginGuide)(i,o),h=!0,f=_i18n("applications.public.components.commandbars.Header.HeaderRight.text1", "未登录情况下只能查看文档，登录使用更多功能");return c&&(f=_i18n("applications.public.components.commandbars.Header.HeaderRight.text2", "该文档为只读文档，开启编辑")),o.attrs&&"0"===o.attrs.certification&&(f=_i18n("applications.public.components.commandbars.Header.HeaderRight.text3", " 验证手机，开启文档编辑")),r&&i.user_acl.comment&&(s?window.APP.isReadOnlyComment()&&(f=_i18n("applications.public.components.commandbars.Header.HeaderRight.text4", "当前权限为可评论，开启编辑")):(n.waitToShow=!0,h=!1)),Object(Ye.isSuperPreview)()&&(n.isSuperpreview=!0,n.props.dispatch(Object(Fe.b)(!1))),n.state={isLogin:c,canEdit:u,visible:d,panelText:f,showPanel:h,isFromExternal:!1},n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){this.state.visible?(this.waitToShow||(this.startAutoClose(),this.sendCollection("show")),window.addEventListener(F.default.names.cooper.ON_SHOW_LOGIN_GUIDE,this.handleShowPanel),window.addEventListener(F.default.names.ON_EDIT,this.handleBtn)):this.props.dispatch(Object(Fe.b)(!1))}},{key:"componentWillUnmount",value:function(){window.removeEventListener(F.default.names.cooper.ON_SHOW_LOGIN_GUIDE,this.handleShowPanel),window.removeEventListener(F.default.names.ON_EDIT,this.handleBtn)}},{key:"componentDidUpdate",value:function(e){this.waitToShow&&this.props.isAppReady&&!e.isAppReady&&(this.handleShowReadOnlyComment(),this.waitToShow=!1)}},{key:"handleShowReadOnlyComment",value:function(){var e=window.APP.isReadOnlyComment()?_i18n("applications.public.components.commandbars.Header.HeaderRight.text4", "当前权限为可评论，开启编辑"):this.state.panelText;this.setState({showPanel:!0,panelText:e}),this.startAutoClose()}},{key:"handleShowPanel",value:function(e){var t=this,n=e.detail.text;this.setState({panelText:n,showPanel:!0,isFromExternal:!0},(function(){t.sendCollection("show"),t.startAutoClose()}))}},{key:"startAutoClose",value:function(){var e=this;(!this.props.file.user_acl.isLinkWrite||Xe.canRequestForAuthForSecurityDoc&&Object(Xe.isEditLimitedSecurityDoc)())&&(clearTimeout(this.autoCloseTimer),this.autoCloseTimer=setTimeout((function(){e.doClose(),e.sendCollection("autoclose")}),5e3))}},{key:"doClose",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;clearTimeout(this.autoCloseTimer);var n=this.refPanel.current||this.refModal.current,i=function(){e.setState({showPanel:!1,isAnimationOut:!1},t),e.props.dispatch(Object(Fe.b)(!1))};n&&Object(je.runOpacity)({element:n,keepEnd:!0,start:1,end:0,onDone:i}),this.refShadow.current&&Object(je.runOpacity)({element:this.refShadow.current,keepEnd:!0,start:1,end:0})}},{key:"handleBtn",value:function(){this.sendCollection("edit"),this.state.isLogin?Object(Ye.isSuperPreview)()?F.default.dispatchEvent(F.default.names.SHOW_SUPERPREVIEW_TOAST):Xe.canRequestForAuthForSecurityDoc&&Object(Xe.isEditLimitedSecurityDoc)()?Object(Xe.requestForAuth)({type:Xe.AUTH_TYPES.EDIT}):Object(Ve.gotoEdit)():Object(Ve.gotoLogin)(!1)}},{key:"handlePanelBtn",value:function(){var e=this;this.doClose((function(){e.sendCollection("click"),e.state.isLogin?Xe.canRequestForAuthForSecurityDoc&&Object(Xe.isEditLimitedSecurityDoc)()?Object(Xe.requestForAuth)({type:Xe.AUTH_TYPES.EDIT}):Object(Ve.gotoEdit)():Object(Ve.gotoLogin)(!1)}))}},{key:"handleClose",value:function(){this.doClose(),this.sendCollection("close")}},{key:"sendCollection",value:function(e){var t=this.state,n=t.isLogin,i=t.canEdit,a=t.showPanel,o=t.isFromExternal;n=n?"login":"nologin",i=i?"edit":"read";var r=a||"click"===e?"max":"min",s=this.props.file.user_acl.isLinkWrite?"modal":"banner";window.collection2("loginguid_"+r+"_"+e+"_"+n+"_"+i+"_"+o+"_"+s)}},{key:"handleSetRefModal",value:function(e){e&&(this.refModal=e.refModal,this.refShadow=e.refShadow)}},{key:"render",value:function(){if(!this.state.visible)return!1;var e=this.state,t=e.showPanel,n=e.panelText,i=this.props,a=i.file,o=i.user,r=a.user_acl.isLinkWrite&&!o.isLogin,s=o.attrs&&"0"===o.attrs.certification?_i18n("applications.public.components.commandbars.Header.HeaderRight.verify", "立即验证"):_i18n("applications.public.components.commandbars.Header.HeaderRight.edit", "编辑");return p.a.createElement(p.a.Fragment,null,t&&!r&&!this.isSuperpreview&&p.a.createElement(Ue.default,{visible:!0},p.a.createElement("div",{ref:this.refPanel,className:"login-guid-bar"},p.a.createElement("div",{className:"content"},p.a.createElement("div",{className:"text"},n),p.a.createElement(Ge.default,{isAuto:!0,className:"edit-btn",onClick:this.handlePanelBtn},o.isLogin?s:_i18n("applications.public.components.commandbars.Header.HeaderRight.loginImmediately", "立即登录")),p.a.createElement(k.default,{className:"close-btn",iconType:$e.close,onClick:this.handleClose})))),t&&r&&Object(P.default)(ze.a,{ref:this.handleSetRefModal,file:a,onClose:this.handleClose,onClick:this.handlePanelBtn}))}}]),t}(d.PureComponent),Qe=n(5199),Ze=n.n(Qe),et=n(5201),tt=n.n(et),nt=(n(5202),n(148)),it=n(377),at=n(203),ot=n(172),rt=k.default.iconTypes,st=rt.size16,lt=rt.other,ct=window.officeType===f.default.outline,ut=window.officeType===f.default.presentation,dt=window.officeType===f.default.pdf,pt=window.officeType===f.default.presentation||dt||ct,ht=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleKeyDown=function(e){(dt||ut||ct)&&Object(ee.isMatchShortCutKey)(e,[ee.Keys.Ctrl,ee.Keys.Enter])&&(F.default.dispatchEvent(F.default.names.CLOSE_MODAL_DIALOG),Object(ee.isMatchShortCutKey)(e,[ee.Keys.Shift])?(Object(W.stopBubble)(e),F.default.dispatchEvent("ON_START_PLAY",{type:"start"}),window.collection("newui","value","play_replay_title_shotcut")):(Object(W.stopBubble)(e),F.default.dispatchEvent("ON_START_PLAY",{type:"active"}),window.collection("newui","value","play_now_title_shotcut")),F.default.dispatchEvent(F.default.names.CLOSE_DROPDOWN_PANEL))},n.handleSelected=function(e){switch(e){case t.types.ACTIVE:return function(){window.collection("newui","value","play_now_title"),F.default.dispatchEvent("ON_START_PLAY",{type:e}),window.collectionOnce(),n.onVisibleChange(!1),ct&&(window.collectionOtl("header_play_current"),!n.state.visible&&window.collectionOtl("header_play"))};case t.types.START:return function(){window.collection("newui","value","play_replay_title"),F.default.dispatchEvent("ON_START_PLAY",{type:e}),window.collectionOnce(),n.onVisibleChange(!1),ct&&window.collectionOtl("header_play_first")};case t.types.AUTO:return function(){window.collection("newui","value","playbtn_autoplay"),F.default.dispatchEvent("ON_START_PLAY",{type:e}),n.onVisibleChange(!1)}}},n.btnRef=p.a.createRef(),n.onVisibleChange=n.onVisibleChange.bind(n),n.state={isEnable:!0,visible:!1,list:[{title:_i18n("applications.public.components.commandbars.Header.HeaderRight.PlayOptions.play_from_active", "从当前播放"),iconType:"play_from_active",type:t.types.ACTIVE,shortCut:Object(x.convertCtrl)("Ctrl+Enter")},{title:_i18n("applications.public.components.commandbars.Header.HeaderRight.PlayOptions.play_from_start", "从头播放"),iconType:"play_from_start",type:t.types.START,shortCut:Object(x.convertCtrl)("Ctrl+Shift+Enter")},{title:_i18n("applications.public.components.commandbars.Header.HeaderRight.PlayOptions.play_autoplay", "自动播放"),iconType:"auto_play",type:t.types.AUTO}]},n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){pt&&window.__WPSENV__.commandbars.push({el:this.btnRef.current.getElement(),text:_i18n("applications.public.components.commandbars.Header.HeaderRight.PlayOptions.play", "播放"),icon:st.highlight_play}),window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"onVisibleChange",value:function(e){this.setState({visible:e}),e&&(window.collection("newui","value","play_title"),ct&&window.collectionOtl("header_play_more"))}},{key:"renderItem",value:function(e){var n=e.iconType,i=this.props.connected,a=ut&&!i&&e.type===t.types.AUTO;if(e.type!==t.types.AUTO||ut)return p.a.createElement(ot.default,{key:e.type,onClick:this.handleSelected(e.type),disabled:a},p.a.createElement(nt.default,{type:st[n]}),p.a.createElement("span",{className:"item-name"},e.title),e.shortCut&&(ut||dt||ct)&&p.a.createElement("span",{className:"head-menuitem-shortcut"},e.shortCut))}},{key:"render",value:function(){var e=this;if(pt){var t=this.state,n=t.visible,i=t.disabled,a=t.list.map((function(t){return e.renderItem(t)})),o=_i18n("applications.public.components.commandbars.Header.HeaderRight.PlayOptions.play", "播放"),r=lt.highlight_play;return ct&&(r=lt.otl_highlight_play),dt&&(r=lt.highlight_pdf_play),(ut||dt||ct)&&(o=Object(x.convertCtrl)(_i18n("applications.public.components.commandbars.Header.HeaderRight.PlayOptions.play_shortcut", "播放(Ctrl+Enter)"))),p.a.createElement(it.default,{className:"header_play_options ",visible:n,disabled:i,iconType:r,title:o,onIconClick:this.handleSelected("active"),onVisibleChange:this.onVisibleChange,ref:this.btnRef},p.a.createElement(at.default,null,a))}return!1}}]),t}(d.PureComponent);ht.types={ACTIVE:"active",START:"start",AUTO:"auto"};var ft=ht,mt=n(219),vt=n(386),wt=n(638),bt=n(2744),gt=n(2745),yt=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e.cmbId));return n.refBtn=p.a.createRef(),n.handleClick=n.handleClick.bind(n),n}return u()(t,e),r()(t,[{key:"handleClick",value:function(){this.props.onClick(this.props.value)}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.text,i=e.disabledTag,a=e.value;return p.a.createElement(ot.default,{ref:this.refBtn,value:a,disabledTag:i,disabled:t,onClick:this.handleClick},n)}}]),t}(window.CommandBarComponent);yt.propTypes={text:g.a.string.isRequired,value:g.a.string,disabled:g.a.bool,disabledTag:g.a.bool};var _t=yt,Ct=n(456),Et=n.n(Ct),kt=at.default.Divider,Ot=window.CommandBarComponentPart,Pt=Ot.cmbIds.$public,St=Ot.cmbIds.et,Mt=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleEnterPlay=n.handleEnterPlay.bind(n),n}var n;return u()(t,e),r()(t,[{key:"handleEnterPlay",value:(n=w()(regeneratorRuntime.mark((function e(t){var n,i,a,o,r,s,l,c,u,d,p,h,f,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.collection2("history："+t),window.collectionOnce(),n=this.props,i=n.checkStatus,a=n.file,o=n.dispatch,i()){e.next=5;break}return e.abrupt("return");case 5:if(t!==wt.rangeMap.cell.value){e.next=11;break}return r=window.APP.getActiveCell(),s=window.APP.getActiveSheet().getIndex(),l={cell:r,sheetIdx:s},F.default.dispatchEvent("ET_SHOW_CELL_HISTORY",l),e.abrupt("return");case 11:return e.next=13,o(Object(vt.e)(t,a.id,"daterange",0,0,!0));case 13:if(!(c=e.sent).error){e.next=16;break}return e.abrupt("return");case 16:if(-1!==c.response.body.check_result){e.next=19;break}return window.Toast.warn(wt.rangeMap[t].msg),e.abrupt("return");case 19:if(-2!==c.response.body.check_result){e.next=22;break}return window.Toast.warn(_i18n("applications.public.components.commandbars.Header.HeaderRight.HistoryEnter.msg6", "协作记录不完整，无法标记改动单元格。")),e.abrupt("return");case 22:u=window.location,d=u.protocol,p=u.host,h=u.pathname,(f=location.search.substr(1).split("&")).push("review="+wt.rangeMap[t].value),m=d+"//"+p+h+"?"+f.join("&"),window.location.replace(m);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderItems",value:function(){var e=this,t=this.props,n=t.disabledTag,i=t.connected;return Object.values(wt.rangeMap).map((function(t,a){return p.a.createElement(ke.a,{key:a,commandBarId:t.cmbId},p.a.createElement(_t,{cmbId:t.cmbId,key:a,text:t.text,disabledTag:n,value:t.value,disabled:!i,onClick:e.handleEnterPlay}))}))}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.file,i=e.onClose,a=this.renderItems();return p.a.createElement(p.a.Fragment,null,p.a.createElement(Et.a,{commandBarId:Pt.CooperHistory}),a,p.a.createElement(Ot,{cmbId:St.HistoryVersionDivider},p.a.createElement(kt,null)),p.a.createElement(ke.a,{commandBarId:St.CooperHistory_HistoryVersion},p.a.createElement(bt.a,{file:n,user:t,onClose:i})),p.a.createElement(ke.a,{commandBarId:St.CooperHistory_HistoryRecord},p.a.createElement(gt.a,{file:n,user:t,onClose:i})))}}]),t}(d.PureComponent),It=window.CommandBarComponent.cmbIds.wps,Nt=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleOpenNewestRecord=n.handleOpenNewestRecord.bind(n),n}var n;return u()(t,e),r()(t,[{key:"handleOpenNewestRecord",value:(n=w()(regeneratorRuntime.mark((function e(){var t,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.checkStatus()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.props.dispatch(vt.i(window.urlFileId,0,1));case 4:(t=e.sent).error||(n=t.response.body.histories[0],i=this.getUrl(n.version),window.open(i),window.collection("commandbar","click","head|revision_recent"));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=window.location,n=t.protocol,i=t.hostname,a=t.pathname,o=t.port,r=t.search,s=r.substr(1).split("&").filter((function(e){return e}));s=s.filter((function(e){return!/^version=/.test(e)})),null!==e&&(s=s.filter((function(e){return-1===e.indexOf("product=")}))).push("version="+e);var l="";return l=0===o.length?n+"//"+i+a:n+"//"+i+":"+o+a,s.length&&(l+="?"+s.join("&")),l}},{key:"render",value:function(){var e=!this.props.inRestrictEditMode&&window.__CONFIG__.isShowHistory,t=this.props,n=t.onClose,i=t.file,a=t.user,o=t.disabledTag;return p.a.createElement(p.a.Fragment,null,e&&p.a.createElement(p.a.Fragment,null,p.a.createElement(_t,{cmbId:It.RightMenuHistory,disabledTag:o,onClick:this.handleOpenNewestRecord,text:_i18n("applications.public.components.commandbars.Header.HeaderRight.HistoryEnter.newest", "查看最新改动")}),p.a.createElement("div",{className:"divider-line"})),p.a.createElement(bt.a,{file:i,user:a,onClose:n}),p.a.createElement(gt.a,{file:i,user:a,onClose:n}))}}]),t}(d.PureComponent),Rt=Object(h.connect)((function(e){return{inRestrictEditMode:e.writer.pc.inRestrictEditMode}}))(Nt),Tt=function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props,t=e.user,n=e.file,i=e.onClose;return p.a.createElement(p.a.Fragment,null,p.a.createElement(bt.a,{file:n,user:t,onClose:i}),n.office_type!==f.default.pdf&&p.a.createElement(gt.a,{file:n,user:t,onClose:i}))}}]),t}(d.PureComponent),Dt=window.CommandBarComponent,Lt=Dt.cmbIds.$public,At=Dt.cmbIds.et,Ht=window.officeType!==f.default.whiteboard&&window.officeType!==f.default.dbsheet&&(window.__CONFIG__.isShowHistory||window.__CONFIG__.isShowHistoryRecord),Bt=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Lt.HeaderHistoryMenuBtn));return n.state={visible:!1},n.getAltChildIds=function(){var e=[];switch(n.props.file.office_type){case f.default.spreadsheet:case f.default.ksheet:e=[At.RightMenuHistory,At.RightMenuHistoryToady,At.RightMenuHistoryThreeDay,At.RightMenuHistorySevenDay,At.CooperHistory_HistoryVersion,At.CooperHistory_HistoryRecord];break;case f.default.writer:}return e},n.refDropDownBtn=p.a.createRef(),n.handleVisibleChange=n.handleVisibleChange.bind(n),n.handleClose=n.handleClose.bind(n),n.checkStatus=n.checkStatus.bind(n),n}return u()(t,e),r()(t,[{key:"handleVisibleChange",value:function(e){this.setState({visible:e})}},{key:"handleMouseEnter",value:function(){window.collection2("header_historyversion_hover")}},{key:"checkStatus",value:function(){this.setState({visible:!1});var e=this.props,t=e.file,n=e.user,i=e.contentReadonly;return!!e.connected&&(n.isLogin?i?(window.Toast.warn(_i18n("applications.public.components.commandbars.Header.HeaderRight.HistoryEnter.msg5", "只读文档不允许查看历史改动。")),!1):!1!==t.user_acl.history||(window.Toast.warn(_i18n("applications.public.components.commandbars.Header.HeaderRight.HistoryEnter.unableOpenHistory", "当前用户没有“查看历史改动”权限")),!1):(Object(Ve.gotoLogin)(!1),!1))}},{key:"handleClose",value:function(e){this.props.inSubMenu?F.default.dispatchEvent(F.default.names.CLOSE_DROPDOWN_PANEL):this.setState({visible:!1}),window.collection2("header_btn_"+e)}},{key:"renderItems",value:function(){var e=this.props,t=e.user,n=e.file,i=e.contentReadonly,a=e.dispatch,o=e.connected,r=!t.isLogin||i,s=void 0;switch(n.office_type){case f.default.spreadsheet:case f.default.ksheet:s=p.a.createElement(Mt,{user:t,file:n,dispatch:a,connected:o,disabledTag:r,checkStatus:this.checkStatus,onClose:this.handleClose});break;case f.default.writer:s=p.a.createElement(Rt,{user:t,file:n,connected:o,disabledTag:r,checkStatus:this.checkStatus,onClose:this.handleClose});break;default:s=p.a.createElement(Tt,{user:t,file:n,onClose:this.handleClose})}return s}},{key:"renderSubMenu",value:function(){return p.a.createElement(ke.a,{commandBarId:Lt.CooperHistory,altChildIds:this.getAltChildIds()},p.a.createElement(mt.default,{title:_i18n("applications.public.components.commandbars.Header.HeaderRight.HistoryEnter.historyRecord", "历史记录")},this.renderItems()))}},{key:"renderPanel",value:function(){return p.a.createElement(at.default,null,this.renderItems())}},{key:"render",value:function(){if(!Ht)return!1;if(this.props.inSubMenu)return this.renderSubMenu();var e=this.renderPanel(),t=this.state.visible;return p.a.createElement(E.a,{ref:this.refDropDownBtn,panel:e,visible:t,panelClass:"component-history-record-panel",onVisibleChange:this.handleVisibleChange,commandBarId:Lt.CooperHistory,altChildIds:this.getAltChildIds(),onMouseEnter:this.handleMouseEnter},p.a.createElement(k.default,{isDropdown:!0,showBorder:!0,selected:t,title:_i18n("applications.public.components.commandbars.Header.HeaderRight.HistoryEnter.historyTooltip", "文档会自动保存，可以在「历史版本」中恢复"),iconType:k.default.iconTypes.other.topbar_history}))}}]),t}(Dt);Bt.propTypes={contentReadonly:g.a.bool.isRequired,connected:g.a.bool.isRequired,file:g.a.object.isRequired,user:g.a.object.isRequired,dispatch:g.a.func.isRequired,inSubMenu:g.a.bool};var Wt=Bt,xt=n(252),Vt=n(3201),jt=function(e){function t(){var e,n,i,o,r=this;a()(this,t);for(var s=arguments.length,c=Array(s),u=0;u<s;u++)c[u]=arguments[u];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),i.handleClick=w()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(Vt.getTextChatPlugin)().then((function(e){e.onContainerClick()})),i.props.onClose(),window.collection2("koa_chat_open");case 3:case"end":return e.stop()}}),e,r)}))),o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props.connected;return p.a.createElement(ot.default,{disabled:!e,onClick:this.handleClick},p.a.createElement(nt.default,{type:xt.size16.koa_chat}),p.a.createElement("span",null,_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.text", "会话")))}}]),t}(d.PureComponent),Ft=Object(h.connect)((function(e){return{connected:e.public.network.connected}}))(jt),Ut=(n(5203),n(3202)),Gt=k.default.iconTypes,Kt=Gt.size16,zt=Gt.other,qt=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.handleClick=function(){i.props.user.isLogin?((0,i.props.onClose)(),Object(Ut.getVoiceChatPlugin)().then((function(e){e.startLaunch()}))):Object(Ve.gotoLogin)(!1)},o=n,l()(i,o)}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props,t=e.connected;return e.isInMenu?p.a.createElement(ot.default,{onClick:this.handleClick,disabled:!t},p.a.createElement(nt.default,{type:Kt.voice_telephone}),p.a.createElement("span",null,_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.voice", "语音通话"))):p.a.createElement(k.default,{title:_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.voice", "语音通话"),showBorder:!0,iconType:zt.voice_telephone,className:"voice-in-header",onClick:this.handleClick,disabled:!t})}}]),t}(d.PureComponent),Yt=Object(h.connect)((function(e){var t=e.public;return{connected:t.network.connected,isAppReady:t.network.isAppReady}}))(qt),Xt=window.__WPSPLUGIN__.helper,$t=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClick=n.handleClick.bind(n),n}var n;return u()(t,e),r()(t,[{key:"handleClick",value:(n=w()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onClose(),Xt.exec(Xt.types.Meeting),window.collection2("meeting_owner_begin_title");case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){return p.a.createElement(ot.default,{onClick:this.handleClick},p.a.createElement(nt.default,{type:nt.default.types.size16.menu_meeting}),p.a.createElement("span",null," ",_i18n("applications.public.components.commandbars.Header.HeaderRight.MeetingBtn.meetingName", "会议")))}}]),t}(d.PureComponent),Jt=window.__WPSPLUGIN__.helper,Qt=window.officeType===f.default.whiteboard,Zt=window.officeType===f.default.dbsheet,en=window.CommandBarComponent.cmbIds.$public,tn=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={visible:!1},n.handleVisibleChange=function(e){n.setState({visible:e})},n.handleClose=function(){n.props.inSubMenu?F.default.dispatchEvent(F.default.names.CLOSE_DROPDOWN_PANEL):n.setState({visible:!1})},n.getPosition=function(){var e=n.iconRef.current.getElement().getBoundingClientRect();return{left:e.left+e.width/2,top:e.bottom+10}},n.iconRef=p.a.createRef(),n.meetingEnabled=!Zt&&Jt.has(Jt.types.Meeting),n}return u()(t,e),r()(t,[{key:"renderMenuItems",value:function(){var e=this.props,t=e.connected,n=e.user;return p.a.createElement(p.a.Fragment,null,p.a.createElement(Et.a,{commandBarId:en.ChatOptions}),this.meetingEnabled&&p.a.createElement(ke.a,{commandBarId:en.MeetingBtn},p.a.createElement($t,{connected:t,isLogin:n.isLogin,onClose:this.handleClose})),Vt.textChatEnabled&&p.a.createElement(ke.a,{commandBarId:en.MeetingChat},p.a.createElement(Ft,{onClose:this.handleClose})),this.renderVoiceChat(!0))}},{key:"renderPanel",value:function(){return p.a.createElement(at.default,null,this.renderMenuItems())}},{key:"renderVoiceChat",value:function(e){return Ut.voiceChatEnabled?p.a.createElement(ke.a,{commandBarId:en.Voice},p.a.createElement(Yt,{isInMenu:e,user:this.props.user,onClose:this.handleClose})):null}},{key:"getIconInfo",value:function(){var e={};switch(e.types=k.default.iconTypes.other.meeting_launch,!0){case this.meetingEnabled:e.title=_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.meeting", "会议");break;case Vt.textChatEnabled:e.title=_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.title", "会话");break;case Ut.voiceChatEnabled:e.title=_i18n("applications.public.components.commandbars.Header.HeaderRight.ChatOptions.voice", "语音通话")}return e}},{key:"getIcon",value:function(){var e=this.state.visible,t=this.getIconInfo(),n=t.title,i=t.types;return p.a.createElement(k.default,{ref:this.iconRef,isDropdown:!0,showBorder:!0,selected:e,title:n,iconType:i})}},{key:"render",value:function(){var e=this.state.visible,t=this.props.inSubMenu;if(!Vt.textChatEnabled&&!Ut.voiceChatEnabled&&!this.meetingEnabled)return!1;if(t){var n=this.getIconInfo().title;return p.a.createElement(ke.a,{commandBarId:en.ChatOptions,altChildIds:[en.MeetingBtn,en.MeetingChat,en.Voice]},p.a.createElement(mt.default,{title:n,ref:this.iconRef},this.renderMenuItems()))}return p.a.createElement(d.Fragment,null,Qt&&this.renderVoiceChat(!1),p.a.createElement(E.a,{panel:this.renderPanel(),visible:e,panelClass:"component-chat-options-panel",onVisibleChange:this.handleVisibleChange,commandBarId:en.ChatOptions,altChildIds:[en.MeetingBtn,en.MeetingChat,en.Voice]},this.getIcon()))}}]),t}(d.PureComponent),nn=Object(h.connect)((function(e){return{isAppReady:e.public.network.isAppReady}}))(tn),an=window.__WPSPLUGIN__.helper,on=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClick=function(){n.props.inSubMenu&&F.default.dispatchEvent(F.default.names.CLOSE_DROPDOWN_PANEL),an.exec(an.types.Report)},n.reportVisible=an.has(an.types.Report),n}return u()(t,e),r()(t,[{key:"render",value:function(){return!!this.reportVisible&&(this.props.inSubMenu?p.a.createElement(ot.default,{onClick:this.handleClick},_i18n("applications.public.components.commandbars.Header.report", "举报")):p.a.createElement(Ge.default,{className:"component-report-btn",onClick:this.handleClick},_i18n("applications.public.components.commandbars.Header.report", "举报")))}}]),t}(d.PureComponent),rn=n(5204),sn=n.n(rn),ln=(n(5206),function(e){function t(){a()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setPanelVisibility=function(){e.props.user.isLogin?(e.props.inSubMenu&&F.default.dispatchEvent(F.default.names.CLOSE_DROPDOWN_PANEL),F.default.dispatchEvent("otl-msg-btn-click")):Object(Ve.gotoLogin)(!1)},e.buttonRef=Object(d.createRef)(),e}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){window.__WPSENV__.commandbars.push([{el:this.buttonRef,text:_i18n("applications.public.components.commandbars.Header.HeaderRight.MessagePanelButton.message", "动态")}])}},{key:"render",value:function(){return this.props.inSubMenu?p.a.createElement(ot.default,{ref:this.buttonRef,onClick:this.setPanelVisibility},_i18n("applications.public.components.commandbars.Header.HeaderRight.MessagePanelButton.message", "动态")):p.a.createElement(k.default,{ref:this.buttonRef,title:_i18n("applications.public.components.commandbars.Header.HeaderRight.MessagePanelButton.message", "动态"),showBorder:!0,iconType:"",className:"otl-msg-btn",onClick:this.setPanelVisibility})}}]),t}(d.PureComponent)),cn=n(5207),un=n.n(cn),dn=n(5209),pn=n.n(dn),hn=n(5213),fn=n.n(hn),mn=(n(5215),window.CommandBarComponent),vn=mn.cmbIds.$public,wn=function(e){function t(e){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,vn.HeaderRightInsert))}return u()(t,e),r()(t,[{key:"render",value:function(){return p.a.createElement("div",{className:"header-right-insert"})}}]),t}(mn),bn=n(4336),gn=n(4337),yn=n(283),_n=E.a.placementTypes,Cn=at.default.Divider,En=k.default.iconTypes,kn=window.CommandBarComponent,On=kn.cmbIds.$public,Pn=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,On.HeaderRight));return n.handleVisibleChange=function(e){n.setState({visible:e})},n.atInboxRef=p.a.createRef(),n.containerRef=p.a.createRef(),n.state={visible:!1},n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){this.props.isAppReady&&this.initPluginsAfterReady()}},{key:"componentDidUpdate",value:function(e){!e.isAppReady&&this.props.isAppReady&&this.initPluginsAfterReady();var t=this.props.isNarrowMode;t!==e.isNarrowMode&&(t?window.__WPSENV__.reduxDispatch(Object(yn.altAppend)({id:On.HeaderRight,child:[On.ShareLink,On.R_MoreMenus].reverse()})):window.__WPSENV__.reduxDispatch(Object(yn.altAppend)({id:On.HeaderRight,child:[On.DraftBtn,On.ShareLink,On.EditEntry,On.WPSOpenBtn,On.At,On.WOAChat,On.CooperHistory,On.PlayOptions,On.ChatOptions,On.ReportBtn].reverse()})))}},{key:"initPluginsAfterReady",value:function(){Object(Vt.initTextChatPlugin)(this.containerRef.current),Object(Ut.initVoiceChatPlugin)(this.containerRef.current),Object(bn.initWOAChatPlugin)(),Object(gn.initAtMessageBtnPlugin)(this.atInboxRef.current)}},{key:"getDraft",value:function(){if(!window.__WPSENV__.draft)return null;var e=this.props,t=e.isAppReady,n=e.file,i=e.dispatch,a=e.isNarrowMode;return p.a.createElement(p.a.Fragment,null,a&&p.a.createElement(Cn,{className:"component-draft-divider"}),p.a.createElement(ke.a,{commandBarId:On.DraftBtn},p.a.createElement(pn.a,{file:n,dispatch:i,isAppReady:t,inSubMenu:a})))}},{key:"getShareLink",value:function(){var e=this.props,t=e.isAppReady,n=e.file,i=e.user,a=e.isNarrowMode;return p.a.createElement(ke.a,{commandBarId:On.ShareLink},p.a.createElement(Ze.a,{user:i,file:n,isAppReady:t,inSubMenu:a}))}},{key:"getWPSOpen",value:function(){var e=this.props,t=e.isAppReady,n=e.openSuccess,i=e.user,a=e.isNarrowMode;return p.a.createElement(ke.a,{commandBarId:On.WPSOpenBtn,noRef:!0},p.a.createElement(sn.a,{user:i,isAppReady:t,openSuccess:n,inSubMenu:a}))}},{key:"getEdit",value:function(){var e=this.props,t=e.file,n=e.openSuccess,i=e.isNarrowMode,a=e.user;return t&&t.id&&n?p.a.createElement(ke.a,{commandBarId:On.EditEntry,noRef:!0},p.a.createElement(tt.a,{inSubMenu:i,file:t,user:a})):null}},{key:"getOTLChat",value:function(){if(window.officeType!==f.default.outline)return null;var e=this.props,t=e.user,n=e.isNarrowMode;return bn.WOAChatPluginEnabled?p.a.createElement(ke.a,{commandBarId:On.WOAChat},p.a.createElement(un.a,{inSubMenu:n})):window.__CONFIG__.outline.enableMessagePanel?p.a.createElement(ke.a,{commandBarId:On.WOAChat},p.a.createElement(ln,{user:t,inSubMenu:n})):null}},{key:"getCooperHistory",value:function(){if(window.officeType===f.default.whiteboard||window.__WPSENV__.draft)return null;var e=this.props,t=e.file,n=e.user,i=e.dispatch,a=e.contentReadonly,o=e.connected,r=e.isNarrowMode;return p.a.createElement(ke.a,{commandBarId:On.CooperHistory},p.a.createElement(Wt,{file:t,user:n,dispatch:i,contentReadonly:a,connected:o,inSubMenu:r}))}},{key:"getPlayOptions",value:function(){return p.a.createElement(ke.a,{commandBarId:On.PlayOptions},p.a.createElement(ft,{connected:this.props.connected}))}},{key:"getChatOptions",value:function(){var e=this.props,t=e.user,n=e.connected,i=e.isNarrowMode;return p.a.createElement(nn,{user:t,connected:n,inSubMenu:i})}},{key:"getReport",value:function(){return p.a.createElement(ke.a,{commandBarId:On.ReportBtn},p.a.createElement(on,{inSubMenu:this.props.isNarrowMode}))}},{key:"getCooperation",value:function(){return!!this.props.user.id&&p.a.createElement(xe,null)}},{key:"getLoginGuide",value:function(){var e=this.props,t=e.file,n=e.openSuccess,i=e.dispatch,a=e.user,o=e.contentReadonly,r=e.isAppReady;return!!t.id&&n&&p.a.createElement(Je,{dispatch:i,user:a,file:t,contentReadonly:o,isAppReady:r})}},{key:"getAtInBox",value:function(){var e=this.props,t=e.isNarrowMode,n=e.user;return p.a.createElement(fn.a,{inSubMenu:t,user:n,ref:this.atInboxRef})}},{key:"renderNormalLayout",value:function(){return p.a.createElement(p.a.Fragment,null,this.getDraft(),this.getShareLink(),this.getEdit(),this.getWPSOpen(),this.getAtInBox(),this.getOTLChat(),this.getCooperHistory(),this.getPlayOptions(),this.getChatOptions(),this.getReport())}},{key:"renderNarrowLayout",value:function(){var e=this.getMoreMenuPanel(),t=this.state.visible;return p.a.createElement(p.a.Fragment,null,this.getShareLink(),p.a.createElement(E.a,{panel:e,visible:t,destroyOnHide:!1,onVisibleChange:this.handleVisibleChange,placement:_n.bottomRight,altChildIds:[On.ReportBtn,On.At,On.ChatOptions,On.CooperHistory,On.WPSOpenBtn,On.EditEntry,On.WOAChat,On.DraftBtn],commandBarId:On.R_MoreMenus},p.a.createElement(k.default,{className:"component-icon-more_horiz",isDropdown:!0,showBorder:!0,title:_i18n("applications.public.components.commandbars.Header.HeaderRight.more", "更多"),iconType:En.size16.more_horiz,selected:t})),this.getPlayOptions())}},{key:"getMoreMenuPanel",value:function(){return p.a.createElement(at.default,{className:"component-more-menu-panel"},p.a.createElement(Et.a,{commandBarId:On.R_MoreMenus}),this.getReport(),this.getAtInBox(),this.getChatOptions(),this.getCooperHistory(),this.getEdit(),this.getOTLChat(),this.getWPSOpen(),this.getDraft())}},{key:"render",value:function(){var e=this.props,t=e.style,n=e.isNarrowMode;return p.a.createElement("div",{className:"component-header-right",style:t,ref:this.containerRef},this.getLoginGuide(),n?this.renderNarrowLayout():this.renderNormalLayout(),p.a.createElement(wn,null),this.getCooperation())}},{key:"__visible",set:function(e){this.baseVisible=e,this.findDOMNode().style.visibility=e?"":"hidden"},get:function(){return this.baseVisible}}]),t}(kn);Pn.propTypes={style:g.a.object.isRequired,contentReadonly:g.a.bool.isRequired,isNarrowMode:g.a.bool};var Sn=Object(h.connect)((function(e){var t=e.public;return{user:t.user,file:t.file,openSuccess:t.network.openSuccess,connected:t.network.connected,isAppReady:t.network.isAppReady}}),null,null,{forwardRef:!0})(Pn),Mn=n(3203),In=n(5216),Nn=n.n(In),Rn=n(805),Tn=n(1302),Dn=n(1937),Ln=n(464),An=n(5218),Hn=n.n(An),Bn=n(5219),Wn=n.n(Bn),xn=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={visible:!1,versionInfo:null,redPoints:[],funcGuides:[],specialFileSaveAs:!1},n.handleClose=n.handleClose.bind(n),n.handleCloseSaveAs=n.handleCloseSaveAs.bind(n),n}var n;return u()(t,e),r()(t,[{key:"componentDidMount",value:(n=w()(regeneratorRuntime.mark((function e(){var t,n,i,a,o,r,s,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkLanguage()){e.next=2;break}return e.abrupt("return");case 2:if(t=this.props.file,n=t.ext.toLowerCase(),!t.user_acl.update||".csv"!==n&&".rtf"!==n){e.next=7;break}return this.setState({specialFileSaveAs:!0,visible:!0}),e.abrupt("return");case 7:if(window.__CONFIG__.isShowUpdateNotice){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.props.dispatch(Object(Ln.c)(window.officeType));case 11:if(!(i=e.sent).error){e.next=14;break}return e.abrupt("return");case 14:a=i.response.body,o=a.red_point_tips,r=a.guide_tips,s=a.version,o=o||[],r=r||[],l=this.filterRedPoints(o),c=this.filterFuncGuide(r,s),(l.length>0||c.length>0||s)&&this.setState({visible:!0,funcGuides:c,redPoints:l,versionInfo:s});case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkLanguage",value:function(){if(window.__CONFIG__.product!==Rn.default.dingtalk)return!0;var e=Object(m.getQuery)("lang");if(e&&e!==window.langName){var t="lang_mismatching_"+e;if(!localStorage.getItem(t))return window.Toast.warn(window.__CONFIG__.checkLanguageToastMap[e]||window.__CONFIG__.checkLanguageToastMap["en-US"]),localStorage.setItem(t,"1"),!1}return!0}},{key:"filterRedPoints",value:function(e){var t=Object.values(Dn.a.pc);return e.filter((function(e){return!!t.includes(e.name)||(console.error("不支持的红点："+e.name),!1)}))}},{key:"filterFuncGuide",value:function(e,t){var n=Object.values(Tn.a.pc);return e=e.filter((function(e){return!!n.includes(e.name)||(console.error("不支持的功能引导："+e.name),!1)})),t?[]:e}},{key:"handleClose",value:function(){this.setState({visible:!1})}},{key:"handleCloseSaveAs",value:function(){this.setState({specialFileSaveAs:!1,visible:!1})}},{key:"render",value:function(){var e=this.props,t=e.dispatch,n=e.file,i=this.state,a=i.visible,o=i.funcGuides,r=i.redPoints,s=i.versionInfo,l=i.specialFileSaveAs;return!!a&&(l?Object(P.default)(Wn.a,{file:n,onClose:this.handleCloseSaveAs}):Object(P.default)(Hn.a,{dispatch:t,funcGuides:o,redPoints:r,versionInfo:s,onClose:this.handleClose}))}}]),t}(d.PureComponent),Vn=n(5220),jn=n.n(Vn),Fn=function(e){function t(){return a()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),r()(t,[{key:"render",value:function(){var e=this.props,t=e.dispatch,n=e.isAppReady,i=e.contentReadonly,a=e.connected,o=e.file;if(!n)return!1;var r=i||!o.user_acl.update;return p.a.createElement(p.a.Fragment,null,!r&&p.a.createElement(Mn.default,{dispatch:t,connected:a}),!o.user_acl.isDefault&&window.officeType!==f.default.outline&&p.a.createElement(xn,{dispatch:t,file:o}),x.isPad&&x.isInWeixin&&p.a.createElement(jn.a,null),p.a.createElement(Nn.a,null))}}]),t}(d.PureComponent),Un=Object(h.connect)((function(e){var t=e.public;return{file:t.file,isAppReady:t.network.isAppReady,connected:t.network.connected}}))(Fn),Gn=n(156),Kn=window.CommandBarComponent.cmbIds.$public,zn=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.adjustUI=function(){if(n.refMiddle.current){var e=n.refMiddle.current.getWidth(),t=e-n.refDiv.current.getBoundingClientRect().width;if(Math.abs(t)<3)setTimeout(n.adjustUI,1e3);else{var i="calc(50% - "+e/2+"px)";n.state.style&&n.state.style.width===i||n.setState({style:{width:i},showMiddle:!0})}}},n.handleResize=Object(Gn.throttle)((function(){n.updateNarrowMode()}),100),n.refDiv=p.a.createRef(),n.refMiddle=p.a.createRef(),n._MiddleAltRef=p.a.createRef(),n.narrowHadRight=[Kn.ShareLink,Kn.R_MoreMenus].reverse(),n.normalHadRight=[Kn.DraftBtn,Kn.ShareLink,Kn.EditEntry,Kn.WPSOpenBtn,Kn.At,Kn.WOAChat,Kn.CooperHistory,Kn.PlayOptions,Kn.ChatOptions,Kn.ReportBtn].reverse(),n.state={contentReadonly:!1,style:{width:"50%"},isHistoryPlay:Object(m.hasQuery)("review"),showMiddle:!1,isNarrowMode:!1,showRight:!1},n}return u()(t,e),r()(t,[{key:"componentDidMount",value:function(){this.props.openSuccess&&this.setContentReadonly(),this.adjustUI(),this.updateNarrowMode(),window.addEventListener("resize",this.handleResize),window._MiddleAltRef=this._MiddleAltRef}},{key:"componentDidUpdate",value:function(e,t){this.props.openSuccess&&!e.openSuccess&&this.setContentReadonly(),this.props.file.user_acl.update&&!e.file.user_acl.update&&(this.adjustUI(),this.updateNarrowMode())}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),ke.a.clear()}},{key:"setContentReadonly",value:function(){var e=window.APP.isReadOnly();this.setState({contentReadonly:e})}},{key:"updateNarrowMode",value:function(){if(this.refDiv.current){var e=[{types:[f.default.presentation,f.default.spreadsheet,f.default.ksheet,f.default.pdf,f.default.writer],thresholdWidth:1110},{types:[f.default.whiteboard,f.default.outline],thresholdWidth:735}],t=this.refDiv.current.offsetWidth,n=(e.filter((function(e){return e.types.indexOf(window.officeType)>-1}))[0]||{}).thresholdWidth,i=!!n&&t<=n;0===t&&(i=this.state.isNarrowMode),this.setState({isNarrowMode:i,showRight:!0})}}},{key:"render",value:function(){var e=this.props,t=e.file,n=e.isAppReady,i=this.state,a=i.style,o=i.showMiddle,r=i.contentReadonly,s=i.isHistoryPlay,l=i.isNarrowMode,c=i.showRight,u=window.officeType,d=u===f.default.outline||u===f.default.dbsheet||u===f.default.whiteboard,h=p.a.classNames({"component-header":1,"file-opening":!n,disabled:s,"white-bg":d});return p.a.createElement(p.a.Fragment,null,p.a.createElement("div",{className:h,ref:this.refDiv,onClick:W.stopBubble},p.a.createElement(ke.a,{commandBarId:Kn.HeaderLeft,altChildIds:[Kn.MoreMenus]},p.a.createElement(ge,{whiteBg:d,style:a,contentReadonly:r})),p.a.createElement(Ee.AltFragmentFRef,{commandBarId:Kn.HeaderMiddle,ref:this.refMiddle},p.a.createElement(Me,{visible:o,onImgLoad:this.adjustUI,commandBarId:Kn.HeaderMiddle})),!t.user_acl.isDefault&&c&&p.a.createElement(ke.a,{commandBarId:Kn.HeaderRight,altChildIds:l?this.narrowHadRight:this.normalHadRight},p.a.createElement(Sn,{style:a,contentReadonly:r,isNarrowMode:l}))),p.a.createElement(Un,{contentReadonly:r}))}}]),t}(d.PureComponent);zn.altChildIds=[Kn.HeaderLeft,Kn.HeaderMiddle,Kn.HeaderRight];t.default=Object(h.connect)((function(e){var t=e.public;return{file:t.file,openSuccess:t.network.openSuccess,isAppReady:t.network.isAppReady}}))(zn)},817:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(143),a=(0,i.__importDefault)(n(142)),o=(0,i.__importDefault)(n(251)),r=(0,i.__importDefault)(n(377)),s=(0,i.__importDefault)(n(166)),l=(0,i.__importDefault)(n(456)),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.commandBarId,n=e.children,s=e.altChildIds,c=a.default.createElement(l.default,{commandBarId:t},a.default.cloneElement(n,{ref:this.refPanel}));return a.default.createElement(o.default,{commandBarId:t,ref:this.refAlt,altChildIds:s,iNotI:!0},a.default.createElement(r.default,(0,i.__assign)({},this.props,{onVisibleChange:this.onVisibleChange}),c))},t.propTypes=(0,i.__assign)({},r.default.propTypes),t.iconTypes=(0,i.__assign)({},r.default.iconTypes),t.DropdownPanel=s.default.DropdownPanel,t}((0,i.__importDefault)(n(768)).default);t.default=c}}]);